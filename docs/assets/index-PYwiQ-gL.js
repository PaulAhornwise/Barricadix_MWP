(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let an,un;function cn(){return{geminiUrl:an,vertexUrl:un}}function dn(o,t,e){var n,i,l;if(!(!((n=o.httpOptions)===null||n===void 0)&&n.baseUrl)){const a=cn();return o.vertexai?(i=a.vertexUrl)!==null&&i!==void 0?i:t:(l=a.geminiUrl)!==null&&l!==void 0?l:e}return o.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class oe{}function M(o,t){const e=/\{([^}]+)\}/g;return o.replace(e,(n,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){const l=t[i];return l!=null?String(l):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function s(o,t,e){for(let l=0;l<t.length-1;l++){const a=t[l];if(a.endsWith("[]")){const c=a.slice(0,-2);if(!(c in o))if(Array.isArray(e))o[c]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(o[c])){const d=o[c];if(Array.isArray(e))for(let u=0;u<d.length;u++){const f=d[u];s(f,t.slice(l+1),e[u])}else for(const u of d)s(u,t.slice(l+1),e)}return}else if(a.endsWith("[0]")){const c=a.slice(0,-3);c in o||(o[c]=[{}]);const d=o[c];s(d[0],t.slice(l+1),e);return}(!o[a]||typeof o[a]!="object")&&(o[a]={}),o=o[a]}const n=t[t.length-1],i=o[n];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else o[n]=e}function r(o,t){try{if(t.length===1&&t[0]==="_self")return o;for(let e=0;e<t.length;e++){if(typeof o!="object"||o===null)return;const n=t[e];if(n.endsWith("[]")){const i=n.slice(0,-2);if(i in o){const l=o[i];return Array.isArray(l)?l.map(a=>r(a,t.slice(e+1))):void 0}else return}else o=o[n]}return o}catch(e){if(e instanceof TypeError)return;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function V(o,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Gt(o,t){const e=V(o,t);return e?e.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:e.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${e}`:e:""}function Bt(o,t){return Array.isArray(t)?t.map(e=>fe(o,e)):[fe(o,t)]}function fe(o,t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function fn(o,t){const e=fe(o,t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function pn(o,t){const e=fe(o,t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Fe(o,t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Ht(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Fe(o,e)):[Fe(o,t)]}function _e(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function Ve(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function Ue(o){return o!=null&&typeof o=="object"&&"functionResponse"in o}function H(o,t){if(t==null)throw new Error("ContentUnion is required");return _e(t)?t:{role:"user",parts:Ht(o,t)}}function $t(o,t){if(!t)return[];if(o.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const n=H(o,e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(o.isVertexAI()){const e=H(o,t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>H(o,e)):[H(o,t)]}function z(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Ve(t)||Ue(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[H(o,t)]}const e=[],n=[],i=_e(t[0]);for(const l of t){const a=_e(l);if(a!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)e.push(l);else{if(Ve(l)||Ue(l))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(l)}}return i||e.push({role:"user",parts:Ht(o,n)}),e}function Jt(o,t){return t}function Yt(o,t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Te(o,t){return t}function Ce(o,t){if(!Array.isArray(t))throw new Error("tool is required and must be an array of Tools");return t}function mn(o,t,e,n=1){const i=!t.startsWith(`${e}/`)&&t.split("/").length===n;return o.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${o.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function O(o,t){if(typeof t!="string")throw new Error("name must be a string");return mn(o,t,"cachedContents")}function Wt(o,t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function X(o,t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function bt(o,t){if(typeof t!="string")throw new Error("fromName must be a string");return t.startsWith("files/")?t.split("files/")[1]:t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hn(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const a=r(t,["fileData"]);a!=null&&s(e,["fileData"],a);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const d=r(t,["functionResponse"]);d!=null&&s(e,["functionResponse"],d);const u=r(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function ke(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>hn(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function gn(){return{}}function yn(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Tn(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],yn(o,n)),e}function Cn(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],gn());const i=r(t,["googleSearchRetrieval"]);i!=null&&s(e,["googleSearchRetrieval"],Tn(o,i));const l=r(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const a=r(t,["functionDeclarations"]);return a!=null&&s(e,["functionDeclarations"],a),e}function vn(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function En(o,t){const e={},n=r(t,["functionCallingConfig"]);return n!=null&&s(e,["functionCallingConfig"],vn(o,n)),e}function Sn(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(t,["expireTime"]);e!==void 0&&l!=null&&s(e,["expireTime"],l);const a=r(t,["displayName"]);e!==void 0&&a!=null&&s(e,["displayName"],a);const c=r(t,["contents"]);if(e!==void 0&&c!=null){let p=z(o,c);Array.isArray(p)&&(p=p.map(m=>ke(o,m))),s(e,["contents"],p)}const d=r(t,["systemInstruction"]);e!==void 0&&d!=null&&s(e,["systemInstruction"],ke(o,H(o,d)));const u=r(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>Cn(o,m))),s(e,["tools"],p)}const f=r(t,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],En(o,f)),n}function _n(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["model"],Gt(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],Sn(o,i,e)),e}function In(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],O(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function An(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],O(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Mn(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(t,["expireTime"]);return e!==void 0&&l!=null&&s(e,["expireTime"],l),n}function Pn(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],O(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],Mn(o,i,e)),e}function Rn(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),n}function wn(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],Rn(o,n,e)),e}function xn(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function qe(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>xn(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Dn(){return{}}function Nn(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Ln(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],Nn(o,n)),e}function Fn(o,t){const e={},n=r(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Dn());const l=r(t,["googleSearchRetrieval"]);l!=null&&s(e,["googleSearchRetrieval"],Ln(o,l));const a=r(t,["codeExecution"]);a!=null&&s(e,["codeExecution"],a);const c=r(t,["functionDeclarations"]);return c!=null&&s(e,["functionDeclarations"],c),e}function Vn(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Un(o,t){const e={},n=r(t,["functionCallingConfig"]);return n!=null&&s(e,["functionCallingConfig"],Vn(o,n)),e}function kn(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(t,["expireTime"]);e!==void 0&&l!=null&&s(e,["expireTime"],l);const a=r(t,["displayName"]);e!==void 0&&a!=null&&s(e,["displayName"],a);const c=r(t,["contents"]);if(e!==void 0&&c!=null){let p=z(o,c);Array.isArray(p)&&(p=p.map(m=>qe(o,m))),s(e,["contents"],p)}const d=r(t,["systemInstruction"]);e!==void 0&&d!=null&&s(e,["systemInstruction"],qe(o,H(o,d)));const u=r(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>Fn(o,m))),s(e,["tools"],p)}const f=r(t,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],Un(o,f)),n}function qn(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["model"],Gt(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],kn(o,i,e)),e}function Gn(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],O(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Bn(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],O(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Hn(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(t,["expireTime"]);return e!==void 0&&l!=null&&s(e,["expireTime"],l),n}function $n(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],O(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],Hn(o,i,e)),e}function Jn(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),n}function Yn(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],Jn(o,n,e)),e}function ue(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["model"]);l!=null&&s(e,["model"],l);const a=r(t,["createTime"]);a!=null&&s(e,["createTime"],a);const c=r(t,["updateTime"]);c!=null&&s(e,["updateTime"],c);const d=r(t,["expireTime"]);d!=null&&s(e,["expireTime"],d);const u=r(t,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function Wn(){return{}}function bn(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>ue(o,a))),s(e,["cachedContents"],l)}return e}function ce(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["model"]);l!=null&&s(e,["model"],l);const a=r(t,["createTime"]);a!=null&&s(e,["createTime"],a);const c=r(t,["updateTime"]);c!=null&&s(e,["updateTime"],c);const d=r(t,["expireTime"]);d!=null&&s(e,["expireTime"],d);const u=r(t,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function Kn(){return{}}function zn(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>ce(o,a))),s(e,["cachedContents"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ne;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(ne||(ne={}));class xe{constructor(t,e,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,i)}init(t,e,n){var i,l;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.idxInternal=0;let a={config:{}};n?typeof n=="object"?a=Object.assign({},n):a=n:a={config:{}},a.config&&(a.config.pageToken=e.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(l=(i=a.config)===null||i===void 0?void 0:i.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ge;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Ge||(Ge={}));var Be;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(Be||(Be={}));var He;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(He||(He={}));var $e;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})($e||($e={}));var Je;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(Je||(Je={}));var Ye;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(Ye||(Ye={}));var W;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})(W||(W={}));var We;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.LANGUAGE="LANGUAGE",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.IMAGE_SAFETY="IMAGE_SAFETY"})(We||(We={}));var be;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(be||(be={}));var Ke;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Ke||(Ke={}));var ze;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(ze||(ze={}));var Oe;(function(o){o.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",o.ON_DEMAND="ON_DEMAND",o.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Oe||(Oe={}));var pe;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(pe||(pe={}));var Xe;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Xe||(Xe={}));var Ie;(function(o){o.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",o.JOB_STATE_QUEUED="JOB_STATE_QUEUED",o.JOB_STATE_PENDING="JOB_STATE_PENDING",o.JOB_STATE_RUNNING="JOB_STATE_RUNNING",o.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",o.JOB_STATE_FAILED="JOB_STATE_FAILED",o.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",o.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",o.JOB_STATE_PAUSED="JOB_STATE_PAUSED",o.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",o.JOB_STATE_UPDATING="JOB_STATE_UPDATING",o.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Ie||(Ie={}));var Ze;(function(o){o.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",o.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",o.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",o.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",o.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",o.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",o.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Ze||(Ze={}));var Qe;(function(o){o.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",o.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",o.BALANCED="BALANCED",o.PRIORITIZE_COST="PRIORITIZE_COST"})(Qe||(Qe={}));var je;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(je||(je={}));var et;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(et||(et={}));var tt;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})(tt||(tt={}));var nt;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(nt||(nt={}));var ot;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(ot||(ot={}));var it;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(it||(it={}));var rt;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(rt||(rt={}));var st;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(st||(st={}));var lt;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(lt||(lt={}));var at;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(at||(at={}));var ut;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.VIDEO="VIDEO",o.AUDIO="AUDIO",o.DOCUMENT="DOCUMENT"})(ut||(ut={}));var ct;(function(o){o.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",o.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",o.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(ct||(ct={}));var dt;(function(o){o.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",o.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",o.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(dt||(dt={}));var ft;(function(o){o.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",o.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",o.NO_INTERRUPTION="NO_INTERRUPTION"})(ft||(ft={}));var pt;(function(o){o.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",o.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",o.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(pt||(pt={}));class ie{get text(){var t,e,n,i,l,a,c,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",f=!1;const p=[];for(const m of(d=(c=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)!==null&&d!==void 0?d:[]){for(const[g,h]of Object.entries(m))g!=="text"&&g!=="thought"&&(h!==null||h!==void 0)&&p.push(g);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;f=!0,u+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?u:void 0}get data(){var t,e,n,i,l,a,c,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const f=[];for(const p of(d=(c=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)!==null&&d!==void 0?d:[]){for(const[m,g]of Object.entries(p))m!=="inlineData"&&(g!==null||g!==void 0)&&f.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(u+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var t,e,n,i,l,a,c,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(d=(c=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var t,e,n,i,l,a,c,d,u;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(c=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var t,e,n,i,l,a,c,d,u;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(c=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.output}}class mt{}class ht{}class gt{}class yt{}class On{}class Tt{}class Ct{}class vt{}class Xn{}class Ae{constructor(t){const e={};for(const n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class Zn{}class Qn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class jn extends oe{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new xe(ne.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=qn(this.apiClient,t);return c=M("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>ce(this.apiClient,f))}else{const u=_n(this.apiClient,t);return c=M("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ue(this.apiClient,f))}}async get(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=Gn(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>ce(this.apiClient,f))}else{const u=In(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ue(this.apiClient,f))}}async delete(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=Bn(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(()=>{const f=Kn(),p=new Ct;return Object.assign(p,f),p})}else{const u=An(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(()=>{const f=Wn(),p=new Ct;return Object.assign(p,f),p})}}async update(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=$n(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>ce(this.apiClient,f))}else{const u=Pn(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ue(this.apiClient,f))}}async listInternal(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=Yn(this.apiClient,t);return c=M("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=zn(this.apiClient,f),m=new vt;return Object.assign(m,p),m})}else{const u=wn(this.apiClient,t);return c=M("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=bn(this.apiClient,f),m=new vt;return Object.assign(m,p),m})}}}function Et(o){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&o[t],n=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function G(o){return this instanceof G?(this.v=o,this):new G(o)}function me(o,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(o,t||[]),i,l=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(g){return function(h){return Promise.resolve(h).then(g,p)}}function c(g,h){n[g]&&(i[g]=function(T){return new Promise(function(v,S){l.push([g,T,v,S])>1||d(g,T)})},h&&(i[g]=h(i[g])))}function d(g,h){try{u(n[g](h))}catch(T){m(l[0][3],T)}}function u(g){g.value instanceof G?Promise.resolve(g.value.v).then(f,p):m(l[0][2],g)}function f(g){d("next",g)}function p(g){d("throw",g)}function m(g,h){g(h),l.shift(),l.length&&d(l[0][0],l[0][1])}}function Me(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],e;return t?t.call(o):(o=typeof Et=="function"?Et(o):o[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(l){e[l]=o[l]&&function(a){return new Promise(function(c,d){a=o[l](a),i(c,d,a.done,a.value)})}}function i(l,a,c,d){Promise.resolve(d).then(function(u){l({value:u,done:c})},a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eo(o){var t;if(o.candidates==null||o.candidates.length===0)return!1;const e=(t=o.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:Kt(e)}function Kt(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const t of o.parts)if(t===void 0||Object.keys(t).length===0||t.text!==void 0&&t.text==="")return!1;return!0}function to(o){if(o.length!==0){if(o[0].role!=="user")throw new Error("History must start with a user turn.");for(const t of o)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function no(o){if(o===void 0||o.length===0)return[];const t=[],e=o.length;let n=0,i=o[0];for(;n<e;)if(o[n].role==="user")i=o[n],n++;else{const l=[];let a=!0;for(;n<e&&o[n].role==="model";)l.push(o[n]),a&&!Kt(o[n])&&(a=!1),n++;a&&(t.push(i),t.push(...l))}return t}class oo{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new io(this.apiClient,this.modelsModule,t.model,t.config,t.history)}}class io{constructor(t,e,n,i={},l=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),to(l)}async sendMessage(t){var e;await this.sendPromise;const n=H(this.apiClient,t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var l,a;const d=(a=(l=(await i).candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content,u=d?[d]:[];this.recordHistory(n,u)})(),await this.sendPromise,i}async sendMessageStream(t){var e;await this.sendPromise;const n=H(this.apiClient,t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const l=await i;return this.processStreamResponse(l,n)}getHistory(t=!1){return t?no(this.history):this.history}processStreamResponse(t,e){var n,i;return me(this,arguments,function*(){var a,c,d,u;const f=[];try{for(var p=!0,m=Me(t),g;g=yield G(m.next()),a=g.done,!a;p=!0){u=g.value,p=!1;const h=u;if(eo(h)){const T=(i=(n=h.candidates)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.content;T!==void 0&&f.push(T)}yield yield G(h)}}catch(h){c={error:h}}finally{try{!p&&!a&&(d=m.return)&&(yield G(d.call(m)))}finally{if(c)throw c.error}}this.recordHistory(e,f)})}recordHistory(t,e){let n=[];e.length>0&&e.every(i=>i.role==="model")?n=e:n.push({role:"model",parts:[]}),this.history.push(t),this.history.push(...n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ro(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),n}function so(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],ro(o,n,e)),e}function lo(o,t){const e={},n=r(t,["details"]);n!=null&&s(e,["details"],n);const i=r(t,["message"]);i!=null&&s(e,["message"],i);const l=r(t,["code"]);return l!=null&&s(e,["code"],l),e}function ao(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["mimeType"]);l!=null&&s(e,["mimeType"],l);const a=r(t,["sizeBytes"]);a!=null&&s(e,["sizeBytes"],a);const c=r(t,["createTime"]);c!=null&&s(e,["createTime"],c);const d=r(t,["expirationTime"]);d!=null&&s(e,["expirationTime"],d);const u=r(t,["updateTime"]);u!=null&&s(e,["updateTime"],u);const f=r(t,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=r(t,["uri"]);p!=null&&s(e,["uri"],p);const m=r(t,["downloadUri"]);m!=null&&s(e,["downloadUri"],m);const g=r(t,["state"]);g!=null&&s(e,["state"],g);const h=r(t,["source"]);h!=null&&s(e,["source"],h);const T=r(t,["videoMetadata"]);T!=null&&s(e,["videoMetadata"],T);const v=r(t,["error"]);return v!=null&&s(e,["error"],lo(o,v)),e}function uo(o,t){const e={},n=r(t,["file"]);n!=null&&s(e,["file"],ao(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function co(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","file"],bt(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function fo(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","file"],bt(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function po(o,t){const e={},n=r(t,["details"]);n!=null&&s(e,["details"],n);const i=r(t,["message"]);i!=null&&s(e,["message"],i);const l=r(t,["code"]);return l!=null&&s(e,["code"],l),e}function Pe(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["mimeType"]);l!=null&&s(e,["mimeType"],l);const a=r(t,["sizeBytes"]);a!=null&&s(e,["sizeBytes"],a);const c=r(t,["createTime"]);c!=null&&s(e,["createTime"],c);const d=r(t,["expirationTime"]);d!=null&&s(e,["expirationTime"],d);const u=r(t,["updateTime"]);u!=null&&s(e,["updateTime"],u);const f=r(t,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=r(t,["uri"]);p!=null&&s(e,["uri"],p);const m=r(t,["downloadUri"]);m!=null&&s(e,["downloadUri"],m);const g=r(t,["state"]);g!=null&&s(e,["state"],g);const h=r(t,["source"]);h!=null&&s(e,["source"],h);const T=r(t,["videoMetadata"]);T!=null&&s(e,["videoMetadata"],T);const v=r(t,["error"]);return v!=null&&s(e,["error"],po(o,v)),e}function mo(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["files"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>Pe(o,a))),s(e,["files"],l)}return e}function ho(){return{}}function go(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yo extends oe{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new xe(ne.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>Pe(this.apiClient,e))}async listInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=so(this.apiClient,t);return l=M("files",c._url),a=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const u=mo(this.apiClient,d),f=new Xn;return Object.assign(f,u),f})}}async createInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=uo(this.apiClient,t);return l=M("upload/v1beta/files",c._url),a=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(()=>{const d=ho(),u=new Zn;return Object.assign(u,d),u})}}async get(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=co(this.apiClient,t);return l=M("files/{file}",c._url),a=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>Pe(this.apiClient,d))}}async delete(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=fo(this.apiClient,t);return l=M("files/{file}",c._url),a=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(()=>{const d=go(),u=new Qn;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function To(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const a=r(t,["fileData"]);a!=null&&s(e,["fileData"],a);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const d=r(t,["functionResponse"]);d!=null&&s(e,["functionResponse"],d);const u=r(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function Co(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function vo(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>To(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Eo(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Co(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function So(){return{}}function _o(){return{}}function Io(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Ao(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Mo(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],Io(o,n)),e}function Po(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],Ao(o,n)),e}function Ro(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],So());const i=r(t,["googleSearchRetrieval"]);i!=null&&s(e,["googleSearchRetrieval"],Mo(o,i));const l=r(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const a=r(t,["functionDeclarations"]);return a!=null&&s(e,["functionDeclarations"],a),e}function wo(o,t){const e={},n=r(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],_o());const l=r(t,["googleSearchRetrieval"]);l!=null&&s(e,["googleSearchRetrieval"],Po(o,l));const a=r(t,["codeExecution"]);a!=null&&s(e,["codeExecution"],a);const c=r(t,["functionDeclarations"]);return c!=null&&s(e,["functionDeclarations"],c),e}function xo(o,t){const e={},n=r(t,["handle"]);if(n!=null&&s(e,["handle"],n),r(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Do(o,t){const e={},n=r(t,["handle"]);n!=null&&s(e,["handle"],n);const i=r(t,["transparent"]);return i!=null&&s(e,["transparent"],i),e}function No(){return{}}function St(){return{}}function Lo(o,t){const e={},n=r(t,["disabled"]);n!=null&&s(e,["disabled"],n);const i=r(t,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const l=r(t,["endOfSpeechSensitivity"]);l!=null&&s(e,["endOfSpeechSensitivity"],l);const a=r(t,["prefixPaddingMs"]);a!=null&&s(e,["prefixPaddingMs"],a);const c=r(t,["silenceDurationMs"]);return c!=null&&s(e,["silenceDurationMs"],c),e}function Fo(o,t){const e={},n=r(t,["disabled"]);n!=null&&s(e,["disabled"],n);const i=r(t,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const l=r(t,["endOfSpeechSensitivity"]);l!=null&&s(e,["endOfSpeechSensitivity"],l);const a=r(t,["prefixPaddingMs"]);a!=null&&s(e,["prefixPaddingMs"],a);const c=r(t,["silenceDurationMs"]);return c!=null&&s(e,["silenceDurationMs"],c),e}function Vo(o,t){const e={},n=r(t,["automaticActivityDetection"]);n!=null&&s(e,["automaticActivityDetection"],Lo(o,n));const i=r(t,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const l=r(t,["turnCoverage"]);return l!=null&&s(e,["turnCoverage"],l),e}function Uo(o,t){const e={},n=r(t,["automaticActivityDetection"]);n!=null&&s(e,["automaticActivityDetection"],Fo(o,n));const i=r(t,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const l=r(t,["turnCoverage"]);return l!=null&&s(e,["turnCoverage"],l),e}function ko(o,t){const e={},n=r(t,["targetTokens"]);return n!=null&&s(e,["targetTokens"],n),e}function qo(o,t){const e={},n=r(t,["targetTokens"]);return n!=null&&s(e,["targetTokens"],n),e}function Go(o,t){const e={},n=r(t,["triggerTokens"]);n!=null&&s(e,["triggerTokens"],n);const i=r(t,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],ko(o,i)),e}function Bo(o,t){const e={},n=r(t,["triggerTokens"]);n!=null&&s(e,["triggerTokens"],n);const i=r(t,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],qo(o,i)),e}function Ho(o,t,e){const n={},i=r(t,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const l=r(t,["responseModalities"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","responseModalities"],l);const a=r(t,["temperature"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","temperature"],a);const c=r(t,["topP"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topP"],c);const d=r(t,["topK"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","topK"],d);const u=r(t,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const f=r(t,["mediaResolution"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","mediaResolution"],f);const p=r(t,["seed"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","seed"],p);const m=r(t,["speechConfig"]);e!==void 0&&m!=null&&s(e,["setup","generationConfig","speechConfig"],m);const g=r(t,["systemInstruction"]);e!==void 0&&g!=null&&s(e,["setup","systemInstruction"],vo(o,H(o,g)));const h=r(t,["tools"]);if(e!==void 0&&h!=null){let y=Ce(o,h);Array.isArray(y)&&(y=y.map(E=>Ro(o,Te(o,E)))),s(e,["setup","tools"],y)}const T=r(t,["sessionResumption"]);if(e!==void 0&&T!=null&&s(e,["setup","sessionResumption"],xo(o,T)),r(t,["inputAudioTranscription"])!==void 0)throw new Error("inputAudioTranscription parameter is not supported in Gemini API.");const v=r(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&s(e,["setup","outputAudioTranscription"],No());const S=r(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&s(e,["setup","realtimeInputConfig"],Vo(o,S));const I=r(t,["contextWindowCompression"]);return e!==void 0&&I!=null&&s(e,["setup","contextWindowCompression"],Go(o,I)),n}function $o(o,t,e){const n={},i=r(t,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const l=r(t,["responseModalities"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","responseModalities"],l);const a=r(t,["temperature"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","temperature"],a);const c=r(t,["topP"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topP"],c);const d=r(t,["topK"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","topK"],d);const u=r(t,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const f=r(t,["mediaResolution"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","mediaResolution"],f);const p=r(t,["seed"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","seed"],p);const m=r(t,["speechConfig"]);e!==void 0&&m!=null&&s(e,["setup","generationConfig","speechConfig"],m);const g=r(t,["systemInstruction"]);e!==void 0&&g!=null&&s(e,["setup","systemInstruction"],Eo(o,H(o,g)));const h=r(t,["tools"]);if(e!==void 0&&h!=null){let E=Ce(o,h);Array.isArray(E)&&(E=E.map(P=>wo(o,Te(o,P)))),s(e,["setup","tools"],E)}const T=r(t,["sessionResumption"]);e!==void 0&&T!=null&&s(e,["setup","sessionResumption"],Do(o,T));const v=r(t,["inputAudioTranscription"]);e!==void 0&&v!=null&&s(e,["setup","inputAudioTranscription"],St());const S=r(t,["outputAudioTranscription"]);e!==void 0&&S!=null&&s(e,["setup","outputAudioTranscription"],St());const I=r(t,["realtimeInputConfig"]);e!==void 0&&I!=null&&s(e,["setup","realtimeInputConfig"],Uo(o,I));const y=r(t,["contextWindowCompression"]);return e!==void 0&&y!=null&&s(e,["setup","contextWindowCompression"],Bo(o,y)),n}function Jo(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["setup","model"],V(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],Ho(o,i,e)),e}function Yo(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["setup","model"],V(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],$o(o,i,e)),e}function Wo(){return{}}function bo(){return{}}function Ko(){return{}}function zo(){return{}}function Oo(o,t){const e={},n=r(t,["media"]);n!=null&&s(e,["mediaChunks"],Bt(o,n));const i=r(t,["audio"]);i!=null&&s(e,["audio"],pn(o,i));const l=r(t,["audioStreamEnd"]);l!=null&&s(e,["audioStreamEnd"],l);const a=r(t,["video"]);a!=null&&s(e,["video"],fn(o,a));const c=r(t,["text"]);return c!=null&&s(e,["text"],c),r(t,["activityStart"])!=null&&s(e,["activityStart"],Wo()),r(t,["activityEnd"])!=null&&s(e,["activityEnd"],Ko()),e}function Xo(o,t){const e={},n=r(t,["media"]);if(n!=null&&s(e,["mediaChunks"],Bt(o,n)),r(t,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=r(t,["audioStreamEnd"]);if(i!=null&&s(e,["audioStreamEnd"],i),r(t,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(r(t,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return r(t,["activityStart"])!=null&&s(e,["activityStart"],bo()),r(t,["activityEnd"])!=null&&s(e,["activityEnd"],zo()),e}function Zo(){return{}}function Qo(){return{}}function jo(o,t){const e={},n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const a=r(t,["fileData"]);a!=null&&s(e,["fileData"],a);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const d=r(t,["functionResponse"]);d!=null&&s(e,["functionResponse"],d);const u=r(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function ei(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function ti(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>jo(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function ni(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>ei(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function _t(o,t){const e={},n=r(t,["text"]);n!=null&&s(e,["text"],n);const i=r(t,["finished"]);return i!=null&&s(e,["finished"],i),e}function It(o,t){const e={},n=r(t,["text"]);n!=null&&s(e,["text"],n);const i=r(t,["finished"]);return i!=null&&s(e,["finished"],i),e}function oi(o,t){const e={},n=r(t,["modelTurn"]);n!=null&&s(e,["modelTurn"],ti(o,n));const i=r(t,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const l=r(t,["interrupted"]);l!=null&&s(e,["interrupted"],l);const a=r(t,["groundingMetadata"]);a!=null&&s(e,["groundingMetadata"],a);const c=r(t,["generationComplete"]);c!=null&&s(e,["generationComplete"],c);const d=r(t,["inputTranscription"]);d!=null&&s(e,["inputTranscription"],_t(o,d));const u=r(t,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],_t(o,u)),e}function ii(o,t){const e={},n=r(t,["modelTurn"]);n!=null&&s(e,["modelTurn"],ni(o,n));const i=r(t,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const l=r(t,["interrupted"]);l!=null&&s(e,["interrupted"],l);const a=r(t,["groundingMetadata"]);a!=null&&s(e,["groundingMetadata"],a);const c=r(t,["generationComplete"]);c!=null&&s(e,["generationComplete"],c);const d=r(t,["inputTranscription"]);d!=null&&s(e,["inputTranscription"],It(o,d));const u=r(t,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],It(o,u)),e}function ri(o,t){const e={},n=r(t,["id"]);n!=null&&s(e,["id"],n);const i=r(t,["args"]);i!=null&&s(e,["args"],i);const l=r(t,["name"]);return l!=null&&s(e,["name"],l),e}function si(o,t){const e={},n=r(t,["args"]);n!=null&&s(e,["args"],n);const i=r(t,["name"]);return i!=null&&s(e,["name"],i),e}function li(o,t){const e={},n=r(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>ri(o,l))),s(e,["functionCalls"],i)}return e}function ai(o,t){const e={},n=r(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>si(o,l))),s(e,["functionCalls"],i)}return e}function ui(o,t){const e={},n=r(t,["ids"]);return n!=null&&s(e,["ids"],n),e}function ci(o,t){const e={},n=r(t,["ids"]);return n!=null&&s(e,["ids"],n),e}function re(o,t){const e={},n=r(t,["modality"]);n!=null&&s(e,["modality"],n);const i=r(t,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function se(o,t){const e={},n=r(t,["modality"]);n!=null&&s(e,["modality"],n);const i=r(t,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function di(o,t){const e={},n=r(t,["promptTokenCount"]);n!=null&&s(e,["promptTokenCount"],n);const i=r(t,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const l=r(t,["responseTokenCount"]);l!=null&&s(e,["responseTokenCount"],l);const a=r(t,["toolUsePromptTokenCount"]);a!=null&&s(e,["toolUsePromptTokenCount"],a);const c=r(t,["thoughtsTokenCount"]);c!=null&&s(e,["thoughtsTokenCount"],c);const d=r(t,["totalTokenCount"]);d!=null&&s(e,["totalTokenCount"],d);const u=r(t,["promptTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(h=>re(o,h))),s(e,["promptTokensDetails"],g)}const f=r(t,["cacheTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(h=>re(o,h))),s(e,["cacheTokensDetails"],g)}const p=r(t,["responseTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(h=>re(o,h))),s(e,["responseTokensDetails"],g)}const m=r(t,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(h=>re(o,h))),s(e,["toolUsePromptTokensDetails"],g)}return e}function fi(o,t){const e={},n=r(t,["promptTokenCount"]);n!=null&&s(e,["promptTokenCount"],n);const i=r(t,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const l=r(t,["candidatesTokenCount"]);l!=null&&s(e,["responseTokenCount"],l);const a=r(t,["toolUsePromptTokenCount"]);a!=null&&s(e,["toolUsePromptTokenCount"],a);const c=r(t,["thoughtsTokenCount"]);c!=null&&s(e,["thoughtsTokenCount"],c);const d=r(t,["totalTokenCount"]);d!=null&&s(e,["totalTokenCount"],d);const u=r(t,["promptTokensDetails"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(T=>se(o,T))),s(e,["promptTokensDetails"],h)}const f=r(t,["cacheTokensDetails"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(T=>se(o,T))),s(e,["cacheTokensDetails"],h)}const p=r(t,["candidatesTokensDetails"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(T=>se(o,T))),s(e,["responseTokensDetails"],h)}const m=r(t,["toolUsePromptTokensDetails"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(T=>se(o,T))),s(e,["toolUsePromptTokensDetails"],h)}const g=r(t,["trafficType"]);return g!=null&&s(e,["trafficType"],g),e}function pi(o,t){const e={},n=r(t,["timeLeft"]);return n!=null&&s(e,["timeLeft"],n),e}function mi(o,t){const e={},n=r(t,["timeLeft"]);return n!=null&&s(e,["timeLeft"],n),e}function hi(o,t){const e={},n=r(t,["newHandle"]);n!=null&&s(e,["newHandle"],n);const i=r(t,["resumable"]);i!=null&&s(e,["resumable"],i);const l=r(t,["lastConsumedClientMessageIndex"]);return l!=null&&s(e,["lastConsumedClientMessageIndex"],l),e}function gi(o,t){const e={},n=r(t,["newHandle"]);n!=null&&s(e,["newHandle"],n);const i=r(t,["resumable"]);i!=null&&s(e,["resumable"],i);const l=r(t,["lastConsumedClientMessageIndex"]);return l!=null&&s(e,["lastConsumedClientMessageIndex"],l),e}function yi(o,t){const e={};r(t,["setupComplete"])!=null&&s(e,["setupComplete"],Zo());const i=r(t,["serverContent"]);i!=null&&s(e,["serverContent"],oi(o,i));const l=r(t,["toolCall"]);l!=null&&s(e,["toolCall"],li(o,l));const a=r(t,["toolCallCancellation"]);a!=null&&s(e,["toolCallCancellation"],ui(o,a));const c=r(t,["usageMetadata"]);c!=null&&s(e,["usageMetadata"],di(o,c));const d=r(t,["goAway"]);d!=null&&s(e,["goAway"],pi(o,d));const u=r(t,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],hi(o,u)),e}function Ti(o,t){const e={};r(t,["setupComplete"])!=null&&s(e,["setupComplete"],Qo());const i=r(t,["serverContent"]);i!=null&&s(e,["serverContent"],ii(o,i));const l=r(t,["toolCall"]);l!=null&&s(e,["toolCall"],ai(o,l));const a=r(t,["toolCallCancellation"]);a!=null&&s(e,["toolCallCancellation"],ci(o,a));const c=r(t,["usageMetadata"]);c!=null&&s(e,["usageMetadata"],fi(o,c));const d=r(t,["goAway"]);d!=null&&s(e,["goAway"],mi(o,d));const u=r(t,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],gi(o,u)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ci(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const a=r(t,["fileData"]);a!=null&&s(e,["fileData"],a);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const d=r(t,["functionResponse"]);d!=null&&s(e,["functionResponse"],d);const u=r(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function ve(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Ci(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function vi(o,t){const e={};if(r(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=r(t,["category"]);n!=null&&s(e,["category"],n);const i=r(t,["threshold"]);return i!=null&&s(e,["threshold"],i),e}function Ei(){return{}}function Si(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function _i(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],Si(o,n)),e}function Ii(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Ei());const i=r(t,["googleSearchRetrieval"]);i!=null&&s(e,["googleSearchRetrieval"],_i(o,i));const l=r(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const a=r(t,["functionDeclarations"]);return a!=null&&s(e,["functionDeclarations"],a),e}function Ai(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Mi(o,t){const e={},n=r(t,["functionCallingConfig"]);return n!=null&&s(e,["functionCallingConfig"],Ai(o,n)),e}function Pi(o,t){const e={},n=r(t,["voiceName"]);return n!=null&&s(e,["voiceName"],n),e}function Ri(o,t){const e={},n=r(t,["prebuiltVoiceConfig"]);return n!=null&&s(e,["prebuiltVoiceConfig"],Pi(o,n)),e}function wi(o,t){const e={},n=r(t,["voiceConfig"]);n!=null&&s(e,["voiceConfig"],Ri(o,n));const i=r(t,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function xi(o,t){const e={},n=r(t,["includeThoughts"]);n!=null&&s(e,["includeThoughts"],n);const i=r(t,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function Di(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],ve(o,H(o,i)));const l=r(t,["temperature"]);l!=null&&s(n,["temperature"],l);const a=r(t,["topP"]);a!=null&&s(n,["topP"],a);const c=r(t,["topK"]);c!=null&&s(n,["topK"],c);const d=r(t,["candidateCount"]);d!=null&&s(n,["candidateCount"],d);const u=r(t,["maxOutputTokens"]);u!=null&&s(n,["maxOutputTokens"],u);const f=r(t,["stopSequences"]);f!=null&&s(n,["stopSequences"],f);const p=r(t,["responseLogprobs"]);p!=null&&s(n,["responseLogprobs"],p);const m=r(t,["logprobs"]);m!=null&&s(n,["logprobs"],m);const g=r(t,["presencePenalty"]);g!=null&&s(n,["presencePenalty"],g);const h=r(t,["frequencyPenalty"]);h!=null&&s(n,["frequencyPenalty"],h);const T=r(t,["seed"]);T!=null&&s(n,["seed"],T);const v=r(t,["responseMimeType"]);v!=null&&s(n,["responseMimeType"],v);const S=r(t,["responseSchema"]);if(S!=null&&s(n,["responseSchema"],Jt(o,S)),r(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const I=r(t,["safetySettings"]);if(e!==void 0&&I!=null){let w=I;Array.isArray(w)&&(w=w.map(F=>vi(o,F))),s(e,["safetySettings"],w)}const y=r(t,["tools"]);if(e!==void 0&&y!=null){let w=Ce(o,y);Array.isArray(w)&&(w=w.map(F=>Ii(o,Te(o,F)))),s(e,["tools"],w)}const E=r(t,["toolConfig"]);if(e!==void 0&&E!=null&&s(e,["toolConfig"],Mi(o,E)),r(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=r(t,["cachedContent"]);e!==void 0&&P!=null&&s(e,["cachedContent"],O(o,P));const k=r(t,["responseModalities"]);k!=null&&s(n,["responseModalities"],k);const R=r(t,["mediaResolution"]);R!=null&&s(n,["mediaResolution"],R);const C=r(t,["speechConfig"]);if(C!=null&&s(n,["speechConfig"],wi(o,Yt(o,C))),r(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const A=r(t,["thinkingConfig"]);return A!=null&&s(n,["thinkingConfig"],xi(o,A)),n}function At(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["contents"]);if(i!=null){let a=z(o,i);Array.isArray(a)&&(a=a.map(c=>ve(o,c))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["generationConfig"],Di(o,l,e)),e}function Ni(o,t,e){const n={},i=r(t,["taskType"]);e!==void 0&&i!=null&&s(e,["requests[]","taskType"],i);const l=r(t,["title"]);e!==void 0&&l!=null&&s(e,["requests[]","title"],l);const a=r(t,["outputDimensionality"]);if(e!==void 0&&a!=null&&s(e,["requests[]","outputDimensionality"],a),r(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Li(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["contents"]);i!=null&&s(e,["requests[]","content"],$t(o,i));const l=r(t,["config"]);l!=null&&s(e,["config"],Ni(o,l,e));const a=r(t,["model"]);return a!==void 0&&s(e,["requests[]","model"],V(o,a)),e}function Fi(o,t,e){const n={};if(r(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=r(t,["numberOfImages"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const l=r(t,["aspectRatio"]);e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l);const a=r(t,["guidanceScale"]);if(e!==void 0&&a!=null&&s(e,["parameters","guidanceScale"],a),r(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=r(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&s(e,["parameters","safetySetting"],c);const d=r(t,["personGeneration"]);e!==void 0&&d!=null&&s(e,["parameters","personGeneration"],d);const u=r(t,["includeSafetyAttributes"]);e!==void 0&&u!=null&&s(e,["parameters","includeSafetyAttributes"],u);const f=r(t,["includeRaiReason"]);e!==void 0&&f!=null&&s(e,["parameters","includeRaiReason"],f);const p=r(t,["language"]);e!==void 0&&p!=null&&s(e,["parameters","language"],p);const m=r(t,["outputMimeType"]);e!==void 0&&m!=null&&s(e,["parameters","outputOptions","mimeType"],m);const g=r(t,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&s(e,["parameters","outputOptions","compressionQuality"],g),r(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(r(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Vi(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["config"]);return l!=null&&s(e,["config"],Fi(o,l,e)),e}function Ui(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],V(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function ki(o,t,e){const n={},i=r(t,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const l=r(t,["description"]);return e!==void 0&&l!=null&&s(e,["description"],l),n}function qi(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],V(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],ki(o,i,e)),e}function Gi(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],V(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Bi(o,t){const e={};if(r(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Hi(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["contents"]);if(i!=null){let a=z(o,i);Array.isArray(a)&&(a=a.map(c=>ve(o,c))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["config"],Bi(o,l)),e}function $i(o,t){const e={};if(r(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(t,["imageBytes"]);n!=null&&s(e,["bytesBase64Encoded"],X(o,n));const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Ji(o,t,e){const n={},i=r(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i),r(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const l=r(t,["durationSeconds"]);if(e!==void 0&&l!=null&&s(e,["parameters","durationSeconds"],l),r(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=r(t,["aspectRatio"]);if(e!==void 0&&a!=null&&s(e,["parameters","aspectRatio"],a),r(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const c=r(t,["personGeneration"]);if(e!==void 0&&c!=null&&s(e,["parameters","personGeneration"],c),r(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=r(t,["negativePrompt"]);if(e!==void 0&&d!=null&&s(e,["parameters","negativePrompt"],d),r(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Yi(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["image"]);l!=null&&s(e,["instances[0]","image"],$i(o,l));const a=r(t,["config"]);return a!=null&&s(e,["config"],Ji(o,a,e)),e}function Wi(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function j(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Wi(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function bi(o,t){const e={},n=r(t,["featureSelectionPreference"]);return n!=null&&s(e,["featureSelectionPreference"],n),e}function Ki(o,t){const e={},n=r(t,["method"]);n!=null&&s(e,["method"],n);const i=r(t,["category"]);i!=null&&s(e,["category"],i);const l=r(t,["threshold"]);return l!=null&&s(e,["threshold"],l),e}function zi(){return{}}function Oi(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Xi(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],Oi(o,n)),e}function zt(o,t){const e={},n=r(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],zi());const l=r(t,["googleSearchRetrieval"]);l!=null&&s(e,["googleSearchRetrieval"],Xi(o,l));const a=r(t,["codeExecution"]);a!=null&&s(e,["codeExecution"],a);const c=r(t,["functionDeclarations"]);return c!=null&&s(e,["functionDeclarations"],c),e}function Zi(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Qi(o,t){const e={},n=r(t,["functionCallingConfig"]);return n!=null&&s(e,["functionCallingConfig"],Zi(o,n)),e}function ji(o,t){const e={},n=r(t,["voiceName"]);return n!=null&&s(e,["voiceName"],n),e}function er(o,t){const e={},n=r(t,["prebuiltVoiceConfig"]);return n!=null&&s(e,["prebuiltVoiceConfig"],ji(o,n)),e}function tr(o,t){const e={},n=r(t,["voiceConfig"]);n!=null&&s(e,["voiceConfig"],er(o,n));const i=r(t,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function nr(o,t){const e={},n=r(t,["includeThoughts"]);n!=null&&s(e,["includeThoughts"],n);const i=r(t,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function or(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],j(o,H(o,i)));const l=r(t,["temperature"]);l!=null&&s(n,["temperature"],l);const a=r(t,["topP"]);a!=null&&s(n,["topP"],a);const c=r(t,["topK"]);c!=null&&s(n,["topK"],c);const d=r(t,["candidateCount"]);d!=null&&s(n,["candidateCount"],d);const u=r(t,["maxOutputTokens"]);u!=null&&s(n,["maxOutputTokens"],u);const f=r(t,["stopSequences"]);f!=null&&s(n,["stopSequences"],f);const p=r(t,["responseLogprobs"]);p!=null&&s(n,["responseLogprobs"],p);const m=r(t,["logprobs"]);m!=null&&s(n,["logprobs"],m);const g=r(t,["presencePenalty"]);g!=null&&s(n,["presencePenalty"],g);const h=r(t,["frequencyPenalty"]);h!=null&&s(n,["frequencyPenalty"],h);const T=r(t,["seed"]);T!=null&&s(n,["seed"],T);const v=r(t,["responseMimeType"]);v!=null&&s(n,["responseMimeType"],v);const S=r(t,["responseSchema"]);S!=null&&s(n,["responseSchema"],Jt(o,S));const I=r(t,["routingConfig"]);I!=null&&s(n,["routingConfig"],I);const y=r(t,["modelSelectionConfig"]);y!=null&&s(n,["modelConfig"],bi(o,y));const E=r(t,["safetySettings"]);if(e!==void 0&&E!=null){let x=E;Array.isArray(x)&&(x=x.map(U=>Ki(o,U))),s(e,["safetySettings"],x)}const P=r(t,["tools"]);if(e!==void 0&&P!=null){let x=Ce(o,P);Array.isArray(x)&&(x=x.map(U=>zt(o,Te(o,U)))),s(e,["tools"],x)}const k=r(t,["toolConfig"]);e!==void 0&&k!=null&&s(e,["toolConfig"],Qi(o,k));const R=r(t,["labels"]);e!==void 0&&R!=null&&s(e,["labels"],R);const C=r(t,["cachedContent"]);e!==void 0&&C!=null&&s(e,["cachedContent"],O(o,C));const A=r(t,["responseModalities"]);A!=null&&s(n,["responseModalities"],A);const w=r(t,["mediaResolution"]);w!=null&&s(n,["mediaResolution"],w);const F=r(t,["speechConfig"]);F!=null&&s(n,["speechConfig"],tr(o,Yt(o,F)));const q=r(t,["audioTimestamp"]);q!=null&&s(n,["audioTimestamp"],q);const D=r(t,["thinkingConfig"]);return D!=null&&s(n,["thinkingConfig"],nr(o,D)),n}function Mt(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["contents"]);if(i!=null){let a=z(o,i);Array.isArray(a)&&(a=a.map(c=>j(o,c))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["generationConfig"],or(o,l,e)),e}function ir(o,t,e){const n={},i=r(t,["taskType"]);e!==void 0&&i!=null&&s(e,["instances[]","task_type"],i);const l=r(t,["title"]);e!==void 0&&l!=null&&s(e,["instances[]","title"],l);const a=r(t,["outputDimensionality"]);e!==void 0&&a!=null&&s(e,["parameters","outputDimensionality"],a);const c=r(t,["mimeType"]);e!==void 0&&c!=null&&s(e,["instances[]","mimeType"],c);const d=r(t,["autoTruncate"]);return e!==void 0&&d!=null&&s(e,["parameters","autoTruncate"],d),n}function rr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["contents"]);i!=null&&s(e,["instances[]","content"],$t(o,i));const l=r(t,["config"]);return l!=null&&s(e,["config"],ir(o,l,e)),e}function sr(o,t,e){const n={},i=r(t,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const l=r(t,["negativePrompt"]);e!==void 0&&l!=null&&s(e,["parameters","negativePrompt"],l);const a=r(t,["numberOfImages"]);e!==void 0&&a!=null&&s(e,["parameters","sampleCount"],a);const c=r(t,["aspectRatio"]);e!==void 0&&c!=null&&s(e,["parameters","aspectRatio"],c);const d=r(t,["guidanceScale"]);e!==void 0&&d!=null&&s(e,["parameters","guidanceScale"],d);const u=r(t,["seed"]);e!==void 0&&u!=null&&s(e,["parameters","seed"],u);const f=r(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&s(e,["parameters","safetySetting"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const m=r(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&s(e,["parameters","includeSafetyAttributes"],m);const g=r(t,["includeRaiReason"]);e!==void 0&&g!=null&&s(e,["parameters","includeRaiReason"],g);const h=r(t,["language"]);e!==void 0&&h!=null&&s(e,["parameters","language"],h);const T=r(t,["outputMimeType"]);e!==void 0&&T!=null&&s(e,["parameters","outputOptions","mimeType"],T);const v=r(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&s(e,["parameters","outputOptions","compressionQuality"],v);const S=r(t,["addWatermark"]);e!==void 0&&S!=null&&s(e,["parameters","addWatermark"],S);const I=r(t,["enhancePrompt"]);return e!==void 0&&I!=null&&s(e,["parameters","enhancePrompt"],I),n}function lr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["config"]);return l!=null&&s(e,["config"],sr(o,l,e)),e}function ar(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],V(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function ur(o,t,e){const n={},i=r(t,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const l=r(t,["description"]);return e!==void 0&&l!=null&&s(e,["description"],l),n}function cr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],ur(o,i,e)),e}function dr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],V(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function fr(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],j(o,H(o,i)));const l=r(t,["tools"]);if(e!==void 0&&l!=null){let c=l;Array.isArray(c)&&(c=c.map(d=>zt(o,d))),s(e,["tools"],c)}const a=r(t,["generationConfig"]);return e!==void 0&&a!=null&&s(e,["generationConfig"],a),n}function pr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["contents"]);if(i!=null){let a=z(o,i);Array.isArray(a)&&(a=a.map(c=>j(o,c))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["config"],fr(o,l,e)),e}function mr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["contents"]);if(i!=null){let a=z(o,i);Array.isArray(a)&&(a=a.map(c=>j(o,c))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["config"],l),e}function hr(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&s(e,["gcsUri"],n);const i=r(t,["imageBytes"]);i!=null&&s(e,["bytesBase64Encoded"],X(o,i));const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function gr(o,t,e){const n={},i=r(t,["numberOfVideos"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const l=r(t,["outputGcsUri"]);e!==void 0&&l!=null&&s(e,["parameters","storageUri"],l);const a=r(t,["fps"]);e!==void 0&&a!=null&&s(e,["parameters","fps"],a);const c=r(t,["durationSeconds"]);e!==void 0&&c!=null&&s(e,["parameters","durationSeconds"],c);const d=r(t,["seed"]);e!==void 0&&d!=null&&s(e,["parameters","seed"],d);const u=r(t,["aspectRatio"]);e!==void 0&&u!=null&&s(e,["parameters","aspectRatio"],u);const f=r(t,["resolution"]);e!==void 0&&f!=null&&s(e,["parameters","resolution"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const m=r(t,["pubsubTopic"]);e!==void 0&&m!=null&&s(e,["parameters","pubsubTopic"],m);const g=r(t,["negativePrompt"]);e!==void 0&&g!=null&&s(e,["parameters","negativePrompt"],g);const h=r(t,["enhancePrompt"]);return e!==void 0&&h!=null&&s(e,["parameters","enhancePrompt"],h),n}function yr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],V(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["image"]);l!=null&&s(e,["instances[0]","image"],hr(o,l));const a=r(t,["config"]);return a!=null&&s(e,["config"],gr(o,a,e)),e}function Tr(o,t){const e={},n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["codeExecutionResult"]);i!=null&&s(e,["codeExecutionResult"],i);const l=r(t,["executableCode"]);l!=null&&s(e,["executableCode"],l);const a=r(t,["fileData"]);a!=null&&s(e,["fileData"],a);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const d=r(t,["functionResponse"]);d!=null&&s(e,["functionResponse"],d);const u=r(t,["inlineData"]);u!=null&&s(e,["inlineData"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function Cr(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Tr(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function vr(o,t){const e={},n=r(t,["citationSources"]);return n!=null&&s(e,["citations"],n),e}function Er(o,t){const e={},n=r(t,["content"]);n!=null&&s(e,["content"],Cr(o,n));const i=r(t,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],vr(o,i));const l=r(t,["tokenCount"]);l!=null&&s(e,["tokenCount"],l);const a=r(t,["finishReason"]);a!=null&&s(e,["finishReason"],a);const c=r(t,["avgLogprobs"]);c!=null&&s(e,["avgLogprobs"],c);const d=r(t,["groundingMetadata"]);d!=null&&s(e,["groundingMetadata"],d);const u=r(t,["index"]);u!=null&&s(e,["index"],u);const f=r(t,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=r(t,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function Pt(o,t){const e={},n=r(t,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>Er(o,d))),s(e,["candidates"],c)}const i=r(t,["modelVersion"]);i!=null&&s(e,["modelVersion"],i);const l=r(t,["promptFeedback"]);l!=null&&s(e,["promptFeedback"],l);const a=r(t,["usageMetadata"]);return a!=null&&s(e,["usageMetadata"],a),e}function Sr(o,t){const e={},n=r(t,["values"]);return n!=null&&s(e,["values"],n),e}function _r(){return{}}function Ir(o,t){const e={},n=r(t,["embeddings"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Sr(o,a))),s(e,["embeddings"],l)}return r(t,["metadata"])!=null&&s(e,["metadata"],_r()),e}function Ar(o,t){const e={},n=r(t,["bytesBase64Encoded"]);n!=null&&s(e,["imageBytes"],X(o,n));const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Ot(o,t){const e={},n=r(t,["safetyAttributes","categories"]);n!=null&&s(e,["categories"],n);const i=r(t,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const l=r(t,["contentType"]);return l!=null&&s(e,["contentType"],l),e}function Mr(o,t){const e={},n=r(t,["_self"]);n!=null&&s(e,["image"],Ar(o,n));const i=r(t,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const l=r(t,["_self"]);return l!=null&&s(e,["safetyAttributes"],Ot(o,l)),e}function Pr(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Mr(o,a))),s(e,["generatedImages"],l)}const i=r(t,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],Ot(o,i)),e}function Rr(o,t){const e={},n=r(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const l=r(t,["updateTime"]);return l!=null&&s(e,["updateTime"],l),e}function Rt(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["description"]);l!=null&&s(e,["description"],l);const a=r(t,["version"]);a!=null&&s(e,["version"],a);const c=r(t,["_self"]);c!=null&&s(e,["tunedModelInfo"],Rr(o,c));const d=r(t,["inputTokenLimit"]);d!=null&&s(e,["inputTokenLimit"],d);const u=r(t,["outputTokenLimit"]);u!=null&&s(e,["outputTokenLimit"],u);const f=r(t,["supportedGenerationMethods"]);return f!=null&&s(e,["supportedActions"],f),e}function wr(){return{}}function xr(o,t){const e={},n=r(t,["totalTokens"]);n!=null&&s(e,["totalTokens"],n);const i=r(t,["cachedContentTokenCount"]);return i!=null&&s(e,["cachedContentTokenCount"],i),e}function Dr(o,t){const e={},n=r(t,["video","uri"]);n!=null&&s(e,["uri"],n);const i=r(t,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],X(o,i));const l=r(t,["encoding"]);return l!=null&&s(e,["mimeType"],l),e}function Nr(o,t){const e={},n=r(t,["_self"]);return n!=null&&s(e,["video"],Dr(o,n)),e}function Lr(o,t){const e={},n=r(t,["generatedSamples"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(c=>Nr(o,c))),s(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const l=r(t,["raiMediaFilteredReasons"]);return l!=null&&s(e,["raiMediaFilteredReasons"],l),e}function Fr(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);a!=null&&s(e,["error"],a);const c=r(t,["response","generateVideoResponse"]);return c!=null&&s(e,["response"],Lr(o,c)),e}function Vr(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const d=r(t,["functionCall"]);d!=null&&s(e,["functionCall"],d);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["inlineData"]);f!=null&&s(e,["inlineData"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function Ur(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Vr(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function kr(o,t){const e={},n=r(t,["citations"]);return n!=null&&s(e,["citations"],n),e}function qr(o,t){const e={},n=r(t,["content"]);n!=null&&s(e,["content"],Ur(o,n));const i=r(t,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],kr(o,i));const l=r(t,["finishMessage"]);l!=null&&s(e,["finishMessage"],l);const a=r(t,["finishReason"]);a!=null&&s(e,["finishReason"],a);const c=r(t,["avgLogprobs"]);c!=null&&s(e,["avgLogprobs"],c);const d=r(t,["groundingMetadata"]);d!=null&&s(e,["groundingMetadata"],d);const u=r(t,["index"]);u!=null&&s(e,["index"],u);const f=r(t,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=r(t,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function wt(o,t){const e={},n=r(t,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(f=>qr(o,f))),s(e,["candidates"],u)}const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const l=r(t,["responseId"]);l!=null&&s(e,["responseId"],l);const a=r(t,["modelVersion"]);a!=null&&s(e,["modelVersion"],a);const c=r(t,["promptFeedback"]);c!=null&&s(e,["promptFeedback"],c);const d=r(t,["usageMetadata"]);return d!=null&&s(e,["usageMetadata"],d),e}function Gr(o,t){const e={},n=r(t,["truncated"]);n!=null&&s(e,["truncated"],n);const i=r(t,["token_count"]);return i!=null&&s(e,["tokenCount"],i),e}function Br(o,t){const e={},n=r(t,["values"]);n!=null&&s(e,["values"],n);const i=r(t,["statistics"]);return i!=null&&s(e,["statistics"],Gr(o,i)),e}function Hr(o,t){const e={},n=r(t,["billableCharacterCount"]);return n!=null&&s(e,["billableCharacterCount"],n),e}function $r(o,t){const e={},n=r(t,["predictions[]","embeddings"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Br(o,a))),s(e,["embeddings"],l)}const i=r(t,["metadata"]);return i!=null&&s(e,["metadata"],Hr(o,i)),e}function Jr(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&s(e,["gcsUri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["imageBytes"],X(o,i));const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function Xt(o,t){const e={},n=r(t,["safetyAttributes","categories"]);n!=null&&s(e,["categories"],n);const i=r(t,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const l=r(t,["contentType"]);return l!=null&&s(e,["contentType"],l),e}function Yr(o,t){const e={},n=r(t,["_self"]);n!=null&&s(e,["image"],Jr(o,n));const i=r(t,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const l=r(t,["_self"]);l!=null&&s(e,["safetyAttributes"],Xt(o,l));const a=r(t,["prompt"]);return a!=null&&s(e,["enhancedPrompt"],a),e}function Wr(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Yr(o,a))),s(e,["generatedImages"],l)}const i=r(t,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],Xt(o,i)),e}function br(o,t){const e={},n=r(t,["endpoint"]);n!=null&&s(e,["name"],n);const i=r(t,["deployedModelId"]);return i!=null&&s(e,["deployedModelId"],i),e}function Kr(o,t){const e={},n=r(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&s(e,["baseModel"],n);const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const l=r(t,["updateTime"]);return l!=null&&s(e,["updateTime"],l),e}function xt(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["description"]);l!=null&&s(e,["description"],l);const a=r(t,["versionId"]);a!=null&&s(e,["version"],a);const c=r(t,["deployedModels"]);if(c!=null){let f=c;Array.isArray(f)&&(f=f.map(p=>br(o,p))),s(e,["endpoints"],f)}const d=r(t,["labels"]);d!=null&&s(e,["labels"],d);const u=r(t,["_self"]);return u!=null&&s(e,["tunedModelInfo"],Kr(o,u)),e}function zr(){return{}}function Or(o,t){const e={},n=r(t,["totalTokens"]);return n!=null&&s(e,["totalTokens"],n),e}function Xr(o,t){const e={},n=r(t,["tokensInfo"]);return n!=null&&s(e,["tokensInfo"],n),e}function Zr(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&s(e,["uri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],X(o,i));const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function Qr(o,t){const e={},n=r(t,["_self"]);return n!=null&&s(e,["video"],Zr(o,n)),e}function jr(o,t){const e={},n=r(t,["videos"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(c=>Qr(o,c))),s(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const l=r(t,["raiMediaFilteredReasons"]);return l!=null&&s(e,["raiMediaFilteredReasons"],l),e}function es(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);a!=null&&s(e,["error"],a);const c=r(t,["response"]);return c!=null&&s(e,["response"],jr(o,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ts="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function ns(o,t,e){let n,i;e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),o.isVertexAI()?n=Ti(o,i):n=yi(o,i),t(n)}class os{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n,i,l;const a=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let d;const u=ls(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())d=`${a}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(u);else{const E=this.apiClient.getApiKey();d=`${a}/ws/google.ai.generativelanguage.${c}.GenerativeService.BidiGenerateContent?key=${E}`}let f=()=>{};const p=new Promise(E=>{f=E}),m=t.callbacks,g=function(){var E;(E=m==null?void 0:m.onopen)===null||E===void 0||E.call(m),f({})},h=this.apiClient,T={onopen:g,onmessage:E=>{ns(h,m.onmessage,E)},onerror:(e=m==null?void 0:m.onerror)!==null&&e!==void 0?e:function(E){},onclose:(n=m==null?void 0:m.onclose)!==null&&n!==void 0?n:function(E){}},v=this.webSocketFactory.create(d,ss(u),T);v.connect(),await p;let S=V(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&S.startsWith("publishers/")){const E=this.apiClient.getProject(),P=this.apiClient.getLocation();S=`projects/${E}/locations/${P}/`+S}let I={};this.apiClient.isVertexAI()&&((i=t.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[pe.AUDIO]}:t.config.responseModalities=[pe.AUDIO]),!((l=t.config)===null||l===void 0)&&l.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const y={model:S,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?I=Yo(this.apiClient,y):I=Jo(this.apiClient,y),delete I.config,v.send(JSON.stringify(I)),new rs(v,this.apiClient)}}const is={turnComplete:!0};class rs{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=z(t,e.turns),t.isVertexAI()?n=n.map(i=>j(t,i)):n=n.map(i=>ve(t,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const l of n){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!t.isVertexAI()&&!("id"in l))throw new Error(ts)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},is),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};this.apiClient.isVertexAI()?e={realtimeInput:Xo(this.apiClient,t)}:e={realtimeInput:Oo(this.apiClient,t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function ss(o){const t={};return o.forEach((e,n)=>{t[n]=e}),t}function ls(o){const t=new Headers;for(const[e,n]of Object.entries(o))t.append(e,n);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class as extends oe{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>await this.generateContentInternal(e),this.generateContentStream=async e=>await this.generateContentStreamInternal(e),this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var i;let l;const a=[];if(n!=null&&n.generatedImages)for(const d of n.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((i=d==null?void 0:d.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?l=d==null?void 0:d.safetyAttributes:a.push(d);let c;return l?c={generatedImages:a,positivePromptSafetyAttributes:l}:c={generatedImages:a},c})}async generateContentInternal(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=Mt(this.apiClient,t);return c=M("{model}:generateContent",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=wt(this.apiClient,f),m=new ie;return Object.assign(m,p),m})}else{const u=At(this.apiClient,t);return c=M("{model}:generateContent",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Pt(this.apiClient,f),m=new ie;return Object.assign(m,p),m})}}async generateContentStreamInternal(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=Mt(this.apiClient,t);c=M("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return a=f.requestStream({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}),a.then(function(p){return me(this,arguments,function*(){var m,g,h,T;try{for(var v=!0,S=Me(p),I;I=yield G(S.next()),m=I.done,!m;v=!0){T=I.value,v=!1;const E=wt(f,yield G(T.json())),P=new ie;Object.assign(P,E),yield yield G(P)}}catch(y){g={error:y}}finally{try{!v&&!m&&(h=S.return)&&(yield G(h.call(S)))}finally{if(g)throw g.error}}})})}else{const u=At(this.apiClient,t);c=M("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return a=f.requestStream({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}),a.then(function(p){return me(this,arguments,function*(){var m,g,h,T;try{for(var v=!0,S=Me(p),I;I=yield G(S.next()),m=I.done,!m;v=!0){T=I.value,v=!1;const E=Pt(f,yield G(T.json())),P=new ie;Object.assign(P,E),yield yield G(P)}}catch(y){g={error:y}}finally{try{!v&&!m&&(h=S.return)&&(yield G(h.call(S)))}finally{if(g)throw g.error}}})})}}async embedContent(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=rr(this.apiClient,t);return c=M("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=$r(this.apiClient,f),m=new mt;return Object.assign(m,p),m})}else{const u=Li(this.apiClient,t);return c=M("{model}:batchEmbedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Ir(this.apiClient,f),m=new mt;return Object.assign(m,p),m})}}async generateImagesInternal(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=lr(this.apiClient,t);return c=M("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Wr(this.apiClient,f),m=new ht;return Object.assign(m,p),m})}else{const u=Vi(this.apiClient,t);return c=M("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Pr(this.apiClient,f),m=new ht;return Object.assign(m,p),m})}}async get(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=ar(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>xt(this.apiClient,f))}else{const u=Ui(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>Rt(this.apiClient,f))}}async update(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=cr(this.apiClient,t);return c=M("{model}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>xt(this.apiClient,f))}else{const u=qi(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>Rt(this.apiClient,f))}}async delete(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=dr(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(()=>{const f=zr(),p=new gt;return Object.assign(p,f),p})}else{const u=Gi(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(()=>{const f=wr(),p=new gt;return Object.assign(p,f),p})}}async countTokens(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=pr(this.apiClient,t);return c=M("{model}:countTokens",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Or(this.apiClient,f),m=new yt;return Object.assign(m,p),m})}else{const u=Hi(this.apiClient,t);return c=M("{model}:countTokens",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=xr(this.apiClient,f),m=new yt;return Object.assign(m,p),m})}}async computeTokens(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI()){const c=mr(this.apiClient,t);return l=M("{model}:computeTokens",c._url),a=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>{const u=Xr(this.apiClient,d),f=new On;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=yr(this.apiClient,t);return c=M("{model}:predictLongRunning",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>es(this.apiClient,f))}else{const u=Yi(this.apiClient,t);return c=M("{model}:predictLongRunning",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>Fr(this.apiClient,f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function us(o,t){const e={},n=r(t,["operationName"]);n!=null&&s(e,["_url","operationName"],n);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function cs(o,t){const e={},n=r(t,["operationName"]);n!=null&&s(e,["_url","operationName"],n);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function ds(o,t){const e={},n=r(t,["operationName"]);n!=null&&s(e,["operationName"],n);const i=r(t,["resourceName"]);i!=null&&s(e,["_url","resourceName"],i);const l=r(t,["config"]);return l!=null&&s(e,["config"],l),e}function fs(o,t){const e={},n=r(t,["video","uri"]);n!=null&&s(e,["uri"],n);const i=r(t,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],X(o,i));const l=r(t,["encoding"]);return l!=null&&s(e,["mimeType"],l),e}function ps(o,t){const e={},n=r(t,["_self"]);return n!=null&&s(e,["video"],fs(o,n)),e}function ms(o,t){const e={},n=r(t,["generatedSamples"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(c=>ps(o,c))),s(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const l=r(t,["raiMediaFilteredReasons"]);return l!=null&&s(e,["raiMediaFilteredReasons"],l),e}function hs(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);a!=null&&s(e,["error"],a);const c=r(t,["response","generateVideoResponse"]);return c!=null&&s(e,["response"],ms(o,c)),e}function gs(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&s(e,["uri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],X(o,i));const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function ys(o,t){const e={},n=r(t,["_self"]);return n!=null&&s(e,["video"],gs(o,n)),e}function Ts(o,t){const e={},n=r(t,["videos"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(c=>ys(o,c))),s(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const l=r(t,["raiMediaFilteredReasons"]);return l!=null&&s(e,["raiMediaFilteredReasons"],l),e}function Dt(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);a!=null&&s(e,["error"],a);const c=r(t,["response"]);return c!=null&&s(e,["response"],Ts(o,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Cs extends oe{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=e.name.split("/operations/")[0];let l;return n&&"httpOptions"in n&&(l=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:l}})}else return this.getVideosOperationInternal({operationName:e.name,config:n})}async getVideosOperationInternal(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=cs(this.apiClient,t);return c=M("{operationName}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>Dt(this.apiClient,f))}else{const u=us(this.apiClient,t);return c=M("{operationName}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>hs(this.apiClient,f))}}async fetchPredictVideosOperationInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI()){const c=ds(this.apiClient,t);return l=M("{resourceName}:fetchPredictOperation",c._url),a=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>Dt(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vs="Content-Type",Es="X-Server-Timeout",Ss="User-Agent",_s="x-goog-api-client",Is="0.12.0",As=`google-genai-sdk/${Is}`,Ms="v1beta1",Ps="v1beta",Nt=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Zt extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ClientError"}}class Re extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ServerError"}}class Rs{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:Ms,this.getProject()||this.getLocation()?(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`,this.clientOptions.apiKey=void 0):(i.baseUrl="https://aiplatform.googleapis.com/",this.clientOptions.project=void 0,this.clientOptions.location=void 0)):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Ps,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol=e.protocol=="http:"?"ws":"wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e,n){const i=[this.getRequestUrlInternal(e)];return n&&i.push(this.getBaseResourcePath()),t!==""&&i.push(t),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);if(t.queryParams)for(const[a,c]of Object.entries(t.queryParams))i.searchParams.append(a,String(c));let l={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else l.body=t.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,e,t.abortSignal),this.unaryApiCall(i,l,t.httpMethod)}patchHttpOptions(t,e){const n=JSON.parse(JSON.stringify(t));for(const[i,l]of Object.entries(e))typeof l=="object"?n[i]=Object.assign(Object.assign({},n[i]),l):l!==void 0&&(n[i]=l);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let l={};return l.body=t.body,l=await this.includeExtraHttpOptionsToRequestInit(l,e,t.abortSignal),this.streamApiCall(i,l,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,n){if(e&&e.timeout||n){const i=new AbortController,l=i.signal;e.timeout&&(e==null?void 0:e.timeout)>0&&setTimeout(()=>i.abort(),e.timeout),n&&n.addEventListener("abort",()=>{i.abort()}),t.signal=l}return t.headers=await this.getHeadersInternal(e),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await Lt(i),new Ae(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await Lt(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){var e;return me(this,arguments,function*(){const i=(e=t==null?void 0:t.body)===null||e===void 0?void 0:e.getReader(),l=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let a="";for(;;){const{done:c,value:d}=yield G(i.read());if(c){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=l.decode(d);try{const p=JSON.parse(u);if("error"in p){const m=JSON.parse(JSON.stringify(p.error)),g=m.status,h=m.code,T=`got status: ${g}. ${JSON.stringify(p)}`;if(h>=400&&h<500)throw new Zt(T);if(h>=500&&h<600)throw new Re(T)}}catch(p){const m=p;if(m.name==="ClientError"||m.name==="ServerError")throw p}a+=u;let f=a.match(Nt);for(;f;){const p=f[1];try{const m=new Response(p,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield G(new Ae(m)),a=a.slice(f[0].length),f=a.match(Nt)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const t={},e=As+" "+this.clientOptions.userAgentExtra;return t[Ss]=e,t[_s]=e,t[vs]="application/json",t}async getHeadersInternal(t){const e=new Headers;if(t&&t.headers){for(const[n,i]of Object.entries(t.headers))e.append(n,i);t.timeout&&t.timeout>0&&e.append(Es,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(e),e}async uploadFile(t,e){var n;const i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const l=this.clientOptions.uploader,a=await l.stat(t);i.sizeBytes=String(a.size);const c=(n=e==null?void 0:e.mimeType)!==null&&n!==void 0?n:a.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=c;const d=await this.fetchUploadUrl(i,e);return l.upload(t,d,this)}async fetchUploadUrl(t,e){var n;let i={};e!=null&&e.httpOptions?i=e.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`}};const l={file:t},a=await this.request({path:M("upload/v1beta/files",l._url),body:JSON.stringify(l),httpMethod:"POST",httpOptions:i});if(!a||!(a!=null&&a.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const c=(n=a==null?void 0:a.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(c===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function Lt(o){var t;if(o===void 0)throw new Re("response is undefined");if(!o.ok){const e=o.status,n=o.statusText;let i;!((t=o.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?i=await o.json():i={error:{message:await o.text(),code:o.status,status:o.statusText}};const l=`got status: ${e} ${n}. ${JSON.stringify(i)}`;throw e>=400&&e<500?new Zt(l):e>=500&&e<600?new Re(l):new Error(l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ws(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],n);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function xs(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);e!==void 0&&l!=null&&s(e,["_query","pageToken"],l);const a=r(t,["filter"]);return e!==void 0&&a!=null&&s(e,["_query","filter"],a),n}function Ds(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],xs(o,n,e)),e}function Ns(o,t){const e={},n=r(t,["textInput"]);n!=null&&s(e,["textInput"],n);const i=r(t,["output"]);return i!=null&&s(e,["output"],i),e}function Ls(o,t){const e={};if(r(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(t,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>Ns(o,l))),s(e,["examples","examples"],i)}return e}function Fs(o,t,e){const n={};if(r(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=r(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&s(e,["displayName"],i),r(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const l=r(t,["epochCount"]);e!==void 0&&l!=null&&s(e,["tuningTask","hyperparameters","epochCount"],l);const a=r(t,["learningRateMultiplier"]);if(a!=null&&s(n,["tuningTask","hyperparameters","learningRateMultiplier"],a),r(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const c=r(t,["batchSize"]);e!==void 0&&c!=null&&s(e,["tuningTask","hyperparameters","batchSize"],c);const d=r(t,["learningRate"]);return e!==void 0&&d!=null&&s(e,["tuningTask","hyperparameters","learningRate"],d),n}function Vs(o,t){const e={},n=r(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=r(t,["trainingDataset"]);i!=null&&s(e,["tuningTask","trainingData"],Ls(o,i));const l=r(t,["config"]);return l!=null&&s(e,["config"],Fs(o,l,e)),e}function Us(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],n);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function ks(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);e!==void 0&&l!=null&&s(e,["_query","pageToken"],l);const a=r(t,["filter"]);return e!==void 0&&a!=null&&s(e,["_query","filter"],a),n}function qs(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],ks(o,n,e)),e}function Gs(o,t,e){const n={},i=r(t,["gcsUri"]);if(e!==void 0&&i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],i),r(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function Bs(o,t){const e={},n=r(t,["gcsUri"]);return n!=null&&s(e,["validationDatasetUri"],n),e}function Hs(o,t,e){const n={},i=r(t,["validationDataset"]);e!==void 0&&i!=null&&s(e,["supervisedTuningSpec"],Bs(o,i));const l=r(t,["tunedModelDisplayName"]);e!==void 0&&l!=null&&s(e,["tunedModelDisplayName"],l);const a=r(t,["description"]);e!==void 0&&a!=null&&s(e,["description"],a);const c=r(t,["epochCount"]);e!==void 0&&c!=null&&s(e,["supervisedTuningSpec","hyperParameters","epochCount"],c);const d=r(t,["learningRateMultiplier"]);e!==void 0&&d!=null&&s(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);const u=r(t,["adapterSize"]);if(e!==void 0&&u!=null&&s(e,["supervisedTuningSpec","hyperParameters","adapterSize"],u),r(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(r(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function $s(o,t){const e={},n=r(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=r(t,["trainingDataset"]);i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],Gs(o,i,e));const l=r(t,["config"]);return l!=null&&s(e,["config"],Hs(o,l,e)),e}function Js(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["model"],n);const i=r(t,["name"]);return i!=null&&s(e,["endpoint"],i),e}function Qt(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["state"]);i!=null&&s(e,["state"],Wt(o,i));const l=r(t,["createTime"]);l!=null&&s(e,["createTime"],l);const a=r(t,["tuningTask","startTime"]);a!=null&&s(e,["startTime"],a);const c=r(t,["tuningTask","completeTime"]);c!=null&&s(e,["endTime"],c);const d=r(t,["updateTime"]);d!=null&&s(e,["updateTime"],d);const u=r(t,["description"]);u!=null&&s(e,["description"],u);const f=r(t,["baseModel"]);f!=null&&s(e,["baseModel"],f);const p=r(t,["_self"]);p!=null&&s(e,["tunedModel"],Js(o,p));const m=r(t,["distillationSpec"]);m!=null&&s(e,["distillationSpec"],m);const g=r(t,["experiment"]);g!=null&&s(e,["experiment"],g);const h=r(t,["labels"]);h!=null&&s(e,["labels"],h);const T=r(t,["pipelineJob"]);T!=null&&s(e,["pipelineJob"],T);const v=r(t,["tunedModelDisplayName"]);return v!=null&&s(e,["tunedModelDisplayName"],v),e}function Ys(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["tunedModels"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>Qt(o,a))),s(e,["tuningJobs"],l)}return e}function Ws(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);return a!=null&&s(e,["error"],a),e}function bs(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["model"],n);const i=r(t,["endpoint"]);return i!=null&&s(e,["endpoint"],i),e}function we(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["state"]);i!=null&&s(e,["state"],Wt(o,i));const l=r(t,["createTime"]);l!=null&&s(e,["createTime"],l);const a=r(t,["startTime"]);a!=null&&s(e,["startTime"],a);const c=r(t,["endTime"]);c!=null&&s(e,["endTime"],c);const d=r(t,["updateTime"]);d!=null&&s(e,["updateTime"],d);const u=r(t,["error"]);u!=null&&s(e,["error"],u);const f=r(t,["description"]);f!=null&&s(e,["description"],f);const p=r(t,["baseModel"]);p!=null&&s(e,["baseModel"],p);const m=r(t,["tunedModel"]);m!=null&&s(e,["tunedModel"],bs(o,m));const g=r(t,["supervisedTuningSpec"]);g!=null&&s(e,["supervisedTuningSpec"],g);const h=r(t,["tuningDataStats"]);h!=null&&s(e,["tuningDataStats"],h);const T=r(t,["encryptionSpec"]);T!=null&&s(e,["encryptionSpec"],T);const v=r(t,["partnerModelTuningSpec"]);v!=null&&s(e,["partnerModelTuningSpec"],v);const S=r(t,["distillationSpec"]);S!=null&&s(e,["distillationSpec"],S);const I=r(t,["experiment"]);I!=null&&s(e,["experiment"],I);const y=r(t,["labels"]);y!=null&&s(e,["labels"],y);const E=r(t,["pipelineJob"]);E!=null&&s(e,["pipelineJob"],E);const P=r(t,["tunedModelDisplayName"]);return P!=null&&s(e,["tunedModelDisplayName"],P),e}function Ks(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["tuningJobs"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>we(o,a))),s(e,["tuningJobs"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zs extends oe{constructor(t){super(),this.apiClient=t,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new xe(ne.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.tune=async e=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(e);{const n=await this.tuneMldevInternal(e);let i="";return n.metadata!==void 0&&n.metadata.tunedModel!==void 0?i=n.metadata.tunedModel:n.name!==void 0&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:Ie.JOB_STATE_QUEUED}}}}async getInternal(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=Us(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>we(this.apiClient,f))}else{const u=ws(this.apiClient,t);return c=M("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>Qt(this.apiClient,f))}}async listInternal(t){var e,n,i,l;let a,c="",d={};if(this.apiClient.isVertexAI()){const u=qs(this.apiClient,t);return c=M("tuningJobs",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Ks(this.apiClient,f),m=new Tt;return Object.assign(m,p),m})}else{const u=Ds(this.apiClient,t);return c=M("tunedModels",u._url),d=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Ys(this.apiClient,f),m=new Tt;return Object.assign(m,p),m})}}async tuneInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI()){const c=$s(this.apiClient,t);return l=M("tuningJobs",c._url),a=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>we(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Vs(this.apiClient,t);return l=M("tunedModels",c._url),a=c._query,delete c.config,delete c._url,delete c._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),i.then(d=>Ws(this.apiClient,d))}}}const Os=1024*1024*8;async function Xs(o,t,e){var n,i;let l=0,a=0,c=new Ae(new Response),d="upload";for(l=o.size;a<l;){const f=Math.min(Os,l-a),p=o.slice(a,a+f);if(a+f>=l&&(d+=", finalize"),c=await e.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(a),"Content-Length":String(f)}}}),a+=f,((n=c==null?void 0:c.headers)===null||n===void 0?void 0:n["x-goog-upload-status"])!=="active")break;if(l<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const u=await(c==null?void 0:c.json());if(((i=c==null?void 0:c.headers)===null||i===void 0?void 0:i["x-goog-upload-status"])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return u.file}async function Zs(o){return{size:o.size,type:o.type}}class Qs{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Xs(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Zs(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class js{create(t,e,n){return new el(t,e,n)}}class el{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ft="x-goog-api-key";class tl{constructor(t){this.apiKey=t}async addAuthHeaders(t){t.get(Ft)===null&&t.append(Ft,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nl="gl-node/";class ol{constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey;const n=dn(t,void 0,void 0);n&&(t.httpOptions?t.httpOptions.baseUrl=n:t.httpOptions={baseUrl:n}),this.apiVersion=t.apiVersion;const i=new tl(this.apiKey);this.apiClient=new Rs({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:nl+"web",uploader:new Qs}),this.models=new as(this.apiClient),this.live=new os(this.apiClient,i,new js),this.chats=new oo(this.models,this.apiClient),this.caches=new jn(this.apiClient),this.files=new yo(this.apiClient),this.operations=new Cs(this.apiClient),this.tunings=new zs(this.apiClient)}}let N,jt,Se=null,Q=!1,J=[],ee=[],Y=null,B=null,le=null,he=new Map,$=new Map,b=null,ae=null,te=[],K="de",De={};function il(o,t){return t.split(".").reduce((e,n)=>e?e[n]:void 0,o)}function _(o,t){let e=il(De[K],o);if(typeof e!="string")return console.warn(`Translation key not found for language '${K}': ${o}`),o;if(t)for(const n in t)e=e.replace(`{${n}}`,String(t[n]));return e}async function rl(){De[K]||await en(),document.querySelectorAll("[data-translate-key]").forEach(t=>{const e=t.getAttribute("data-translate-key"),n=_(e);if(t.hasAttribute("placeholder"))t.placeholder=n;else if(t.tagName==="INPUT"&&t.type==="text")t.value=n;else{const i=Array.from(t.childNodes).find(l=>{var a;return l.nodeType===Node.TEXT_NODE&&((a=l.textContent)==null?void 0:a.trim())});i?i.textContent=n:t.textContent=n}}),document.querySelectorAll("[data-translate-key-placeholder]").forEach(t=>{const e=t.getAttribute("data-translate-key-placeholder");t.placeholder=_(e)}),document.querySelectorAll("[data-translate-key-aria]").forEach(t=>{const e=t.getAttribute("data-translate-key-aria");t.setAttribute("aria-label",_(e))}),document.querySelectorAll("[data-translate-key-tooltip]").forEach(t=>{const e=t.getAttribute("data-translate-key-tooltip");t.dataset.tooltip=_(e)});const o=document.getElementById("toggle-draw-mode");if(o){const t=o.querySelector("span");t&&(t.textContent=_(Q?"map.setWaypointsActive":"map.setWaypoints"))}}async function en(){try{const o=await fetch("translations.json");if(!o.ok)throw new Error("Failed to load translations file.");De=await o.json()}catch(o){console.error("Could not load translations:",o)}}async function Vt(o){var t;K=o,localStorage.setItem("language",o),document.documentElement.lang=o,document.querySelectorAll(".lang-btn").forEach(e=>{e.classList.toggle("active",e.getAttribute("data-lang")===o)}),await rl(),$.size>0&&nn(),((t=document.querySelector(".product-recommendations-container"))==null?void 0:t.classList.contains("hidden"))===!1&&await ye()}function sl(){const o=document.getElementById("map");if(!o){console.error("Map container element not found.");return}const t=[51.7189,8.7575];N=L.map(o,{zoomControl:!1,preferCanvas:!0}).setView(t,16),L.control.zoom({position:"topright"}).addTo(N),jt=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(N)}const de=()=>{he.forEach(e=>{e.forEach(n=>N.removeLayer(n))}),he.clear(),$.clear();const o=document.querySelector(".threat-list");o&&(o.innerHTML="");const t=document.querySelector(".product-recommendations-container");t&&t.classList.add("hidden")};function ll(o,t,e,n){const i=o.lon,l=o.lat,a=t.lon,c=t.lat,d=e.lon,u=e.lat,f=n.lon,p=n.lat,m=(i-a)*(u-p)-(l-c)*(d-f);if(m===0)return null;const g=((i-d)*(u-p)-(l-u)*(d-f))/m,h=-((i-a)*(l-u)-(l-c)*(i-d))/m;return g>0&&g<1&&h>0&&h<1?{lat:l+g*(c-l),lon:i+g*(a-i)}:null}const Ut=(o,t)=>{let e=!1;for(let n=0,i=t.length-1;n<t.length;i=n++){const l=t[n].lon,a=t[n].lat,c=t[i].lon,d=t[i].lat;a>o.lat!=d>o.lat&&o.lon<(c-l)*(o.lat-a)/(d-a)+l&&(e=!e)}return e};function al(o,t){const n=o.lat*Math.PI/180,i=t.lat*Math.PI/180,l=(t.lat-o.lat)*Math.PI/180,a=(t.lon-o.lon)*Math.PI/180,c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(n)*Math.cos(i)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function ul(o,t,e){const n={x:o.lon-t.lon,y:o.lat-t.lat},i={x:e.lon-t.lon,y:e.lat-t.lat},l=n.x*i.x+n.y*i.y,a=Math.sqrt(n.x*n.x+n.y*n.y),c=Math.sqrt(i.x*i.x+i.y*i.y);if(a===0||c===0)return 180;const d=l/(a*c),u=Math.max(-1,Math.min(1,d));return Math.acos(u)*(180/Math.PI)}function tn(o){switch(o){case"500":return[4,6];case"3500":return[3,4];case"7500":return[1.5,2.5];case"12000":return[1,1.5];case"40000":return[.5,1];default:return null}}function ge(o,t){return t<=0?0:Math.sqrt(2*o*t)*3.6}function nn(){const o=document.querySelector(".threat-list");if(!o||(o.innerHTML="",$.size===0))return;const e=document.getElementById("vehicle-select").value,n=tn(e);if($.forEach((i,l)=>{if(i.entryPoints.length===0)return;const a=document.createElement("li"),c=Math.round(i.totalLength);let d="";if(n&&c>0){const[u,f]=n,p=Math.round(ge(u,c)),m=Math.round(ge(f,c));d=` | ${_("threats.speed")}: ${p}-${m} km/h`}a.textContent=`${l} (${c} m)${d}`,a.setAttribute("role","button"),a.setAttribute("tabindex","0"),a.addEventListener("click",()=>{o.querySelectorAll("li").forEach(f=>f.classList.remove("active")),a.classList.add("active");const u=he.get(l);if(u&&u.length>0){const f=L.featureGroup(u);N.fitBounds(f.getBounds().pad(.5))}}),a.addEventListener("keydown",u=>{(u.key==="Enter"||u.key===" ")&&a.click()}),o.appendChild(a)}),o.children.length===0){const i=document.createElement("li");i.textContent=_("threats.noCrossingWaysBoundary"),o.appendChild(i)}}const kt=async()=>{if(!B){alert(_("alerts.noPolygon"));return}const o=document.querySelector(".loading-indicator");if(o){de(),o.classList.remove("hidden");try{const t=B.getBounds(),e=.002,n=t.getSouthWest(),i=t.getNorthEast(),l=`${n.lat-e},${n.lng-e},${i.lat+e},${i.lng+e}`,a=`
            [out:json][timeout:25];
            (
              way["highway"](bbox:${l});
              way["railway"="tram"](bbox:${l});
            );
            (._;>;);
            out;
        `,c=`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(a)}`,d=await fetch(c);if(!d.ok)throw new Error(_("alerts.overpassError",{status:d.status}));const u=await d.json(),f={},p={};u.elements.forEach(h=>{h.type==="node"?f[h.id]={lat:h.lat,lon:h.lon}:h.type==="way"&&h.tags&&(h.tags.highway||h.tags.railway)&&h.tags.name&&(p[h.id]={name:h.tags.name,nodes:h.nodes,id:h.id})});const m=new Map,g=B.getLatLngs()[0].map(h=>({lat:h.lat,lon:h.lng}));for(const h in p){const T=p[h],v=T.nodes.map(y=>({id:y,...f[y]})).filter(y=>y.lat&&y.lon);if(v.length<2)continue;const S=[],I=[];for(let y=0;y<v.length-1;y++){const E=v[y],P=v[y+1],k=Ut(E,g),R=Ut(P,g);if(k!==R){let C=null;for(let A=0;A<g.length;A++){const w=g[A],F=g[(A+1)%g.length],q=ll(E,P,w,F);if(q){C=q;break}}if(C){I.push(C);const A=[C];let w,F;R?(A.push({lat:E.lat,lon:E.lon}),w=y-1,F=-1):(A.push({lat:P.lat,lon:P.lon}),w=y+1,F=1);for(let q=w;q>=0&&q<v.length;q+=F){const D=v[q];if(A.length>=2){const x=A[A.length-2],U=A[A.length-1],Z={lat:D.lat,lon:D.lon};if(ul(x,U,Z)<150)break}A.push({lat:D.lat,lon:D.lon})}S.push(A)}}}if(I.length>0){m.has(T.name)||m.set(T.name,{entryPoints:[],pathSegments:[],totalLength:0});const y=m.get(T.name);y.entryPoints.push(...I),y.pathSegments.push(...S);let E=0;S.forEach(P=>{for(let k=0;k<P.length-1;k++)E+=al(P[k],P[k+1])}),y.totalLength+=E}}if($=m,$.size>0){$.forEach((T,v)=>{if(T.entryPoints.length===0)return;const S=[];T.entryPoints.forEach(I=>{const y=L.circle([I.lat,I.lon],{radius:5,color:"red",fillColor:"#f03",fillOpacity:1,weight:2}).addTo(N).bindPopup(`<b>${_("threats.popupHeader")}</b><br>${v}`);S.push(y)}),T.pathSegments.forEach(I=>{if(I.length>1){const y=I.map(P=>[P.lat,P.lon]),E=L.polyline(y,{color:"red",weight:4,opacity:.8}).addTo(N);S.push(E)}}),S.length>0&&he.set(v,S)}),nn();const h=document.querySelector(".product-recommendations-container");h&&(h.classList.remove("hidden"),await ye())}else{const h=document.querySelector(".threat-list"),T=document.createElement("li");T.textContent=_("threats.noCrossingWaysArea"),h.appendChild(T)}}catch(t){console.error("Fehler bei der Gefahrenanalyse:",t),alert(_("alerts.analysisError"));const e=document.querySelector(".threat-list"),n=document.createElement("li");n.textContent=_("threats.analysisFailed"),e.appendChild(n)}finally{o.classList.add("hidden")}}};async function cl(o){try{const t="AIzaSyAu89J9B0b57XIao133a19Wd64T6oiCA9A",e=new ol({apiKey:t}),n=_("ai.reportPrompt",{locationName:o.locationName,assetToProtect:o.assetToProtect,securityLevel:o.securityLevel,protectionGrade:o.protectionGrade,threatList:o.threatList,protectionPeriod:o.protectionPeriod,productType:o.productType,penetration:o.penetration,debrisDistance:o.debrisDistance,language:K==="de"?"German":"English"}),l=(await e.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{responseMimeType:"application/json",responseSchema:{type:W.OBJECT,properties:{purpose:{type:W.STRING},threatAnalysis:{type:W.STRING},vulnerabilities:{type:W.STRING},hvmMeasures:{type:W.STRING},siteConsiderations:{type:W.STRING},operationalImpact:{type:W.STRING}},required:["purpose","threatAnalysis","vulnerabilities","hvmMeasures","siteConsiderations","operationalImpact"]}}})).text.trim();return JSON.parse(l)}catch(t){return console.error("Fehler bei der Gemini-API-Anfrage fr den Bericht:",t),alert(_("alerts.geminiError")),null}}async function dl(o){const t=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${o.lat}&lon=${o.lng}&zoom=18&addressdetails=1`;try{const e=await fetch(t,{headers:{"Accept-Language":K}});return e.ok&&(await e.json()).display_name||"Unknown Location"}catch(e){return console.error("Fehler beim Reverse Geocoding:",e),"Could not determine location"}}async function ye(){if(te.length===0)try{const d=await fetch("product-database.json");if(!d.ok)throw new Error("Product database fetch failed");te=await d.json()}catch(d){console.error(_("alerts.productDbError"),d);const u=document.querySelector("#poller-category-header small"),f=document.querySelector("#barrier-category-header small");u&&(u.textContent=_("products.dbError")),f&&(f.textContent=_("products.dbError"));return}const t=document.getElementById("vehicle-select").value,e=document.querySelector("#poller-category-header small"),n=document.querySelector("#barrier-category-header small");if(e&&(e.textContent=_("products.resistanceHigh")),n&&(n.textContent=_("products.resistanceMedium")),t==="alle")return;const i=["bollard","poller"],l=["barrier","barriere","gate"],a=te.find(d=>d.vehicleWeight===t&&d.type&&i.some(u=>d.type.toLowerCase().includes(u))),c=te.find(d=>d.vehicleWeight===t&&d.type&&l.some(u=>d.type.toLowerCase().includes(u)));e&&(e.textContent=a?`${_("products.recommendation")} ${a.type}`:_("products.noRecommendation")),n&&(n.textContent=c?`${_("products.recommendation")} ${c.type}`:_("products.noRecommendation"))}function qt(o){return o<33?_("sidebar.low"):o<66?_("products.resistanceMedium"):_("sidebar.high")}function fl(){const o=document.getElementById("vehicle-select"),t=parseInt(o.value,10);if(isNaN(t))return null;let e=null,n=1/0;for(const i of te){const l=parseInt(i.vehicleWeight,10),a=parseFloat(i.penetration);!isNaN(l)&&!isNaN(a)&&l>=t&&a<n&&(n=a,e=i)}return e}async function pl(){var a;const o=document.getElementById("report-iframe"),t=document.querySelector(".report-loading-overlay"),e=document.getElementById("download-report-btn"),n=document.getElementById("map"),i=document.getElementById("report-preview-area");t.classList.remove("view-hidden"),e.disabled=!0;let l=null;try{B&&(i.classList.add("view-hidden"),n.classList.remove("view-hidden"),await new Promise(D=>{N.invalidateSize();const x=()=>requestAnimationFrame(()=>setTimeout(D,250));let U;jt.once("load",()=>{clearTimeout(U),x()}),N.once("moveend",()=>{U=window.setTimeout(x,500)}),N.fitBounds(B.getBounds(),{animate:!1})}),l=await html2canvas(n,{useCORS:!0,logging:!1,onclone:D=>{D.querySelectorAll(".leaflet-popup-pane > *").forEach(x=>x.style.display="none")}}));const c=B?await dl(B.getBounds().getCenter()):_("report.undefinedLocation"),u=document.getElementById("asset-to-protect").value.trim()||_("report.undefinedAsset"),f=$.size>0?Array.from($.keys()).join(", "):_("report.noThreatAnalysis"),p=document.getElementById("security-risk-slider"),m=document.getElementById("product-class-slider"),g=document.getElementById("protection-period-select"),h=document.getElementById("protection-product-select"),T=fl(),v={locationName:c,assetToProtect:u,securityLevel:qt(parseInt(p.value)),protectionGrade:qt(parseInt(m.value)),threatList:f,protectionPeriod:g.options[g.selectedIndex].text,productType:h.options[h.selectedIndex].text,penetration:T?T.penetration:_("report.undefinedValue"),debrisDistance:T&&T.debrisDistance||_("report.undefinedValue")},S=await cl(v);if(!S)throw new Error("AI did not return report sections.");const{jsPDF:I}=window.jspdf,y=new I({orientation:"p",unit:"mm",format:"a4"}),E=()=>{const D=y.internal.pageSize.getWidth(),x=y.internal.pageSize.getHeight();if(y.saveGraphicsState(),y.setFont("helvetica","bold"),y.setFontSize(120),y.setTextColor(200,200,200),I.GState){const U=new I.GState({opacity:.2});y.setGState(U)}y.text(_("report.watermark"),D/2+50,x/2+50,{align:"center",angle:45}),y.restoreGraphicsState()},P=20,k=y.internal.pageSize.getWidth(),R=k-P*2;let C=25;const A=(D,x)=>{C>250&&(y.addPage(),E(),C=25),y.setFont("helvetica","bold").setFontSize(14).text(_(D),P,C),C+=7;const U=y.setFont("helvetica","normal").setFontSize(11).splitTextToSize(x,R);C+U.length*5>280&&(y.addPage(),E(),C=25),y.text(U,P,C),C+=U.length*5+10};E();const w=_("report.mainTitle",{locationName:c});y.setFont("helvetica","bold").setFontSize(18);const F=y.splitTextToSize(w,R),q=8;if(C+F.length*q>280&&(y.addPage(),E(),C=25),y.text(F,P,C),C+=F.length*q+5,y.setDrawColor(30,144,255).setLineWidth(.5).line(P,C,k-P,C),C+=15,A("report.sections.purpose.title",S.purpose),A("report.sections.threatAnalysis.title",S.threatAnalysis),$.size>0){C-=5,y.setFont("helvetica","normal").setFontSize(11);const x=document.getElementById("vehicle-select").value,U=tn(x);$.forEach((Z,Ne)=>{let Le=` ${Ne} (${Math.round(Z.totalLength)} m)`;if(U&&Z.totalLength>0){const[on,rn]=U,sn=Math.round(ge(on,Z.totalLength)),ln=Math.round(ge(rn,Z.totalLength));Le+=` | ${_("threats.speed")}: ${sn}-${ln} km/h`}const Ee=y.splitTextToSize(Le,R-5);C+Ee.length*7>280&&(y.addPage(),E(),C=25),y.text(Ee,P+5,C),C+=Ee.length*6}),C+=10}if(A("report.sections.vulnerabilities.title",S.vulnerabilities),A("report.sections.hvmMeasures.title",S.hvmMeasures),A("report.sections.siteConsiderations.title",S.siteConsiderations),l){const D=l.height/l.width,x=R*D;C+x>280&&(y.addPage(),E(),C=25),y.addImage(l,"PNG",P,C,R,x),C+=x+10}else{const D=_("report.noMapAvailable"),x=y.setFont("helvetica","italic").setFontSize(10).splitTextToSize(D,R);C+x.length*5>280&&(y.addPage(),E(),C=25),y.text(x,P,C),C+=x.length*5+10}A("report.sections.operationalImpact.title",S.operationalImpact);try{const D=y.getNumberOfPages||((a=y.internal)==null?void 0:a.getNumberOfPages),x=typeof D=="function"?D.call(y):1;for(let U=1;U<=x;U++)y.setPage(U),E()}catch{E()}i.classList.remove("view-hidden"),n.classList.add("view-hidden"),await new Promise(requestAnimationFrame);try{const D=y.output("blob");ae&&URL.revokeObjectURL(ae),ae=URL.createObjectURL(D),o.src=ae}catch{o.src=y.output("datauristring")}b=y,e.disabled=!1}catch(c){console.error("Fehler bei der Erstellung des Berichts:",c),alert(_("alerts.reportCreationError")),n.classList.add("view-hidden"),i.classList.remove("view-hidden")}finally{t.classList.add("view-hidden")}}function ml(){b?b.save(_("report.reportFilename")):alert(_("alerts.noReportToDownload"))}document.addEventListener("DOMContentLoaded",async()=>{var k;sl(),await en();const o=localStorage.getItem("language")||"de";await Vt(o),document.querySelectorAll(".lang-btn").forEach(R=>{R.addEventListener("click",C=>{const A=C.currentTarget.dataset.lang;A&&A!==K&&Vt(A)})});const t=document.getElementById("tooltip");document.querySelectorAll(".info-icon").forEach(R=>{R.addEventListener("mouseover",C=>{const A=C.currentTarget,w=A.dataset.tooltip||"";t.textContent=w,t.style.opacity="1";const F=A.getBoundingClientRect();t.style.left=`${F.left+window.scrollX}px`,t.style.top=`${F.bottom+window.scrollY+5}px`}),R.addEventListener("mouseout",()=>{t.style.opacity="0"})});const n=document.getElementById("map-search-input"),i=document.getElementById("map-search-button"),l=async()=>{const R=n.value.trim();if(!R)return;const C=`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(R)}`;try{const A=await fetch(C,{headers:{"Accept-Language":K}});if(!A.ok)throw new Error(`API request failed with status ${A.status}`);const w=await A.json();if(w&&w.length>0){const{lat:F,lon:q,display_name:D}=w[0];N.setView([F,q],15),Se&&N.removeLayer(Se),Se=L.marker([F,q]).addTo(N).bindPopup(`<b>${D}</b>`).openPopup()}else alert(_("alerts.locationNotFound"))}catch(A){console.error("Fehler bei der Kartensuche:",A),alert(_("alerts.searchError"))}};i.addEventListener("click",l),n.addEventListener("keypress",R=>{R.key==="Enter"&&l()});const a=document.getElementById("toggle-draw-mode"),c=document.getElementById("reset-drawing"),d=document.getElementById("map"),u=R=>{Q=R;const C=a.querySelector("span");R?(a.classList.add("active"),C&&(C.textContent=_("map.setWaypointsActive")),d==null||d.classList.add("drawing-mode")):(a.classList.remove("active"),C&&(C.textContent=_("map.setWaypoints")),d==null||d.classList.remove("drawing-mode"))},f=()=>{ee.forEach(R=>N.removeLayer(R)),ee=[],Y&&N.removeLayer(Y),Y=null,B&&N.removeLayer(B),B=null,le&&N.removeLayer(le),le=null,J=[],Q&&u(!1)},p=()=>{Y&&N.removeLayer(Y),J.length>1&&(Y=L.polyline(J,{color:"var(--accent-color)",weight:3}).addTo(N))},m=()=>{if(J.length<3)return;B&&N.removeLayer(B),B=L.polygon(J,{color:"yellow",fillColor:"#FFFF00",fillOpacity:.3,weight:2}).addTo(N);const R=B.getBounds().getCenter();le=L.marker(R,{icon:L.divIcon({className:"polygon-label",html:_("map.securityAreaLabel"),iconSize:[150,24]})}).addTo(N),Y&&N.removeLayer(Y),Y=null,ee.forEach(C=>N.removeLayer(C)),ee=[],J=[],u(!1)},g=R=>{if(!Q)return;const C=R.latlng,A=L.marker(C).addTo(N);J.length===0&&A.on("click",()=>{Q&&J.length>=3&&m()}),J.push(C),ee.push(A),p()};N.on("click",g);const h=document.querySelectorAll(".main-nav a"),T=document.getElementById("analyze-threats"),v=document.getElementById("create-report-btn"),S=document.getElementById("download-report-btn"),I=document.getElementById("report-iframe"),y=document.getElementById("map"),E=document.getElementById("report-preview-area"),P=document.getElementById("vehicle-select");h.forEach(R=>{R.addEventListener("click",async C=>{C.preventDefault();const A=C.currentTarget,w=A.id;h.forEach(q=>q.classList.remove("active")),A.classList.add("active"),w==="nav-param-input"&&(f(),de(),b=null),w==="nav-marking-area"&&(de(),b=null),w==="nav-threat-analysis"&&(b=null),w==="nav-product-selection"&&await ye(),a.classList.add("hidden"),c.classList.add("hidden"),T.classList.add("hidden"),v.classList.add("hidden"),S.classList.add("hidden");const F=w==="nav-risk-report";y.classList.toggle("view-hidden",F),E.classList.toggle("view-hidden",!F),N&&(F||N.invalidateSize()),b||(I.src="about:blank",S.disabled=!0),w==="nav-marking-area"?(a.classList.remove("hidden"),c.classList.remove("hidden")):w==="nav-threat-analysis"?T.classList.remove("hidden"):w==="nav-risk-report"&&(v.classList.remove("hidden"),S.classList.remove("hidden"),S.disabled=!b)})}),P.addEventListener("change",async()=>{var R;$.size>0&&await kt(),((R=document.querySelector(".product-recommendations-container"))==null?void 0:R.classList.contains("hidden"))===!1&&await ye()}),a.addEventListener("click",()=>{B&&f(),u(!Q)}),c.addEventListener("click",()=>{f(),de()}),T.addEventListener("click",kt),v.addEventListener("click",pl),S.addEventListener("click",ml),(k=document.getElementById("nav-param-input"))==null||k.click()});
