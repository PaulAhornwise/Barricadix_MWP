const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/indexIntegration-BWW4NxPp.js","assets/mapIntegration-Gh_eCX7z.js","assets/entryDetectionIntegration-CxuSJ9_A.js","assets/index-CcROzGNL.js","assets/nrwProvider-CmK2Sn0v.js","assets/osmProvider-gKewWwbw.js","assets/provider-DtzApHY_.js"])))=>i.map(i=>d[i]);
var e,t,n=Object.defineProperty,i=(e,t,i)=>((e,t,i)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const r={},s=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),s=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));i=e(t.map(e=>{if((e=function(e){return"/Barricadix_MWP/"+e}(e))in r)return;r[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,s&&i.setAttribute("nonce",s),document.head.appendChild(i),t?new Promise((t,n)=>{i.addEventListener("load",t),i.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})};var o,a,l,c,u,h;(a=o||(o={})).STRING="string",a.NUMBER="number",a.INTEGER="integer",a.BOOLEAN="boolean",a.ARRAY="array",a.OBJECT="object",(c=l||(l={})).LANGUAGE_UNSPECIFIED="language_unspecified",c.PYTHON="python",(h=u||(u={})).OUTCOME_UNSPECIFIED="outcome_unspecified",h.OUTCOME_OK="outcome_ok",h.OUTCOME_FAILED="outcome_failed",h.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const d=["user","model","function","system"];var f,p,g,m,y,v,_,b,E,w,x,A,S,T,C,I;(p=f||(f={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",p.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",p.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",p.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",p.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",p.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(m=g||(g={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",m.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",m.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",m.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",m.BLOCK_NONE="BLOCK_NONE",(v=y||(y={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",v.NEGLIGIBLE="NEGLIGIBLE",v.LOW="LOW",v.MEDIUM="MEDIUM",v.HIGH="HIGH",(b=_||(_={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",b.SAFETY="SAFETY",b.OTHER="OTHER",(w=E||(E={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",w.STOP="STOP",w.MAX_TOKENS="MAX_TOKENS",w.SAFETY="SAFETY",w.RECITATION="RECITATION",w.LANGUAGE="LANGUAGE",w.BLOCKLIST="BLOCKLIST",w.PROHIBITED_CONTENT="PROHIBITED_CONTENT",w.SPII="SPII",w.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",w.OTHER="OTHER",(A=x||(x={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",A.RETRIEVAL_QUERY="RETRIEVAL_QUERY",A.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",A.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",A.CLASSIFICATION="CLASSIFICATION",A.CLUSTERING="CLUSTERING",(T=S||(S={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",T.AUTO="AUTO",T.ANY="ANY",T.NONE="NONE",(I=C||(C={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",I.MODE_DYNAMIC="MODE_DYNAMIC";
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class k extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class R extends k{constructor(e,t){super(e),this.response=t}}class P extends k{constructor(e,t,n,i){super(e),this.status=t,this.statusText=n,this.errorDetails=i}}class M extends k{}class B extends k{}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var N,O;(O=N||(N={})).GENERATE_CONTENT="generateContent",O.STREAM_GENERATE_CONTENT="streamGenerateContent",O.COUNT_TOKENS="countTokens",O.EMBED_CONTENT="embedContent",O.BATCH_EMBED_CONTENTS="batchEmbedContents";class D{constructor(e,t,n,i,r){this.model=e,this.task=t,this.apiKey=n,this.stream=i,this.requestOptions=r}toString(){var e,t;const n=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta";let i=`${(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com"}/${n}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}async function F(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",function(e){const t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.24.1"),t.join(" ")}(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let i=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(dy){throw new M(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${dy.message}`)}for(const[e,t]of i.entries()){if("x-goog-api-key"===e)throw new M(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new M(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function U(e,t,n,i,r,s={},o=fetch){const{url:a,fetchOptions:l}=await async function(e,t,n,i,r,s){const o=new D(e,t,n,i,s);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},z(s)),{method:"POST",headers:await F(o),body:r})}}(e,t,n,i,r,s);return async function(e,t,n=fetch){let i;try{i=await n(e,t)}catch(dy){!function(e,t){let n=e;"AbortError"===n.name?(n=new B(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof P||e instanceof M||(n=new k(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack);throw n}(dy,e)}i.ok||await async function(e,t){let n,i="";try{const t=await e.json();i=t.error.message,t.error.details&&(i+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(dy){}throw new P(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${i}`,e.status,e.statusText,n)}(i,e);return i}(a,l,o)}function z(e){const t={};if(void 0!==(null==e?void 0:e.signal)||(null==e?void 0:e.timeout)>=0){const n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length,j(e.candidates[0]))throw new R(`${W(e)}`,e);return function(e){var t,n,i,r;const s=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(const o of null===(r=null===(i=e.candidates)||void 0===i?void 0:i[0].content)||void 0===r?void 0:r.parts)o.text&&s.push(o.text),o.executableCode&&s.push("\n```"+o.executableCode.language+"\n"+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&s.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}(e)}if(e.promptFeedback)throw new R(`Text not available. ${W(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length,j(e.candidates[0]))throw new R(`${W(e)}`,e);return V(e)[0]}if(e.promptFeedback)throw new R(`Function call not available. ${W(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length,j(e.candidates[0]))throw new R(`${W(e)}`,e);return V(e)}if(e.promptFeedback)throw new R(`Function call not available. ${W(e)}`,e)},e}function V(e){var t,n,i,r;const s=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(const o of null===(r=null===(i=e.candidates)||void 0===i?void 0:i[0].content)||void 0===r?void 0:r.parts)o.functionCall&&s.push(o.functionCall);return s.length>0?s:void 0}const H=[E.RECITATION,E.SAFETY,E.LANGUAGE];function j(e){return!!e.finishReason&&H.includes(e.finishReason)}function W(e){var t,n,i;let r="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(i=e.candidates)||void 0===i?void 0:i[0]){const t=e.candidates[0];j(t)&&(r+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(r+=`: ${t.finishMessage}`))}}else r+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(r+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(r+=`: ${e.promptFeedback.blockReasonMessage}`);return r}function $(e){return this instanceof $?(this.v=e,this):new $(e)}function X(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){r[e]&&(i[e]=function(t){return new Promise(function(n,i){s.push([e,t,n,i])>1||a(e,t)})})}function a(e,t){try{(n=r[e](t)).value instanceof $?Promise.resolve(n.value.v).then(l,c):u(s[0][2],n)}catch(dy){u(s[0][3],dy)}var n}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}"function"==typeof SuppressedError&&SuppressedError;
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const q=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function K(e){const t=function(e){const t=e.getReader();return new ReadableStream({start(e){let n="";return i();function i(){return t.read().then(({value:t,done:r})=>{if(r)return n.trim()?void e.error(new k("Failed to parse stream")):void e.close();n+=t;let s,o=n.match(q);for(;o;){try{s=JSON.parse(o[1])}catch(dy){return void e.error(new k(`Error parsing JSON response: "${o[1]}"`))}e.enqueue(s),n=n.substring(o[0].length),o=n.match(q)}return i()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new B("Request aborted when reading from the stream"):new k("Error reading from the stream"),t})}}})}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[n,i]=t.tee();return{stream:J(n),response:Y(i)}}async function Y(e){const t=[],n=e.getReader();for(;;){const{done:e,value:i}=await n.read();if(e)return G(Z(t));t.push(i)}}function J(e){return X(this,arguments,function*(){const t=e.getReader();for(;;){const{value:e,done:n}=yield $(t.read());if(n)break;yield yield $(G(e))}})}function Z(e){const t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(const i of e){if(i.candidates){let e=0;for(const t of i.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=t.citationMetadata,n.candidates[e].groundingMetadata=t.groundingMetadata,n.candidates[e].finishReason=t.finishReason,n.candidates[e].finishMessage=t.finishMessage,n.candidates[e].safetyRatings=t.safetyRatings,t.content&&t.content.parts){n.candidates[e].content||(n.candidates[e].content={role:t.content.role||"user",parts:[]});const i={};for(const r of t.content.parts)r.text&&(i.text=r.text),r.functionCall&&(i.functionCall=r.functionCall),r.executableCode&&(i.executableCode=r.executableCode),r.codeExecutionResult&&(i.codeExecutionResult=r.codeExecutionResult),0===Object.keys(i).length&&(i.text=""),n.candidates[e].content.parts.push(i)}e++}i.usageMetadata&&(n.usageMetadata=i.usageMetadata)}return n}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q(e,t,n,i){return K(await U(t,N.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),i))}async function ee(e,t,n,i){const r=await U(t,N.GENERATE_CONTENT,e,!1,JSON.stringify(n),i);return{response:G(await r.json())}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function te(e){if(null!=e)return"string"==typeof e?{role:"system",parts:[{text:e}]}:e.text?{role:"system",parts:[e]}:e.parts?e.role?e:{role:"system",parts:e.parts}:void 0}function ne(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(const n of e)"string"==typeof n?t.push({text:n}):t.push(n);return function(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let i=!1,r=!1;for(const s of e)"functionResponse"in s?(n.parts.push(s),r=!0):(t.parts.push(s),i=!0);if(i&&r)throw new k("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!r)throw new k("No content is provided for sending chat message.");if(i)return t;return n}(t)}function ie(e){let t;if(e.contents)t=e;else{t={contents:[ne(e)]}}return e.systemInstruction&&(t.systemInstruction=te(e.systemInstruction)),t}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const re=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],se={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function oe(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;const n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;if(void 0===n)return!1;if(void 0===n.parts||0===n.parts.length)return!1;for(const i of n.parts){if(void 0===i||0===Object.keys(i).length)return!1;if(void 0!==i.text&&""===i.text)return!1}return!0}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae="SILENT_ERROR";class le{constructor(e,t,n,i={}){this.model=t,this.params=n,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(!function(e){let t=!1;for(const n of e){const{role:e,parts:i}=n;if(!t&&"user"!==e)throw new k(`First content should be with role 'user', got ${e}`);if(!d.includes(e))throw new k(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(d)}`);if(!Array.isArray(i))throw new k("Content should have 'parts' property with an array of Parts");if(0===i.length)throw new k("Each Content should have at least one part");const r={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const t of i)for(const e of re)e in t&&(r[e]+=1);const s=se[e];for(const t of re)if(!s.includes(t)&&r[t]>0)throw new k(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,i,r,s,o,a;await this._sendPromise;const l=ne(e),c={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(i=this.params)||void 0===i?void 0:i.generationConfig,tools:null===(r=this.params)||void 0===r?void 0:r.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(o=this.params)||void 0===o?void 0:o.systemInstruction,cachedContent:null===(a=this.params)||void 0===a?void 0:a.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t);let h;return this._sendPromise=this._sendPromise.then(()=>ee(this._apiKey,this.model,c,u)).then(e=>{var t;if(oe(e.response)){this._history.push(l);const n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{W(e.response)}h=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,h}async sendMessageStream(e,t={}){var n,i,r,s,o,a;await this._sendPromise;const l=ne(e),c={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(i=this.params)||void 0===i?void 0:i.generationConfig,tools:null===(r=this.params)||void 0===r?void 0:r.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(o=this.params)||void 0===o?void 0:o.systemInstruction,cachedContent:null===(a=this.params)||void 0===a?void 0:a.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t),h=Q(this._apiKey,this.model,c,u);return this._sendPromise=this._sendPromise.then(()=>h).catch(e=>{throw new Error(ae)}).then(e=>e.response).then(e=>{if(oe(e)){this._history.push(l);const t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{W(e)}}).catch(e=>{e.message}),h}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ce{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=te(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const i=ie(e),r=Object.assign(Object.assign({},this._requestOptions),t);return ee(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},i),r)}async generateContentStream(e,t={}){var n;const i=ie(e),r=Object.assign(Object.assign({},this._requestOptions),t);return Q(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},i),r)}startChat(e){var t;return new le(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=function(e,t){var n;let i={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(n=null==t?void 0:t.cachedContent)||void 0===n?void 0:n.name,contents:[]};const r=null!=e.generateContentRequest;if(e.contents){if(r)throw new M("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=e.contents}else if(r)i=Object.assign(Object.assign({},i),e.generateContentRequest);else{const t=ne(e);i.contents=[t]}return{generateContentRequest:i}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,i){return(await U(t,N.COUNT_TOKENS,e,!1,JSON.stringify(n),i)).json()}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.apiKey,this.model,n,i)}async embedContent(e,t={}){const n=function(e){if("string"==typeof e||Array.isArray(e))return{content:ne(e)};return e}(e),i=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,i){return(await U(t,N.EMBED_CONTENT,e,!1,JSON.stringify(n),i)).json()}(this.apiKey,this.model,n,i)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return async function(e,t,n,i){const r=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await U(t,N.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:r}),i)).json()}(this.apiKey,this.model,e,n)}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new k("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ce(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new M("Cached content must contain a `name` field.");if(!e.model)throw new M("Cached content must contain a `model` field.");const i=["model","systemInstruction"];for(const s of i)if((null==t?void 0:t[s])&&e[s]&&(null==t?void 0:t[s])!==e[s]){if("model"===s){if((t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue}throw new M(`Different value for "${s}" specified in modelParams (${t[s]}) and cachedContent (${e[s]})`)}const r=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new ce(this.apiKey,r,n)}}function he(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var de,fe,pe={exports:{}},ge={};function me(){if(de)return ge;de=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,p={};function g(e,t,n){this.props=e,this.context=t,this.refs=p,this.updater=n||d}function m(){}function y(e,t,n){this.props=e,this.context=t,this.refs=p,this.updater=n||d}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=g.prototype;var v=y.prototype=new m;v.constructor=y,f(v,g.prototype),v.isPureReactComponent=!0;var _=Array.isArray,b={H:null,A:null,T:null,S:null,V:null},E=Object.prototype.hasOwnProperty;function w(t,n,i,r,s,o){return i=o.ref,{$$typeof:e,type:t,key:n,ref:void 0!==i?i:null,props:o}}function x(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var A=/\/+/g;function S(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,i={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,function(e){return i[e]})):t.toString(36);var n,i}function T(){}function C(n,i,r,s,o){var a=typeof n;"undefined"!==a&&"boolean"!==a||(n=null);var l,c,d=!1;if(null===n)d=!0;else switch(a){case"bigint":case"string":case"number":d=!0;break;case"object":switch(n.$$typeof){case e:case t:d=!0;break;case u:return C((d=n._init)(n._payload),i,r,s,o)}}if(d)return o=o(n),d=""===s?"."+S(n,0):s,_(o)?(r="",null!=d&&(r=d.replace(A,"$&/")+"/"),C(o,i,r,"",function(e){return e})):null!=o&&(x(o)&&(l=o,c=r+(null==o.key||n&&n.key===o.key?"":(""+o.key).replace(A,"$&/")+"/")+d,o=w(l.type,c,void 0,0,0,l.props)),i.push(o)),1;d=0;var f,p=""===s?".":s+":";if(_(n))for(var g=0;g<n.length;g++)d+=C(s=n[g],i,r,a=p+S(s,g),o);else if("function"==typeof(g=null===(f=n)||"object"!=typeof f?null:"function"==typeof(f=h&&f[h]||f["@@iterator"])?f:null))for(n=g.call(n),g=0;!(s=n.next()).done;)d+=C(s=s.value,i,r,a=p+S(s,g++),o);else if("object"===a){if("function"==typeof n.then)return C(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(T,T):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(n),i,r,s,o);throw i=String(n),Error("Objects are not valid as a React child (found: "+("[object Object]"===i?"object with keys {"+Object.keys(n).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.")}return d}function I(e,t,n){if(null==e)return e;var i=[],r=0;return C(e,i,"","",function(e){return t.call(n,e,r++)}),i}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)};function P(){}return ge.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},ge.Component=g,ge.Fragment=n,ge.Profiler=r,ge.PureComponent=y,ge.StrictMode=i,ge.Suspense=l,ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=b,ge.__COMPILER_RUNTIME={__proto__:null,c:function(e){return b.H.useMemoCache(e)}},ge.cache=function(e){return function(){return e.apply(null,arguments)}},ge.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var i=f({},e.props),r=e.key;if(null!=t)for(s in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!E.call(t,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===t.ref||(i[s]=t[s]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var o=Array(s),a=0;a<s;a++)o[a]=arguments[a+2];i.children=o}return w(e.type,r,void 0,0,0,i)},ge.createContext=function(e){return(e={$$typeof:o,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},ge.createElement=function(e,t,n){var i,r={},s=null;if(null!=t)for(i in void 0!==t.key&&(s=""+t.key),t)E.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(r[i]=t[i]);var o=arguments.length-2;if(1===o)r.children=n;else if(1<o){for(var a=Array(o),l=0;l<o;l++)a[l]=arguments[l+2];r.children=a}if(e&&e.defaultProps)for(i in o=e.defaultProps)void 0===r[i]&&(r[i]=o[i]);return w(e,s,void 0,0,0,r)},ge.createRef=function(){return{current:null}},ge.forwardRef=function(e){return{$$typeof:a,render:e}},ge.isValidElement=x,ge.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:k}},ge.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},ge.startTransition=function(e){var t=b.T,n={};b.T=n;try{var i=e(),r=b.S;null!==r&&r(n,i),"object"==typeof i&&null!==i&&"function"==typeof i.then&&i.then(P,R)}catch(s){R(s)}finally{b.T=t}},ge.unstable_useCacheRefresh=function(){return b.H.useCacheRefresh()},ge.use=function(e){return b.H.use(e)},ge.useActionState=function(e,t,n){return b.H.useActionState(e,t,n)},ge.useCallback=function(e,t){return b.H.useCallback(e,t)},ge.useContext=function(e){return b.H.useContext(e)},ge.useDebugValue=function(){},ge.useDeferredValue=function(e,t){return b.H.useDeferredValue(e,t)},ge.useEffect=function(e,t,n){var i=b.H;if("function"==typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return i.useEffect(e,t)},ge.useId=function(){return b.H.useId()},ge.useImperativeHandle=function(e,t,n){return b.H.useImperativeHandle(e,t,n)},ge.useInsertionEffect=function(e,t){return b.H.useInsertionEffect(e,t)},ge.useLayoutEffect=function(e,t){return b.H.useLayoutEffect(e,t)},ge.useMemo=function(e,t){return b.H.useMemo(e,t)},ge.useOptimistic=function(e,t){return b.H.useOptimistic(e,t)},ge.useReducer=function(e,t,n){return b.H.useReducer(e,t,n)},ge.useRef=function(e){return b.H.useRef(e)},ge.useState=function(e){return b.H.useState(e)},ge.useSyncExternalStore=function(e,t,n){return b.H.useSyncExternalStore(e,t,n)},ge.useTransition=function(){return b.H.useTransition()},ge.version="19.1.1",ge}function ye(){return fe||(fe=1,pe.exports=me()),pe.exports}var ve=ye();const _e=he(ve);var be,Ee,we={exports:{}},xe={};var Ae=(Ee||(Ee=1,we.exports=function(){if(be)return xe;be=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(t,n,i){var r=null;if(void 0!==i&&(r=""+i),void 0!==n.key&&(r=""+n.key),"key"in n)for(var s in i={},n)"key"!==s&&(i[s]=n[s]);else i=n;return n=i.ref,{$$typeof:e,type:t,key:r,ref:void 0!==n?n:null,props:i}}return xe.Fragment=t,xe.jsx=n,xe.jsxs=n,xe}()),we.exports);const Se=ve.createContext({});function Te(e){const t=ve.useRef(null);return null===t.current&&(t.current=e()),t.current}const Ce="undefined"!=typeof window,Ie=Ce?ve.useLayoutEffect:ve.useEffect,ke=ve.createContext(null);function Re(e,t){-1===e.indexOf(t)&&e.push(t)}function Pe(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Me=(e,t,n)=>n>t?t:n<e?e:n;const Le={},Be=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function Ne(e){return"object"==typeof e&&null!==e}const Oe=e=>/^0[^.\s]+$/u.test(e);function De(e){let t;return()=>(void 0===t&&(t=e()),t)}const Fe=e=>e,Ue=(e,t)=>n=>t(e(n)),ze=(...e)=>e.reduce(Ue),Ge=(e,t,n)=>{const i=t-e;return 0===i?1:(n-e)/i};class Ve{constructor(){this.subscriptions=[]}add(e){return Re(this.subscriptions,e),()=>Pe(this.subscriptions,e)}notify(e,t,n){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,t,n);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const He=e=>1e3*e,je=e=>e/1e3;function We(e,t){return t?e*(1e3/t):0}const $e=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function Xe(e,t,n,i){if(e===t&&n===i)return Fe;const r=t=>function(e,t,n,i,r){let s,o,a=0;do{o=t+(n-t)/2,s=$e(o,i,r)-e,s>0?n=o:t=o}while(Math.abs(s)>1e-7&&++a<12);return o}(t,0,1,e,n);return e=>0===e||1===e?e:$e(r(e),t,i)}const qe=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Ke=e=>t=>1-e(1-t),Ye=Xe(.33,1.53,.69,.99),Je=Ke(Ye),Ze=qe(Je),Qe=e=>(e*=2)<1?.5*Je(e):.5*(2-Math.pow(2,-10*(e-1))),et=e=>1-Math.sin(Math.acos(e)),tt=Ke(et),nt=qe(et),it=Xe(.42,0,1,1),rt=Xe(0,0,.58,1),st=Xe(.42,0,.58,1),ot=e=>Array.isArray(e)&&"number"==typeof e[0],at={linear:Fe,easeIn:it,easeInOut:st,easeOut:rt,circIn:et,circInOut:nt,circOut:tt,backIn:Je,backInOut:Ze,backOut:Ye,anticipate:Qe},lt=e=>{if(ot(e)){e.length;const[t,n,i,r]=e;return Xe(t,n,i,r)}return"string"==typeof e?at[e]:e},ct=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function ut(e,t){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>n=!0,o=ct.reduce((e,t)=>(e[t]=function(e){let t=new Set,n=new Set,i=!1,r=!1;const s=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(t){s.has(t)&&(l.schedule(t),e()),t(o)}const l={schedule:(e,r=!1,o=!1)=>{const a=o&&i?t:n;return r&&s.add(e),a.has(e)||a.add(e),e},cancel:e=>{n.delete(e),s.delete(e)},process:e=>{o=e,i?r=!0:(i=!0,[t,n]=[n,t],t.forEach(a),t.clear(),i=!1,r&&(r=!1,l.process(e)))}};return l}(s),e),{}),{setup:a,read:l,resolveKeyframes:c,preUpdate:u,update:h,preRender:d,render:f,postRender:p}=o,g=()=>{const s=Le.useManualTiming?r.timestamp:performance.now();n=!1,Le.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(s-r.timestamp,40),1)),r.timestamp=s,r.isProcessing=!0,a.process(r),l.process(r),c.process(r),u.process(r),h.process(r),d.process(r),f.process(r),p.process(r),r.isProcessing=!1,n&&t&&(i=!1,e(g))};return{schedule:ct.reduce((t,s)=>{const a=o[s];return t[s]=(t,s=!1,o=!1)=>(n||(n=!0,i=!0,r.isProcessing||e(g)),a.schedule(t,s,o)),t},{}),cancel:e=>{for(let t=0;t<ct.length;t++)o[ct[t]].cancel(e)},state:r,steps:o}}const{schedule:ht,cancel:dt,state:ft,steps:pt}=ut("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:Fe,!0);let gt;function mt(){gt=void 0}const yt={now:()=>(void 0===gt&&yt.set(ft.isProcessing||Le.useManualTiming?ft.timestamp:performance.now()),gt),set:e=>{gt=e,queueMicrotask(mt)}},vt=e=>t=>"string"==typeof t&&t.startsWith(e),_t=vt("--"),bt=vt("var(--"),Et=e=>!!bt(e)&&wt.test(e.split("/*")[0].trim()),wt=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,xt={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},At={...xt,transform:e=>Me(0,1,e)},St={...xt,default:1},Tt=e=>Math.round(1e5*e)/1e5,Ct=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const It=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,kt=(e,t)=>n=>Boolean("string"==typeof n&&It.test(n)&&n.startsWith(e)||t&&!function(e){return null==e}(n)&&Object.prototype.hasOwnProperty.call(n,t)),Rt=(e,t,n)=>i=>{if("string"!=typeof i)return i;const[r,s,o,a]=i.match(Ct);return{[e]:parseFloat(r),[t]:parseFloat(s),[n]:parseFloat(o),alpha:void 0!==a?parseFloat(a):1}},Pt={...xt,transform:e=>Math.round((e=>Me(0,255,e))(e))},Mt={test:kt("rgb","red"),parse:Rt("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:i=1})=>"rgba("+Pt.transform(e)+", "+Pt.transform(t)+", "+Pt.transform(n)+", "+Tt(At.transform(i))+")"};const Lt={test:kt("#"),parse:function(e){let t="",n="",i="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:Mt.transform},Bt=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),Nt=Bt("deg"),Ot=Bt("%"),Dt=Bt("px"),Ft=Bt("vh"),Ut=Bt("vw"),zt=(()=>({...Ot,parse:e=>Ot.parse(e)/100,transform:e=>Ot.transform(100*e)}))(),Gt={test:kt("hsl","hue"),parse:Rt("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:i=1})=>"hsla("+Math.round(e)+", "+Ot.transform(Tt(t))+", "+Ot.transform(Tt(n))+", "+Tt(At.transform(i))+")"},Vt={test:e=>Mt.test(e)||Lt.test(e)||Gt.test(e),parse:e=>Mt.test(e)?Mt.parse(e):Gt.test(e)?Gt.parse(e):Lt.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?Mt.transform(e):Gt.transform(e),getAnimatableNone:e=>{const t=Vt.parse(e);return t.alpha=0,Vt.transform(t)}},Ht=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const jt="number",Wt="color",$t=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Xt(e){const t=e.toString(),n=[],i={color:[],number:[],var:[]},r=[];let s=0;const o=t.replace($t,e=>(Vt.test(e)?(i.color.push(s),r.push(Wt),n.push(Vt.parse(e))):e.startsWith("var(")?(i.var.push(s),r.push("var"),n.push(e)):(i.number.push(s),r.push(jt),n.push(parseFloat(e))),++s,"${}")).split("${}");return{values:n,split:o,indexes:i,types:r}}function qt(e){return Xt(e).values}function Kt(e){const{split:t,types:n}=Xt(e),i=t.length;return e=>{let r="";for(let s=0;s<i;s++)if(r+=t[s],void 0!==e[s]){const t=n[s];r+=t===jt?Tt(e[s]):t===Wt?Vt.transform(e[s]):e[s]}return r}}const Yt=e=>"number"==typeof e?0:Vt.test(e)?Vt.getAnimatableNone(e):e;const Jt={test:function(e){var t,n;return isNaN(e)&&"string"==typeof e&&((null==(t=e.match(Ct))?void 0:t.length)||0)+((null==(n=e.match(Ht))?void 0:n.length)||0)>0},parse:qt,createTransformer:Kt,getAnimatableNone:function(e){const t=qt(e);return Kt(e)(t.map(Yt))}};function Zt(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Qt(e,t){return n=>n>0?t:e}const en=(e,t,n)=>e+(t-e)*n,tn=(e,t,n)=>{const i=e*e,r=n*(t*t-i)+i;return r<0?0:Math.sqrt(r)},nn=[Lt,Mt,Gt];function rn(e){const t=(n=e,nn.find(e=>e.test(n)));var n;if(!Boolean(t))return!1;let i=t.parse(e);return t===Gt&&(i=function({hue:e,saturation:t,lightness:n,alpha:i}){e/=360,n/=100;let r=0,s=0,o=0;if(t/=100){const i=n<.5?n*(1+t):n+t-n*t,a=2*n-i;r=Zt(a,i,e+1/3),s=Zt(a,i,e),o=Zt(a,i,e-1/3)}else r=s=o=n;return{red:Math.round(255*r),green:Math.round(255*s),blue:Math.round(255*o),alpha:i}}(i)),i}const sn=(e,t)=>{const n=rn(e),i=rn(t);if(!n||!i)return Qt(e,t);const r={...n};return e=>(r.red=tn(n.red,i.red,e),r.green=tn(n.green,i.green,e),r.blue=tn(n.blue,i.blue,e),r.alpha=en(n.alpha,i.alpha,e),Mt.transform(r))},on=new Set(["none","hidden"]);function an(e,t){return n=>en(e,t,n)}function ln(e){return"number"==typeof e?an:"string"==typeof e?Et(e)?Qt:Vt.test(e)?sn:hn:Array.isArray(e)?cn:"object"==typeof e?Vt.test(e)?sn:un:Qt}function cn(e,t){const n=[...e],i=n.length,r=e.map((e,n)=>ln(e)(e,t[n]));return e=>{for(let t=0;t<i;t++)n[t]=r[t](e);return n}}function un(e,t){const n={...e,...t},i={};for(const r in n)void 0!==e[r]&&void 0!==t[r]&&(i[r]=ln(e[r])(e[r],t[r]));return e=>{for(const t in i)n[t]=i[t](e);return n}}const hn=(e,t)=>{const n=Jt.createTransformer(t),i=Xt(e),r=Xt(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?on.has(e)&&!r.values.length||on.has(t)&&!i.values.length?function(e,t){return on.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}(e,t):ze(cn(function(e,t){const n=[],i={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){const s=t.types[r],o=e.indexes[s][i[s]],a=e.values[o]??0;n[r]=a,i[s]++}return n}(i,r),r.values),n):Qt(e,t)};function dn(e,t,n){if("number"==typeof e&&"number"==typeof t&&"number"==typeof n)return en(e,t,n);return ln(e)(e,t)}const fn=e=>{const t=({timestamp:t})=>e(t);return{start:(e=!0)=>ht.update(t,e),stop:()=>dt(t),now:()=>ft.isProcessing?ft.timestamp:yt.now()}},pn=(e,t,n=10)=>{let i="";const r=Math.max(Math.round(t/n),2);for(let s=0;s<r;s++)i+=Math.round(1e4*e(s/(r-1)))/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},gn=2e4;function mn(e){let t=0;let n=e.next(t);for(;!n.done&&t<gn;)t+=50,n=e.next(t);return t>=gn?1/0:t}function yn(e,t,n){const i=Math.max(t-5,0);return We(n-e(i),t-i)}const vn=100,_n=10,bn=1,En=0,wn=800,xn=.3,An=.3,Sn={granular:.01,default:2},Tn={granular:.005,default:.5},Cn=.01,In=10,kn=.05,Rn=1,Pn=.001;function Mn({duration:e=wn,bounce:t=xn,velocity:n=En,mass:i=bn}){let r,s,o=1-t;o=Me(kn,Rn,o),e=Me(Cn,In,je(e)),o<1?(r=t=>{const i=t*o,r=i*e,s=i-n,a=Bn(t,o),l=Math.exp(-r);return Pn-s/a*l},s=t=>{const i=t*o*e,s=i*n+n,a=Math.pow(o,2)*Math.pow(t,2)*e,l=Math.exp(-i),c=Bn(Math.pow(t,2),o);return(-r(t)+Pn>0?-1:1)*((s-a)*l)/c}):(r=t=>Math.exp(-t*e)*((t-n)*e+1)-.001,s=t=>Math.exp(-t*e)*(e*e*(n-t)));const a=function(e,t,n){let i=n;for(let r=1;r<Ln;r++)i-=e(i)/t(i);return i}(r,s,5/e);if(e=He(e),isNaN(a))return{stiffness:vn,damping:_n,duration:e};{const t=Math.pow(a,2)*i;return{stiffness:t,damping:2*o*Math.sqrt(i*t),duration:e}}}const Ln=12;function Bn(e,t){return e*Math.sqrt(1-t*t)}const Nn=["duration","bounce"],On=["stiffness","damping","mass"];function Dn(e,t){return t.some(t=>void 0!==e[t])}function Fn(e=An,t=xn){const n="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=n;const s=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:s},{stiffness:l,damping:c,mass:u,duration:h,velocity:d,isResolvedFromDuration:f}=function(e){let t={velocity:En,stiffness:vn,damping:_n,mass:bn,isResolvedFromDuration:!1,...e};if(!Dn(e,On)&&Dn(e,Nn))if(e.visualDuration){const n=e.visualDuration,i=2*Math.PI/(1.2*n),r=i*i,s=2*Me(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:bn,stiffness:r,damping:s}}else{const n=Mn(e);t={...t,...n,mass:bn},t.isResolvedFromDuration=!0}return t}({...n,velocity:-je(n.velocity||0)}),p=d||0,g=c/(2*Math.sqrt(l*u)),m=o-s,y=je(Math.sqrt(l/u)),v=Math.abs(m)<5;let _;if(i||(i=v?Sn.granular:Sn.default),r||(r=v?Tn.granular:Tn.default),g<1){const e=Bn(y,g);_=t=>{const n=Math.exp(-g*y*t);return o-n*((p+g*y*m)/e*Math.sin(e*t)+m*Math.cos(e*t))}}else if(1===g)_=e=>o-Math.exp(-y*e)*(m+(p+y*m)*e);else{const e=y*Math.sqrt(g*g-1);_=t=>{const n=Math.exp(-g*y*t),i=Math.min(e*t,300);return o-n*((p+g*y*m)*Math.sinh(i)+e*m*Math.cosh(i))/e}}const b={calculatedDuration:f&&h||null,next:e=>{const t=_(e);if(f)a.done=e>=h;else{let n=0===e?p:0;g<1&&(n=0===e?He(p):yn(_,e,t));const s=Math.abs(n)<=i,l=Math.abs(o-t)<=r;a.done=s&&l}return a.value=a.done?o:t,a},toString:()=>{const e=Math.min(mn(b),gn),t=pn(t=>b.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return b}function Un({keyframes:e,velocity:t=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:u}){const h=e[0],d={done:!1,value:h},f=e=>void 0===a?l:void 0===l||Math.abs(a-e)<Math.abs(l-e)?a:l;let p=n*t;const g=h+p,m=void 0===o?g:o(g);m!==g&&(p=m-h);const y=e=>-p*Math.exp(-e/i),v=e=>m+y(e),_=e=>{const t=y(e),n=v(e);d.done=Math.abs(t)<=c,d.value=d.done?m:n};let b,E;const w=e=>{var t;(t=d.value,void 0!==a&&t<a||void 0!==l&&t>l)&&(b=e,E=Fn({keyframes:[d.value,f(d.value)],velocity:yn(v,e,d.value),damping:r,stiffness:s,restDelta:c,restSpeed:u}))};return w(0),{calculatedDuration:null,next:e=>{let t=!1;return E||void 0!==b||(t=!0,_(e),w(e)),void 0!==b&&e>=b?E.next(e-b):(!t&&_(e),d)}}}function zn(e,t,{clamp:n=!0,ease:i,mixer:r}={}){const s=e.length;if(t.length,1===s)return()=>t[0];if(2===s&&t[0]===t[1])return()=>t[1];const o=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=function(e,t,n){const i=[],r=n||Le.mix||dn,s=e.length-1;for(let o=0;o<s;o++){let n=r(e[o],e[o+1]);if(t){const e=Array.isArray(t)?t[o]||Fe:t;n=ze(e,n)}i.push(n)}return i}(t,i,r),l=a.length,c=n=>{if(o&&n<e[0])return t[0];let i=0;if(l>1)for(;i<e.length-2&&!(n<e[i+1]);i++);const r=Ge(e[i],e[i+1],n);return a[i](r)};return n?t=>c(Me(e[0],e[s-1],t)):c}function Gn(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let i=1;i<=t;i++){const r=Ge(0,t,i);e.push(en(n,1,r))}}(t,e.length-1),t}function Vn({duration:e=300,keyframes:t,times:n,ease:i="easeInOut"}){const r=(e=>Array.isArray(e)&&"number"!=typeof e[0])(i)?i.map(lt):lt(i),s={done:!1,value:t[0]},o=function(e,t){return e.map(e=>e*t)}(n&&n.length===t.length?n:Gn(t),e),a=zn(o,t,{ease:Array.isArray(r)?r:(l=t,c=r,l.map(()=>c||st).splice(0,l.length-1))});var l,c;return{calculatedDuration:e,next:t=>(s.value=a(t),s.done=t>=e,s)}}Fn.applyToOptions=e=>{const t=function(e,t=100,n){const i=n({...e,keyframes:[0,t]}),r=Math.min(mn(i),gn);return{type:"keyframes",ease:e=>i.next(r*e).value/t,duration:je(r)}}(e,100,Fn);return e.ease=t.ease,e.duration=He(t.duration),e.type="keyframes",e};const Hn=e=>null!==e;function jn(e,{repeat:t,repeatType:n="loop"},i,r=1){const s=e.filter(Hn),o=r<0||t&&"loop"!==n&&t%2==1?0:s.length-1;return o&&void 0!==i?i:s[o]}const Wn={decay:Un,inertia:Un,tween:Vn,keyframes:Vn,spring:Fn};function $n(e){"string"==typeof e.type&&(e.type=Wn[e.type])}class Xn{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const qn=e=>e/100;class Kn extends Xn{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var e,t;const{motionValue:n}=this.options;n&&n.updatedAt!==yt.now()&&this.tick(yt.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),null==(t=(e=this.options).onStop)||t.call(e))},this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;$n(e);const{type:t=Vn,repeat:n=0,repeatDelay:i=0,repeatType:r,velocity:s=0}=e;let{keyframes:o}=e;const a=t||Vn;a!==Vn&&"number"!=typeof o[0]&&(this.mixKeyframes=ze(qn,dn(o[0],o[1])),o=[0,100]);const l=a({...e,keyframes:o});"mirror"===r&&(this.mirroredGenerator=a({...e,keyframes:[...o].reverse(),velocity:-s})),null===l.calculatedDuration&&(l.calculatedDuration=mn(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+i,this.totalDuration=this.resolvedDuration*(n+1)-i,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:n,totalDuration:i,mixKeyframes:r,mirroredGenerator:s,resolvedDuration:o,calculatedDuration:a}=this;if(null===this.startTime)return n.next(0);const{delay:l=0,keyframes:c,repeat:u,repeatType:h,repeatDelay:d,type:f,onUpdate:p,finalKeyframe:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const m=this.currentTime-l*(this.playbackSpeed>=0?1:-1),y=this.playbackSpeed>=0?m<0:m>i;this.currentTime=Math.max(m,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=i);let v=this.currentTime,_=n;if(u){const e=Math.min(this.currentTime,i)/o;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,u+1);Boolean(t%2)&&("reverse"===h?(n=1-n,d&&(n-=d/o)):"mirror"===h&&(_=s)),v=Me(0,1,n)*o}const b=y?{done:!1,value:c[0]}:_.next(v);r&&(b.value=r(b.value));let{done:E}=b;y||null===a||(E=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&E);return w&&f!==Un&&(b.value=jn(c,this.options,g,this.speed)),p&&p(b.value),w&&this.finish(),b}then(e,t){return this.finished.then(e,t)}get duration(){return je(this.calculatedDuration)}get time(){return je(this.currentTime)}set time(e){var t;e=He(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),null==(t=this.driver)||t.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(yt.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=je(this.currentTime))}play(){var e,t;if(this.isStopped)return;const{driver:n=fn,startTime:i}=this.options;this.driver||(this.driver=n(e=>this.tick(e))),null==(t=(e=this.options).onPlay)||t.call(e);const r=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=r):null!==this.holdTime?this.startTime=r-this.holdTime:this.startTime||(this.startTime=i??r),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(yt.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,t;this.notifyFinished(),this.teardown(),this.state="finished",null==(t=(e=this.options).onComplete)||t.call(e)}cancel(){var e,t;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),null==(t=(e=this.options).onCancel)||t.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var t;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),null==(t=this.driver)||t.stop(),e.observe(this)}}const Yn=e=>180*e/Math.PI,Jn=e=>{const t=Yn(Math.atan2(e[1],e[0]));return Qn(t)},Zn={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:Jn,rotateZ:Jn,skewX:e=>Yn(Math.atan(e[1])),skewY:e=>Yn(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},Qn=e=>((e%=360)<0&&(e+=360),e),ei=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),ti=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),ni={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:ei,scaleY:ti,scale:e=>(ei(e)+ti(e))/2,rotateX:e=>Qn(Yn(Math.atan2(e[6],e[5]))),rotateY:e=>Qn(Yn(Math.atan2(-e[2],e[0]))),rotateZ:Jn,rotate:Jn,skewX:e=>Yn(Math.atan(e[4])),skewY:e=>Yn(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function ii(e){return e.includes("scale")?1:0}function ri(e,t){if(!e||"none"===e)return ii(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,r;if(n)i=ni,r=n;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=Zn,r=t}if(!r)return ii(t);const s=i[t],o=r[1].split(",").map(si);return"function"==typeof s?s(o):o[s]}function si(e){return parseFloat(e.trim())}const oi=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ai=(()=>new Set(oi))(),li=e=>e===xt||e===Dt,ci=new Set(["x","y","z"]),ui=oi.filter(e=>!ci.has(e));const hi={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>ri(t,"x"),y:(e,{transform:t})=>ri(t,"y")};hi.translateX=hi.x,hi.translateY=hi.y;const di=new Set;let fi=!1,pi=!1,gi=!1;function mi(){if(pi){const e=Array.from(di).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),n=new Map;t.forEach(e=>{const t=function(e){const t=[];return ui.forEach(n=>{const i=e.getValue(n);void 0!==i&&(t.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),t}(e);t.length&&(n.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=n.get(e);t&&t.forEach(([t,n])=>{var i;null==(i=e.getValue(t))||i.set(n)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}pi=!1,fi=!1,di.forEach(e=>e.complete(gi)),di.clear()}function yi(){di.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(pi=!0)})}class vi{constructor(e,t,n,i,r,s=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=i,this.element=r,this.isAsync=s}scheduleResolve(){this.state="scheduled",this.isAsync?(di.add(this),fi||(fi=!0,ht.read(yi),ht.resolveKeyframes(mi))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:i}=this;if(null===e[0]){const r=null==i?void 0:i.get(),s=e[e.length-1];if(void 0!==r)e[0]=r;else if(n&&t){const i=n.readValue(t,s);null!=i&&(e[0]=i)}void 0===e[0]&&(e[0]=s),i&&void 0===r&&i.set(e[0])}!function(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),di.delete(this)}cancel(){"scheduled"===this.state&&(di.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const _i=De(()=>void 0!==window.ScrollTimeline),bi={};function Ei(e,t){const n=De(e);return()=>bi[t]??n()}const wi=Ei(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(dy){return!1}return!0},"linearEasing"),xi=([e,t,n,i])=>`cubic-bezier(${e}, ${t}, ${n}, ${i})`,Ai={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:xi([0,.65,.55,1]),circOut:xi([.55,0,1,.45]),backIn:xi([.31,.01,.66,-.59]),backOut:xi([.33,1.53,.69,.99])};function Si(e,t){return e?"function"==typeof e?wi()?pn(e,t):"ease-out":ot(e)?xi(e):Array.isArray(e)?e.map(e=>Si(e,t)||Ai.easeOut):Ai[e]:void 0}function Ti(e,t,n,{delay:i=0,duration:r=300,repeat:s=0,repeatType:o="loop",ease:a="easeOut",times:l}={},c=void 0){const u={[t]:n};l&&(u.offset=l);const h=Si(a,r);Array.isArray(h)&&(u.easing=h);const d={delay:i,duration:r,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:s+1,direction:"reverse"===o?"alternate":"normal"};c&&(d.pseudoElement=c);return e.animate(u,d)}function Ci(e){return"function"==typeof e&&"applyToOptions"in e}class Ii extends Xn{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:n,keyframes:i,pseudoElement:r,allowFlatten:s=!1,finalKeyframe:o,onComplete:a}=e;this.isPseudoElement=Boolean(r),this.allowFlatten=s,this.options=e,e.type;const l=function({type:e,...t}){return Ci(e)&&wi()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=Ti(t,n,i,l,r),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const e=jn(i,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,n){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,n):e.style[t]=n}(t,n,e),this.animation.cancel()}null==a||a(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,t;null==(t=(e=this.animation).finish)||t.call(e)}cancel(){try{this.animation.cancel()}catch(dy){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,t;this.isPseudoElement||null==(t=(e=this.animation).commitStyles)||t.call(e)}get duration(){var e,t;const n=(null==(t=null==(e=this.animation.effect)?void 0:e.getComputedTiming)?void 0:t.call(e).duration)||0;return je(Number(n))}get time(){return je(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=He(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){var n;return this.allowFlatten&&(null==(n=this.animation.effect)||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&_i()?(this.animation.timeline=e,Fe):t(this)}}const ki={anticipate:Qe,backInOut:Ze,circInOut:nt};function Ri(e){"string"==typeof e.ease&&e.ease in ki&&(e.ease=ki[e.ease])}class Pi extends Ii{constructor(e){Ri(e),$n(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:n,onComplete:i,element:r,...s}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);const o=new Kn({...s,autoplay:!1}),a=He(this.finishedTime??this.time);t.setWithVelocity(o.sample(a-10).value,o.sample(a).value,10),o.stop()}}const Mi=(e,t)=>"zIndex"!==t&&(!("number"!=typeof e&&!Array.isArray(e))||!("string"!=typeof e||!Jt.test(e)&&"0"!==e||e.startsWith("url(")));function Li(e){e.duration=0,e.type}const Bi=new Set(["opacity","clipPath","filter","transform"]),Ni=De(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class Oi extends Xn{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:s="loop",keyframes:o,name:a,motionValue:l,element:c,...u}){var h;super(),this.stop=()=>{var e,t;this._animation&&(this._animation.stop(),null==(e=this.stopTimeline)||e.call(this)),null==(t=this.keyframeResolver)||t.cancel()},this.createdAt=yt.now();const d={autoplay:e,delay:t,type:n,repeat:i,repeatDelay:r,repeatType:s,name:a,motionValue:l,element:c,...u},f=(null==c?void 0:c.KeyframeResolver)||vi;this.keyframeResolver=new f(o,(e,t,n)=>this.onKeyframesResolved(e,t,d,!n),a,l,c),null==(h=this.keyframeResolver)||h.scheduleResolve()}onKeyframesResolved(e,t,n,i){this.keyframeResolver=void 0;const{name:r,type:s,velocity:o,delay:a,isHandoff:l,onUpdate:c}=n;this.resolvedAt=yt.now(),function(e,t,n,i){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const s=e[e.length-1],o=Mi(r,t),a=Mi(s,t);return!(!o||!a)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||("spring"===n||Ci(n))&&i)}(e,r,s,o)||(!Le.instantAnimations&&a||null==c||c(jn(e,n,t)),e[0]=e[e.length-1],Li(n),n.repeat=0);const u={startTime:i?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...n,keyframes:e},h=!l&&function(e){var t;const{motionValue:n,name:i,repeatDelay:r,repeatType:s,damping:o,type:a}=e;if(!((null==(t=null==n?void 0:n.owner)?void 0:t.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=n.owner.getProps();return Ni()&&i&&Bi.has(i)&&("transform"!==i||!c)&&!l&&!r&&"mirror"!==s&&0!==o&&"inertia"!==a}(u)?new Pi({...u,element:u.motionValue.owner.current}):new Kn(u);h.finished.then(()=>this.notifyFinished()).catch(Fe),this.pendingTimeline&&(this.stopTimeline=h.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=h}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||(null==(e=this.keyframeResolver)||e.resume(),gi=!0,yi(),mi(),gi=!1),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),null==(e=this.keyframeResolver)||e.cancel()}}const Di=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Fi(e,t,n=1){const[i,r]=function(e){const t=Di.exec(e);if(!t)return[,];const[,n,i,r]=t;return[`--${n??i}`,r]}(e);if(!i)return;const s=window.getComputedStyle(t).getPropertyValue(i);if(s){const e=s.trim();return Be(e)?parseFloat(e):e}return Et(r)?Fi(r,t,n+1):r}function Ui(e,t){return(null==e?void 0:e[t])??(null==e?void 0:e.default)??e}const zi=new Set(["width","height","top","left","right","bottom",...oi]),Gi=e=>t=>t.test(e),Vi=[xt,Dt,Ot,Nt,Ut,Ft,{test:e=>"auto"===e,parse:e=>e}],Hi=e=>Vi.find(Gi(e));function ji(e){return"number"==typeof e?0===e:null===e||("none"===e||"0"===e||Oe(e))}const Wi=new Set(["brightness","contrast","saturate","opacity"]);function $i(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[i]=n.match(Ct)||[];if(!i)return e;const r=n.replace(i,"");let s=Wi.has(t)?1:0;return i!==n&&(s*=100),t+"("+s+r+")"}const Xi=/\b([a-z-]*)\(.*?\)/gu,qi={...Jt,getAnimatableNone:e=>{const t=e.match(Xi);return t?t.map($i).join(" "):e}},Ki={...xt,transform:Math.round},Yi={borderWidth:Dt,borderTopWidth:Dt,borderRightWidth:Dt,borderBottomWidth:Dt,borderLeftWidth:Dt,borderRadius:Dt,radius:Dt,borderTopLeftRadius:Dt,borderTopRightRadius:Dt,borderBottomRightRadius:Dt,borderBottomLeftRadius:Dt,width:Dt,maxWidth:Dt,height:Dt,maxHeight:Dt,top:Dt,right:Dt,bottom:Dt,left:Dt,padding:Dt,paddingTop:Dt,paddingRight:Dt,paddingBottom:Dt,paddingLeft:Dt,margin:Dt,marginTop:Dt,marginRight:Dt,marginBottom:Dt,marginLeft:Dt,backgroundPositionX:Dt,backgroundPositionY:Dt,...{rotate:Nt,rotateX:Nt,rotateY:Nt,rotateZ:Nt,scale:St,scaleX:St,scaleY:St,scaleZ:St,skew:Nt,skewX:Nt,skewY:Nt,distance:Dt,translateX:Dt,translateY:Dt,translateZ:Dt,x:Dt,y:Dt,z:Dt,perspective:Dt,transformPerspective:Dt,opacity:At,originX:zt,originY:zt,originZ:Dt},zIndex:Ki,fillOpacity:At,strokeOpacity:At,numOctaves:Ki},Ji={...Yi,color:Vt,backgroundColor:Vt,outlineColor:Vt,fill:Vt,stroke:Vt,borderColor:Vt,borderTopColor:Vt,borderRightColor:Vt,borderBottomColor:Vt,borderLeftColor:Vt,filter:qi,WebkitFilter:qi},Zi=e=>Ji[e];function Qi(e,t){let n=Zi(e);return n!==qi&&(n=Jt),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const er=new Set(["auto","none","0"]);class tr extends vi{constructor(e,t,n,i,r){super(e,t,n,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let a=0;a<e.length;a++){let n=e[a];if("string"==typeof n&&(n=n.trim(),Et(n))){const i=Fi(n,t.current);void 0!==i&&(e[a]=i),a===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!zi.has(n)||2!==e.length)return;const[i,r]=e,s=Hi(i),o=Hi(r);if(s!==o)if(li(s)&&li(o))for(let a=0;a<e.length;a++){const t=e[a];"string"==typeof t&&(e[a]=parseFloat(t))}else hi[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let i=0;i<e.length;i++)(null===e[i]||ji(e[i]))&&n.push(i);n.length&&function(e,t,n){let i,r=0;for(;r<e.length&&!i;){const t=e[r];"string"==typeof t&&!er.has(t)&&Xt(t).values.length&&(i=e[r]),r++}if(i&&n)for(const s of t)e[s]=Qi(n,i)}(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=hi[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];void 0!==i&&e.getValue(n,i).jump(i,!1)}measureEndState(){var e;const{element:t,name:n,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const r=t.getValue(n);r&&r.jump(this.measuredOrigin,!1);const s=i.length-1,o=i[s];i[s]=hi[n](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),(null==(e=this.removedTransforms)?void 0:e.length)&&this.removedTransforms.forEach(([e,n])=>{t.getValue(e).set(n)}),this.resolveNoneKeyframes()}}const nr=(e,t)=>t&&"number"==typeof e?t.transform(e):e;function ir(e){return Ne(e)&&"offsetHeight"in e}class rr{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{var t;const n=yt.now();if(this.updatedAt!==n&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(null==(t=this.events.change)||t.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){var t;this.current=e,this.updatedAt=yt.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Ve);const n=this.events[e].add(t);return"change"===e?()=>{n(),ht.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;null==(e=this.events.change)||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=yt.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return We(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,t;null==(e=this.dependents)||e.clear(),null==(t=this.events.destroy)||t.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function sr(e,t){return new rr(e,t)}const{schedule:or}=ut(queueMicrotask,!1),ar={x:!1,y:!1};function lr(){return ar.x||ar.y}function cr(e,t){const n=function(e,t,n){if(e instanceof EventTarget)return[e];if("string"==typeof e){let t=document;const i=(null==n?void 0:n[e])??t.querySelectorAll(e);return i?Array.from(i):[]}return Array.from(e)}(e),i=new AbortController;return[n,{passive:!0,...t,signal:i.signal},()=>i.abort()]}function ur(e){return!("touch"===e.pointerType||lr())}const hr=(e,t)=>!!t&&(e===t||hr(e,t.parentElement)),dr=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary,fr=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const pr=new WeakSet;function gr(e){return t=>{"Enter"===t.key&&e(t)}}function mr(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function yr(e){return dr(e)&&!lr()}function vr(e,t,n={}){const[i,r,s]=cr(e,n),o=e=>{const i=e.currentTarget;if(!yr(e))return;pr.add(i);const s=t(i,e),o=(e,t)=>{window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",l),pr.has(i)&&pr.delete(i),yr(e)&&"function"==typeof s&&s(e,{success:t})},a=e=>{o(e,i===window||i===document||n.useGlobalTarget||hr(i,e.target))},l=e=>{o(e,!1)};window.addEventListener("pointerup",a,r),window.addEventListener("pointercancel",l,r)};return i.forEach(e=>{var t;(n.useGlobalTarget?window:e).addEventListener("pointerdown",o,r),ir(e)&&(e.addEventListener("focus",e=>((e,t)=>{const n=e.currentTarget;if(!n)return;const i=gr(()=>{if(pr.has(n))return;mr(n,"down");const e=gr(()=>{mr(n,"up")});n.addEventListener("keyup",e,t),n.addEventListener("blur",()=>mr(n,"cancel"),t)});n.addEventListener("keydown",i,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),t)})(e,r)),t=e,fr.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))}),s}function _r(e){return Ne(e)&&"ownerSVGElement"in e}const br=e=>Boolean(e&&e.getVelocity),Er=[...Vi,Vt,Jt],wr=ve.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class xr extends ve.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,n=ir(e)&&e.offsetWidth||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=n-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Ar({children:e,isPresent:t,anchorX:n,root:i}){const r=ve.useId(),s=ve.useRef(null),o=ve.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=ve.useContext(wr);return ve.useInsertionEffect(()=>{const{width:e,height:l,top:c,left:u,right:h}=o.current;if(t||!s.current||!e||!l)return;const d="left"===n?`left: ${u}`:`right: ${h}`;s.current.dataset.motionPopId=r;const f=document.createElement("style");a&&(f.nonce=a);const p=i??document.head;return p.appendChild(f),f.sheet&&f.sheet.insertRule(`\n          [data-motion-pop-id="${r}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${l}px !important;\n            ${d}px !important;\n            top: ${c}px !important;\n          }\n        `),()=>{p.contains(f)&&p.removeChild(f)}},[t]),Ae.jsx(xr,{isPresent:t,childRef:s,sizeRef:o,children:ve.cloneElement(e,{ref:s})})}const Sr=({children:e,initial:t,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:s,mode:o,anchorX:a,root:l})=>{const c=Te(Tr),u=ve.useId();let h=!0,d=ve.useMemo(()=>(h=!1,{id:u,initial:t,isPresent:n,custom:r,onExitComplete:e=>{c.set(e,!0);for(const t of c.values())if(!t)return;i&&i()},register:e=>(c.set(e,!1),()=>c.delete(e))}),[n,c,i]);return s&&h&&(d={...d}),ve.useMemo(()=>{c.forEach((e,t)=>c.set(t,!1))},[n]),ve.useEffect(()=>{!n&&!c.size&&i&&i()},[n]),"popLayout"===o&&(e=Ae.jsx(Ar,{isPresent:n,anchorX:a,root:l,children:e})),Ae.jsx(ke.Provider,{value:d,children:e})};function Tr(){return new Map}function Cr(e=!0){const t=ve.useContext(ke);if(null===t)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=t,s=ve.useId();ve.useEffect(()=>{if(e)return r(s)},[e]);const o=ve.useCallback(()=>e&&i&&i(s),[s,i,e]);return!n&&i?[!1,o]:[!0]}const Ir=e=>e.key||"";function kr(e){const t=[];return ve.Children.forEach(e,e=>{ve.isValidElement(e)&&t.push(e)}),t}const Rr=({children:e,custom:t,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:s="sync",propagate:o=!1,anchorX:a="left",root:l})=>{const[c,u]=Cr(o),h=ve.useMemo(()=>kr(e),[e]),d=o&&!c?[]:h.map(Ir),f=ve.useRef(!0),p=ve.useRef(h),g=Te(()=>new Map),[m,y]=ve.useState(h),[v,_]=ve.useState(h);Ie(()=>{f.current=!1,p.current=h;for(let e=0;e<v.length;e++){const t=Ir(v[e]);d.includes(t)?g.delete(t):!0!==g.get(t)&&g.set(t,!1)}},[v,d.length,d.join("-")]);const b=[];if(h!==m){let e=[...h];for(let t=0;t<v.length;t++){const n=v[t],i=Ir(n);d.includes(i)||(e.splice(t,0,n),b.push(n))}return"wait"===s&&b.length&&(e=b),_(kr(e)),y(h),null}const{forceRender:E}=ve.useContext(Se);return Ae.jsx(Ae.Fragment,{children:v.map(e=>{const m=Ir(e),y=!(o&&!c)&&(h===v||d.includes(m));return Ae.jsx(Sr,{isPresent:y,initial:!(f.current&&!n)&&void 0,custom:t,presenceAffectsLayout:r,mode:s,root:l,onExitComplete:y?void 0:()=>{if(!g.has(m))return;g.set(m,!0);let e=!0;g.forEach(t=>{t||(e=!1)}),e&&(null==E||E(),_(p.current),o&&(null==u||u()),i&&i())},anchorX:a,children:e},m)})})},Pr=ve.createContext({strict:!1}),Mr={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Lr={};for(const L in Mr)Lr[L]={isEnabled:e=>Mr[L].some(t=>!!e[t])};const Br=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Nr(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Br.has(e)}let Or=e=>!Nr(e);try{"function"==typeof(Dr=require("@emotion/is-prop-valid").default)&&(Or=e=>e.startsWith("on")?!Nr(e):Dr(e))}catch{}var Dr;const Fr=ve.createContext({});function Ur(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function zr(e){return"string"==typeof e||Array.isArray(e)}const Gr=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Vr=["initial",...Gr];function Hr(e){return Ur(e.animate)||Vr.some(t=>zr(e[t]))}function jr(e){return Boolean(Hr(e)||e.variants)}function Wr(e){const{initial:t,animate:n}=function(e,t){if(Hr(e)){const{initial:t,animate:n}=e;return{initial:!1===t||zr(t)?t:void 0,animate:zr(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,ve.useContext(Fr));return ve.useMemo(()=>({initial:t,animate:n}),[$r(t),$r(n)])}function $r(e){return Array.isArray(e)?e.join(" "):e}const Xr={};function qr(e,{layout:t,layoutId:n}){return ai.has(e)||e.startsWith("origin")||(t||void 0!==n)&&(!!Xr[e]||"opacity"===e)}const Kr={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Yr=oi.length;function Jr(e,t,n){const{style:i,vars:r,transformOrigin:s}=e;let o=!1,a=!1;for(const l in t){const e=t[l];if(ai.has(l))o=!0;else if(_t(l))r[l]=e;else{const t=nr(e,Yi[l]);l.startsWith("origin")?(a=!0,s[l]=t):i[l]=t}}if(t.transform||(o||n?i.transform=function(e,t,n){let i="",r=!0;for(let s=0;s<Yr;s++){const o=oi[s],a=e[o];if(void 0===a)continue;let l=!0;if(l="number"==typeof a?a===(o.startsWith("scale")?1:0):0===parseFloat(a),!l||n){const e=nr(a,Yi[o]);l||(r=!1,i+=`${Kr[o]||o}(${e}) `),n&&(t[o]=e)}}return i=i.trim(),n?i=n(t,r?"":i):r&&(i="none"),i}(t,e.transform,n):i.transform&&(i.transform="none")),a){const{originX:e="50%",originY:t="50%",originZ:n=0}=s;i.transformOrigin=`${e} ${t} ${n}`}}const Zr=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Qr(e,t,n){for(const i in t)br(t[i])||qr(i,n)||(e[i]=t[i])}function es(e,t){const n={};return Qr(n,e.style||{},e),Object.assign(n,function({transformTemplate:e},t){return ve.useMemo(()=>{const n={style:{},transform:{},transformOrigin:{},vars:{}};return Jr(n,t,e),Object.assign({},n.vars,n.style)},[t])}(e,t)),n}function ts(e,t){const n={},i=es(e,t);return e.drag&&!1!==e.dragListener&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=i,n}const ns={offset:"stroke-dashoffset",array:"stroke-dasharray"},is={offset:"strokeDashoffset",array:"strokeDasharray"};function rs(e,{attrX:t,attrY:n,attrScale:i,pathLength:r,pathSpacing:s=1,pathOffset:o=0,...a},l,c,u){if(Jr(e,a,c),l)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:h,style:d}=e;h.transform&&(d.transform=h.transform,delete h.transform),(d.transform||h.transformOrigin)&&(d.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),d.transform&&(d.transformBox=(null==u?void 0:u.transformBox)??"fill-box",delete h.transformBox),void 0!==t&&(h.x=t),void 0!==n&&(h.y=n),void 0!==i&&(h.scale=i),void 0!==r&&function(e,t,n=1,i=0,r=!0){e.pathLength=1;const s=r?ns:is;e[s.offset]=Dt.transform(-i);const o=Dt.transform(t),a=Dt.transform(n);e[s.array]=`${o} ${a}`}(h,r,s,o,!1)}const ss=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),os=e=>"string"==typeof e&&"svg"===e.toLowerCase();function as(e,t,n,i){const r=ve.useMemo(()=>{const n={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return rs(n,t,os(i),e.transformTemplate,e.style),{...n.attrs,style:{...n.style}}},[t]);if(e.style){const t={};Qr(t,e.style,e),r.style={...t,...r.style}}return r}const ls=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function cs(e){return"string"==typeof e&&!e.includes("-")&&!!(ls.indexOf(e)>-1||/[A-Z]/u.test(e))}function us(e,t,n,{latestValues:i},r,s=!1){const o=(cs(e)?as:ts)(t,i,r,e),a=function(e,t,n){const i={};for(const r in e)"values"===r&&"object"==typeof e.values||(Or(r)||!0===n&&Nr(r)||!t&&!Nr(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(t,"string"==typeof e,s),l=e!==ve.Fragment?{...a,...o,ref:n}:{},{children:c}=t,u=ve.useMemo(()=>br(c)?c.get():c,[c]);return ve.createElement(e,{...l,children:u})}function hs(e){const t=[{},{}];return null==e||e.values.forEach((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()}),t}function ds(e,t,n,i){if("function"==typeof t){const[r,s]=hs(i);t=t(void 0!==n?n:e.custom,r,s)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){const[r,s]=hs(i);t=t(void 0!==n?n:e.custom,r,s)}return t}function fs(e){return br(e)?e.get():e}function ps(e,t,n,i){const r={},s=i(e,{});for(const d in s)r[d]=fs(s[d]);let{initial:o,animate:a}=e;const l=Hr(e),c=jr(e);t&&c&&!l&&!1!==e.inherit&&(void 0===o&&(o=t.initial),void 0===a&&(a=t.animate));let u=!!n&&!1===n.initial;u=u||!1===o;const h=u?a:o;if(h&&"boolean"!=typeof h&&!Ur(h)){const t=Array.isArray(h)?h:[h];for(let n=0;n<t.length;n++){const i=ds(e,t[n]);if(i){const{transitionEnd:e,transition:t,...n}=i;for(const i in n){let e=n[i];if(Array.isArray(e)){e=e[u?e.length-1:0]}null!==e&&(r[i]=e)}for(const i in e)r[i]=e[i]}}}return r}const gs=e=>(t,n)=>{const i=ve.useContext(Fr),r=ve.useContext(ke),s=()=>function({scrapeMotionValuesFromProps:e,createRenderState:t},n,i,r){return{latestValues:ps(n,i,r,e),renderState:t()}}(e,t,i,r);return n?s():Te(s)};function ms(e,t,n){var i;const{style:r}=e,s={};for(const o in r)(br(r[o])||t.style&&br(t.style[o])||qr(o,e)||void 0!==(null==(i=null==n?void 0:n.getValue(o))?void 0:i.liveStyle))&&(s[o]=r[o]);return s}const ys=gs({scrapeMotionValuesFromProps:ms,createRenderState:Zr});function vs(e,t,n){const i=ms(e,t,n);for(const r in e)if(br(e[r])||br(t[r])){i[-1!==oi.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return i}const _s=gs({scrapeMotionValuesFromProps:vs,createRenderState:ss}),bs=Symbol.for("motionComponentSymbol");function Es(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function ws(e,t,n){return ve.useCallback(i=>{i&&e.onMount&&e.onMount(i),t&&(i?t.mount(i):t.unmount()),n&&("function"==typeof n?n(i):Es(n)&&(n.current=i))},[t])}const xs=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),As="data-"+xs("framerAppearId"),Ss=ve.createContext({});function Ts(e,t,n,i,r){var s,o;const{visualElement:a}=ve.useContext(Fr),l=ve.useContext(Pr),c=ve.useContext(ke),u=ve.useContext(wr).reducedMotion,h=ve.useRef(null);i=i||l.renderer,!h.current&&i&&(h.current=i(e,{visualState:t,parent:a,props:n,presenceContext:c,blockInitialAnimation:!!c&&!1===c.initial,reducedMotionConfig:u}));const d=h.current,f=ve.useContext(Ss);!d||d.projection||!r||"html"!==d.type&&"svg"!==d.type||function(e,t,n,i){const{layoutId:r,layout:s,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:c,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:Cs(e.parent)),e.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:Boolean(o)||a&&Es(a),visualElement:e,animationType:"string"==typeof s?s:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:l,layoutRoot:c})}(h.current,n,r,f);const p=ve.useRef(!1);ve.useInsertionEffect(()=>{d&&p.current&&d.update(n,c)});const g=n[As],m=ve.useRef(Boolean(g)&&!(null==(s=window.MotionHandoffIsComplete)?void 0:s.call(window,g))&&(null==(o=window.MotionHasOptimisedAnimation)?void 0:o.call(window,g)));return Ie(()=>{d&&(p.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),m.current&&d.animationState&&d.animationState.animateChanges())}),ve.useEffect(()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var e;null==(e=window.MotionHandoffMarkAsComplete)||e.call(window,g)}),m.current=!1),d.enteringChildren=void 0)}),d}function Cs(e){if(e)return!1!==e.options.allowProjection?e.projection:Cs(e.parent)}function Is(e,{forwardMotionProps:t=!1}={},n,i){n&&function(e){for(const t in e)Lr[t]={...Lr[t],...e[t]}}(n);const r=cs(e)?_s:ys;function s(n,s){let o;const a={...ve.useContext(wr),...n,layoutId:ks(n)},{isStatic:l}=a,c=Wr(n),u=r(n,l);if(!l&&Ce){ve.useContext(Pr).strict;const t=function(e){const{drag:t,layout:n}=Lr;if(!t&&!n)return{};const i={...t,...n};return{MeasureLayout:(null==t?void 0:t.isEnabled(e))||(null==n?void 0:n.isEnabled(e))?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(a);o=t.MeasureLayout,c.visualElement=Ts(e,u,a,i,t.ProjectionNode)}return Ae.jsxs(Fr.Provider,{value:c,children:[o&&c.visualElement?Ae.jsx(o,{visualElement:c.visualElement,...a}):null,us(e,n,ws(u,c.visualElement,s),u,l,t)]})}s.displayName=`motion.${"string"==typeof e?e:`create(${e.displayName??e.name??""})`}`;const o=ve.forwardRef(s);return o[bs]=e,o}function ks({layoutId:e}){const t=ve.useContext(Se).id;return t&&void 0!==e?t+"-"+e:e}function Rs(e,t){if("undefined"==typeof Proxy)return Is;const n=new Map,i=(n,i)=>Is(n,i,e,t);return new Proxy((e,t)=>i(e,t),{get:(r,s)=>"create"===s?i:(n.has(s)||n.set(s,Is(s,void 0,e,t)),n.get(s))})}function Ps({top:e,left:t,right:n,bottom:i}){return{x:{min:t,max:n},y:{min:e,max:i}}}function Ms(e){return void 0===e||1===e}function Ls({scale:e,scaleX:t,scaleY:n}){return!Ms(e)||!Ms(t)||!Ms(n)}function Bs(e){return Ls(e)||Ns(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Ns(e){return Os(e.x)||Os(e.y)}function Os(e){return e&&"0%"!==e}function Ds(e,t,n){return n+t*(e-n)}function Fs(e,t,n,i,r){return void 0!==r&&(e=Ds(e,r,i)),Ds(e,n,i)+t}function Us(e,t=0,n=1,i,r){e.min=Fs(e.min,t,n,i,r),e.max=Fs(e.max,t,n,i,r)}function zs(e,{x:t,y:n}){Us(e.x,t.translate,t.scale,t.originPoint),Us(e.y,n.translate,n.scale,n.originPoint)}const Gs=.999999999999,Vs=1.0000000000001;function Hs(e,t){e.min=e.min+t,e.max=e.max+t}function js(e,t,n,i,r=.5){Us(e,t,n,en(e.min,e.max,r),i)}function Ws(e,t){js(e.x,t.x,t.scaleX,t.scale,t.originX),js(e.y,t.y,t.scaleY,t.scale,t.originY)}function $s(e,t){return Ps(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),t))}const Xs=()=>({x:{min:0,max:0},y:{min:0,max:0}}),qs={current:null},Ks={current:!1};const Ys=new WeakMap;const Js=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Zs{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:i,blockInitialAnimation:r,visualState:s},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=vi,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=yt.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,ht.render(this.render,!1,!0))};const{latestValues:a,renderState:l}=s;this.latestValues=a,this.baseTarget={...a},this.initialValues=t.initial?{...a}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=o,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=Hr(t),this.isVariantNode=jr(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:c,...u}=this.scrapeMotionValuesFromProps(t,{},this);for(const h in u){const e=u[h];void 0!==a[h]&&br(e)&&e.set(a[h])}}mount(e){var t;this.current=e,Ys.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),Ks.current||function(){if(Ks.current=!0,Ce)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>qs.current=e.matches;e.addEventListener("change",t),t()}else qs.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||qs.current),null==(t=this.parent)||t.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),dt(this.notifyUpdate),dt(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),null==(e=this.parent)||e.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const e=this.features[t];e&&(e.unmount(),e.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=ai.has(e);n&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&ht.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),r&&r(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Lr){const t=Lr[e];if(!t)continue;const{isEnabled:n,Feature:i}=t;if(!this.features[e]&&i&&n(this.props)&&(this.features[e]=new i(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<Js.length;n++){const t=Js[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,t,n){for(const i in t){const r=t[i],s=n[i];if(br(r))e.addValue(i,r);else if(br(s))e.addValue(i,sr(r,{owner:e}));else if(s!==r)if(e.hasValue(i)){const t=e.getValue(i);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(i);e.addValue(i,sr(void 0!==t?t:r,{owner:e}))}}for(const i in n)void 0===t[i]&&e.removeValue(i);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=sr(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){let n=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var i;return null!=n&&("string"==typeof n&&(Be(n)||Oe(n))?n=parseFloat(n):(i=n,!Er.find(Gi(i))&&Jt.test(t)&&(n=Qi(e,t))),this.setBaseTarget(e,br(n)?n.get():n)),br(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props;let i;if("string"==typeof n||"object"==typeof n){const r=ds(this.props,n,null==(t=this.presenceContext)?void 0:t.custom);r&&(i=r[e])}if(n&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||br(r)?void 0!==this.initialValues[e]&&void 0===i?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new Ve),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){or.render(this.render)}}class Qs extends Zs{constructor(){super(...arguments),this.KeyframeResolver=tr}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;br(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}function eo(e,{style:t,vars:n},i,r){const s=e.style;let o;for(o in t)s[o]=t[o];for(o in null==r||r.applyProjectionStyles(s,i),n)s.setProperty(o,n[o])}class to extends Qs{constructor(){super(...arguments),this.type="html",this.renderInstance=eo}readValueFromInstance(e,t){var n,i;if(ai.has(t))return(null==(n=this.projection)?void 0:n.isProjecting)?ii(t):((e,t)=>{const{transform:n="none"}=getComputedStyle(e);return ri(n,t)})(e,t);{const n=(i=e,window.getComputedStyle(i)),r=(_t(t)?n.getPropertyValue(t):n[t])||0;return"string"==typeof r?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return $s(e,t)}build(e,t,n){Jr(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return ms(e,t,n)}}const no=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);class io extends Qs{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Xs}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(ai.has(t)){const e=Zi(t);return e&&e.default||0}return t=no.has(t)?t:xs(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return vs(e,t,n)}build(e,t,n){rs(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,i){!function(e,t,n,i){eo(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(no.has(r)?r:xs(r),t.attrs[r])}(e,t,0,i)}mount(e){this.isSVGTag=os(e.tagName),super.mount(e)}}const ro=(e,t)=>cs(e)?new io(t):new to(t,{allowProjection:e!==ve.Fragment});function so(e,t,n){const i=e.getProps();return ds(i,t,void 0!==n?n:i.custom,e)}const oo=e=>Array.isArray(e);function ao(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,sr(n))}function lo(e){return oo(e)?e[e.length-1]||0:e}function co(e,t){const n=e.getValue("willChange");if(i=n,Boolean(br(i)&&i.add))return n.add(t);if(!n&&Le.WillChange){const n=new Le.WillChange("auto");e.addValue("willChange",n),n.add(t)}var i}function uo(e){return e.props[As]}const ho=e=>null!==e;const fo={type:"spring",stiffness:500,damping:25,restSpeed:10},po={type:"keyframes",duration:.8},go={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},mo=(e,{keyframes:t})=>t.length>2?po:ai.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:fo:go;const yo=(e,t,n,i={},r,s)=>o=>{const a=Ui(i,e)||{},l=a.delay||i.delay||0;let{elapsed:c=0}=i;c-=He(l);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...a,delay:-c,onUpdate:e=>{t.set(e),a.onUpdate&&a.onUpdate(e)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:e,motionValue:t,element:s?void 0:r};(function({when:e,delay:t,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:s,repeatType:o,repeatDelay:a,from:l,elapsed:c,...u}){return!!Object.keys(u).length})(a)||Object.assign(u,mo(e,u)),u.duration&&(u.duration=He(u.duration)),u.repeatDelay&&(u.repeatDelay=He(u.repeatDelay)),void 0!==u.from&&(u.keyframes[0]=u.from);let h=!1;if((!1===u.type||0===u.duration&&!u.repeatDelay)&&(Li(u),0===u.delay&&(h=!0)),(Le.instantAnimations||Le.skipAnimations)&&(h=!0,Li(u),u.delay=0),u.allowFlatten=!a.type&&!a.ease,h&&!s&&void 0!==t.get()){const e=function(e,{repeat:t,repeatType:n="loop"}){const i=e.filter(ho);return i[t&&"loop"!==n&&t%2==1?0:i.length-1]}(u.keyframes,a);if(void 0!==e)return void ht.update(()=>{u.onUpdate(e),u.onComplete()})}return a.isSync?new Kn(u):new Oi(u)};function vo({protectedKeys:e,needsAnimating:t},n){const i=e.hasOwnProperty(n)&&!0!==t[n];return t[n]=!1,i}function _o(e,t,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:s=e.getDefaultTransition(),transitionEnd:o,...a}=t;i&&(s=i);const l=[],c=r&&e.animationState&&e.animationState.getState()[r];for(const u in a){const t=e.getValue(u,e.latestValues[u]??null),i=a[u];if(void 0===i||c&&vo(c,u))continue;const r={delay:n,...Ui(s||{},u)},o=t.get();if(void 0!==o&&!t.isAnimating&&!Array.isArray(i)&&i===o&&!r.velocity)continue;let h=!1;if(window.MotionHandoffAnimation){const t=uo(e);if(t){const e=window.MotionHandoffAnimation(t,u,ht);null!==e&&(r.startTime=e,h=!0)}}co(e,u),t.start(yo(u,t,i,e.shouldReduceMotion&&zi.has(u)?{type:!1}:r,e,h));const d=t.animation;d&&l.push(d)}return o&&Promise.all(l).then(()=>{ht.update(()=>{o&&function(e,t){const n=so(e,t);let{transitionEnd:i={},transition:r={},...s}=n||{};s={...s,...i};for(const o in s)ao(e,o,lo(s[o]))}(e,o)})}),l}function bo(e,t,n,i=0,r=1){const s=Array.from(e).sort((e,t)=>e.sortNodePosition(t)).indexOf(t),o=e.size,a=(o-1)*i;return"function"==typeof n?n(s,o):1===r?s*i:a-s*i}function Eo(e,t,n={}){var i;const r=so(e,t,"exit"===n.type?null==(i=e.presenceContext)?void 0:i.custom:void 0);let{transition:s=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const o=r?()=>Promise.all(_o(e,r,n)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(i=0)=>{const{delayChildren:r=0,staggerChildren:o,staggerDirection:a}=s;return function(e,t,n=0,i=0,r=0,s=1,o){const a=[];for(const l of e.variantChildren)l.notify("AnimationStart",t),a.push(Eo(l,t,{...o,delay:n+("function"==typeof i?0:i)+bo(e.variantChildren,l,i,r,s)}).then(()=>l.notify("AnimationComplete",t)));return Promise.all(a)}(e,t,i,r,o,a,n)}:()=>Promise.resolve(),{when:l}=s;if(l){const[e,t]="beforeChildren"===l?[o,a]:[a,o];return e().then(()=>t())}return Promise.all([o(),a(n.delay)])}function wo(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}const xo=Vr.length;function Ao(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&Ao(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let n=0;n<xo;n++){const i=Vr[n],r=e.props[i];(zr(r)||!1===r)&&(t[i]=r)}return t}const So=[...Gr].reverse(),To=Gr.length;function Co(e){return t=>Promise.all(t.map(({animation:t,options:n})=>function(e,t,n={}){let i;if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map(t=>Eo(e,t,n));i=Promise.all(r)}else if("string"==typeof t)i=Eo(e,t,n);else{const r="function"==typeof t?so(e,t,n.custom):t;i=Promise.all(_o(e,r,n))}return i.then(()=>{e.notify("AnimationComplete",t)})}(e,t,n)))}function Io(e){let t=Co(e),n=Po(),i=!0;const r=t=>(n,i)=>{var r;const s=so(e,i,"exit"===t?null==(r=e.presenceContext)?void 0:r.custom:void 0);if(s){const{transition:e,transitionEnd:t,...i}=s;n={...n,...i,...t}}return n};function s(s){const{props:o}=e,a=Ao(e.parent)||{},l=[],c=new Set;let u={},h=1/0;for(let t=0;t<To;t++){const d=So[t],f=n[d],p=void 0!==o[d]?o[d]:a[d],g=zr(p),m=d===s?f.isActive:null;!1===m&&(h=t);let y=p===a[d]&&p!==o[d]&&g;if(y&&i&&e.manuallyAnimateOnMount&&(y=!1),f.protectedKeys={...u},!f.isActive&&null===m||!p&&!f.prevProp||Ur(p)||"boolean"==typeof p)continue;const v=ko(f.prevProp,p);let _=v||d===s&&f.isActive&&!y&&g||t>h&&g,b=!1;const E=Array.isArray(p)?p:[p];let w=E.reduce(r(d),{});!1===m&&(w={});const{prevResolvedValues:x={}}=f,A={...x,...w},S=t=>{_=!0,c.has(t)&&(b=!0,c.delete(t)),f.needsAnimating[t]=!0;const n=e.getValue(t);n&&(n.liveStyle=!1)};for(const e in A){const t=w[e],n=x[e];if(u.hasOwnProperty(e))continue;let i=!1;i=oo(t)&&oo(n)?!wo(t,n):t!==n,i?null!=t?S(e):c.add(e):void 0!==t&&c.has(e)?S(e):f.protectedKeys[e]=!0}f.prevProp=p,f.prevResolvedValues=w,f.isActive&&(u={...u,...w}),i&&e.blockInitialAnimation&&(_=!1);const T=y&&v;_&&(!T||b)&&l.push(...E.map(t=>{const n={type:d};if("string"==typeof t&&i&&!T&&e.manuallyAnimateOnMount&&e.parent){const{parent:i}=e,r=so(i,t);if(i.enteringChildren&&r){const{delayChildren:t}=r.transition||{};n.delay=bo(i.enteringChildren,e,t)}}return{animation:t,options:n}}))}if(c.size){const t={};if("boolean"!=typeof o.initial){const n=so(e,Array.isArray(o.initial)?o.initial[0]:o.initial);n&&n.transition&&(t.transition=n.transition)}c.forEach(n=>{const i=e.getBaseTarget(n),r=e.getValue(n);r&&(r.liveStyle=!0),t[n]=i??null}),l.push({animation:t})}let d=Boolean(l.length);return!i||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(d=!1),i=!1,d?t(l):Promise.resolve()}return{animateChanges:s,setActive:function(t,i){var r;if(n[t].isActive===i)return Promise.resolve();null==(r=e.variantChildren)||r.forEach(e=>{var n;return null==(n=e.animationState)?void 0:n.setActive(t,i)}),n[t].isActive=i;const o=s(t);for(const e in n)n[e].protectedKeys={};return o},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=Po(),i=!0}}}function ko(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!wo(t,e)}function Ro(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Po(){return{animate:Ro(!0),whileInView:Ro(),whileHover:Ro(),whileTap:Ro(),whileDrag:Ro(),whileFocus:Ro(),exit:Ro()}}class Mo{constructor(e){this.isMounted=!1,this.node=e}update(){}}let Lo=0;const Bo={animation:{Feature:class extends Mo{constructor(e){super(e),e.animationState||(e.animationState=Io(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Ur(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null==(e=this.unmountControls)||e.call(this)}}},exit:{Feature:class extends Mo{constructor(){super(...arguments),this.id=Lo++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}};function No(e,t,n,i={passive:!0}){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n)}function Oo(e){return{point:{x:e.pageX,y:e.pageY}}}function Do(e,t,n,i){return No(e,t,(e=>t=>dr(t)&&e(t,Oo(t)))(n),i)}function Fo(e){return e.max-e.min}function Uo(e,t,n,i=.5){e.origin=i,e.originPoint=en(t.min,t.max,e.origin),e.scale=Fo(n)/Fo(t),e.translate=en(n.min,n.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function zo(e,t,n,i){Uo(e.x,t.x,n.x,i?i.originX:void 0),Uo(e.y,t.y,n.y,i?i.originY:void 0)}function Go(e,t,n){e.min=n.min+t.min,e.max=e.min+Fo(t)}function Vo(e,t,n){e.min=t.min-n.min,e.max=e.min+Fo(t)}function Ho(e,t,n){Vo(e.x,t.x,n.x),Vo(e.y,t.y,n.y)}function jo(e){return[e("x"),e("y")]}const Wo=({current:e})=>e?e.ownerDocument.defaultView:null,$o=(e,t)=>Math.abs(e-t);class Xo{constructor(e,t,{transformPagePoint:n,contextWindow:i=window,dragSnapToOrigin:r=!1,distanceThreshold:s=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Yo(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=$o(e.x,t.x),i=$o(e.y,t.y);return Math.sqrt(n**2+i**2)}(e.offset,{x:0,y:0})>=this.distanceThreshold;if(!t&&!n)return;const{point:i}=e,{timestamp:r}=ft;this.history.push({...i,timestamp:r});const{onStart:s,onMove:o}=this.handlers;t||(s&&s(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=qo(t,this.transformPagePoint),ht.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const s=Yo("pointercancel"===e.type?this.lastMoveEventInfo:qo(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,s),i&&i(e,s)},!dr(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=n,this.distanceThreshold=s,this.contextWindow=i||window;const o=qo(Oo(e),this.transformPagePoint),{point:a}=o,{timestamp:l}=ft;this.history=[{...a,timestamp:l}];const{onSessionStart:c}=t;c&&c(e,Yo(o,this.history)),this.removeListeners=ze(Do(this.contextWindow,"pointermove",this.handlePointerMove),Do(this.contextWindow,"pointerup",this.handlePointerUp),Do(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),dt(this.updatePoint)}}function qo(e,t){return t?{point:t(e.point)}:e}function Ko(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Yo({point:e},t){return{point:e,delta:Ko(e,Zo(t)),offset:Ko(e,Jo(t)),velocity:Qo(t,.1)}}function Jo(e){return e[0]}function Zo(e){return e[e.length-1]}function Qo(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,i=null;const r=Zo(e);for(;n>=0&&(i=e[n],!(r.timestamp-i.timestamp>He(t)));)n--;if(!i)return{x:0,y:0};const s=je(r.timestamp-i.timestamp);if(0===s)return{x:0,y:0};const o={x:(r.x-i.x)/s,y:(r.y-i.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function ea(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function ta(e,t){let n=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,i]=[i,n]),{min:n,max:i}}const na=.35;function ia(e,t,n){return{min:ra(e,t),max:ra(e,n)}}function ra(e,t){return"number"==typeof e?e:e[t]||0}const sa=new WeakMap;class oa{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:n}={}){const{presenceContext:i}=this.visualElement;if(i&&!1===i.isPresent)return;const{dragSnapToOrigin:r}=this.getProps();this.panSession=new Xo(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Oo(e).point)},onStart:(e,t)=>{const{drag:n,dragPropagation:i,onDragStart:r}=this.getProps();if(n&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(s=n)||"y"===s?ar[s]?null:(ar[s]=!0,()=>{ar[s]=!1}):ar.x||ar.y?null:(ar.x=ar.y=!0,()=>{ar.x=ar.y=!1}),!this.openDragLock))return;var s;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),jo(e=>{let t=this.getAxisMotionValue(e).get()||0;if(Ot.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const i=n.layout.layoutBox[e];if(i){t=Fo(i)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),r&&ht.postRender(()=>r(e,t)),co(this.visualElement,"transform");const{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;const{dragPropagation:n,dragDirectionLock:i,onDirectionLock:r,onDrag:s}=this.getProps();if(!n&&!this.openDragLock)return;const{offset:o}=t;if(i&&null===this.currentDirection)return this.currentDirection=function(e,t=10){let n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(o),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,o),this.updateAxis("y",t.point,o),this.visualElement.render(),s&&s(e,t)},onSessionEnd:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},resumeAnimation:()=>jo(e=>{var t;return"paused"===this.getAnimationState(e)&&(null==(t=this.getAxisMotionValue(e).animation)?void 0:t.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:r,distanceThreshold:n,contextWindow:Wo(this.visualElement)})}stop(e,t){const n=e||this.latestPointerEvent,i=t||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!i||!n)return;const{velocity:s}=i;this.startAnimation(s);const{onDragEnd:o}=this.getProps();o&&ht.postRender(()=>o(n,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:i}=this.getProps();if(!n||!aa(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let s=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(s=function(e,{min:t,max:n},i){return void 0!==t&&e<t?e=i?en(t,e,i.min):Math.max(e,t):void 0!==n&&e>n&&(e=i?en(n,e,i.max):Math.min(e,n)),e}(s,this.constraints[e],this.elastic[e])),r.set(s)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null==(e=this.visualElement.projection)?void 0:e.layout,r=this.constraints;t&&Es(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!i)&&function(e,{top:t,left:n,bottom:i,right:r}){return{x:ea(e.x,n,r),y:ea(e.y,t,i)}}(i.layoutBox,t),this.elastic=function(e=na){return!1===e?e=0:!0===e&&(e=na),{x:ia(e,"left","right"),y:ia(e,"top","bottom")}}(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&jo(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(i.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Es(e))return!1;const n=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(e,t,n){const i=$s(e,n),{scroll:r}=t;return r&&(Hs(i.x,r.offset.x),Hs(i.y,r.offset.y)),i}(n,i.root,this.visualElement.getTransformPagePoint());let s=function(e,t){return{x:ta(e.x,t.x),y:ta(e.y,t.y)}}(i.layout.layoutBox,r);if(t){const e=t(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(s));this.hasMutatedConstraints=!!e,e&&(s=Ps(e))}return s}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:s,onDragTransitionEnd:o}=this.getProps(),a=this.constraints||{},l=jo(o=>{if(!aa(o,t,this.currentDirection))return;let l=a&&a[o]||{};s&&(l={min:0,max:0});const c=i?200:1e6,u=i?40:1e7,h={type:"inertia",velocity:n?e[o]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(o,h)});return Promise.all(l).then(o)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return co(this.visualElement,e),n.start(yo(e,n,0,t,this.visualElement,!1))}stopAnimation(){jo(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){jo(e=>{var t;return null==(t=this.getAxisMotionValue(e).animation)?void 0:t.pause()})}getAnimationState(e){var t;return null==(t=this.getAxisMotionValue(e).animation)?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),i=n[t];return i||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){jo(t=>{const{drag:n}=this.getProps();if(!aa(t,n,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){const{min:n,max:s}=i.layout.layoutBox[t];r.set(e[t]-en(n,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!Es(t)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};jo(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const n=t.get();i[e]=function(e,t){let n=.5;const i=Fo(e),r=Fo(t);return r>i?n=Ge(t.min,t.max-i,e.min):i>r&&(n=Ge(e.min,e.max-r,t.min)),Me(0,1,n)}({min:n,max:n},this.constraints[e])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),jo(t=>{if(!aa(t,e,null))return;const n=this.getAxisMotionValue(t),{min:r,max:s}=this.constraints[t];n.set(en(r,s,i[t]))})}addListeners(){if(!this.visualElement.current)return;sa.set(this.visualElement,this);const e=Do(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();Es(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),ht.read(t);const r=No(window,"resize",()=>this.scalePositionWithinConstraints()),s=n.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(jo(t=>{const n=this.getAxisMotionValue(t);n&&(this.originPoint[t]+=e[t].translate,n.set(n.get()+e[t].translate))}),this.visualElement.render())});return()=>{r(),e(),i(),s&&s()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:s=na,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:s,dragMomentum:o}}}function aa(e,t,n){return!(!0!==t&&t!==e||null!==n&&n!==e)}const la=e=>(t,n)=>{e&&ht.postRender(()=>e(t,n))};const ca={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function ua(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const ha={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e){if(!Dt.test(e))return e;e=parseFloat(e)}return`${ua(e,t.target.x)}% ${ua(e,t.target.y)}%`}},da={correct:(e,{treeScale:t,projectionDelta:n})=>{const i=e,r=Jt.parse(e);if(r.length>5)return i;const s=Jt.createTransformer(e),o="number"!=typeof r[0]?1:0,a=n.x.scale*t.x,l=n.y.scale*t.y;r[0+o]/=a,r[1+o]/=l;const c=en(a,l,.5);return"number"==typeof r[2+o]&&(r[2+o]/=c),"number"==typeof r[3+o]&&(r[3+o]/=c),s(r)}};let fa=!1;class pa extends ve.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=e;!function(e){for(const t in e)Xr[t]=e[t],_t(t)&&(Xr[t].isCSSVariable=!0)}(ma),r&&(t.group&&t.group.add(r),n&&n.register&&i&&n.register(r),fa&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),ca.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:i,isPresent:r}=this.props,{projection:s}=n;return s?(s.isPresent=r,fa=!0,i||e.layoutDependency!==t||void 0===t||e.isPresent!==r?s.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?s.promote():s.relegate()||ht.postRender(()=>{const e=s.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),or.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:i}=e;fa=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ga(e){const[t,n]=Cr(),i=ve.useContext(Se);return Ae.jsx(pa,{...e,layoutGroup:i,switchLayoutGroup:ve.useContext(Ss),isPresent:t,safeToRemove:n})}const ma={borderRadius:{...ha,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ha,borderTopRightRadius:ha,borderBottomLeftRadius:ha,borderBottomRightRadius:ha,boxShadow:da};const ya=(e,t)=>e.depth-t.depth;class va{constructor(){this.children=[],this.isDirty=!1}add(e){Re(this.children,e),this.isDirty=!0}remove(e){Pe(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(ya),this.isDirty=!1,this.children.forEach(e)}}const _a=["TopLeft","TopRight","BottomLeft","BottomRight"],ba=_a.length,Ea=e=>"string"==typeof e?parseFloat(e):e,wa=e=>"number"==typeof e||Dt.test(e);function xa(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Aa=Ta(0,.5,tt),Sa=Ta(.5,.95,Fe);function Ta(e,t,n){return i=>i<e?0:i>t?1:n(Ge(e,t,i))}function Ca(e,t){e.min=t.min,e.max=t.max}function Ia(e,t){Ca(e.x,t.x),Ca(e.y,t.y)}function ka(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Ra(e,t,n,i,r){return e=Ds(e-=t,1/n,i),void 0!==r&&(e=Ds(e,1/r,i)),e}function Pa(e,t,[n,i,r],s,o){!function(e,t=0,n=1,i=.5,r,s=e,o=e){Ot.test(t)&&(t=parseFloat(t),t=en(o.min,o.max,t/100)-o.min);if("number"!=typeof t)return;let a=en(s.min,s.max,i);e===s&&(a-=t),e.min=Ra(e.min,t,n,a,r),e.max=Ra(e.max,t,n,a,r)}(e,t[n],t[i],t[r],t.scale,s,o)}const Ma=["x","scaleX","originX"],La=["y","scaleY","originY"];function Ba(e,t,n,i){Pa(e.x,t,Ma,n?n.x:void 0,i?i.x:void 0),Pa(e.y,t,La,n?n.y:void 0,i?i.y:void 0)}function Na(e){return 0===e.translate&&1===e.scale}function Oa(e){return Na(e.x)&&Na(e.y)}function Da(e,t){return e.min===t.min&&e.max===t.max}function Fa(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Ua(e,t){return Fa(e.x,t.x)&&Fa(e.y,t.y)}function za(e){return Fo(e.x)/Fo(e.y)}function Ga(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Va{constructor(){this.members=[]}add(e){Re(this.members,e),e.scheduleRender()}remove(e){if(Pe(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let n;for(let i=t;i>=0;i--){const e=this.members[i];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Ha=["","X","Y","Z"];let ja=0;function Wa(e,t,n,i){const{latestValues:r}=t;r[e]&&(n[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function $a(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=uo(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:t,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",ht,!(t||i))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&$a(i)}function Xa({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(e={},n=(null==t?void 0:t())){this.id=ja++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Ya),this.nodes.forEach(il),this.nodes.forEach(rl),this.nodes.forEach(Ja)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=n?n.root||n:this,this.path=n?[...n.path,n]:[],this.parent=n,this.depth=n?n.depth+1:0;for(let t=0;t<this.path.length;t++)this.path[t].shouldResetTransform=!0;this.root===this&&(this.nodes=new va)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Ve),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){const n=this.eventHandlers.get(e);n&&n.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;var n;this.isSVG=_r(t)&&!(_r(n=t)&&"svg"===n.tagName),this.instance=t;const{layoutId:i,layout:r,visualElement:s}=this.options;if(s&&!s.current&&s.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(r||i)&&(this.isLayoutDirty=!0),e){let n,i=0;const r=()=>this.root.updateBlockedByResize=!1;ht.read(()=>{i=window.innerWidth}),e(t,()=>{const e=window.innerWidth;e!==i&&(i=e,this.root.updateBlockedByResize=!0,n&&n(),n=function(e,t){const n=yt.now(),i=({timestamp:r})=>{const s=r-n;s>=t&&(dt(i),e(s-t))};return ht.setup(i,!0),()=>dt(i)}(r,250),ca.hasAnimatedSinceResize&&(ca.hasAnimatedSinceResize=!1,this.nodes.forEach(nl)))})}i&&this.root.registerSharedNode(i,this),!1!==this.options.animate&&s&&(i||r)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:n,layout:i})=>{if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const r=this.options.transition||s.getDefaultTransition()||ul,{onLayoutAnimationStart:o,onLayoutAnimationComplete:a}=s.getProps(),l=!this.targetLayout||!Ua(this.targetLayout,i),c=!t&&n;if(this.options.layoutRoot||this.resumeFrom||c||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const t={...Ui(r,"layout"),onPlay:o,onComplete:a};(s.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,c)}else t||nl(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=i})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),dt(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(sl),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&$a(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(Qa);if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(el);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(tl),this.nodes.forEach(qa),this.nodes.forEach(Ka)):this.nodes.forEach(el),this.clearAllSnapshots();const e=yt.now();ft.delta=Me(0,1e3/60,e-ft.timestamp),ft.timestamp=e,ft.isProcessing=!0,pt.update.process(ft),pt.preRender.process(ft),pt.render.process(ft),ft.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,or.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Za),this.sharedNodes.forEach(ol)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ht.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ht.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||Fo(this.snapshot.measuredBox.x)||Fo(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead()||this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=i(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Oa(this.projectionDelta),n=this.getTransformTemplate(),i=n?n(this.latestValues,""):void 0,s=i!==this.prevTransformTemplateValue;e&&this.instance&&(t||Bs(this.latestValues)||s)&&(r(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){const t=this.measurePageBox();let n=this.removeElementScroll(t);var i;return e&&(n=this.removeTransform(n)),fl((i=n).x),fl(i.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const n=t.measureViewportBox();if(!((null==(e=this.scroll)?void 0:e.wasRoot)||this.path.some(gl))){const{scroll:e}=this.root;e&&(Hs(n.x,e.offset.x),Hs(n.y,e.offset.y))}return n}removeElementScroll(e){var t;const n={x:{min:0,max:0},y:{min:0,max:0}};if(Ia(n,e),null==(t=this.scroll)?void 0:t.wasRoot)return n;for(let i=0;i<this.path.length;i++){const t=this.path[i],{scroll:r,options:s}=t;t!==this.root&&r&&s.layoutScroll&&(r.wasRoot&&Ia(n,e),Hs(n.x,r.offset.x),Hs(n.y,r.offset.y))}return n}applyTransform(e,t=!1){const n={x:{min:0,max:0},y:{min:0,max:0}};Ia(n,e);for(let i=0;i<this.path.length;i++){const e=this.path[i];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&Ws(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),Bs(e.latestValues)&&Ws(n,e.latestValues)}return Bs(this.latestValues)&&Ws(n,this.latestValues),n}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Ia(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!Bs(e.latestValues))continue;Ls(e.latestValues)&&e.updateSnapshot();const i=Xs();Ia(i,e.measurePageBox()),Ba(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,i)}return Bs(this.latestValues)&&Ba(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ft.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){var t;const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==n;if(!(e||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null==(t=this.parent)?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:s}=this.options;if(this.layout&&(r||s)){if(this.resolvedRelativeTargetAt=ft.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Ho(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Ia(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}var o,a,l;if(this.relativeTarget||this.targetDelta)if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,a=this.relativeTarget,l=this.relativeParent.target,Go(o.x,a.x,l.x),Go(o.y,a.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Ia(this.target,this.layout.layoutBox),zs(this.target,this.targetDelta)):Ia(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Ho(this.relativeTargetOrigin,this.target,e.target),Ia(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(this.parent&&!Ls(this.parent.latestValues)&&!Ns(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),n=Boolean(this.resumingFrom)||this!==t;let i=!0;if((this.isProjectionDirty||(null==(e=this.parent)?void 0:e.isProjectionDirty))&&(i=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===ft.timestamp&&(i=!1),i)return;const{layout:r,layoutId:s}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!s)return;Ia(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,a=this.treeScale.y;!function(e,t,n,i=!1){const r=n.length;if(!r)return;let s,o;t.x=t.y=1;for(let a=0;a<r;a++){s=n[a],o=s.projectionDelta;const{visualElement:r}=s.options;r&&r.props.style&&"contents"===r.props.style.display||(i&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Ws(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,zs(e,o)),i&&Bs(s.latestValues)&&Ws(e,s.latestValues))}t.x<Vs&&t.x>Gs&&(t.x=1),t.y<Vs&&t.y>Gs&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,n),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(ka(this.prevProjectionDelta.x,this.projectionDelta.x),ka(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),zo(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===o&&this.treeScale.y===a&&Ga(this.projectionDelta.x,this.prevProjectionDelta.x)&&Ga(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l))):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){var t;if(null==(t=this.options.visualElement)||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e,t=!1){const n=this.snapshot,i=n?n.latestValues:{},r={...this.latestValues},s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const o={x:{min:0,max:0},y:{min:0,max:0}},a=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(a&&!c&&!0===this.options.crossfade&&!this.path.some(cl));let h;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;var l,d,f,p,g,m;al(s.x,e.x,n),al(s.y,e.y,n),this.setTargetDelta(s),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ho(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),f=this.relativeTarget,p=this.relativeTargetOrigin,g=o,m=n,ll(f.x,p.x,g.x,m),ll(f.y,p.y,g.y,m),h&&(l=this.relativeTarget,d=h,Da(l.x,d.x)&&Da(l.y,d.y))&&(this.isProjectionDirty=!1),h||(h={x:{min:0,max:0},y:{min:0,max:0}}),Ia(h,this.relativeTarget)),a&&(this.animationValues=r,function(e,t,n,i,r,s){r?(e.opacity=en(0,n.opacity??1,Aa(i)),e.opacityExit=en(t.opacity??1,0,Sa(i))):s&&(e.opacity=en(t.opacity??1,n.opacity??1,i));for(let o=0;o<ba;o++){const r=`border${_a[o]}Radius`;let s=xa(t,r),a=xa(n,r);void 0===s&&void 0===a||(s||(s=0),a||(a=0),0===s||0===a||wa(s)===wa(a)?(e[r]=Math.max(en(Ea(s),Ea(a),i),0),(Ot.test(a)||Ot.test(s))&&(e[r]+="%")):e[r]=a)}(t.rotate||n.rotate)&&(e.rotate=en(t.rotate||0,n.rotate||0,i))}(r,i,this.latestValues,n,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){var t,n,i;this.notifyListeners("animationStart"),null==(t=this.currentAnimation)||t.stop(),null==(i=null==(n=this.resumingFrom)?void 0:n.currentAnimation)||i.stop(),this.pendingAnimation&&(dt(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ht.update(()=>{ca.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=sr(0)),this.currentAnimation=function(e,t,n){const i=br(e)?e:sr(e);return i.start(yo("",i,t,n)),i.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{},onComplete:()=>{e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:i,latestValues:r}=e;if(t&&n&&i){if(this!==e&&this.layout&&i&&pl(this.options.animationType,this.layout.layoutBox,i.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=Fo(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const i=Fo(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+i}Ia(t,n),Ws(t,r),zo(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Va);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null==(e=this.getStack())?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null==(e=this.getStack())?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:n}={}){const i=this.getStack();i&&i.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;const i={};n.z&&Wa("z",e,i,this.animationValues);for(let r=0;r<Ha.length;r++)Wa(`rotate${Ha[r]}`,e,i,this.animationValues),Wa(`skew${Ha[r]}`,e,i,this.animationValues);e.render();for(const r in i)e.setStaticValue(r,i[r]),this.animationValues&&(this.animationValues[r]=i[r]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible)return void(e.visibility="hidden");const n=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=fs(null==t?void 0:t.pointerEvents)||"",void(e.transform=n?n(this.latestValues,""):"none");const i=this.getLead();if(!this.projectionDelta||!this.layout||!i.target)return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=fs(null==t?void 0:t.pointerEvents)||""),void(this.hasProjected&&!Bs(this.latestValues)&&(e.transform=n?n({},""):"none",this.hasProjected=!1));e.visibility="";const r=i.animationValues||i.latestValues;this.applyTransformsToTarget();let s=function(e,t,n){let i="";const r=e.x.translate/t.x,s=e.y.translate/t.y,o=(null==n?void 0:n.z)||0;if((r||s||o)&&(i=`translate3d(${r}px, ${s}px, ${o}px) `),1===t.x&&1===t.y||(i+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:s,skewX:o,skewY:a}=n;e&&(i=`perspective(${e}px) ${i}`),t&&(i+=`rotate(${t}deg) `),r&&(i+=`rotateX(${r}deg) `),s&&(i+=`rotateY(${s}deg) `),o&&(i+=`skewX(${o}deg) `),a&&(i+=`skewY(${a}deg) `)}const a=e.x.scale*t.x,l=e.y.scale*t.y;return 1===a&&1===l||(i+=`scale(${a}, ${l})`),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,r);n&&(s=n(r,s)),e.transform=s;const{x:o,y:a}=this.projectionDelta;e.transformOrigin=`${100*o.origin}% ${100*a.origin}% 0`,i.animationValues?e.opacity=i===this?r.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:r.opacityExit:e.opacity=i===this?void 0!==r.opacity?r.opacity:"":void 0!==r.opacityExit?r.opacityExit:0;for(const l in Xr){if(void 0===r[l])continue;const{correct:t,applyTo:n,isCSSVariable:o}=Xr[l],a="none"===s?r[l]:t(r[l],i);if(n){const t=n.length;for(let i=0;i<t;i++)e[n[i]]=a}else o?this.options.visualElement.renderState.vars[l]=a:e[l]=a}this.options.layoutId&&(e.pointerEvents=i===this?fs(null==t?void 0:t.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var t;return null==(t=e.currentAnimation)?void 0:t.stop()}),this.root.nodes.forEach(Qa),this.root.sharedNodes.clear()}}}function qa(e){e.updateLayout()}function Ka(e){var t;const n=(null==(t=e.resumeFrom)?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:i}=e.layout,{animationType:r}=e.options,s=n.source!==e.layout.source;"size"===r?jo(e=>{const i=s?n.measuredBox[e]:n.layoutBox[e],r=Fo(i);i.min=t[e].min,i.max=i.min+r}):pl(r,n.layoutBox,t)&&jo(i=>{const r=s?n.measuredBox[i]:n.layoutBox[i],o=Fo(t[i]);r.max=r.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+o)});const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};zo(o,t,n.layoutBox);const a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};s?zo(a,e.applyTransform(i,!0),n.measuredBox):zo(a,t,n.layoutBox);const l=!Oa(o);let c=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:s}=i;if(r&&s){const o={x:{min:0,max:0},y:{min:0,max:0}};Ho(o,n.layoutBox,r.layoutBox);const a={x:{min:0,max:0},y:{min:0,max:0}};Ho(a,t,s.layoutBox),Ua(o,a)||(c=!0),i.options.layoutRoot&&(e.relativeTarget=a,e.relativeTargetOrigin=o,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:n,delta:a,layoutDelta:o,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function Ya(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Ja(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Za(e){e.clearSnapshot()}function Qa(e){e.clearMeasurements()}function el(e){e.isLayoutDirty=!1}function tl(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function nl(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function il(e){e.resolveTargetDelta()}function rl(e){e.calcProjection()}function sl(e){e.resetSkewAndRotation()}function ol(e){e.removeLeadSnapshot()}function al(e,t,n){e.translate=en(t.translate,0,n),e.scale=en(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function ll(e,t,n,i){e.min=en(t.min,n.min,i),e.max=en(t.max,n.max,i)}function cl(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const ul={duration:.45,ease:[.4,0,.1,1]},hl=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),dl=hl("applewebkit/")&&!hl("chrome/")?Math.round:Fe;function fl(e){e.min=dl(e.min),e.max=dl(e.max)}function pl(e,t,n){return"position"===e||"preserve-aspect"===e&&(i=za(t),r=za(n),s=.2,!(Math.abs(i-r)<=s));var i,r,s}function gl(e){var t;return e!==e.root&&(null==(t=e.scroll)?void 0:t.wasRoot)}const ml=Xa({attachResizeListener:(e,t)=>No(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),yl={current:void 0},vl=Xa({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!yl.current){const e=new ml({});e.mount(window),e.setOptions({layoutScroll:!0}),yl.current=e}return yl.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),_l={pan:{Feature:class extends Mo{constructor(){super(...arguments),this.removePointerDownListener=Fe}onPointerDown(e){this.session=new Xo(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Wo(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:la(e),onStart:la(t),onMove:n,onEnd:(e,t)=>{delete this.session,i&&ht.postRender(()=>i(e,t))}}}mount(){this.removePointerDownListener=Do(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Mo{constructor(e){super(e),this.removeGroupControls=Fe,this.removeListeners=Fe,this.controls=new oa(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Fe}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:vl,MeasureLayout:ga}};function bl(e,t,n){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===n);const r=i["onHover"+n];r&&ht.postRender(()=>r(t,Oo(t)))}function El(e,t,n){const{props:i}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===n);const r=i["onTap"+("End"===n?"":n)];r&&ht.postRender(()=>r(t,Oo(t)))}const wl=new WeakMap,xl=new WeakMap,Al=e=>{const t=wl.get(e.target);t&&t(e)},Sl=e=>{e.forEach(Al)};function Tl(e,t,n){const i=function({root:e,...t}){const n=e||document;xl.has(n)||xl.set(n,{});const i=xl.get(n),r=JSON.stringify(t);return i[r]||(i[r]=new IntersectionObserver(Sl,{root:e,...t})),i[r]}(t);return wl.set(e,n),i.observe(e),()=>{wl.delete(e),i.unobserve(e)}}const Cl={some:0,all:1};const Il=Rs({...Bo,...{inView:{Feature:class extends Mo{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:i="some",once:r}=e,s={root:t?t.current:void 0,rootMargin:n,threshold:"number"==typeof i?i:Cl[i]};return Tl(this.node.current,s,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:i}=this.node.getProps(),s=t?n:i;s&&s(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Mo{mount(){const{current:e}=this.node;e&&(this.unmount=vr(e,(e,t)=>(El(this.node,t,"Start"),(e,{success:t})=>El(this.node,e,t?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends Mo{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(dy){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ze(No(this.node.current,"focus",()=>this.onFocus()),No(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends Mo{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t,n={}){const[i,r,s]=cr(e,n),o=e=>{if(!ur(e))return;const{target:n}=e,i=t(n,e);if("function"!=typeof i||!n)return;const s=e=>{ur(e)&&(i(e),n.removeEventListener("pointerleave",s))};n.addEventListener("pointerleave",s,r)};return i.forEach(e=>{e.addEventListener("pointerenter",o,r)}),s}(e,(e,t)=>(bl(this.node,t,"Start"),e=>bl(this.node,e,"End"))))}unmount(){}}}},..._l,...{layout:{ProjectionNode:vl,MeasureLayout:ga}}},ro);function kl(e,t){return t.split(".").reduce((e,t)=>e?e[t]:void 0,e)}function Rl(e,t,n){const i=t.split("."),r=i.pop();let s=e;for(const o of i)"object"==typeof s[o]&&null!==s[o]||(s[o]={}),s=s[o];s[r]=n}function Pl(e,t=[],n=.7){if(!t||0===t.length)return{ask:!0,reason:"missing"};const i=[...t].sort((e,t)=>t.confidence-e.confidence)[0];return i.confidence>=n?{value:i.value,ask:!1}:{value:i.value,ask:!0,reason:"low_confidence"}}function Ml(e){if("undefined"!=typeof window&&window.t)try{const t=window.t(e);if(t&&t!==e)return t}catch(i){}const t={de:{"ai.chatbot.title":"Zufahrtsschutz-Assistent","ai.chatbot.welcome":"Willkommen zum Zufahrtsschutz-Assistenten. Ich stelle nur Fragen, die noch fehlen oder unsicher sind. Bereit?","ai.chatbot.assetQuestion":"Welche Schutzgter mchten Sie absichern?","ai.chatbot.inputPlaceholder":"Antwort eingeben...","ai.chatbot.sendButton":"Senden","ai.chatbot.stakeholderQuestion":"Wer sind die relevanten Stakeholder (Behrden, Veranstalter, Betreiber)?","ai.chatbot.restRiskQuestion":"Welches akzeptable Restrisiko gilt?","ai.chatbot.operationalQuestion":"Betriebsanforderungen (mehrfach whlbar)","ai.chatbot.threatQuestion":"Welche Art fahrzeuggesttzter Bedrohung ist zu erwarten?","ai.chatbot.vehicleTypesQuestion":"Welche Fahrzeugtypen sind relevant?","ai.chatbot.accessCorridorsQuestion":"Wo knnten Fahrzeuge eindringen? (Karte markieren oder beschreiben)","ai.chatbot.speedQuestion":"Maximale Zufahrtsgeschwindigkeit (km/h)","ai.chatbot.angleQuestion":"Wahrscheinlicher Anprallwinkel ()","ai.chatbot.groundQuestion":"Untergrund/Fundamente am Standort","ai.chatbot.riskMatrixQuestion":"Risikobewertung: Eintrittswahrscheinlichkeit & Schadensausma","ai.chatbot.completionMessage":"Danke! Alle erforderlichen Angaben sind vorhanden. Mchten Sie den normkonformen PDF-Plan erzeugen?","ai.chatbot.infoPrefix":"Hinweis: ","ai.chatbot.assetQuestionInfo":"Grundlage fr Schutzziel & Schutzklasse (DIN SPEC 91414-2 / ISO 22343-2)","ai.chatbot.restRiskQuestionInfo":"Steuert Schutzklasse/Sicherungsgrad (DIN SPEC 91414-2)","ai.chatbot.speedQuestionInfo":"Pflichtparameter fr FSB-Performance (ISO 22343-2/-1)","ai.chatbot.angleQuestionInfo":"Pflichtparameter fr FSB-Performance (ISO 22343-2/-1)","ai.chatbot.riskMatrixQuestionInfo":"Erzeugt Sicherungsgrad & Schutzklasse (DIN SPEC 91414-2)","ai.chatbot.assetOptions":"Menschenmenge,Gebude,KRITIS-Prozess,Veranstaltungsflche","ai.chatbot.assetPlaceholder":"z. B. Menschenmenge, Bhne","ai.chatbot.stakeholderOptions":"Behrden,Veranstalter,Betreiber","ai.chatbot.restRiskOptions":"niedrig,mittel,hoch","ai.chatbot.operationalOptions":"Feuerwehrzufahrt,Fluchtwege,Verkehrssicherheit,Betriebssicherheit","ai.chatbot.threatOptions":"intentional,unbeabsichtigt,beides","ai.chatbot.vehicleOptions":"PKW,Transporter,LKW,Bus","ai.chatbot.groundOptions":"Asphalt,Beton,Pflaster,Erde,Unbekannt","ai.chatbot.riskMatrixOptions":"EW:niedrig|SA:gering,EW:niedrig|SA:mittel,EW:mittel|SA:mittel,EW:hoch|SA:schwer","ai.chatbot.accessCorridorsPlaceholder":"Polyline/Polygon auswhlen oder kurz beschreiben"},en:{"ai.chatbot.title":"Access Protection Assistant","ai.chatbot.welcome":"Welcome to the Access Protection Assistant. I only ask questions that are still missing or uncertain. Ready?","ai.chatbot.assetQuestion":"Which protective assets would you like to secure?","ai.chatbot.inputPlaceholder":"Enter answer...","ai.chatbot.sendButton":"Send","ai.chatbot.stakeholderQuestion":"Who are the relevant stakeholders (authorities, organizers, operators)?","ai.chatbot.restRiskQuestion":"What acceptable residual risk applies?","ai.chatbot.operationalQuestion":"Operational requirements (multiple choice)","ai.chatbot.threatQuestion":"What type of vehicle-based threat is expected?","ai.chatbot.vehicleTypesQuestion":"Which vehicle types are relevant?","ai.chatbot.accessCorridorsQuestion":"Where could vehicles penetrate? (Mark on map or describe)","ai.chatbot.speedQuestion":"Maximum access speed (km/h)","ai.chatbot.angleQuestion":"Probable impact angle ()","ai.chatbot.groundQuestion":"Ground/foundations at the site","ai.chatbot.riskMatrixQuestion":"Risk assessment: probability of occurrence & extent of damage","ai.chatbot.completionMessage":"Thank you! All required information is available. Would you like to generate the standards-compliant PDF plan?","ai.chatbot.infoPrefix":"Note: ","ai.chatbot.assetQuestionInfo":"Basis for Protection Goal & Protection Class (DIN SPEC 91414-2 / ISO 22343-2)","ai.chatbot.restRiskQuestionInfo":"Controls Protection Class/Security Level (DIN SPEC 91414-2)","ai.chatbot.speedQuestionInfo":"Required parameter for FSB performance (ISO 22343-2/-1)","ai.chatbot.angleQuestionInfo":"Required parameter for FSB performance (ISO 22343-2/-1)","ai.chatbot.riskMatrixQuestionInfo":"Generates Security Level & Protection Class (DIN SPEC 91414-2)","ai.chatbot.assetOptions":"Crowd,Building,CRITIS Process,Event Area","ai.chatbot.assetPlaceholder":"e.g. crowd, stage","ai.chatbot.stakeholderOptions":"Authorities,Organizers,Operators","ai.chatbot.restRiskOptions":"low,medium,high","ai.chatbot.operationalOptions":"Fire Brigade Access,Escape Routes,Traffic Safety,Operational Safety","ai.chatbot.threatOptions":"intentional,unintentional,both","ai.chatbot.vehicleOptions":"Car,Van,Truck,Bus","ai.chatbot.groundOptions":"Asphalt,Concrete,Pavement,Earth,Unknown","ai.chatbot.riskMatrixOptions":"PO:low|SD:medium,PO:medium|SD:medium,PO:high|SD:severe","ai.chatbot.accessCorridorsPlaceholder":"Select polyline/polygon or describe briefly"}};let n="de";if("undefined"!=typeof window)if(window.currentLanguage)n=window.currentLanguage;else if(window.translations&&window.translations.currentLanguage)n=window.translations.currentLanguage;else{const e=document.querySelector('.lang-btn[data-lang="de"].active');if(document.querySelector('.lang-btn[data-lang="en"].active'))n="en";else if(e)n="de";else{document.querySelectorAll(".lang-btn").forEach((e,t)=>{})}}return t[n]&&t[n][e]?t[n][e]:e}function Ll({open:e,onToggle:t}){return Ae.jsx("button",{"aria-label":Ml("ai.chatbot.title"),onClick:t,className:"zb-btn",children:Ae.jsx("span",{className:"text-xl",children:e?"":""})})}function Bl({role:e,text:t}){const n="bot"===e;return Ae.jsx("div",{className:"zb-msg "+(n?"zb-msg-left":"zb-msg-right"),children:Ae.jsx("div",{className:"zb-bubble "+(n?"zb-bot":"zb-user"),children:t})})}function Nl({onSend:e}){const[t,n]=ve.useState("");return Ae.jsxs("div",{className:"zb-input",children:[Ae.jsx("input",{className:"zb-input-field",placeholder:Ml("ai.chatbot.inputPlaceholder"),value:t,onChange:e=>n(e.target.value),onKeyDown:i=>{"Enter"===i.key&&t.trim()&&(e(t.trim()),n(""))}}),Ae.jsx("button",{className:"zb-input-send",onClick:()=>{t.trim()&&(e(t.trim()),n(""))},children:Ml("ai.chatbot.sendButton")})]})}function Ol({planningState:e,setPlanningState:t,getCandidatesFor:n}){const[i,r]=ve.useState({}),s=e??i,o=t??(e=>r(t=>e(t)));window.planningState=s;const[a,l]=ve.useState(!0),[c,u]=ve.useState([]),[h,d]=ve.useState(null),[f,p]=ve.useState(!1),g=ve.useRef(null);function m(e){u(t=>[...t,{role:"bot",text:e}])}function y(e,t){u(n=>[...n,{role:"user",text:e,field:t}])}ve.useEffect(()=>{0===c.length&&m(Ml("ai.chatbot.welcome"))},[]),ve.useEffect(()=>{c.length>0&&(g.current&&(g.current.scrollTop=g.current.scrollHeight),setTimeout(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},50))},[c.length]);const v=e=>{const t=kl(s,e.field);if(null!=t&&""!==t)return{ask:!1,value:t};const i=n?n(e.field):[];return e.resolver?e.resolver(i):Pl(e.field,i,.7)};function _(){for(const e of[{id:"schutzgueter",label:Ml("ai.chatbot.assetQuestion"),field:"schutzgter",type:"chips",options:Ml("ai.chatbot.assetOptions").split(","),placeholder:Ml("ai.chatbot.assetPlaceholder"),info:Ml("ai.chatbot.assetQuestionInfo")},{id:"stakeholder",label:Ml("ai.chatbot.stakeholderQuestion"),field:"stakeholder",type:"chips",options:Ml("ai.chatbot.stakeholderOptions").split(",")},{id:"restrisiko",label:Ml("ai.chatbot.restRiskQuestion"),field:"restrisiko.klasse",type:"select",options:Ml("ai.chatbot.restRiskOptions").split(","),info:Ml("ai.chatbot.restRiskQuestionInfo")},{id:"betrieb",label:Ml("ai.chatbot.operationalQuestion"),field:"betrieb",type:"multiselect",options:Ml("ai.chatbot.operationalOptions").split(",")},{id:"bedrohung",label:Ml("ai.chatbot.threatQuestion"),field:"risiko.bedrohung.art",type:"select",options:Ml("ai.chatbot.threatOptions").split(",")},{id:"fahrzeugtypen",label:Ml("ai.chatbot.vehicleTypesQuestion"),field:"risiko.bedrohung.fahrzeugtypen",type:"chips",options:Ml("ai.chatbot.vehicleOptions").split(",")},{id:"anfahrkorridore",label:Ml("ai.chatbot.accessCorridorsQuestion"),field:"risiko.site.anfahrkorridore",type:"geo",placeholder:Ml("ai.chatbot.accessCorridorsPlaceholder")},{id:"geschwindigkeit",label:Ml("ai.chatbot.speedQuestion"),field:"risiko.dynamik.v_kmh",type:"number",info:Ml("ai.chatbot.speedQuestionInfo"),resolver:e=>Pl(0,e,.7)},{id:"winkel",label:Ml("ai.chatbot.angleQuestion"),field:"risiko.dynamik.winkel_grad",type:"number",info:Ml("ai.chatbot.angleQuestionInfo"),resolver:e=>Pl(0,e,.7)},{id:"untergrund",label:Ml("ai.chatbot.groundQuestion"),field:"risiko.site.untergrund",type:"select",options:Ml("ai.chatbot.groundOptions").split(",")},{id:"risikomatrix",label:Ml("ai.chatbot.riskMatrixQuestion"),field:"risiko.matrix",type:"select",options:Ml("ai.chatbot.riskMatrixOptions").split(","),info:Ml("ai.chatbot.riskMatrixQuestionInfo")}]){if(e.dependsOn){if(e.dependsOn.find(e=>!kl(s,e)))continue}const t=v(e);if(t.ask)return e;void 0!==t.value&&o(n=>{const i={...n??{}};return Rl(i,e.field,t.value),i})}return null}return ve.useEffect(()=>{if(f)return;if(h)return;if(0===c.length)return;const e=_();if(e){d(e);const t=e.label,n=e.info?Ml("ai.chatbot.infoPrefix")+e.info:"";m(t+(n?`\n\n${n}`:""))}else!f&&c.length>0&&(m(Ml("ai.chatbot.completionMessage")),p(!0))},[s,a,h,f,c.length]),ve.useEffect(()=>{const e=()=>{u([]),d(null),p(!1),setTimeout(()=>{m(Ml("ai.chatbot.welcome"))},100)};window.addEventListener("languageChanged",e);const t=setInterval(()=>{const t=window.currentLanguage;t&&t!==window.lastChatbotLanguage&&(window.lastChatbotLanguage=t,e());const n=document.querySelector('.lang-btn[data-lang="de"].active');let i=null;document.querySelector('.lang-btn[data-lang="en"].active')?i="en":n&&(i="de"),i&&i!==window.lastChatbotDetectedLanguage&&(window.lastChatbotDetectedLanguage=i,e())},100);return()=>{window.removeEventListener("languageChanged",e),clearInterval(t)}},[]),Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(Ll,{open:a,onToggle:()=>l(e=>!e)}),Ae.jsx(Rr,{children:a&&Ae.jsxs(Il.aside,{initial:{x:380,opacity:0},animate:{x:0,opacity:1},exit:{x:380,opacity:0},transition:{type:"spring",stiffness:240,damping:28},className:"zb-panel","aria-label":"Zufahrtsschutz-Assistent Panel",children:[Ae.jsx("header",{className:"zb-header",children:Ae.jsx("div",{className:"zb-title",children:Ml("ai.chatbot.title")})}),Ae.jsx("div",{className:"zb-messages",ref:g,children:c.map((e,t)=>Ae.jsx(Bl,{role:e.role,text:e.text},t))}),Ae.jsx(Nl,{onSend:function(e){if(!h)return/^(ja|start|bereit|ok|okay|los)/i.test(e)&&(p(!1),d(null)),void y(e);y(e,h.field);let t=e;if("number"===h.type){const n=parseFloat(e.replace(",","."));t=isNaN(n)?void 0:n}else"chips"===h.type||"multiselect"===h.type?t=e.split(",").map(e=>e.trim()).filter(Boolean):"select"===h.type?t=e.trim():"bool"===h.type&&(t=/^(ja|true|y|yes)$/i.test(e));o(e=>{const n={...e??{}};return void 0!==t&&Rl(n,h.field,t),n}),d(null)}})]})})]})}var Dl,Fl,Ul={exports:{}},zl={},Gl={exports:{}},Vl={};function Hl(){return Fl||(Fl=1,Gl.exports=(Dl||(Dl=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,s=e[i];if(!(0<r(s,t)))break e;e[i]=t,e[n]=s,n=i}}function n(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,s=e.length,o=s>>>1;i<o;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>r(l,n))c<s&&0>r(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<s&&0>r(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,g=!1,m=!1,y="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,_="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var r=n(c);null!==r;){if(null===r.callback)i(c);else{if(!(r.startTime<=e))break;i(c),r.sortIndex=r.expirationTime,t(l,r)}r=n(c)}}function E(e){if(g=!1,b(e),!p)if(null!==n(l))p=!0,x||(x=!0,w());else{var t=n(c);null!==t&&P(E,t.startTime-e)}}var w,x=!1,A=-1,S=5,T=-1;function C(){return!(!m&&e.unstable_now()-T<S)}function I(){if(m=!1,x){var t=e.unstable_now();T=t;var r=!0;try{e:{p=!1,g&&(g=!1,v(A),A=-1),f=!0;var s=d;try{t:{for(b(t),h=n(l);null!==h&&!(h.expirationTime>t&&C());){var o=h.callback;if("function"==typeof o){h.callback=null,d=h.priorityLevel;var a=o(h.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof a){h.callback=a,b(t),r=!0;break t}h===n(l)&&i(l),b(t)}else i(l);h=n(l)}if(null!==h)r=!0;else{var u=n(c);null!==u&&P(E,u.startTime-t),r=!1}}break e}finally{h=null,d=s,f=!1}r=void 0}}finally{r?w():x=!1}}}if("function"==typeof _)w=function(){_(I)};else if("undefined"!=typeof MessageChannel){var k=new MessageChannel,R=k.port2;k.port1.onmessage=I,w=function(){R.postMessage(null)}}else w=function(){y(I,0)};function P(t,n){A=y(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(S=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},e.unstable_requestPaint=function(){m=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},e.unstable_scheduleCallback=function(i,r,s){var o=e.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?o+s:o,i){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return i={id:u++,callback:r,priorityLevel:i,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(i.sortIndex=s,t(c,i),null===n(l)&&i===n(c)&&(g?(v(A),A=-1):g=!0,P(E,s-o))):(i.sortIndex=a,t(l,i),p||f||(p=!0,x||(x=!0,w()))),i},e.unstable_shouldYield=C,e.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}}(Vl)),Vl)),Gl.exports}var jl,Wl,$l,Xl,ql={exports:{}},Kl={};function Yl(){if(jl)return Kl;jl=1;var e=ye();function t(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");var s=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}return Kl.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Kl.createPortal=function(e,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!n||1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType)throw Error(t(299));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:r,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,n,null,i)},Kl.flushSync=function(e){var t=s.T,n=i.p;try{if(s.T=null,i.p=2,e)return e()}finally{s.T=t,i.p=n,i.d.f()}},Kl.preconnect=function(e,t){"string"==typeof e&&(t?t="string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,i.d.C(e,t))},Kl.prefetchDNS=function(e){"string"==typeof e&&i.d.D(e)},Kl.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,r=o(n,t.crossOrigin),s="string"==typeof t.integrity?t.integrity:void 0,a="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?i.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:s,fetchPriority:a}):"script"===n&&i.d.X(e,{crossOrigin:r,integrity:s,fetchPriority:a,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},Kl.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=o(t.as,t.crossOrigin);i.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&i.d.M(e)},Kl.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,r=o(n,t.crossOrigin);i.d.L(e,n,{crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},Kl.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=o(t.as,t.crossOrigin);i.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else i.d.m(e)},Kl.requestFormReset=function(e){i.d.r(e)},Kl.unstable_batchedUpdates=function(e,t){return e(t)},Kl.useFormState=function(e,t,n){return s.H.useFormState(e,t,n)},Kl.useFormStatus=function(){return s.H.useHostTransitionStatus()},Kl.version="19.1.1",Kl}function Jl(){if($l)return zl;$l=1;var e=Hl(),t=ye(),n=(Wl||(Wl=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),ql.exports=Yl()),ql.exports);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function s(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function o(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function a(e){if(s(e)!==e)throw Error(i(188))}function l(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=l(e)))return t;e=e.sibling}return null}var c=Object.assign,u=Symbol.for("react.element"),h=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),m=Symbol.for("react.provider"),y=Symbol.for("react.consumer"),v=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),S=Symbol.for("react.memo_cache_sentinel"),T=Symbol.iterator;function C(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=T&&e[T]||e["@@iterator"])?e:null}var I=Symbol.for("react.client.reference");function k(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===I?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case f:return"Fragment";case g:return"Profiler";case p:return"StrictMode";case b:return"Suspense";case E:return"SuspenseList";case A:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case d:return"Portal";case v:return(e.displayName||"Context")+".Provider";case y:return(e._context.displayName||"Context")+".Consumer";case _:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case w:return null!==(t=e.displayName||null)?t:k(e.type)||"Memo";case x:t=e._payload,e=e._init;try{return k(e(t))}catch(n){}}return null}var R=Array.isArray,P=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L={pending:!1,data:null,method:null,action:null},B=[],N=-1;function O(e){return{current:e}}function D(e){0>N||(e.current=B[N],B[N]=null,N--)}function F(e,t){N++,B[N]=e.current,e.current=t}var U=O(null),z=O(null),G=O(null),V=O(null);function H(e,t){switch(F(G,t),F(z,e),F(U,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?lh(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=ch(t=lh(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}D(U),F(U,e)}function j(){D(U),D(z),D(G)}function W(e){null!==e.memoizedState&&F(V,e);var t=U.current,n=ch(t,e.type);t!==n&&(F(z,e),F(U,n))}function $(e){z.current===e&&(D(U),D(z)),V.current===e&&(D(V),Zh._currentValue=L)}var X=Object.prototype.hasOwnProperty,q=e.unstable_scheduleCallback,K=e.unstable_cancelCallback,Y=e.unstable_shouldYield,J=e.unstable_requestPaint,Z=e.unstable_now,Q=e.unstable_getCurrentPriorityLevel,ee=e.unstable_ImmediatePriority,te=e.unstable_UserBlockingPriority,ne=e.unstable_NormalPriority,ie=e.unstable_LowPriority,re=e.unstable_IdlePriority,se=e.log,oe=e.unstable_setDisableYieldValue,ae=null,le=null;function ce(e){if("function"==typeof se&&oe(e),le&&"function"==typeof le.setStrictMode)try{le.setStrictMode(ae,e)}catch(t){}}var ue=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(he(e)/de|0)|0},he=Math.log,de=Math.LN2;var fe=256,pe=4194304;function ge(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function me(e,t,n){var i=e.pendingLanes;if(0===i)return 0;var r=0,s=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var a=134217727&i;return 0!==a?0!==(i=a&~s)?r=ge(i):0!==(o&=a)?r=ge(o):n||0!==(n=a&~e)&&(r=ge(n)):0!==(a=i&~s)?r=ge(a):0!==o?r=ge(o):n||0!==(n=i&~e)&&(r=ge(n)),0===r?0:0!==t&&t!==r&&0===(t&s)&&((s=r&-r)>=(n=t&-t)||32===s&&4194048&n)?t:r}function ve(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function _e(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function be(){var e=fe;return!(4194048&(fe<<=1))&&(fe=256),e}function Ee(){var e=pe;return!(62914560&(pe<<=1))&&(pe=4194304),e}function we(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function xe(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ae(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-ue(t);e.entangledLanes|=t,e.entanglements[i]=1073741824|e.entanglements[i]|4194090&n}function Se(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ue(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}function Te(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ce(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Ie(){var e=M.p;return 0!==e?e:void 0===(e=window.event)?32:fd(e.type)}var ke=Math.random().toString(36).slice(2),Re="__reactFiber$"+ke,Pe="__reactProps$"+ke,Me="__reactContainer$"+ke,Le="__reactEvents$"+ke,Be="__reactListeners$"+ke,Ne="__reactHandles$"+ke,Oe="__reactResources$"+ke,De="__reactMarker$"+ke;function Fe(e){delete e[Re],delete e[Pe],delete e[Le],delete e[Be],delete e[Ne]}function Ue(e){var t=e[Re];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Me]||n[Re]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=xh(e);null!==e;){if(n=e[Re])return n;e=xh(e)}return t}n=(e=n).parentNode}return null}function ze(e){if(e=e[Re]||e[Me]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ge(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(i(33))}function Ve(e){var t=e[Oe];return t||(t=e[Oe]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function He(e){e[De]=!0}var je=new Set,We={};function $e(e,t){Xe(e,t),Xe(e+"Capture",t)}function Xe(e,t){for(We[e]=t,e=0;e<t.length;e++)je.add(t[e])}var qe,Ke,Ye=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Je={},Ze={};function Qe(e,t,n){if(r=t,X.call(Ze,r)||!X.call(Je,r)&&(Ye.test(r)?Ze[r]=!0:(Je[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function et(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function tt(e,t,n,i){if(null===i)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+i)}}function nt(e){if(void 0===qe)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);qe=t&&t[1]||"",Ke=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+qe+e+Ke}var it=!1;function rt(e,t){if(!e||it)return"";it=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(r){var i=r}Reflect.construct(e,[],n)}else{try{n.call()}catch(s){i=s}e.call(n.prototype)}}else{try{throw Error()}catch(o){i=o}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(a){if(a&&i&&"string"==typeof a.stack)return[a.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=i.DetermineComponentFrameRoot(),o=s[0],a=s[1];if(o&&a){var l=o.split("\n"),c=a.split("\n");for(r=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(i===l.length||r===c.length)for(i=l.length-1,r=c.length-1;1<=i&&0<=r&&l[i]!==c[r];)r--;for(;1<=i&&0<=r;i--,r--)if(l[i]!==c[r]){if(1!==i||1!==r)do{if(i--,0>--r||l[i]!==c[r]){var u="\n"+l[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=i&&0<=r);break}}}finally{it=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?nt(n):""}function st(e){switch(e.tag){case 26:case 27:case 5:return nt(e.type);case 16:return nt("Lazy");case 13:return nt("Suspense");case 19:return nt("SuspenseList");case 0:case 15:return rt(e.type,!1);case 11:return rt(e.type.render,!1);case 1:return rt(e.type,!0);case 31:return nt("Activity");default:return""}}function ot(e){try{var t="";do{t+=st(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function at(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function lt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ct(e){e._valueTracker||(e._valueTracker=function(e){var t=lt(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ut(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=lt(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function ht(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(dy){return e.body}}var dt=/[\n"\\]/g;function ft(e){return e.replace(dt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function pt(e,t,n,i,r,s,o,a){e.name="",null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+at(t)):e.value!==""+at(t)&&(e.value=""+at(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?mt(e,o,at(t)):null!=n?mt(e,o,at(n)):null!=i&&e.removeAttribute("value"),null==r&&null!=s&&(e.defaultChecked=!!s),null!=r&&(e.checked=r&&"function"!=typeof r&&"symbol"!=typeof r),null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a?e.name=""+at(a):e.removeAttribute("name")}function gt(e,t,n,i,r,s,o,a){if(null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s&&(e.type=s),null!=t||null!=n){if(("submit"===s||"reset"===s)&&null==t)return;n=null!=n?""+at(n):"",t=null!=t?""+at(t):n,a||t===e.value||(e.value=t),e.defaultValue=t}i="function"!=typeof(i=null!=i?i:r)&&"symbol"!=typeof i&&!!i,e.checked=a?e.checked:!!i,e.defaultChecked=!!i,null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.name=o)}function mt(e,t,n){"number"===t&&ht(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function yt(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+at(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function vt(e,t,n){null==t||((t=""+at(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+at(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function _t(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(i(92));if(R(r)){if(1<r.length)throw Error(i(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=at(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function bt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Et=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wt(e,t,n){var i=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?i?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":i?e.setProperty(t,n):"number"!=typeof n||0===n||Et.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function xt(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(i(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var s in t)r=t[s],t.hasOwnProperty(s)&&n[s]!==r&&wt(e,s,r)}else for(var o in t)t.hasOwnProperty(o)&&wt(e,o,t[o])}function At(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var St=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ct(e){return Tt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var It=null;function kt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Rt=null,Pt=null;function Mt(e){var t=ze(e);if(t&&(e=t.stateNode)){var n=e[Pe]||null;e:switch(e=t.stateNode,t.type){case"input":if(pt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+ft(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var s=r[Pe]||null;if(!s)throw Error(i(90));pt(r,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ut(r)}break e;case"textarea":vt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&yt(e,!!n.multiple,t,!1)}}}var Lt=!1;function Bt(e,t,n){if(Lt)return e(t,n);Lt=!0;try{return e(t)}finally{if(Lt=!1,(null!==Rt||null!==Pt)&&(Wc(),Rt&&(t=Rt,e=Pt,Pt=Rt=null,Mt(t),e)))for(t=0;t<e.length;t++)Mt(e[t])}}function Nt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Pe]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(i(231,t,typeof n));return n}var Ot=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Dt=!1;if(Ot)try{var Ft={};Object.defineProperty(Ft,"passive",{get:function(){Dt=!0}}),window.addEventListener("test",Ft,Ft),window.removeEventListener("test",Ft,Ft)}catch(dy){Dt=!1}var Ut=null,zt=null,Gt=null;function Vt(){if(Gt)return Gt;var e,t,n=zt,i=n.length,r="value"in Ut?Ut.value:Ut.textContent,s=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[s-t];t++);return Gt=r.slice(e,1<t?1-t:void 0)}function Ht(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function jt(){return!0}function Wt(){return!1}function $t(e){function t(t,n,i,r,s){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?jt:Wt,this.isPropagationStopped=Wt,this}return c(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=jt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=jt)},persist:function(){},isPersistent:jt}),t}var Xt,qt,Kt,Yt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jt=$t(Yt),Zt=c({},Yt,{view:0,detail:0}),Qt=$t(Zt),en=c({},Zt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Kt&&(Kt&&"mousemove"===e.type?(Xt=e.screenX-Kt.screenX,qt=e.screenY-Kt.screenY):qt=Xt=0,Kt=e),Xt)},movementY:function(e){return"movementY"in e?e.movementY:qt}}),tn=$t(en),nn=$t(c({},en,{dataTransfer:0})),rn=$t(c({},Zt,{relatedTarget:0})),sn=$t(c({},Yt,{animationName:0,elapsedTime:0,pseudoElement:0})),on=$t(c({},Yt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),an=$t(c({},Yt,{data:0})),ln={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},un={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=un[e])&&!!t[e]}function dn(){return hn}var fn=$t(c({},Zt,{key:function(e){if(e.key){var t=ln[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Ht(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?cn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dn,charCode:function(e){return"keypress"===e.type?Ht(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Ht(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),pn=$t(c({},en,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),gn=$t(c({},Zt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dn})),mn=$t(c({},Yt,{propertyName:0,elapsedTime:0,pseudoElement:0})),yn=$t(c({},en,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),vn=$t(c({},Yt,{newState:0,oldState:0})),_n=[9,13,27,32],bn=Ot&&"CompositionEvent"in window,En=null;Ot&&"documentMode"in document&&(En=document.documentMode);var wn=Ot&&"TextEvent"in window&&!En,xn=Ot&&(!bn||En&&8<En&&11>=En),An=String.fromCharCode(32),Sn=!1;function Tn(e,t){switch(e){case"keyup":return-1!==_n.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var In=!1;var kn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!kn[e.type]:"textarea"===t}function Pn(e,t,n,i){Rt?Pt?Pt.push(i):Pt=[i]:Rt=i,0<(t=qu(t,"onChange")).length&&(n=new Jt("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Mn=null,Ln=null;function Bn(e){zu(e,0)}function Nn(e){if(ut(Ge(e)))return e}function On(e,t){if("change"===e)return t}var Dn=!1;if(Ot){var Fn;if(Ot){var Un="oninput"in document;if(!Un){var zn=document.createElement("div");zn.setAttribute("oninput","return;"),Un="function"==typeof zn.oninput}Fn=Un}else Fn=!1;Dn=Fn&&(!document.documentMode||9<document.documentMode)}function Gn(){Mn&&(Mn.detachEvent("onpropertychange",Vn),Ln=Mn=null)}function Vn(e){if("value"===e.propertyName&&Nn(Ln)){var t=[];Pn(t,Ln,e,kt(e)),Bt(Bn,t)}}function Hn(e,t,n){"focusin"===e?(Gn(),Ln=n,(Mn=t).attachEvent("onpropertychange",Vn)):"focusout"===e&&Gn()}function jn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Nn(Ln)}function Wn(e,t){if("click"===e)return Nn(t)}function $n(e,t){if("input"===e||"change"===e)return Nn(t)}var Xn="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function qn(e,t){if(Xn(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!X.call(t,r)||!Xn(e[r],t[r]))return!1}return!0}function Kn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Yn(e,t){var n,i=Kn(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Kn(i)}}function Jn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Jn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Zn(e){for(var t=ht((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=ht((e=t.contentWindow).document)}return t}function Qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ei=Ot&&"documentMode"in document&&11>=document.documentMode,ti=null,ni=null,ii=null,ri=!1;function si(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ri||null==ti||ti!==ht(i)||("selectionStart"in(i=ti)&&Qn(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},ii&&qn(ii,i)||(ii=i,0<(i=qu(ni,"onSelect")).length&&(t=new Jt("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=ti)))}function oi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ai={animationend:oi("Animation","AnimationEnd"),animationiteration:oi("Animation","AnimationIteration"),animationstart:oi("Animation","AnimationStart"),transitionrun:oi("Transition","TransitionRun"),transitionstart:oi("Transition","TransitionStart"),transitioncancel:oi("Transition","TransitionCancel"),transitionend:oi("Transition","TransitionEnd")},li={},ci={};function ui(e){if(li[e])return li[e];if(!ai[e])return e;var t,n=ai[e];for(t in n)if(n.hasOwnProperty(t)&&t in ci)return li[e]=n[t];return e}Ot&&(ci=document.createElement("div").style,"AnimationEvent"in window||(delete ai.animationend.animation,delete ai.animationiteration.animation,delete ai.animationstart.animation),"TransitionEvent"in window||delete ai.transitionend.transition);var hi=ui("animationend"),di=ui("animationiteration"),fi=ui("animationstart"),pi=ui("transitionrun"),gi=ui("transitionstart"),mi=ui("transitioncancel"),yi=ui("transitionend"),vi=new Map,_i="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bi(e,t){vi.set(e,t),$e(t,[e])}_i.push("scrollEnd");var Ei=new WeakMap;function wi(e,t){if("object"==typeof e&&null!==e){var n=Ei.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ot(t)},Ei.set(e,t),t)}return{value:e,source:t,stack:ot(t)}}var xi=[],Ai=0,Si=0;function Ti(){for(var e=Ai,t=Si=Ai=0;t<e;){var n=xi[t];xi[t++]=null;var i=xi[t];xi[t++]=null;var r=xi[t];xi[t++]=null;var s=xi[t];if(xi[t++]=null,null!==i&&null!==r){var o=i.pending;null===o?r.next=r:(r.next=o.next,o.next=r),i.pending=r}0!==s&&Ri(n,r,s)}}function Ci(e,t,n,i){xi[Ai++]=e,xi[Ai++]=t,xi[Ai++]=n,xi[Ai++]=i,Si|=i,e.lanes|=i,null!==(e=e.alternate)&&(e.lanes|=i)}function Ii(e,t,n,i){return Ci(e,t,n,i),Pi(e)}function ki(e,t){return Ci(e,null,null,t),Pi(e)}function Ri(e,t,n){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n);for(var r=!1,s=e.return;null!==s;)s.childLanes|=n,null!==(i=s.alternate)&&(i.childLanes|=n),22===s.tag&&(null===(e=s.stateNode)||1&e._visibility||(r=!0)),e=s,s=s.return;return 3===e.tag?(s=e.stateNode,r&&null!==t&&(r=31-ue(n),null===(i=(e=s.hiddenUpdates)[r])?e[r]=[t]:i.push(t),t.lane=536870912|n),s):null}function Pi(e){if(50<Oc)throw Oc=0,Dc=null,Error(i(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Mi={};function Li(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bi(e,t,n,i){return new Li(e,t,n,i)}function Ni(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oi(e,t){var n=e.alternate;return null===n?((n=Bi(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Di(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Fi(e,t,n,r,s,o){var a=0;if(r=e,"function"==typeof e)Ni(e)&&(a=1);else if("string"==typeof e)a=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,U.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case A:return(e=Bi(31,n,t,s)).elementType=A,e.lanes=o,e;case f:return Ui(n.children,s,o,t);case p:a=8,s|=24;break;case g:return(e=Bi(12,n,t,2|s)).elementType=g,e.lanes=o,e;case b:return(e=Bi(13,n,t,s)).elementType=b,e.lanes=o,e;case E:return(e=Bi(19,n,t,s)).elementType=E,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case m:case v:a=10;break e;case y:a=9;break e;case _:a=11;break e;case w:a=14;break e;case x:a=16,r=null;break e}a=29,n=Error(i(130,null===e?"null":typeof e,"")),r=null}return(t=Bi(a,n,t,s)).elementType=e,t.type=r,t.lanes=o,t}function Ui(e,t,n,i){return(e=Bi(7,e,i,t)).lanes=n,e}function zi(e,t,n){return(e=Bi(6,e,null,t)).lanes=n,e}function Gi(e,t,n){return(t=Bi(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Vi=[],Hi=0,ji=null,Wi=0,$i=[],Xi=0,qi=null,Ki=1,Yi="";function Ji(e,t){Vi[Hi++]=Wi,Vi[Hi++]=ji,ji=e,Wi=t}function Zi(e,t,n){$i[Xi++]=Ki,$i[Xi++]=Yi,$i[Xi++]=qi,qi=e;var i=Ki;e=Yi;var r=32-ue(i)-1;i&=~(1<<r),n+=1;var s=32-ue(t)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Ki=1<<32-ue(t)+r|n<<r|i,Yi=s+e}else Ki=1<<s|n<<r|i,Yi=e}function Qi(e){null!==e.return&&(Ji(e,1),Zi(e,1,0))}function er(e){for(;e===ji;)ji=Vi[--Hi],Vi[Hi]=null,Wi=Vi[--Hi],Vi[Hi]=null;for(;e===qi;)qi=$i[--Xi],$i[Xi]=null,Yi=$i[--Xi],$i[Xi]=null,Ki=$i[--Xi],$i[Xi]=null}var tr=null,nr=null,ir=!1,rr=null,sr=!1,or=Error(i(519));function ar(e){throw fr(wi(Error(i(418,"")),e)),or}function lr(e){var t=e.stateNode,n=e.type,i=e.memoizedProps;switch(t[Re]=e,t[Pe]=i,n){case"dialog":Gu("cancel",t),Gu("close",t);break;case"iframe":case"object":case"embed":Gu("load",t);break;case"video":case"audio":for(n=0;n<Fu.length;n++)Gu(Fu[n],t);break;case"source":Gu("error",t);break;case"img":case"image":case"link":Gu("error",t),Gu("load",t);break;case"details":Gu("toggle",t);break;case"input":Gu("invalid",t),gt(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),ct(t);break;case"select":Gu("invalid",t);break;case"textarea":Gu("invalid",t),_t(t,i.value,i.defaultValue,i.children),ct(t)}"string"!=typeof(n=i.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===i.suppressHydrationWarning||eh(t.textContent,n)?(null!=i.popover&&(Gu("beforetoggle",t),Gu("toggle",t)),null!=i.onScroll&&Gu("scroll",t),null!=i.onScrollEnd&&Gu("scrollend",t),null!=i.onClick&&(t.onclick=th),t=!0):t=!1,t||ar(e)}function cr(e){for(tr=e.return;tr;)switch(tr.tag){case 5:case 13:return void(sr=!1);case 27:case 3:return void(sr=!0);default:tr=tr.return}}function ur(e){if(e!==tr)return!1;if(!ir)return cr(e),ir=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||uh(e.type,e.memoizedProps)),t=!t),t&&nr&&ar(e),cr(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){nr=Eh(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}nr=null}}else 27===n?(n=nr,yh(e.type)?(e=wh,wh=null,nr=e):nr=n):nr=tr?Eh(e.stateNode.nextSibling):null;return!0}function hr(){nr=tr=null,ir=!1}function dr(){var e=rr;return null!==e&&(null===xc?xc=e:xc.push.apply(xc,e),rr=null),e}function fr(e){null===rr?rr=[e]:rr.push(e)}var pr=O(null),gr=null,mr=null;function yr(e,t,n){F(pr,t._currentValue),t._currentValue=n}function vr(e){e._currentValue=pr.current,D(pr)}function _r(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function br(e,t,n,r){var s=e.child;for(null!==s&&(s.return=e);null!==s;){var o=s.dependencies;if(null!==o){var a=s.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=s;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),_r(o.return,n,e),r||(a=null);break e}o=l.next}}else if(18===s.tag){if(null===(a=s.return))throw Error(i(341));a.lanes|=n,null!==(o=a.alternate)&&(o.lanes|=n),_r(a,n,e),a=null}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===e){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}}function Er(e,t,n,r){e=null;for(var s=t,o=!1;null!==s;){if(!o)if(524288&s.flags)o=!0;else if(262144&s.flags)break;if(10===s.tag){var a=s.alternate;if(null===a)throw Error(i(387));if(null!==(a=a.memoizedProps)){var l=s.type;Xn(s.pendingProps.value,a.value)||(null!==e?e.push(l):e=[l])}}else if(s===V.current){if(null===(a=s.alternate))throw Error(i(387));a.memoizedState.memoizedState!==s.memoizedState.memoizedState&&(null!==e?e.push(Zh):e=[Zh])}s=s.return}null!==e&&br(t,e,n,r),t.flags|=262144}function wr(e){for(e=e.firstContext;null!==e;){if(!Xn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function xr(e){gr=e,mr=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ar(e){return Tr(gr,e)}function Sr(e,t){return null===gr&&xr(e),Tr(e,t)}function Tr(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===mr){if(null===e)throw Error(i(308));mr=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else mr=mr.next=t;return n}var Cr="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ir=e.unstable_scheduleCallback,kr=e.unstable_NormalPriority,Rr={$$typeof:v,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pr(){return{controller:new Cr,data:new Map,refCount:0}}function Mr(e){e.refCount--,0===e.refCount&&Ir(kr,function(){e.controller.abort()})}var Lr=null,Br=0,Nr=0,Or=null;function Dr(){if(0===--Br&&null!==Lr){null!==Or&&(Or.status="fulfilled");var e=Lr;Lr=null,Nr=0,Or=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Fr=P.S;P.S=function(e,t){"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Lr){var n=Lr=[];Br=0,Nr=Lu(),Or={status:"pending",value:void 0,then:function(e){n.push(e)}}}Br++,t.then(Dr,Dr)}(0,t),null!==Fr&&Fr(e,t)};var Ur=O(null);function zr(){var e=Ur.current;return null!==e?e:ac.pooledCache}function Gr(e,t){F(Ur,null===t?Ur.current:t.pool)}function Vr(){var e=zr();return null===e?null:{parent:Rr._currentValue,pool:e}}var Hr=Error(i(460)),jr=Error(i(474)),Wr=Error(i(542)),$r={then:function(){}};function Xr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function qr(){}function Kr(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(qr,qr),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw Zr(e=t.reason),e;default:if("string"==typeof t.status)t.then(qr,qr);else{if(null!==(e=ac)&&100<e.shellSuspendCounter)throw Error(i(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw Zr(e=t.reason),e}throw Yr=t,Hr}}var Yr=null;function Jr(){if(null===Yr)throw Error(i(459));var e=Yr;return Yr=null,e}function Zr(e){if(e===Hr||e===Wr)throw Error(i(483))}var Qr=!1;function es(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ts(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ns(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function is(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,2&oc){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,t=Pi(e),Ri(e,null,n),t}return Ci(e,i,t,n),Pi(e)}function rs(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Se(e,n)}}function ss(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===s?r=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?r=s=t:s=s.next=t}else r=s=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,callbacks:i.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var os=!1;function as(){if(os){if(null!==Or)throw Or}}function ls(e,t,n,i){os=!1;var r=e.updateQueue;Qr=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,u=l.next;l.next=null,null===o?s=u:o.next=u,o=l;var h=e.alternate;null!==h&&((a=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===a?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(null!==s){var d=r.baseState;for(o=0,h=u=l=null,a=s;;){var f=-536870913&a.lane,p=f!==a.lane;if(p?(cc&f)===f:(i&f)===f){0!==f&&f===Nr&&(os=!0),null!==h&&(h=h.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});e:{var g=e,m=a;f=t;var y=n;switch(m.tag){case 1:if("function"==typeof(g=m.payload)){d=g.call(y,d,f);break e}d=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null==(f="function"==typeof(g=m.payload)?g.call(y,d,f):g))break e;d=c({},d,f);break e;case 2:Qr=!0}}null!==(f=a.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=r.callbacks)?r.callbacks=[f]:p.push(f))}else p={lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===h?(u=h=p,l=d):h=h.next=p,o|=f;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(p=a).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}null===h&&(l=d),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=h,null===s&&(r.shared.lanes=0),yc|=o,e.lanes=o,e.memoizedState=d}}function cs(e,t){if("function"!=typeof e)throw Error(i(191,e));e.call(t)}function us(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)cs(n[e],t)}var hs=O(null),ds=O(0);function fs(e,t){F(ds,e=gc),F(hs,t),gc=e|t.baseLanes}function ps(){F(ds,gc),F(hs,hs.current)}function gs(){gc=ds.current,D(hs),D(ds)}var ms=0,ys=null,vs=null,_s=null,bs=!1,Es=!1,ws=!1,xs=0,As=0,Ss=null,Ts=0;function Cs(){throw Error(i(321))}function Is(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Xn(e[n],t[n]))return!1;return!0}function ks(e,t,n,i,r,s){return ms=s,ys=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,P.H=null===e||null===e.memoizedState?jo:Wo,ws=!1,s=n(i,r),ws=!1,Es&&(s=Ps(t,n,i,r)),Rs(e),s}function Rs(e){P.H=Ho;var t=null!==vs&&null!==vs.next;if(ms=0,_s=vs=ys=null,bs=!1,As=0,Ss=null,t)throw Error(i(300));null===e||Sa||null!==(e=e.dependencies)&&wr(e)&&(Sa=!0)}function Ps(e,t,n,r){ys=e;var s=0;do{if(Es&&(Ss=null),As=0,Es=!1,25<=s)throw Error(i(301));if(s+=1,_s=vs=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}P.H=$o,o=t(n,r)}while(Es);return o}function Ms(){var e=P.H,t=e.useState()[0];return t="function"==typeof t.then?Fs(t):t,e=e.useState()[0],(null!==vs?vs.memoizedState:null)!==e&&(ys.flags|=1024),t}function Ls(){var e=0!==xs;return xs=0,e}function Bs(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Ns(e){if(bs){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}bs=!1}ms=0,_s=vs=ys=null,Es=!1,As=xs=0,Ss=null}function Os(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===_s?ys.memoizedState=_s=e:_s=_s.next=e,_s}function Ds(){if(null===vs){var e=ys.alternate;e=null!==e?e.memoizedState:null}else e=vs.next;var t=null===_s?ys.memoizedState:_s.next;if(null!==t)_s=t,vs=e;else{if(null===e){if(null===ys.alternate)throw Error(i(467));throw Error(i(310))}e={memoizedState:(vs=e).memoizedState,baseState:vs.baseState,baseQueue:vs.baseQueue,queue:vs.queue,next:null},null===_s?ys.memoizedState=_s=e:_s=_s.next=e}return _s}function Fs(e){var t=As;return As+=1,null===Ss&&(Ss=[]),e=Kr(Ss,e,t),t=ys,null===(null===_s?t.memoizedState:_s.next)&&(t=t.alternate,P.H=null===t||null===t.memoizedState?jo:Wo),e}function Us(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return Fs(e);if(e.$$typeof===v)return Ar(e)}throw Error(i(438,String(e)))}function zs(e){var t=null,n=ys.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var i=ys.alternate;null!==i&&(null!==(i=i.updateQueue)&&(null!=(i=i.memoCache)&&(t={data:i.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},ys.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),i=0;i<e;i++)n[i]=S;return t.index++,n}function Gs(e,t){return"function"==typeof t?t(e):t}function Vs(e){return Hs(Ds(),vs,e)}function Hs(e,t,n){var r=e.queue;if(null===r)throw Error(i(311));r.lastRenderedReducer=n;var s=e.baseQueue,o=r.pending;if(null!==o){if(null!==s){var a=s.next;s.next=o.next,o.next=a}t.baseQueue=s=o,r.pending=null}if(o=e.baseState,null===s)e.memoizedState=o;else{var l=a=null,c=null,u=t=s.next,h=!1;do{var d=-536870913&u.lane;if(d!==u.lane?(cc&d)===d:(ms&d)===d){var f=u.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===Nr&&(h=!0);else{if((ms&f)===f){u=u.next,f===Nr&&(h=!0);continue}d={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=d,a=o):c=c.next=d,ys.lanes|=f,yc|=f}d=u.action,ws&&n(o,d),o=u.hasEagerState?u.eagerState:n(o,d)}else f={lane:d,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,a=o):c=c.next=f,ys.lanes|=d,yc|=d;u=u.next}while(null!==u&&u!==t);if(null===c?a=o:c.next=l,!Xn(o,e.memoizedState)&&(Sa=!0,h&&null!==(n=Or)))throw n;e.memoizedState=o,e.baseState=a,e.baseQueue=c,r.lastRenderedState=o}return null===s&&(r.lanes=0),[e.memoizedState,r.dispatch]}function js(e){var t=Ds(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,s=n.pending,o=t.memoizedState;if(null!==s){n.pending=null;var a=s=s.next;do{o=e(o,a.action),a=a.next}while(a!==s);Xn(o,t.memoizedState)||(Sa=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ws(e,t,n){var r=ys,s=Ds(),o=ir;if(o){if(void 0===n)throw Error(i(407));n=n()}else n=t();var a=!Xn((vs||s).memoizedState,n);if(a&&(s.memoizedState=n,Sa=!0),s=s.queue,go(2048,8,qs.bind(null,r,s,e),[e]),s.getSnapshot!==t||a||null!==_s&&1&_s.memoizedState.tag){if(r.flags|=2048,ho(9,{destroy:void 0,resource:void 0},Xs.bind(null,r,s,n,t),null),null===ac)throw Error(i(349));o||124&ms||$s(r,t,n)}return n}function $s(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ys.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},ys.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Xs(e,t,n,i){t.value=n,t.getSnapshot=i,Ks(t)&&Ys(e)}function qs(e,t,n){return n(function(){Ks(t)&&Ys(e)})}function Ks(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Xn(e,n)}catch(i){return!0}}function Ys(e){var t=ki(e,2);null!==t&&zc(t,e,2)}function Js(e){var t=Os();if("function"==typeof e){var n=e;if(e=n(),ws){ce(!0);try{n()}finally{ce(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gs,lastRenderedState:e},t}function Zs(e,t,n,i){return e.baseState=n,Hs(e,vs,"function"==typeof i?i:Gs)}function Qs(e,t,n,r,s){if(zo(e))throw Error(i(485));if(null!==(e=t.action)){var o={payload:s,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==P.T?n(!0):o.isTransition=!1,r(o),null===(n=t.pending)?(o.next=t.pending=o,eo(t,o)):(o.next=n.next,t.pending=n.next=o)}}function eo(e,t){var n=t.action,i=t.payload,r=e.state;if(t.isTransition){var s=P.T,o={};P.T=o;try{var a=n(r,i),l=P.S;null!==l&&l(o,a),to(e,t,a)}catch(c){io(e,t,c)}finally{P.T=s}}else try{to(e,t,s=n(r,i))}catch(u){io(e,t,u)}}function to(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){no(e,t,n)},function(n){return io(e,t,n)}):no(e,t,n)}function no(e,t,n){t.status="fulfilled",t.value=n,ro(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,eo(e,n)))}function io(e,t,n){var i=e.pending;if(e.pending=null,null!==i){i=i.next;do{t.status="rejected",t.reason=n,ro(t),t=t.next}while(t!==i)}e.action=null}function ro(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function so(e,t){return t}function oo(e,t){if(ir){var n=ac.formState;if(null!==n){e:{var i=ys;if(ir){if(nr){t:{for(var r=nr,s=sr;8!==r.nodeType;){if(!s){r=null;break t}if(null===(r=Eh(r.nextSibling))){r=null;break t}}r="F!"===(s=r.data)||"F"===s?r:null}if(r){nr=Eh(r.nextSibling),i="F!"===r.data;break e}}ar(i)}i=!1}i&&(t=n[0])}}return(n=Os()).memoizedState=n.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:so,lastRenderedState:t},n.queue=i,n=Do.bind(null,ys,i),i.dispatch=n,i=Js(!1),s=Uo.bind(null,ys,!1,i.queue),r={state:t,dispatch:null,action:e,pending:null},(i=Os()).queue=r,n=Qs.bind(null,ys,r,s,n),r.dispatch=n,i.memoizedState=e,[t,n,!1]}function ao(e){return lo(Ds(),vs,e)}function lo(e,t,n){if(t=Hs(e,t,so)[0],e=Vs(Gs)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var i=Fs(t)}catch(o){if(o===Hr)throw Wr;throw o}else i=t;var r=(t=Ds()).queue,s=r.dispatch;return n!==t.memoizedState&&(ys.flags|=2048,ho(9,{destroy:void 0,resource:void 0},co.bind(null,r,n),null)),[i,s,e]}function co(e,t){e.action=t}function uo(e){var t=Ds(),n=vs;if(null!==n)return lo(t,n,e);Ds(),t=t.memoizedState;var i=(n=Ds()).queue.dispatch;return n.memoizedState=e,[t,i,!1]}function ho(e,t,n,i){return e={tag:e,create:n,deps:i,inst:t,next:null},null===(t=ys.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},ys.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function fo(){return Ds().memoizedState}function po(e,t,n,i){var r=Os();i=void 0===i?null:i,ys.flags|=e,r.memoizedState=ho(1|t,{destroy:void 0,resource:void 0},n,i)}function go(e,t,n,i){var r=Ds();i=void 0===i?null:i;var s=r.memoizedState.inst;null!==vs&&null!==i&&Is(i,vs.memoizedState.deps)?r.memoizedState=ho(t,s,n,i):(ys.flags|=e,r.memoizedState=ho(1|t,s,n,i))}function mo(e,t){po(8390656,8,e,t)}function yo(e,t){go(2048,8,e,t)}function vo(e,t){return go(4,2,e,t)}function _o(e,t){return go(4,4,e,t)}function bo(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Eo(e,t,n){n=null!=n?n.concat([e]):null,go(4,4,bo.bind(null,t,e),n)}function wo(){}function xo(e,t){var n=Ds();t=void 0===t?null:t;var i=n.memoizedState;return null!==t&&Is(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ao(e,t){var n=Ds();t=void 0===t?null:t;var i=n.memoizedState;if(null!==t&&Is(t,i[1]))return i[0];if(i=e(),ws){ce(!0);try{e()}finally{ce(!1)}}return n.memoizedState=[i,t],i}function So(e,t,n){return void 0===n||1073741824&ms?e.memoizedState=t:(e.memoizedState=n,e=Uc(),ys.lanes|=e,yc|=e,n)}function To(e,t,n,i){return Xn(n,t)?n:null!==hs.current?(e=So(e,n,i),Xn(e,t)||(Sa=!0),e):42&ms?(e=Uc(),ys.lanes|=e,yc|=e,t):(Sa=!0,e.memoizedState=n)}function Co(e,t,n,i,r){var s=M.p;M.p=0!==s&&8>s?s:8;var o,a,l,c=P.T,u={};P.T=u,Uo(e,!1,t,n);try{var h=r(),d=P.S;if(null!==d&&d(u,h),null!==h&&"object"==typeof h&&"function"==typeof h.then)Fo(e,t,(o=i,a=[],l={status:"pending",value:null,reason:null,then:function(e){a.push(e)}},h.then(function(){l.status="fulfilled",l.value=o;for(var e=0;e<a.length;e++)(0,a[e])(o)},function(e){for(l.status="rejected",l.reason=e,e=0;e<a.length;e++)(0,a[e])(void 0)}),l),Fc());else Fo(e,t,i,Fc())}catch(f){Fo(e,t,{then:function(){},status:"rejected",reason:f},Fc())}finally{M.p=s,P.T=c}}function Io(){}function ko(e,t,n,r){if(5!==e.tag)throw Error(i(476));var s=Ro(e).queue;Co(e,s,t,L,null===n?Io:function(){return Po(e),n(r)})}function Ro(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:L,baseState:L,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gs,lastRenderedState:L},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gs,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Po(e){Fo(e,Ro(e).next.queue,{},Fc())}function Mo(){return Ar(Zh)}function Lo(){return Ds().memoizedState}function Bo(){return Ds().memoizedState}function No(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Fc(),i=is(t,e=ns(n),n);return null!==i&&(zc(i,t,n),rs(i,t,n)),t={cache:Pr()},void(e.payload=t)}t=t.return}}function Oo(e,t,n){var i=Fc();n={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},zo(e)?Go(t,n):null!==(n=Ii(e,t,n,i))&&(zc(n,e,i),Vo(n,t,i))}function Do(e,t,n){Fo(e,t,n,Fc())}function Fo(e,t,n,i){var r={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(zo(e))Go(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Xn(a,o))return Ci(e,t,r,0),null===ac&&Ti(),!1}catch(l){}if(null!==(n=Ii(e,t,r,i)))return zc(n,e,i),Vo(n,t,i),!0}return!1}function Uo(e,t,n,r){if(r={lane:2,revertLane:Lu(),action:r,hasEagerState:!1,eagerState:null,next:null},zo(e)){if(t)throw Error(i(479))}else null!==(t=Ii(e,n,r,2))&&zc(t,e,2)}function zo(e){var t=e.alternate;return e===ys||null!==t&&t===ys}function Go(e,t){Es=bs=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Vo(e,t,n){if(4194048&n){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Se(e,n)}}var Ho={readContext:Ar,use:Us,useCallback:Cs,useContext:Cs,useEffect:Cs,useImperativeHandle:Cs,useLayoutEffect:Cs,useInsertionEffect:Cs,useMemo:Cs,useReducer:Cs,useRef:Cs,useState:Cs,useDebugValue:Cs,useDeferredValue:Cs,useTransition:Cs,useSyncExternalStore:Cs,useId:Cs,useHostTransitionStatus:Cs,useFormState:Cs,useActionState:Cs,useOptimistic:Cs,useMemoCache:Cs,useCacheRefresh:Cs},jo={readContext:Ar,use:Us,useCallback:function(e,t){return Os().memoizedState=[e,void 0===t?null:t],e},useContext:Ar,useEffect:mo,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,po(4194308,4,bo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return po(4194308,4,e,t)},useInsertionEffect:function(e,t){po(4,2,e,t)},useMemo:function(e,t){var n=Os();t=void 0===t?null:t;var i=e();if(ws){ce(!0);try{e()}finally{ce(!1)}}return n.memoizedState=[i,t],i},useReducer:function(e,t,n){var i=Os();if(void 0!==n){var r=n(t);if(ws){ce(!0);try{n(t)}finally{ce(!1)}}}else r=t;return i.memoizedState=i.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},i.queue=e,e=e.dispatch=Oo.bind(null,ys,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Os().memoizedState=e},useState:function(e){var t=(e=Js(e)).queue,n=Do.bind(null,ys,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:wo,useDeferredValue:function(e,t){return So(Os(),e,t)},useTransition:function(){var e=Js(!1);return e=Co.bind(null,ys,e.queue,!0,!1),Os().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=ys,s=Os();if(ir){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===ac)throw Error(i(349));124&cc||$s(r,t,n)}s.memoizedState=n;var o={value:n,getSnapshot:t};return s.queue=o,mo(qs.bind(null,r,o,e),[e]),r.flags|=2048,ho(9,{destroy:void 0,resource:void 0},Xs.bind(null,r,o,n,t),null),n},useId:function(){var e=Os(),t=ac.identifierPrefix;if(ir){var n=Yi;t=""+t+"R"+(n=(Ki&~(1<<32-ue(Ki)-1)).toString(32)+n),0<(n=xs++)&&(t+="H"+n.toString(32)),t+=""}else t=""+t+"r"+(n=Ts++).toString(32)+"";return e.memoizedState=t},useHostTransitionStatus:Mo,useFormState:oo,useActionState:oo,useOptimistic:function(e){var t=Os();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Uo.bind(null,ys,!0,n),n.dispatch=t,[e,t]},useMemoCache:zs,useCacheRefresh:function(){return Os().memoizedState=No.bind(null,ys)}},Wo={readContext:Ar,use:Us,useCallback:xo,useContext:Ar,useEffect:yo,useImperativeHandle:Eo,useInsertionEffect:vo,useLayoutEffect:_o,useMemo:Ao,useReducer:Vs,useRef:fo,useState:function(){return Vs(Gs)},useDebugValue:wo,useDeferredValue:function(e,t){return To(Ds(),vs.memoizedState,e,t)},useTransition:function(){var e=Vs(Gs)[0],t=Ds().memoizedState;return["boolean"==typeof e?e:Fs(e),t]},useSyncExternalStore:Ws,useId:Lo,useHostTransitionStatus:Mo,useFormState:ao,useActionState:ao,useOptimistic:function(e,t){return Zs(Ds(),0,e,t)},useMemoCache:zs,useCacheRefresh:Bo},$o={readContext:Ar,use:Us,useCallback:xo,useContext:Ar,useEffect:yo,useImperativeHandle:Eo,useInsertionEffect:vo,useLayoutEffect:_o,useMemo:Ao,useReducer:js,useRef:fo,useState:function(){return js(Gs)},useDebugValue:wo,useDeferredValue:function(e,t){var n=Ds();return null===vs?So(n,e,t):To(n,vs.memoizedState,e,t)},useTransition:function(){var e=js(Gs)[0],t=Ds().memoizedState;return["boolean"==typeof e?e:Fs(e),t]},useSyncExternalStore:Ws,useId:Lo,useHostTransitionStatus:Mo,useFormState:uo,useActionState:uo,useOptimistic:function(e,t){var n=Ds();return null!==vs?Zs(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:zs,useCacheRefresh:Bo},Xo=null,qo=0;function Ko(e){var t=qo;return qo+=1,null===Xo&&(Xo=[]),Kr(Xo,e,t)}function Yo(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Jo(e,t){if(t.$$typeof===u)throw Error(i(525));throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Zo(e){return(0,e._init)(e._payload)}function Qo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function s(e,t){return(e=Oi(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=67108866,n):i:(t.flags|=67108866,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=zi(n,e.mode,i)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,i){var r=n.type;return r===f?p(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===r||"object"==typeof r&&null!==r&&r.$$typeof===x&&Zo(r)===t.type)?(Yo(t=s(t,n.props),n),t.return=e,t):(Yo(t=Fi(n.type,n.key,n.props,null,e.mode,i),n),t.return=e,t)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gi(n,e.mode,i)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function p(e,t,n,i,r){return null===t||7!==t.tag?((t=Ui(n,e.mode,i,r)).return=e,t):((t=s(t,n)).return=e,t)}function g(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=zi(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case h:return Yo(n=Fi(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case d:return(t=Gi(t,e.mode,n)).return=e,t;case x:return g(e,t=(0,t._init)(t._payload),n)}if(R(t)||C(t))return(t=Ui(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return g(e,Ko(t),n);if(t.$$typeof===v)return g(e,Sr(e,t),n);Jo(e,t)}return null}function m(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==r?null:l(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case h:return n.key===r?c(e,t,n,i):null;case d:return n.key===r?u(e,t,n,i):null;case x:return m(e,t,n=(r=n._init)(n._payload),i)}if(R(n)||C(n))return null!==r?null:p(e,t,n,i,null);if("function"==typeof n.then)return m(e,t,Ko(n),i);if(n.$$typeof===v)return m(e,t,Sr(e,n),i);Jo(e,n)}return null}function y(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i||"bigint"==typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case h:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case d:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case x:return y(e,t,n,i=(0,i._init)(i._payload),r)}if(R(i)||C(i))return p(t,e=e.get(n)||null,i,r,null);if("function"==typeof i.then)return y(e,t,n,Ko(i),r);if(i.$$typeof===v)return y(e,t,n,Sr(t,i),r);Jo(t,i)}return null}function _(l,c,u,p){if("object"==typeof u&&null!==u&&u.type===f&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case h:e:{for(var b=u.key;null!==c;){if(c.key===b){if((b=u.type)===f){if(7===c.tag){n(l,c.sibling),(p=s(c,u.props.children)).return=l,l=p;break e}}else if(c.elementType===b||"object"==typeof b&&null!==b&&b.$$typeof===x&&Zo(b)===c.type){n(l,c.sibling),Yo(p=s(c,u.props),u),p.return=l,l=p;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===f?((p=Ui(u.props.children,l.mode,p,u.key)).return=l,l=p):(Yo(p=Fi(u.type,u.key,u.props,null,l.mode,p),u),p.return=l,l=p)}return a(l);case d:e:{for(b=u.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(p=s(c,u.children||[])).return=l,l=p;break e}n(l,c);break}t(l,c),c=c.sibling}(p=Gi(u,l.mode,p)).return=l,l=p}return a(l);case x:return _(l,c,u=(b=u._init)(u._payload),p)}if(R(u))return function(i,s,a,l){for(var c=null,u=null,h=s,d=s=0,f=null;null!==h&&d<a.length;d++){h.index>d?(f=h,h=null):f=h.sibling;var p=m(i,h,a[d],l);if(null===p){null===h&&(h=f);break}e&&h&&null===p.alternate&&t(i,h),s=o(p,s,d),null===u?c=p:u.sibling=p,u=p,h=f}if(d===a.length)return n(i,h),ir&&Ji(i,d),c;if(null===h){for(;d<a.length;d++)null!==(h=g(i,a[d],l))&&(s=o(h,s,d),null===u?c=h:u.sibling=h,u=h);return ir&&Ji(i,d),c}for(h=r(h);d<a.length;d++)null!==(f=y(h,i,d,a[d],l))&&(e&&null!==f.alternate&&h.delete(null===f.key?d:f.key),s=o(f,s,d),null===u?c=f:u.sibling=f,u=f);return e&&h.forEach(function(e){return t(i,e)}),ir&&Ji(i,d),c}(l,c,u,p);if(C(u)){if("function"!=typeof(b=C(u)))throw Error(i(150));return function(s,a,l,c){if(null==l)throw Error(i(151));for(var u=null,h=null,d=a,f=a=0,p=null,v=l.next();null!==d&&!v.done;f++,v=l.next()){d.index>f?(p=d,d=null):p=d.sibling;var _=m(s,d,v.value,c);if(null===_){null===d&&(d=p);break}e&&d&&null===_.alternate&&t(s,d),a=o(_,a,f),null===h?u=_:h.sibling=_,h=_,d=p}if(v.done)return n(s,d),ir&&Ji(s,f),u;if(null===d){for(;!v.done;f++,v=l.next())null!==(v=g(s,v.value,c))&&(a=o(v,a,f),null===h?u=v:h.sibling=v,h=v);return ir&&Ji(s,f),u}for(d=r(d);!v.done;f++,v=l.next())null!==(v=y(d,s,f,v.value,c))&&(e&&null!==v.alternate&&d.delete(null===v.key?f:v.key),a=o(v,a,f),null===h?u=v:h.sibling=v,h=v);return e&&d.forEach(function(e){return t(s,e)}),ir&&Ji(s,f),u}(l,c,u=b.call(u),p)}if("function"==typeof u.then)return _(l,c,Ko(u),p);if(u.$$typeof===v)return _(l,c,Sr(l,u),p);Jo(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u||"bigint"==typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(p=s(c,u)).return=l,l=p):(n(l,c),(p=zi(u,l.mode,p)).return=l,l=p),a(l)):n(l,c)}return function(e,t,n,i){try{qo=0;var r=_(e,t,n,i);return Xo=null,r}catch(o){if(o===Hr||o===Wr)throw o;var s=Bi(29,o,null,e.mode);return s.lanes=i,s.return=e,s}}}var ea=Qo(!0),ta=Qo(!1),na=O(null),ia=null;function ra(e){var t=e.alternate;F(la,1&la.current),F(na,e),null===ia&&(null===t||null!==hs.current||null!==t.memoizedState)&&(ia=e)}function sa(e){if(22===e.tag){if(F(la,la.current),F(na,e),null===ia){var t=e.alternate;null!==t&&null!==t.memoizedState&&(ia=e)}}else oa()}function oa(){F(la,la.current),F(na,na.current)}function aa(e){D(na),ia===e&&(ia=null),D(la)}var la=O(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||bh(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ua(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:c({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ha={enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Fc(),r=ns(i);r.payload=t,null!=n&&(r.callback=n),null!==(t=is(e,r,i))&&(zc(t,e,i),rs(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Fc(),r=ns(i);r.tag=1,r.payload=t,null!=n&&(r.callback=n),null!==(t=is(e,r,i))&&(zc(t,e,i),rs(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Fc(),i=ns(n);i.tag=2,null!=t&&(i.callback=t),null!==(t=is(e,i,n))&&(zc(t,e,n),rs(t,e,n))}};function da(e,t,n,i,r,s,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!qn(n,i)||!qn(r,s))}function fa(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&ha.enqueueReplaceState(t,t.state,null)}function pa(e,t){var n=t;if("ref"in t)for(var i in n={},t)"ref"!==i&&(n[i]=t[i]);if(e=e.defaultProps)for(var r in n===t&&(n=c({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}var ga="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)};function ma(e){ga(e)}function ya(e){}function va(e){ga(e)}function _a(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function ba(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function Ea(e,t,n){return(n=ns(n)).tag=3,n.payload={element:null},n.callback=function(){_a(e,t)},n}function wa(e){return(e=ns(e)).tag=3,e}function xa(e,t,n,i){var r=n.type.getDerivedStateFromError;if("function"==typeof r){var s=i.value;e.payload=function(){return r(s)},e.callback=function(){ba(t,n,i)}}var o=n.stateNode;null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){ba(t,n,i),"function"!=typeof r&&(null===Ic?Ic=new Set([this]):Ic.add(this));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})})}var Aa=Error(i(461)),Sa=!1;function Ta(e,t,n,i){t.child=null===e?ta(t,null,n,i):ea(t,e.child,n,i)}function Ca(e,t,n,i,r){n=n.render;var s=t.ref;if("ref"in i){var o={};for(var a in i)"ref"!==a&&(o[a]=i[a])}else o=i;return xr(t),i=ks(e,t,n,o,s,r),a=Ls(),null===e||Sa?(ir&&a&&Qi(t),t.flags|=1,Ta(e,t,i,r),t.child):(Bs(e,t,r),Xa(e,t,r))}function Ia(e,t,n,i,r){if(null===e){var s=n.type;return"function"!=typeof s||Ni(s)||void 0!==s.defaultProps||null!==n.compare?((e=Fi(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,ka(e,t,s,i,r))}if(s=e.child,!qa(e,r)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:qn)(o,i)&&e.ref===t.ref)return Xa(e,t,r)}return t.flags|=1,(e=Oi(s,i)).ref=t.ref,e.return=t,t.child=e}function ka(e,t,n,i,r){if(null!==e){var s=e.memoizedProps;if(qn(s,i)&&e.ref===t.ref){if(Sa=!1,t.pendingProps=i=s,!qa(e,r))return t.lanes=e.lanes,Xa(e,t,r);131072&e.flags&&(Sa=!0)}}return La(e,t,n,i,r)}function Ra(e,t,n){var i=t.pendingProps,r=i.children,s=null!==e?e.memoizedState:null;if("hidden"===i.mode){if(128&t.flags){if(i=null!==s?s.baseLanes|n:n,null!==e){for(r=t.child=e.child,s=0;null!==r;)s=s|r.lanes|r.childLanes,r=r.sibling;t.childLanes=s&~i}else t.childLanes=0,t.child=null;return Pa(e,t,i,n)}if(!(536870912&n))return t.lanes=t.childLanes=536870912,Pa(e,t,null!==s?s.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Gr(0,null!==s?s.cachePool:null),null!==s?fs(t,s):ps(),sa(t)}else null!==s?(Gr(0,s.cachePool),fs(t,s),oa(),t.memoizedState=null):(null!==e&&Gr(0,null),ps(),oa());return Ta(e,t,r,n),t.child}function Pa(e,t,n,i){var r=zr();return r=null===r?null:{parent:Rr._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&Gr(0,null),ps(),sa(t),null!==e&&Er(e,t,i,!0),null}function Ma(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(i(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function La(e,t,n,i,r){return xr(t),n=ks(e,t,n,i,void 0,r),i=Ls(),null===e||Sa?(ir&&i&&Qi(t),t.flags|=1,Ta(e,t,n,r),t.child):(Bs(e,t,r),Xa(e,t,r))}function Ba(e,t,n,i,r,s){return xr(t),t.updateQueue=null,n=Ps(t,i,n,r),Rs(e),i=Ls(),null===e||Sa?(ir&&i&&Qi(t),t.flags|=1,Ta(e,t,n,s),t.child):(Bs(e,t,s),Xa(e,t,s))}function Na(e,t,n,i,r){if(xr(t),null===t.stateNode){var s=Mi,o=n.contextType;"object"==typeof o&&null!==o&&(s=Ar(o)),s=new n(i,s),t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,s.updater=ha,t.stateNode=s,s._reactInternals=t,(s=t.stateNode).props=i,s.state=t.memoizedState,s.refs={},es(t),o=n.contextType,s.context="object"==typeof o&&null!==o?Ar(o):Mi,s.state=t.memoizedState,"function"==typeof(o=n.getDerivedStateFromProps)&&(ua(t,n,o,i),s.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof s.getSnapshotBeforeUpdate||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||(o=s.state,"function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),o!==s.state&&ha.enqueueReplaceState(s,s.state,null),ls(t,i,s,r),as(),s.state=t.memoizedState),"function"==typeof s.componentDidMount&&(t.flags|=4194308),i=!0}else if(null===e){s=t.stateNode;var a=t.memoizedProps,l=pa(n,a);s.props=l;var c=s.context,u=n.contextType;o=Mi,"object"==typeof u&&null!==u&&(o=Ar(u));var h=n.getDerivedStateFromProps;u="function"==typeof h||"function"==typeof s.getSnapshotBeforeUpdate,a=t.pendingProps!==a,u||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a||c!==o)&&fa(t,s,i,o),Qr=!1;var d=t.memoizedState;s.state=d,ls(t,i,s,r),as(),c=t.memoizedState,a||d!==c||Qr?("function"==typeof h&&(ua(t,n,h,i),c=t.memoizedState),(l=Qr||da(t,n,l,i,d,c,o))?(u||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),s.props=i,s.state=c,s.context=o,i=l):("function"==typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,ts(e,t),u=pa(n,o=t.memoizedProps),s.props=u,h=t.pendingProps,d=s.context,c=n.contextType,l=Mi,"object"==typeof c&&null!==c&&(l=Ar(c)),(c="function"==typeof(a=n.getDerivedStateFromProps)||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==h||d!==l)&&fa(t,s,i,l),Qr=!1,d=t.memoizedState,s.state=d,ls(t,i,s,r),as();var f=t.memoizedState;o!==h||d!==f||Qr||null!==e&&null!==e.dependencies&&wr(e.dependencies)?("function"==typeof a&&(ua(t,n,a,i),f=t.memoizedState),(u=Qr||da(t,n,u,i,d,f,l)||null!==e&&null!==e.dependencies&&wr(e.dependencies))?(c||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=u):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return s=i,Ma(e,t),i=!!(128&t.flags),s||i?(s=t.stateNode,n=i&&"function"!=typeof n.getDerivedStateFromError?null:s.render(),t.flags|=1,null!==e&&i?(t.child=ea(t,e.child,null,r),t.child=ea(t,null,n,r)):Ta(e,t,n,r),t.memoizedState=s.state,e=t.child):e=Xa(e,t,r),e}function Oa(e,t,n,i){return hr(),t.flags|=256,Ta(e,t,n,i),t.child}var Da={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Fa(e){return{baseLanes:e,cachePool:Vr()}}function Ua(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=bc),e}function za(e,t,n){var r,s=t.pendingProps,o=!1,a=!!(128&t.flags);if((r=a)||(r=(null===e||null!==e.memoizedState)&&!!(2&la.current)),r&&(o=!0,t.flags&=-129),r=!!(32&t.flags),t.flags&=-33,null===e){if(ir){if(o?ra(t):oa(),ir){var l,c=nr;if(l=c){e:{for(l=c,c=sr;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=Eh(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==qi?{id:Ki,overflow:Yi}:null,retryLane:536870912,hydrationErrors:null},(l=Bi(18,null,null,0)).stateNode=c,l.return=t,t.child=l,tr=t,nr=null,l=!0):l=!1}l||ar(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return bh(c)?t.lanes=32:t.lanes=536870912,null;aa(t)}return c=s.children,s=s.fallback,o?(oa(),c=Va({mode:"hidden",children:c},o=t.mode),s=Ui(s,o,n,null),c.return=t,s.return=t,c.sibling=s,t.child=c,(o=t.child).memoizedState=Fa(n),o.childLanes=Ua(e,r,n),t.memoizedState=Da,s):(ra(t),Ga(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(a)256&t.flags?(ra(t),t.flags&=-257,t=Ha(e,t,n)):null!==t.memoizedState?(oa(),t.child=e.child,t.flags|=128,t=null):(oa(),o=s.fallback,c=t.mode,s=Va({mode:"visible",children:s.children},c),(o=Ui(o,c,n,null)).flags|=2,s.return=t,o.return=t,s.sibling=o,t.child=s,ea(t,e.child,null,n),(s=t.child).memoizedState=Fa(n),s.childLanes=Ua(e,r,n),t.memoizedState=Da,t=o);else if(ra(t),bh(c)){if(r=c.nextSibling&&c.nextSibling.dataset)var u=r.dgst;r=u,(s=Error(i(419))).stack="",s.digest=r,fr({value:s,source:null,stack:null}),t=Ha(e,t,n)}else if(Sa||Er(e,t,n,!1),r=0!==(n&e.childLanes),Sa||r){if(null!==(r=ac)&&(0!==(s=0!==((s=42&(s=n&-n)?1:Te(s))&(r.suspendedLanes|n))?0:s)&&s!==l.retryLane))throw l.retryLane=s,ki(e,s),zc(r,e,s),Aa;"$?"===c.data||Jc(),t=Ha(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,nr=Eh(c.nextSibling),tr=t,ir=!0,rr=null,sr=!1,null!==e&&($i[Xi++]=Ki,$i[Xi++]=Yi,$i[Xi++]=qi,Ki=e.id,Yi=e.overflow,qi=t),(t=Ga(t,s.children)).flags|=4096);return t}return o?(oa(),o=s.fallback,c=t.mode,u=(l=e.child).sibling,(s=Oi(l,{mode:"hidden",children:s.children})).subtreeFlags=65011712&l.subtreeFlags,null!==u?o=Oi(u,o):(o=Ui(o,c,n,null)).flags|=2,o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,null===(c=e.child.memoizedState)?c=Fa(n):(null!==(l=c.cachePool)?(u=Rr._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Vr(),c={baseLanes:c.baseLanes|n,cachePool:l}),o.memoizedState=c,o.childLanes=Ua(e,r,n),t.memoizedState=Da,s):(ra(t),e=(n=e.child).sibling,(n=Oi(n,{mode:"visible",children:s.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Ga(e,t){return(t=Va({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Va(e,t){return(e=Bi(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Ha(e,t,n){return ea(t,e.child,null,n),(e=Ga(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ja(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),_r(e.return,t,n)}function Wa(e,t,n,i,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function $a(e,t,n){var i=t.pendingProps,r=i.revealOrder,s=i.tail;if(Ta(e,t,i.children,n),2&(i=la.current))i=1&i|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ja(e,n,t);else if(19===e.tag)ja(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(F(la,i),r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ca(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Wa(t,!1,r,n,s);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ca(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Wa(t,!0,n,null,s);break;case"together":Wa(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Xa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),yc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Er(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Oi(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Oi(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function qa(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!wr(e))}function Ka(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Sa=!0;else{if(!(qa(e,n)||128&t.flags))return Sa=!1,function(e,t,n){switch(t.tag){case 3:H(t,t.stateNode.containerInfo),yr(0,Rr,e.memoizedState.cache),hr();break;case 27:case 5:W(t);break;case 4:H(t,t.stateNode.containerInfo);break;case 10:yr(0,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(ra(t),t.flags|=128,null):0!==(n&t.child.childLanes)?za(e,t,n):(ra(t),null!==(e=Xa(e,t,n))?e.sibling:null);ra(t);break;case 19:var r=!!(128&e.flags);if((i=0!==(n&t.childLanes))||(Er(e,t,n,!1),i=0!==(n&t.childLanes)),r){if(i)return $a(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),F(la,la.current),i)break;return null;case 22:case 23:return t.lanes=0,Ra(e,t,n);case 24:yr(0,Rr,e.memoizedState.cache)}return Xa(e,t,n)}(e,t,n);Sa=!!(131072&e.flags)}else Sa=!1,ir&&1048576&t.flags&&Zi(t,Wi,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,s=r._init;if(r=s(r._payload),t.type=r,"function"!=typeof r){if(null!=r){if((s=r.$$typeof)===_){t.tag=11,t=Ca(null,t,r,e,n);break e}if(s===w){t.tag=14,t=Ia(null,t,r,e,n);break e}}throw t=k(r)||r,Error(i(306,t,""))}Ni(r)?(e=pa(r,e),t.tag=1,t=Na(null,t,r,e,n)):(t.tag=0,t=La(null,t,r,e,n))}return t;case 0:return La(e,t,t.type,t.pendingProps,n);case 1:return Na(e,t,r=t.type,s=pa(r,t.pendingProps),n);case 3:e:{if(H(t,t.stateNode.containerInfo),null===e)throw Error(i(387));r=t.pendingProps;var o=t.memoizedState;s=o.element,ts(e,t),ls(t,r,null,n);var a=t.memoizedState;if(r=a.cache,yr(0,Rr,r),r!==o.cache&&br(t,[Rr],n,!0),as(),r=a.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:a.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Oa(e,t,r,n);break e}if(r!==s){fr(s=wi(Error(i(424)),t)),t=Oa(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(nr=Eh(e.firstChild),tr=t,ir=!0,rr=null,sr=!0,n=ta(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(hr(),r===s){t=Xa(e,t,n);break e}Ta(e,t,r,n)}t=t.child}return t;case 26:return Ma(e,t),null===e?(n=Mh(t.type,null,t.pendingProps,null))?t.memoizedState=n:ir||(n=t.type,e=t.pendingProps,(r=ah(G.current).createElement(n))[Re]=t,r[Pe]=e,rh(r,n,e),He(r),t.stateNode=r):t.memoizedState=Mh(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return W(t),null===e&&ir&&(r=t.stateNode=Ah(t.type,t.pendingProps,G.current),tr=t,sr=!0,s=nr,yh(t.type)?(wh=s,nr=Eh(r.firstChild)):nr=s),Ta(e,t,t.pendingProps.children,n),Ma(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&ir&&((s=r=nr)&&(null!==(r=function(e,t,n,i){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(i){if(!e[De])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(s=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(s!==r.rel||e.getAttribute("href")!==(null==r.href||""===r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((s=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&s&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var s=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===s)return e}if(null===(e=Eh(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,sr))?(t.stateNode=r,tr=t,nr=Eh(r.firstChild),sr=!1,s=!0):s=!1),s||ar(t)),W(t),s=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,r=o.children,uh(s,o)?r=null:null!==a&&uh(s,a)&&(t.flags|=32),null!==t.memoizedState&&(s=ks(e,t,Ms,null,null,n),Zh._currentValue=s),Ma(e,t),Ta(e,t,r,n),t.child;case 6:return null===e&&ir&&((e=n=nr)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Eh(e.nextSibling)))return null}return e}(n,t.pendingProps,sr))?(t.stateNode=n,tr=t,nr=null,e=!0):e=!1),e||ar(t)),null;case 13:return za(e,t,n);case 4:return H(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ea(t,null,r,n):Ta(e,t,r,n),t.child;case 11:return Ca(e,t,t.type,t.pendingProps,n);case 7:return Ta(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ta(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,yr(0,t.type,r.value),Ta(e,t,r.children,n),t.child;case 9:return s=t.type._context,r=t.pendingProps.children,xr(t),r=r(s=Ar(s)),t.flags|=1,Ta(e,t,r,n),t.child;case 14:return Ia(e,t,t.type,t.pendingProps,n);case 15:return ka(e,t,t.type,t.pendingProps,n);case 19:return $a(e,t,n);case 31:return r=t.pendingProps,n=t.mode,r={mode:r.mode,children:r.children},null===e?((n=Va(r,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Oi(e.child,r)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Ra(e,t,n);case 24:return xr(t),r=Ar(Rr),null===e?(null===(s=zr())&&(s=ac,o=Pr(),s.pooledCache=o,o.refCount++,null!==o&&(s.pooledCacheLanes|=n),s=o),t.memoizedState={parent:r,cache:s},es(t),yr(0,Rr,s)):(0!==(e.lanes&n)&&(ts(e,t),ls(t,null,null,n),as()),s=e.memoizedState,o=t.memoizedState,s.parent!==r?(s={parent:r,cache:r},t.memoizedState=s,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=s),yr(0,Rr,r)):(r=o.cache,yr(0,Rr,r),r!==s.cache&&br(t,[Rr],n,!0))),Ta(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function Ya(e){e.flags|=4}function Ja(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!Wh(t)){if(null!==(t=na.current)&&((4194048&cc)===cc?null!==ia:(62914560&cc)!==cc&&!(536870912&cc)||t!==ia))throw Yr=$r,jr;e.flags|=8192}}function Za(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ee():536870912,e.lanes|=t,Ec|=t)}function Qa(e,t){if(!ir)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function el(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=65011712&r.subtreeFlags,i|=65011712&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function tl(e,t,n){var r=t.pendingProps;switch(er(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return el(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),vr(Rr),j(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ur(t)?Ya(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,dr())),el(t),null;case 26:return n=t.memoizedState,null===e?(Ya(t),null!==n?(el(t),Ja(t,n)):(el(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Ya(t),el(t),Ja(t,n)):(el(t),t.flags&=-16777217):(e.memoizedProps!==r&&Ya(t),el(t),t.flags&=-16777217),null;case 27:$(t),n=G.current;var s=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Ya(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return el(t),null}e=U.current,ur(t)?lr(t):(e=Ah(s,r,n),t.stateNode=e,Ya(t))}return el(t),null;case 5:if($(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Ya(t);else{if(!r){if(null===t.stateNode)throw Error(i(166));return el(t),null}if(e=U.current,ur(t))lr(t);else{switch(s=ah(G.current),e){case 1:e=s.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=s.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=s.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=s.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=s.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"==typeof r.is?s.createElement("select",{is:r.is}):s.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"==typeof r.is?s.createElement(n,{is:r.is}):s.createElement(n)}}e[Re]=t,e[Pe]=r;e:for(s=t.child;null!==s;){if(5===s.tag||6===s.tag)e.appendChild(s.stateNode);else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;null===s.sibling;){if(null===s.return||s.return===t)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=e;e:switch(rh(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Ya(t)}}return el(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Ya(t);else{if("string"!=typeof r&&null===t.stateNode)throw Error(i(166));if(e=G.current,ur(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(s=tr))switch(s.tag){case 27:case 5:r=s.memoizedProps}e[Re]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||eh(e.nodeValue,n)))||ar(t)}else(e=ah(e).createTextNode(r))[Re]=t,t.stateNode=e}return el(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(s=ur(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(i(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(i(317));s[Re]=t}else hr(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;el(t),s=!1}else s=dr(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=s),s=!0;if(!s)return 256&t.flags?(aa(t),t):(aa(t),null)}if(aa(t),128&t.flags)return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){s=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(s=r.alternate.memoizedState.cachePool.pool);var o=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(o=r.memoizedState.cachePool.pool),o!==s&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),Za(t,t.updateQueue),el(t),null;case 4:return j(),null===e&&ju(t.stateNode.containerInfo),el(t),null;case 10:return vr(t.type),el(t),null;case 19:if(D(la),null===(s=t.memoizedState))return el(t),null;if(r=!!(128&t.flags),null===(o=s.rendering))if(r)Qa(s,!1);else{if(0!==mc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=ca(e))){for(t.flags|=128,Qa(s,!1),e=o.updateQueue,t.updateQueue=e,Za(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Di(n,e),n=n.sibling;return F(la,1&la.current|2),t.child}e=e.sibling}null!==s.tail&&Z()>Tc&&(t.flags|=128,r=!0,Qa(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ca(o))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,Za(t,e),Qa(s,!0),null===s.tail&&"hidden"===s.tailMode&&!o.alternate&&!ir)return el(t),null}else 2*Z()-s.renderingStartTime>Tc&&536870912!==n&&(t.flags|=128,r=!0,Qa(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=s.last)?e.sibling=o:t.child=o,s.last=o)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Z(),t.sibling=null,e=la.current,F(la,r?1&e|2:1&e),t):(el(t),null);case 22:case 23:return aa(t),gs(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?!!(536870912&n)&&!(128&t.flags)&&(el(t),6&t.subtreeFlags&&(t.flags|=8192)):el(t),null!==(n=t.updateQueue)&&Za(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&D(Ur),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),vr(Rr),el(t),null;case 25:case 30:return null}throw Error(i(156,t.tag))}function nl(e,t){switch(er(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return vr(Rr),j(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return $(t),null;case 13:if(aa(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));hr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return D(la),null;case 4:return j(),null;case 10:return vr(t.type),null;case 22:case 23:return aa(t),gs(),null!==e&&D(Ur),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return vr(Rr),null;default:return null}}function il(e,t){switch(er(t),t.tag){case 3:vr(Rr),j();break;case 26:case 27:case 5:$(t);break;case 4:j();break;case 13:aa(t);break;case 19:D(la);break;case 10:vr(t.type);break;case 22:case 23:aa(t),gs(),null!==e&&D(Ur);break;case 24:vr(Rr)}}function rl(e,t){try{var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var r=i.next;n=r;do{if((n.tag&e)===e){i=void 0;var s=n.create,o=n.inst;i=s(),o.destroy=i}n=n.next}while(n!==r)}}catch(a){pu(t,t.return,a)}}function sl(e,t,n){try{var i=t.updateQueue,r=null!==i?i.lastEffect:null;if(null!==r){var s=r.next;i=s;do{if((i.tag&e)===e){var o=i.inst,a=o.destroy;if(void 0!==a){o.destroy=void 0,r=t;var l=n,c=a;try{c()}catch(u){pu(r,l,u)}}}i=i.next}while(i!==s)}}catch(u){pu(t,t.return,u)}}function ol(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{us(t,n)}catch(i){pu(e,e.return,i)}}}function al(e,t,n){n.props=pa(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(i){pu(e,t,i)}}function ll(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;default:i=e.stateNode}"function"==typeof n?e.refCleanup=n(i):n.current=i}}catch(r){pu(e,t,r)}}function cl(e,t){var n=e.ref,i=e.refCleanup;if(null!==n)if("function"==typeof i)try{i()}catch(r){pu(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(s){pu(e,t,s)}else n.current=null}function ul(e){var t=e.type,n=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(r){pu(e,e.return,r)}}function hl(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var s=null,o=null,a=null,l=null,c=null,u=null,h=null;for(p in n){var d=n[p];if(n.hasOwnProperty(p)&&null!=d)switch(p){case"checked":case"value":break;case"defaultValue":c=d;default:r.hasOwnProperty(p)||nh(e,t,p,null,r,d)}}for(var f in r){var p=r[f];if(d=n[f],r.hasOwnProperty(f)&&(null!=p||null!=d))switch(f){case"type":o=p;break;case"name":s=p;break;case"checked":u=p;break;case"defaultChecked":h=p;break;case"value":a=p;break;case"defaultValue":l=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(i(137,t));break;default:p!==d&&nh(e,t,f,p,r,d)}}return void pt(e,a,l,c,u,h,o,s);case"select":for(o in p=a=l=f=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":p=c;default:r.hasOwnProperty(o)||nh(e,t,o,null,r,c)}for(s in r)if(o=r[s],c=n[s],r.hasOwnProperty(s)&&(null!=o||null!=c))switch(s){case"value":f=o;break;case"defaultValue":l=o;break;case"multiple":a=o;default:o!==c&&nh(e,t,s,o,r,c)}return t=l,n=a,r=p,void(null!=f?yt(e,!!n,f,!1):!!r!=!!n&&(null!=t?yt(e,!!n,t,!0):yt(e,!!n,n?[]:"",!1)));case"textarea":for(l in p=f=null,n)if(s=n[l],n.hasOwnProperty(l)&&null!=s&&!r.hasOwnProperty(l))switch(l){case"value":case"children":break;default:nh(e,t,l,null,r,s)}for(a in r)if(s=r[a],o=n[a],r.hasOwnProperty(a)&&(null!=s||null!=o))switch(a){case"value":f=s;break;case"defaultValue":p=s;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=s)throw Error(i(91));break;default:s!==o&&nh(e,t,a,s,r,o)}return void vt(e,f,p);case"option":for(var g in n)if(f=n[g],n.hasOwnProperty(g)&&null!=f&&!r.hasOwnProperty(g))if("selected"===g)e.selected=!1;else nh(e,t,g,null,r,f);for(c in r)if(f=r[c],p=n[c],r.hasOwnProperty(c)&&f!==p&&(null!=f||null!=p))if("selected"===c)e.selected=f&&"function"!=typeof f&&"symbol"!=typeof f;else nh(e,t,c,f,r,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in n)f=n[m],n.hasOwnProperty(m)&&null!=f&&!r.hasOwnProperty(m)&&nh(e,t,m,null,r,f);for(u in r)if(f=r[u],p=n[u],r.hasOwnProperty(u)&&f!==p&&(null!=f||null!=p))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(i(137,t));break;default:nh(e,t,u,f,r,p)}return;default:if(At(t)){for(var y in n)f=n[y],n.hasOwnProperty(y)&&void 0!==f&&!r.hasOwnProperty(y)&&ih(e,t,y,void 0,r,f);for(h in r)f=r[h],p=n[h],!r.hasOwnProperty(h)||f===p||void 0===f&&void 0===p||ih(e,t,h,f,r,p);return}}for(var v in n)f=n[v],n.hasOwnProperty(v)&&null!=f&&!r.hasOwnProperty(v)&&nh(e,t,v,null,r,f);for(d in r)f=r[d],p=n[d],!r.hasOwnProperty(d)||f===p||null==f&&null==p||nh(e,t,d,f,r,p)}(r,e.type,n,t),r[Pe]=t}catch(s){pu(e,e.return,s)}}function dl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&yh(e.type)||4===e.tag}function fl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||dl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&yh(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function pl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=th));else if(4!==i&&(27===i&&yh(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(pl(e,t,n),e=e.sibling;null!==e;)pl(e,t,n),e=e.sibling}function gl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&(27===i&&yh(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(gl(e,t,n),e=e.sibling;null!==e;)gl(e,t,n),e=e.sibling}function ml(e){var t=e.stateNode,n=e.memoizedProps;try{for(var i=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);rh(t,i,n),t[Re]=e,t[Pe]=n}catch(s){pu(e,e.return,s)}}var yl=!1,vl=!1,_l=!1,bl="function"==typeof WeakSet?WeakSet:Set,El=null;function wl(e,t,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:Nl(e,n),4&i&&rl(5,n);break;case 1:if(Nl(e,n),4&i)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(o){pu(n,n.return,o)}else{var r=pa(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(a){pu(n,n.return,a)}}64&i&&ol(n),512&i&&ll(n,n.return);break;case 3:if(Nl(e,n),64&i&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{us(e,t)}catch(o){pu(n,n.return,o)}}break;case 27:null===t&&4&i&&ml(n);case 26:case 5:Nl(e,n),null===t&&4&i&&ul(n),512&i&&ll(n,n.return);break;case 12:Nl(e,n);break;case 13:Nl(e,n),4&i&&Il(e,n),64&i&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var i=function(){t(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}(e,n=vu.bind(null,n))));break;case 22:if(!(i=null!==n.memoizedState||yl)){t=null!==t&&null!==t.memoizedState||vl,r=yl;var s=vl;yl=i,(vl=t)&&!s?Dl(e,n,!!(8772&n.subtreeFlags)):Nl(e,n),yl=r,vl=s}break;case 30:break;default:Nl(e,n)}}function xl(e){var t=e.alternate;null!==t&&(e.alternate=null,xl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Fe(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Al=null,Sl=!1;function Tl(e,t,n){for(n=n.child;null!==n;)Cl(e,t,n),n=n.sibling}function Cl(e,t,n){if(le&&"function"==typeof le.onCommitFiberUnmount)try{le.onCommitFiberUnmount(ae,n)}catch(s){}switch(n.tag){case 26:vl||cl(n,t),Tl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:vl||cl(n,t);var i=Al,r=Sl;yh(n.type)&&(Al=n.stateNode,Sl=!1),Tl(e,t,n),Sh(n.stateNode),Al=i,Sl=r;break;case 5:vl||cl(n,t);case 6:if(i=Al,r=Sl,Al=null,Tl(e,t,n),Sl=r,null!==(Al=i))if(Sl)try{(9===Al.nodeType?Al.body:"HTML"===Al.nodeName?Al.ownerDocument.body:Al).removeChild(n.stateNode)}catch(o){pu(n,t,o)}else try{Al.removeChild(n.stateNode)}catch(o){pu(n,t,o)}break;case 18:null!==Al&&(Sl?(vh(9===(e=Al).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Pd(e)):vh(Al,n.stateNode));break;case 4:i=Al,r=Sl,Al=n.stateNode.containerInfo,Sl=!0,Tl(e,t,n),Al=i,Sl=r;break;case 0:case 11:case 14:case 15:vl||sl(2,n,t),vl||sl(4,n,t),Tl(e,t,n);break;case 1:vl||(cl(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount&&al(n,t,i)),Tl(e,t,n);break;case 21:Tl(e,t,n);break;case 22:vl=(i=vl)||null!==n.memoizedState,Tl(e,t,n),vl=i;break;default:Tl(e,t,n)}}function Il(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Pd(e)}catch(n){pu(t,t.return,n)}}function kl(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new bl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new bl),t;default:throw Error(i(435,e.tag))}}(e);t.forEach(function(t){var i=_u.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}function Rl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var s=n[r],o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 27:if(yh(l.type)){Al=l.stateNode,Sl=!1;break e}break;case 5:Al=l.stateNode,Sl=!1;break e;case 3:case 4:Al=l.stateNode.containerInfo,Sl=!0;break e}l=l.return}if(null===Al)throw Error(i(160));Cl(o,a,s),Al=null,Sl=!1,null!==(o=s.alternate)&&(o.return=null),s.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Ml(t,e),t=t.sibling}var Pl=null;function Ml(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Rl(t,e),Ll(e),4&r&&(sl(3,e,e.return),rl(3,e),sl(5,e,e.return));break;case 1:Rl(t,e),Ll(e),512&r&&(vl||null===n||cl(n,n.return)),64&r&&yl&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var s=Pl;if(Rl(t,e),Ll(e),512&r&&(vl||null===n||cl(n,n.return)),4&r){var o=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,s=s.ownerDocument||s;t:switch(r){case"title":(!(o=s.getElementsByTagName("title")[0])||o[De]||o[Re]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=s.createElement(r),s.head.insertBefore(o,s.querySelector("head > title"))),rh(o,r,n),o[Re]=e,He(o),r=o;break e;case"link":var a=Hh("link","href",s).get(r+(n.href||""));if(a)for(var l=0;l<a.length;l++)if((o=a[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){a.splice(l,1);break t}rh(o=s.createElement(r),r,n),s.head.appendChild(o);break;case"meta":if(a=Hh("meta","content",s).get(r+(n.content||"")))for(l=0;l<a.length;l++)if((o=a[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){a.splice(l,1);break t}rh(o=s.createElement(r),r,n),s.head.appendChild(o);break;default:throw Error(i(468,r))}o[Re]=e,He(o),r=o}e.stateNode=r}else jh(s,e.type,e.stateNode);else e.stateNode=Fh(s,r,e.memoizedProps);else o!==r?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===r?jh(s,e.type,e.stateNode):Fh(s,r,e.memoizedProps)):null===r&&null!==e.stateNode&&hl(e,e.memoizedProps,n.memoizedProps)}break;case 27:Rl(t,e),Ll(e),512&r&&(vl||null===n||cl(n,n.return)),null!==n&&4&r&&hl(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Rl(t,e),Ll(e),512&r&&(vl||null===n||cl(n,n.return)),32&e.flags){s=e.stateNode;try{bt(s,"")}catch(p){pu(e,e.return,p)}}4&r&&null!=e.stateNode&&hl(e,s=e.memoizedProps,null!==n?n.memoizedProps:s),1024&r&&(_l=!0);break;case 6:if(Rl(t,e),Ll(e),4&r){if(null===e.stateNode)throw Error(i(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(p){pu(e,e.return,p)}}break;case 3:if(Vh=null,s=Pl,Pl=Ih(t.containerInfo),Rl(t,e),Pl=s,Ll(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Pd(t.containerInfo)}catch(p){pu(e,e.return,p)}_l&&(_l=!1,Bl(e));break;case 4:r=Pl,Pl=Ih(e.stateNode.containerInfo),Rl(t,e),Ll(e),Pl=r;break;case 12:default:Rl(t,e),Ll(e);break;case 13:Rl(t,e),Ll(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(Sc=Z()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,kl(e,r)));break;case 22:s=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=yl,h=vl;if(yl=u||s,vl=h||c,Rl(t,e),vl=h,yl=u,Ll(e),8192&r)e:for(t=e.stateNode,t._visibility=s?-2&t._visibility:1|t._visibility,s&&(null===n||c||yl||vl||Ol(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(o=c.stateNode,s)"function"==typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var d=c.memoizedProps.style,f=null!=d&&d.hasOwnProperty("display")?d.display:null;l.style.display=null==f||"boolean"==typeof f?"":(""+f).trim()}}catch(p){pu(c,c.return,p)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=s?"":c.memoizedProps}catch(p){pu(c,c.return,p)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,kl(e,n))));break;case 19:Rl(t,e),Ll(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,kl(e,r)));case 30:case 21:}}function Ll(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(dl(r)){n=r;break}r=r.return}if(null==n)throw Error(i(160));switch(n.tag){case 27:var s=n.stateNode;gl(e,fl(e),s);break;case 5:var o=n.stateNode;32&n.flags&&(bt(o,""),n.flags&=-33),gl(e,fl(e),o);break;case 3:case 4:var a=n.stateNode.containerInfo;pl(e,fl(e),a);break;default:throw Error(i(161))}}catch(l){pu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Bl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Bl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Nl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)wl(e,t.alternate,t),t=t.sibling}function Ol(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:sl(4,t,t.return),Ol(t);break;case 1:cl(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&al(t,t.return,n),Ol(t);break;case 27:Sh(t.stateNode);case 26:case 5:cl(t,t.return),Ol(t);break;case 22:null===t.memoizedState&&Ol(t);break;default:Ol(t)}e=e.sibling}}function Dl(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var i=t.alternate,r=e,s=t,o=s.flags;switch(s.tag){case 0:case 11:case 15:Dl(r,s,n),rl(4,s);break;case 1:if(Dl(r,s,n),"function"==typeof(r=(i=s).stateNode).componentDidMount)try{r.componentDidMount()}catch(c){pu(i,i.return,c)}if(null!==(r=(i=s).updateQueue)){var a=i.stateNode;try{var l=r.shared.hiddenCallbacks;if(null!==l)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)cs(l[r],a)}catch(c){pu(i,i.return,c)}}n&&64&o&&ol(s),ll(s,s.return);break;case 27:ml(s);case 26:case 5:Dl(r,s,n),n&&null===i&&4&o&&ul(s),ll(s,s.return);break;case 12:Dl(r,s,n);break;case 13:Dl(r,s,n),n&&4&o&&Il(r,s);break;case 22:null===s.memoizedState&&Dl(r,s,n),ll(s,s.return);break;case 30:break;default:Dl(r,s,n)}t=t.sibling}}function Fl(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Mr(n))}function Ul(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Mr(e))}function Gl(e,t,n,i){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Vl(e,t,n,i),t=t.sibling}function Vl(e,t,n,i){var r=t.flags;switch(t.tag){case 0:case 11:case 15:Gl(e,t,n,i),2048&r&&rl(9,t);break;case 1:case 13:default:Gl(e,t,n,i);break;case 3:Gl(e,t,n,i),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Mr(e)));break;case 12:if(2048&r){Gl(e,t,n,i),e=t.stateNode;try{var s=t.memoizedProps,o=s.id,a=s.onPostCommit;"function"==typeof a&&a(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){pu(t,t.return,l)}}else Gl(e,t,n,i);break;case 23:break;case 22:s=t.stateNode,o=t.alternate,null!==t.memoizedState?2&s._visibility?Gl(e,t,n,i):Xl(e,t):2&s._visibility?Gl(e,t,n,i):(s._visibility|=2,jl(e,t,n,i,!!(10256&t.subtreeFlags))),2048&r&&Fl(o,t);break;case 24:Gl(e,t,n,i),2048&r&&Ul(t.alternate,t)}}function jl(e,t,n,i,r){for(r=r&&!!(10256&t.subtreeFlags),t=t.child;null!==t;){var s=e,o=t,a=n,l=i,c=o.flags;switch(o.tag){case 0:case 11:case 15:jl(s,o,a,l,r),rl(8,o);break;case 23:break;case 22:var u=o.stateNode;null!==o.memoizedState?2&u._visibility?jl(s,o,a,l,r):Xl(s,o):(u._visibility|=2,jl(s,o,a,l,r)),r&&2048&c&&Fl(o.alternate,o);break;case 24:jl(s,o,a,l,r),r&&2048&c&&Ul(o.alternate,o);break;default:jl(s,o,a,l,r)}t=t.sibling}}function Xl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,i=t,r=i.flags;switch(i.tag){case 22:Xl(n,i),2048&r&&Fl(i.alternate,i);break;case 24:Xl(n,i),2048&r&&Ul(i.alternate,i);break;default:Xl(n,i)}t=t.sibling}}var Kl=8192;function Jl(e){if(e.subtreeFlags&Kl)for(e=e.child;null!==e;)Zl(e),e=e.sibling}function Zl(e){switch(e.tag){case 26:Jl(e),e.flags&Kl&&null!==e.memoizedState&&function(e,t,n){if(null===$h)throw Error(i(475));var r=$h;if(!("stylesheet"!==t.type||"string"==typeof n.media&&!1===matchMedia(n.media).matches||4&t.state.loading)){if(null===t.instance){var s=Lh(n.href),o=e.querySelector(Bh(s));if(o)return null!==(e=o._p)&&"object"==typeof e&&"function"==typeof e.then&&(r.count++,r=qh.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=o,void He(o);o=e.ownerDocument||e,n=Nh(n),(s=Th.get(s))&&zh(n,s),He(o=o.createElement("link"));var a=o;a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),rh(o,"link",n),t.instance=o}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&!(3&t.state.loading)&&(r.count++,t=qh.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(Pl,e.memoizedState,e.memoizedProps);break;case 5:default:Jl(e);break;case 3:case 4:var t=Pl;Pl=Ih(e.stateNode.containerInfo),Jl(e),Pl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Kl,Kl=16777216,Jl(e),Kl=t):Jl(e))}}function Ql(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function ec(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];El=i,ic(i,e)}Ql(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)tc(e),e=e.sibling}function tc(e){switch(e.tag){case 0:case 11:case 15:ec(e),2048&e.flags&&sl(9,e,e.return);break;case 3:case 12:default:ec(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,nc(e)):ec(e)}}function nc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];El=i,ic(i,e)}Ql(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:sl(8,t,t.return),nc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,nc(t));break;default:nc(t)}e=e.sibling}}function ic(e,t){for(;null!==El;){var n=El;switch(n.tag){case 0:case 11:case 15:sl(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var i=n.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:Mr(n.memoizedState.cache)}if(null!==(i=n.child))i.return=n,El=i;else e:for(n=e;null!==El;){var r=(i=El).sibling,s=i.return;if(xl(i),i===n){El=null;break e}if(null!==r){r.return=s,El=r;break e}El=s}}}var rc={getCacheForType:function(e){var t=Ar(Rr),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},sc="function"==typeof WeakMap?WeakMap:Map,oc=0,ac=null,lc=null,cc=0,uc=0,hc=null,dc=!1,fc=!1,pc=!1,gc=0,mc=0,yc=0,vc=0,_c=0,bc=0,Ec=0,wc=null,xc=null,Ac=!1,Sc=0,Tc=1/0,Cc=null,Ic=null,kc=0,Rc=null,Pc=null,Mc=0,Lc=0,Bc=null,Nc=null,Oc=0,Dc=null;function Fc(){if(2&oc&&0!==cc)return cc&-cc;if(null!==P.T){return 0!==Nr?Nr:Lu()}return Ie()}function Uc(){0===bc&&(bc=536870912&cc&&!ir?536870912:be());var e=na.current;return null!==e&&(e.flags|=32),bc}function zc(e,t,n){(e!==ac||2!==uc&&9!==uc)&&null===e.cancelPendingCommit||(Xc(e,0),jc(e,cc,bc,!1)),xe(e,n),2&oc&&e===ac||(e===ac&&(!(2&oc)&&(vc|=n),4===mc&&jc(e,cc,bc,!1)),Tu(e))}function Gc(e,t,n){if(6&oc)throw Error(i(327));for(var r=!n&&!(124&t)&&0===(t&e.expiredLanes)||ve(e,t),s=r?function(e,t){var n=oc;oc|=2;var r=Kc(),s=Yc();ac!==e||cc!==t?(Cc=null,Tc=Z()+500,Xc(e,t)):fc=ve(e,t);e:for(;;)try{if(0!==uc&&null!==lc){t=lc;var o=hc;t:switch(uc){case 1:uc=0,hc=null,iu(e,t,o,1);break;case 2:case 9:if(Xr(o)){uc=0,hc=null,nu(t);break}t=function(){2!==uc&&9!==uc||ac!==e||(uc=7),Tu(e)},o.then(t,t);break e;case 3:uc=7;break e;case 4:uc=5;break e;case 7:Xr(o)?(uc=0,hc=null,nu(t)):(uc=0,hc=null,iu(e,t,o,7));break;case 5:var a=null;switch(lc.tag){case 26:a=lc.memoizedState;case 5:case 27:var l=lc;if(!a||Wh(a)){uc=0,hc=null;var c=l.sibling;if(null!==c)lc=c;else{var u=l.return;null!==u?(lc=u,ru(u)):lc=null}break t}}uc=0,hc=null,iu(e,t,o,5);break;case 6:uc=0,hc=null,iu(e,t,o,6);break;case 8:$c(),mc=6;break e;default:throw Error(i(462))}}eu();break}catch(h){qc(e,h)}return mr=gr=null,P.H=r,P.A=s,oc=n,null!==lc?0:(ac=null,cc=0,Ti(),mc)}(e,t):Zc(e,t,!0),o=r;;){if(0===s){fc&&!r&&jc(e,t,0,!1);break}if(n=e.current.alternate,!o||Hc(n)){if(2===s){if(o=t,e.errorRecoveryDisabledLanes&o)var a=0;else a=0!==(a=-536870913&e.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){t=a;e:{var l=e;s=wc;var c=l.current.memoizedState.isDehydrated;if(c&&(Xc(l,a).flags|=256),2!==(a=Zc(l,a,!1))){if(pc&&!c){l.errorRecoveryDisabledLanes|=o,vc|=o,s=4;break e}o=xc,xc=s,null!==o&&(null===xc?xc=o:xc.push.apply(xc,o))}s=a}if(o=!1,2!==s)continue}}if(1===s){Xc(e,0),jc(e,t,0,!0);break}e:{switch(r=e,o=s){case 0:case 1:throw Error(i(345));case 4:if((4194048&t)!==t)break;case 6:jc(r,t,bc,!dc);break e;case 2:xc=null;break;case 3:case 5:break;default:throw Error(i(329))}if((62914560&t)===t&&10<(s=Sc+300-Z())){if(jc(r,t,bc,!dc),0!==me(r,0,!0))break e;r.timeoutHandle=dh(Vc.bind(null,r,n,xc,Cc,Ac,t,bc,vc,Ec,dc,o,2,-0,0),s)}else Vc(r,n,xc,Cc,Ac,t,bc,vc,Ec,dc,o,0,-0,0)}break}s=Zc(e,t,!1),o=!1}Tu(e)}function Vc(e,t,n,r,s,o,a,l,c,u,h,d,f,p){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||!(16785408&~d))&&($h={stylesheets:null,count:0,unsuspend:Xh},Zl(t),null!==(d=function(){if(null===$h)throw Error(i(475));var e=$h;return e.stylesheets&&0===e.count&&Yh(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Yh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=d(ou.bind(null,e,t,o,n,r,s,a,l,c,h,1,f,p)),void jc(e,o,a,!u);ou(e,t,o,n,r,s,a,l,c)}function Hc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Xn(s(),r))return!1}catch(o){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function jc(e,t,n,i){t&=~_c,t&=~vc,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var r=t;0<r;){var s=31-ue(r),o=1<<s;i[s]=-1,r&=~o}0!==n&&Ae(e,n,t)}function Wc(){return!!(6&oc)||(Cu(0),!1)}function $c(){if(null!==lc){if(0===uc)var e=lc.return;else mr=gr=null,Ns(e=lc),Xo=null,qo=0,e=lc;for(;null!==e;)il(e.alternate,e),e=e.return;lc=null}}function Xc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,fh(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),$c(),ac=e,lc=n=Oi(e.current,null),cc=t,uc=0,hc=null,dc=!1,fc=ve(e,t),pc=!1,Ec=bc=_c=vc=yc=mc=0,xc=wc=null,Ac=!1,8&t&&(t|=32&t);var i=e.entangledLanes;if(0!==i)for(e=e.entanglements,i&=t;0<i;){var r=31-ue(i),s=1<<r;t|=e[r],i&=~s}return gc=t,Ti(),n}function qc(e,t){ys=null,P.H=Ho,t===Hr||t===Wr?(t=Jr(),uc=3):t===jr?(t=Jr(),uc=4):uc=t===Aa?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,hc=t,null===lc&&(mc=1,_a(e,wi(t,e.current)))}function Kc(){var e=P.H;return P.H=Ho,null===e?Ho:e}function Yc(){var e=P.A;return P.A=rc,e}function Jc(){mc=4,dc||(4194048&cc)!==cc&&null!==na.current||(fc=!0),!(134217727&yc)&&!(134217727&vc)||null===ac||jc(ac,cc,bc,!1)}function Zc(e,t,n){var i=oc;oc|=2;var r=Kc(),s=Yc();ac===e&&cc===t||(Cc=null,Xc(e,t)),t=!1;var o=mc;e:for(;;)try{if(0!==uc&&null!==lc){var a=lc,l=hc;switch(uc){case 8:$c(),o=6;break e;case 3:case 2:case 9:case 6:null===na.current&&(t=!0);var c=uc;if(uc=0,hc=null,iu(e,a,l,c),n&&fc){o=0;break e}break;default:c=uc,uc=0,hc=null,iu(e,a,l,c)}}Qc(),o=mc;break}catch(u){qc(e,u)}return t&&e.shellSuspendCounter++,mr=gr=null,oc=i,P.H=r,P.A=s,null===lc&&(ac=null,cc=0,Ti()),o}function Qc(){for(;null!==lc;)tu(lc)}function eu(){for(;null!==lc&&!Y();)tu(lc)}function tu(e){var t=Ka(e.alternate,e,gc);e.memoizedProps=e.pendingProps,null===t?ru(e):lc=t}function nu(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Ba(n,t,t.pendingProps,t.type,void 0,cc);break;case 11:t=Ba(n,t,t.pendingProps,t.type.render,t.ref,cc);break;case 5:Ns(t);default:il(n,t),t=Ka(n,t=lc=Di(t,gc),gc)}e.memoizedProps=e.pendingProps,null===t?ru(e):lc=t}function iu(e,t,n,r){mr=gr=null,Ns(t),Xo=null,qo=0;var s=t.return;try{if(function(e,t,n,r,s){if(n.flags|=32768,null!==r&&"object"==typeof r&&"function"==typeof r.then){if(null!==(t=n.alternate)&&Er(t,n,s,!0),null!==(n=na.current)){switch(n.tag){case 13:return null===ia?Jc():null===n.alternate&&0===mc&&(mc=3),n.flags&=-257,n.flags|=65536,n.lanes=s,r===$r?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),gu(e,r,s)),!1;case 22:return n.flags|=65536,r===$r?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),gu(e,r,s)),!1}throw Error(i(435,n.tag))}return gu(e,r,s),Jc(),!1}if(ir)return null!==(t=na.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=s,r!==or&&fr(wi(e=Error(i(422),{cause:r}),n))):(r!==or&&fr(wi(t=Error(i(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,s&=-s,e.lanes|=s,r=wi(r,n),ss(e,s=Ea(e.stateNode,r,s)),4!==mc&&(mc=2)),!1;var o=Error(i(520),{cause:r});if(o=wi(o,n),null===wc?wc=[o]:wc.push(o),4!==mc&&(mc=2),null===t)return!0;r=wi(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=s&-s,n.lanes|=e,ss(n,e=Ea(n.stateNode,r,e)),!1;case 1:if(t=n.type,o=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===o||"function"!=typeof o.componentDidCatch||null!==Ic&&Ic.has(o))))return n.flags|=65536,s&=-s,n.lanes|=s,xa(s=wa(s),e,n,r),ss(n,s),!1}n=n.return}while(null!==n);return!1}(e,s,t,n,cc))return mc=1,_a(e,wi(n,e.current)),void(lc=null)}catch(o){if(null!==s)throw lc=s,o;return mc=1,_a(e,wi(n,e.current)),void(lc=null)}32768&t.flags?(ir||1===r?e=!0:fc||536870912&cc?e=!1:(dc=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=na.current)&&13===r.tag&&(r.flags|=16384))),su(t,e)):ru(t)}function ru(e){var t=e;do{if(32768&t.flags)return void su(t,dc);e=t.return;var n=tl(t.alternate,t,gc);if(null!==n)return void(lc=n);if(null!==(t=t.sibling))return void(lc=t);lc=t=e}while(null!==t);0===mc&&(mc=5)}function su(e,t){do{var n=nl(e.alternate,e);if(null!==n)return n.flags&=32767,void(lc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(lc=e);lc=e=n}while(null!==e);mc=6,lc=null}function ou(e,t,n,r,s,o,a,l,c){e.cancelPendingCommit=null;do{hu()}while(0!==kc);if(6&oc)throw Error(i(327));if(null!==t){if(t===e.current)throw Error(i(177));if(o=t.lanes|t.childLanes,function(e,t,n,i,r,s){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var a=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-ue(n),h=1<<u;a[u]=0,l[u]=-1;var d=c[u];if(null!==d)for(c[u]=null,u=0;u<d.length;u++){var f=d[u];null!==f&&(f.lane&=-536870913)}n&=~h}0!==i&&Ae(e,i,0),0!==s&&0===r&&0!==e.tag&&(e.suspendedLanes|=s&~(o&~t))}(e,n,o|=Si,a,l,c),e===ac&&(lc=ac=null,cc=0),Pc=t,Rc=e,Mc=n,Lc=o,Bc=s,Nc=r,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,q(ne,function(){return du(),null})):(e.callbackNode=null,e.callbackPriority=0),r=!!(13878&t.flags),13878&t.subtreeFlags||r){r=P.T,P.T=null,s=M.p,M.p=2,a=oc,oc|=4;try{!function(e,t){if(e=e.containerInfo,sh=od,Qn(e=Zn(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var s=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(m){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==s&&3!==d.nodeType||(l=a+s),d!==o||0!==r&&3!==d.nodeType||(c=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++u===s&&(l=a),f===o&&++h===r&&(c=a),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(oh={focusedElem:e,selectionRange:n},od=!1,El=t;null!==El;)if(e=(t=El).child,1024&t.subtreeFlags&&null!==e)e.return=t,El=e;else for(;null!==El;){switch(o=(t=El).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==o){e=void 0,n=t,s=o.memoizedProps,o=o.memoizedState,r=n.stateNode;try{var g=pa(n.type,s,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(g,o),r.__reactInternalSnapshotBeforeUpdate=e}catch(y){pu(n,n.return,y)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))_h(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":_h(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(i(163))}if(null!==(e=t.sibling)){e.return=t.return,El=e;break}El=t.return}}(e,t)}finally{oc=a,M.p=s,P.T=r}}kc=1,au(),lu(),cu()}}function au(){if(1===kc){kc=0;var e=Rc,t=Pc,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=P.T,P.T=null;var i=M.p;M.p=2;var r=oc;oc|=4;try{Ml(t,e);var s=oh,o=Zn(e.containerInfo),a=s.focusedElem,l=s.selectionRange;if(o!==a&&a&&a.ownerDocument&&Jn(a.ownerDocument.documentElement,a)){if(null!==l&&Qn(a)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in a)a.selectionStart=c,a.selectionEnd=Math.min(u,a.value.length);else{var h=a.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var f=d.getSelection(),p=a.textContent.length,g=Math.min(l.start,p),m=void 0===l.end?g:Math.min(l.end,p);!f.extend&&g>m&&(o=m,m=g,g=o);var y=Yn(a,g),v=Yn(a,m);if(y&&v&&(1!==f.rangeCount||f.anchorNode!==y.node||f.anchorOffset!==y.offset||f.focusNode!==v.node||f.focusOffset!==v.offset)){var _=h.createRange();_.setStart(y.node,y.offset),f.removeAllRanges(),g>m?(f.addRange(_),f.extend(v.node,v.offset)):(_.setEnd(v.node,v.offset),f.addRange(_))}}}}for(h=[],f=a;f=f.parentNode;)1===f.nodeType&&h.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"==typeof a.focus&&a.focus(),a=0;a<h.length;a++){var b=h[a];b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}od=!!sh,oh=sh=null}finally{oc=r,M.p=i,P.T=n}}e.current=t,kc=2}}function lu(){if(2===kc){kc=0;var e=Rc,t=Pc,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=P.T,P.T=null;var i=M.p;M.p=2;var r=oc;oc|=4;try{wl(e,t.alternate,t)}finally{oc=r,M.p=i,P.T=n}}kc=3}}function cu(){if(4===kc||3===kc){kc=0,J();var e=Rc,t=Pc,n=Mc,i=Nc;10256&t.subtreeFlags||10256&t.flags?kc=5:(kc=0,Pc=Rc=null,uu(e,e.pendingLanes));var r=e.pendingLanes;if(0===r&&(Ic=null),Ce(n),t=t.stateNode,le&&"function"==typeof le.onCommitFiberRoot)try{le.onCommitFiberRoot(ae,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==i){t=P.T,r=M.p,M.p=2,P.T=null;try{for(var s=e.onRecoverableError,o=0;o<i.length;o++){var a=i[o];s(a.value,{componentStack:a.stack})}}finally{P.T=t,M.p=r}}3&Mc&&hu(),Tu(e),r=e.pendingLanes,4194090&n&&42&r?e===Dc?Oc++:(Oc=0,Dc=e):Oc=0,Cu(0)}}function uu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Mr(t)))}function hu(e){return au(),lu(),cu(),du()}function du(){if(5!==kc)return!1;var e=Rc,t=Lc;Lc=0;var n=Ce(Mc),r=P.T,s=M.p;try{M.p=32>n?32:n,P.T=null,n=Bc,Bc=null;var o=Rc,a=Mc;if(kc=0,Pc=Rc=null,Mc=0,6&oc)throw Error(i(331));var l=oc;if(oc|=4,tc(o.current),Vl(o,o.current,a,n),oc=l,Cu(0,!1),le&&"function"==typeof le.onPostCommitFiberRoot)try{le.onPostCommitFiberRoot(ae,o)}catch(c){}return!0}finally{M.p=s,P.T=r,uu(e,t)}}function fu(e,t,n){t=wi(n,t),null!==(e=is(e,t=Ea(e.stateNode,t,2),2))&&(xe(e,2),Tu(e))}function pu(e,t,n){if(3===e.tag)fu(e,e,n);else for(;null!==t;){if(3===t.tag){fu(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Ic||!Ic.has(i))){e=wi(n,e),null!==(i=is(t,n=wa(2),2))&&(xa(n,i,t,e),xe(i,2),Tu(i));break}}t=t.return}}function gu(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new sc;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(pc=!0,r.add(n),e=mu.bind(null,e,t,n),t.then(e,e))}function mu(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,ac===e&&(cc&n)===n&&(4===mc||3===mc&&(62914560&cc)===cc&&300>Z()-Sc?!(2&oc)&&Xc(e,0):_c|=n,Ec===cc&&(Ec=0)),Tu(e)}function yu(e,t){0===t&&(t=Ee()),null!==(e=ki(e,t))&&(xe(e,t),Tu(e))}function vu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),yu(e,n)}function _u(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(i(314))}null!==r&&r.delete(t),yu(e,n)}var bu=null,Eu=null,wu=!1,xu=!1,Au=!1,Su=0;function Tu(e){e!==Eu&&null===e.next&&(null===Eu?bu=Eu=e:Eu=Eu.next=e),xu=!0,wu||(wu=!0,gh(function(){6&oc?q(ee,Iu):ku()}))}function Cu(e,t){if(!Au&&xu){Au=!0;do{for(var n=!1,i=bu;null!==i;){if(0!==e){var r=i.pendingLanes;if(0===r)var s=0;else{var o=i.suspendedLanes,a=i.pingedLanes;s=(1<<31-ue(42|e)+1)-1,s=201326741&(s&=r&~(o&~a))?201326741&s|1:s?2|s:0}0!==s&&(n=!0,Mu(i,s))}else s=cc,!(3&(s=me(i,i===ac?s:0,null!==i.cancelPendingCommit||-1!==i.timeoutHandle)))||ve(i,s)||(n=!0,Mu(i,s));i=i.next}}while(n);Au=!1}}function Iu(){ku()}function ku(){xu=wu=!1;var e=0;0!==Su&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==hh&&(hh=e,!0);return hh=null,!1}()&&(e=Su),Su=0);for(var t=Z(),n=null,i=bu;null!==i;){var r=i.next,s=Ru(i,t);0===s?(i.next=null,null===n?bu=r:n.next=r,null===r&&(Eu=n)):(n=i,(0!==e||3&s)&&(xu=!0)),i=r}Cu(e)}function Ru(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,s=-62914561&e.pendingLanes;0<s;){var o=31-ue(s),a=1<<o,l=r[o];-1===l?0!==(a&n)&&0===(a&i)||(r[o]=_e(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}if(n=cc,n=me(e,e===(t=ac)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),i=e.callbackNode,0===n||e===t&&(2===uc||9===uc)||null!==e.cancelPendingCommit)return null!==i&&null!==i&&K(i),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||ve(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==i&&K(i),Ce(n)){case 2:case 8:n=te;break;case 32:default:n=ne;break;case 268435456:n=re}return i=Pu.bind(null,e),n=q(n,i),e.callbackPriority=t,e.callbackNode=n,t}return null!==i&&null!==i&&K(i),e.callbackPriority=2,e.callbackNode=null,2}function Pu(e,t){if(0!==kc&&5!==kc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(hu()&&e.callbackNode!==n)return null;var i=cc;return 0===(i=me(e,e===ac?i:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Gc(e,i,t),Ru(e,Z()),null!=e.callbackNode&&e.callbackNode===n?Pu.bind(null,e):null)}function Mu(e,t){if(hu())return null;Gc(e,t,!0)}function Lu(){return 0===Su&&(Su=be()),Su}function Bu(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Ct(""+e)}function Nu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Ou=0;Ou<_i.length;Ou++){var Du=_i[Ou];bi(Du.toLowerCase(),"on"+(Du[0].toUpperCase()+Du.slice(1)))}bi(hi,"onAnimationEnd"),bi(di,"onAnimationIteration"),bi(fi,"onAnimationStart"),bi("dblclick","onDoubleClick"),bi("focusin","onFocus"),bi("focusout","onBlur"),bi(pi,"onTransitionRun"),bi(gi,"onTransitionStart"),bi(mi,"onTransitionCancel"),bi(yi,"onTransitionEnd"),Xe("onMouseEnter",["mouseout","mouseover"]),Xe("onMouseLeave",["mouseout","mouseover"]),Xe("onPointerEnter",["pointerout","pointerover"]),Xe("onPointerLeave",["pointerout","pointerover"]),$e("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$e("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$e("onBeforeInput",["compositionend","keypress","textInput","paste"]),$e("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$e("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$e("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Uu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Fu));function zu(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;s=a,r.currentTarget=c;try{s(r)}catch(u){ga(u)}r.currentTarget=null,s=l}else for(o=0;o<i.length;o++){if(l=(a=i[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;s=a,r.currentTarget=c;try{s(r)}catch(u){ga(u)}r.currentTarget=null,s=l}}}}function Gu(e,t){var n=t[Le];void 0===n&&(n=t[Le]=new Set);var i=e+"__bubble";n.has(i)||(Wu(t,e,2,!1),n.add(i))}function Vu(e,t,n){var i=0;t&&(i|=4),Wu(n,e,i,t)}var Hu="_reactListening"+Math.random().toString(36).slice(2);function ju(e){if(!e[Hu]){e[Hu]=!0,je.forEach(function(t){"selectionchange"!==t&&(Uu.has(t)||Vu(t,!1,e),Vu(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Hu]||(t[Hu]=!0,Vu("selectionchange",!1,t))}}function Wu(e,t,n,i){switch(fd(t)){case 2:var r=ad;break;case 8:r=ld;break;default:r=cd}n=r.bind(null,t,n,e),r=void 0,!Dt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function $u(e,t,n,i,r){var o=i;if(!(1&t||2&t||null===i))e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var l=i.stateNode.containerInfo;if(l===r)break;if(4===a)for(a=i.return;null!==a;){var c=a.tag;if((3===c||4===c)&&a.stateNode.containerInfo===r)return;a=a.return}for(;null!==l;){if(null===(a=Ue(l)))return;if(5===(c=a.tag)||6===c||26===c||27===c){i=o=a;continue e}l=l.parentNode}}i=i.return}Bt(function(){var i=o,r=kt(n),a=[];e:{var l=vi.get(e);if(void 0!==l){var c=Jt,u=e;switch(e){case"keypress":if(0===Ht(n))break e;case"keydown":case"keyup":c=fn;break;case"focusin":u="focus",c=rn;break;case"focusout":u="blur",c=rn;break;case"beforeblur":case"afterblur":c=rn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=tn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=nn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=gn;break;case hi:case di:case fi:c=sn;break;case yi:c=mn;break;case"scroll":case"scrollend":c=Qt;break;case"wheel":c=yn;break;case"copy":case"cut":case"paste":c=on;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=pn;break;case"toggle":case"beforetoggle":c=vn}var h=!!(4&t),d=!h&&("scroll"===e||"scrollend"===e),f=h?null!==l?l+"Capture":null:l;h=[];for(var p,g=i;null!==g;){var m=g;if(p=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===p||null===f||null!=(m=Nt(g,f))&&h.push(Xu(g,m,p)),d)break;g=g.return}0<h.length&&(l=new c(l,u,null,n,r),a.push({event:l,listeners:h}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||n===It||!(u=n.relatedTarget||n.fromElement)||!Ue(u)&&!u[Me])&&(c||l)&&(l=r.window===r?r:(l=r.ownerDocument)?l.defaultView||l.parentWindow:window,c?(c=i,null!==(u=(u=n.relatedTarget||n.toElement)?Ue(u):null)&&(d=s(u),h=u.tag,u!==d||5!==h&&27!==h&&6!==h)&&(u=null)):(c=null,u=i),c!==u)){if(h=tn,m="onMouseLeave",f="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(h=pn,m="onPointerLeave",f="onPointerEnter",g="pointer"),d=null==c?l:Ge(c),p=null==u?l:Ge(u),(l=new h(m,g+"leave",c,n,r)).target=d,l.relatedTarget=p,m=null,Ue(r)===i&&((h=new h(f,g+"enter",u,n,r)).target=p,h.relatedTarget=d,m=h),d=m,c&&u)e:{for(f=u,g=0,p=h=c;p;p=Ku(p))g++;for(p=0,m=f;m;m=Ku(m))p++;for(;0<g-p;)h=Ku(h),g--;for(;0<p-g;)f=Ku(f),p--;for(;g--;){if(h===f||null!==f&&h===f.alternate)break e;h=Ku(h),f=Ku(f)}h=null}else h=null;null!==c&&Yu(a,l,c,h,!1),null!==u&&null!==d&&Yu(a,d,u,h,!0)}if("select"===(c=(l=i?Ge(i):window).nodeName&&l.nodeName.toLowerCase())||"input"===c&&"file"===l.type)var y=On;else if(Rn(l))if(Dn)y=$n;else{y=jn;var v=Hn}else!(c=l.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?i&&At(i.elementType)&&(y=On):y=Wn;switch(y&&(y=y(e,i))?Pn(a,y,n,r):(v&&v(e,l,i),"focusout"===e&&i&&"number"===l.type&&null!=i.memoizedProps.value&&mt(l,"number",l.value)),v=i?Ge(i):window,e){case"focusin":(Rn(v)||"true"===v.contentEditable)&&(ti=v,ni=i,ii=null);break;case"focusout":ii=ni=ti=null;break;case"mousedown":ri=!0;break;case"contextmenu":case"mouseup":case"dragend":ri=!1,si(a,n,r);break;case"selectionchange":if(ei)break;case"keydown":case"keyup":si(a,n,r)}var _;if(bn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else In?Tn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(xn&&"ko"!==n.locale&&(In||"onCompositionStart"!==b?"onCompositionEnd"===b&&In&&(_=Vt()):(zt="value"in(Ut=r)?Ut.value:Ut.textContent,In=!0)),0<(v=qu(i,b)).length&&(b=new an(b,e,null,n,r),a.push({event:b,listeners:v}),_?b.data=_:null!==(_=Cn(n))&&(b.data=_))),(_=wn?function(e,t){switch(e){case"compositionend":return Cn(t);case"keypress":return 32!==t.which?null:(Sn=!0,An);case"textInput":return(e=t.data)===An&&Sn?null:e;default:return null}}(e,n):function(e,t){if(In)return"compositionend"===e||!bn&&Tn(e,t)?(e=Vt(),Gt=zt=Ut=null,In=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return xn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(b=qu(i,"onBeforeInput")).length&&(v=new an("onBeforeInput","beforeinput",null,n,r),a.push({event:v,listeners:b}),v.data=_)),function(e,t,n,i,r){if("submit"===t&&n&&n.stateNode===r){var s=Bu((r[Pe]||null).action),o=i.submitter;o&&null!==(t=(t=o[Pe]||null)?Bu(t.formAction):o.getAttribute("formAction"))&&(s=t,o=null);var a=new Jt("action","action",null,i,r);e.push({event:a,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==Su){var e=o?Nu(r,o):new FormData(r);ko(n,{pending:!0,data:e,method:r.method,action:s},null,e)}}else"function"==typeof s&&(a.preventDefault(),e=o?Nu(r,o):new FormData(r),ko(n,{pending:!0,data:e,method:r.method,action:s},s,e))},currentTarget:r}]})}}(a,e,i,n,r)}zu(a,t)})}function Xu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qu(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,s=r.stateNode;if(5!==(r=r.tag)&&26!==r&&27!==r||null===s||(null!=(r=Nt(e,n))&&i.unshift(Xu(e,r,s)),null!=(r=Nt(e,t))&&i.push(Xu(e,r,s))),3===e.tag)return i;e=e.return}return[]}function Ku(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Yu(e,t,n,i,r){for(var s=t._reactName,o=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===i)break;5!==a&&26!==a&&27!==a||null===c||(l=c,r?null!=(c=Nt(n,s))&&o.unshift(Xu(n,c,l)):r||null!=(c=Nt(n,s))&&o.push(Xu(n,c,l))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Ju=/\r\n?/g,Zu=/\u0000|\uFFFD/g;function Qu(e){return("string"==typeof e?e:""+e).replace(Ju,"\n").replace(Zu,"")}function eh(e,t){return t=Qu(t),Qu(e)===t}function th(){}function nh(e,t,n,r,s,o){switch(n){case"children":"string"==typeof r?"body"===t||"textarea"===t&&""===r||bt(e,r):("number"==typeof r||"bigint"==typeof r)&&"body"!==t&&bt(e,""+r);break;case"className":et(e,"class",r);break;case"tabIndex":et(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":et(e,n,r);break;case"style":xt(e,r,o);break;case"data":if("object"!==t){et(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=Ct(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"==typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof o&&("formAction"===n?("input"!==t&&nh(e,t,"name",s.name,s,null),nh(e,t,"formEncType",s.formEncType,s,null),nh(e,t,"formMethod",s.formMethod,s,null),nh(e,t,"formTarget",s.formTarget,s,null)):(nh(e,t,"encType",s.encType,s,null),nh(e,t,"method",s.method,s,null),nh(e,t,"target",s.target,s,null))),null==r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=Ct(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=th);break;case"onScroll":null!=r&&Gu("scroll",e);break;case"onScrollEnd":null!=r&&Gu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=s.children)throw Error(i(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"muted":e.muted=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"==typeof r||"boolean"==typeof r||"symbol"==typeof r){e.removeAttribute("xlink:href");break}n=Ct(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"==typeof r||"symbol"==typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Gu("beforetoggle",e),Gu("toggle",e),Qe(e,"popover",r);break;case"xlinkActuate":tt(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":tt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":tt(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":tt(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":tt(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":tt(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":tt(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":tt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":tt(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":Qe(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&Qe(e,n=St.get(n)||n,r)}}function ih(e,t,n,r,s,o){switch(n){case"style":xt(e,r,o);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(i(61));if(null!=(n=r.__html)){if(null!=s.children)throw Error(i(60));e.innerHTML=n}}break;case"children":"string"==typeof r?bt(e,r):("number"==typeof r||"bigint"==typeof r)&&bt(e,""+r);break;case"onScroll":null!=r&&Gu("scroll",e);break;case"onScrollEnd":null!=r&&Gu("scrollend",e);break;case"onClick":null!=r&&(e.onclick=th);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:We.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(s=n.endsWith("Capture"),t=n.slice(2,s?n.length-7:void 0),"function"==typeof(o=null!=(o=e[Pe]||null)?o[n]:null)&&e.removeEventListener(t,o,s),"function"!=typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):Qe(e,n,r):("function"!=typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,s)))}}function rh(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Gu("error",e),Gu("load",e);var r,s=!1,o=!1;for(r in n)if(n.hasOwnProperty(r)){var a=n[r];if(null!=a)switch(r){case"src":s=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:nh(e,t,r,a,n,null)}}return o&&nh(e,t,"srcSet",n.srcSet,n,null),void(s&&nh(e,t,"src",n.src,n,null));case"input":Gu("invalid",e);var l=r=a=o=null,c=null,u=null;for(s in n)if(n.hasOwnProperty(s)){var h=n[s];if(null!=h)switch(s){case"name":o=h;break;case"type":a=h;break;case"checked":c=h;break;case"defaultChecked":u=h;break;case"value":r=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(i(137,t));break;default:nh(e,t,s,h,n,null)}}return gt(e,r,l,c,u,a,o,!1),void ct(e);case"select":for(o in Gu("invalid",e),s=a=r=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":r=l;break;case"defaultValue":a=l;break;case"multiple":s=l;default:nh(e,t,o,l,n,null)}return t=r,n=a,e.multiple=!!s,void(null!=t?yt(e,!!s,t,!1):null!=n&&yt(e,!!s,n,!0));case"textarea":for(a in Gu("invalid",e),r=o=s=null,n)if(n.hasOwnProperty(a)&&null!=(l=n[a]))switch(a){case"value":s=l;break;case"defaultValue":o=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(i(91));break;default:nh(e,t,a,l,n,null)}return _t(e,s,o,r),void ct(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(s=n[c]))if("selected"===c)e.selected=s&&"function"!=typeof s&&"symbol"!=typeof s;else nh(e,t,c,s,n,null);return;case"dialog":Gu("beforetoggle",e),Gu("toggle",e),Gu("cancel",e),Gu("close",e);break;case"iframe":case"object":Gu("load",e);break;case"video":case"audio":for(s=0;s<Fu.length;s++)Gu(Fu[s],e);break;case"image":Gu("error",e),Gu("load",e);break;case"details":Gu("toggle",e);break;case"embed":case"source":case"link":Gu("error",e),Gu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(s=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,t));default:nh(e,t,u,s,n,null)}return;default:if(At(t)){for(h in n)n.hasOwnProperty(h)&&(void 0!==(s=n[h])&&ih(e,t,h,s,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(s=n[l])&&nh(e,t,l,s,n,null))}var sh=null,oh=null;function ah(e){return 9===e.nodeType?e:e.ownerDocument}function lh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ch(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function uh(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var hh=null;var dh="function"==typeof setTimeout?setTimeout:void 0,fh="function"==typeof clearTimeout?clearTimeout:void 0,ph="function"==typeof Promise?Promise:void 0,gh="function"==typeof queueMicrotask?queueMicrotask:void 0!==ph?function(e){return ph.resolve(null).then(e).catch(mh)}:dh;function mh(e){setTimeout(function(){throw e})}function yh(e){return"head"===e}function vh(e,t){var n=t,i=0,r=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0<i&&8>i){n=i;var o=e.ownerDocument;if(1&n&&Sh(o.documentElement),2&n&&Sh(o.body),4&n)for(Sh(n=o.head),o=n.firstChild;o;){var a=o.nextSibling,l=o.nodeName;o[De]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=a}}if(0===r)return e.removeChild(s),void Pd(t);r--}else"$"===n||"$?"===n||"$!"===n?r++:i=n.charCodeAt(0)-48;else i=0;n=s}while(n);Pd(t)}function _h(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":_h(n),Fe(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function bh(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function Eh(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var wh=null;function xh(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function Ah(e,t,n){switch(t=ah(n),e){case"html":if(!(e=t.documentElement))throw Error(i(452));return e;case"head":if(!(e=t.head))throw Error(i(453));return e;case"body":if(!(e=t.body))throw Error(i(454));return e;default:throw Error(i(451))}}function Sh(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Fe(e)}var Th=new Map,Ch=new Set;function Ih(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var kh=M.d;M.d={f:function(){var e=kh.f(),t=Wc();return e||t},r:function(e){var t=ze(e);null!==t&&5===t.tag&&"form"===t.type?Po(t):kh.r(e)},D:function(e){kh.D(e),Ph("dns-prefetch",e,null)},C:function(e,t){kh.C(e,t),Ph("preconnect",e,t)},L:function(e,t,n){kh.L(e,t,n);var i=Rh;if(i&&e&&t){var r='link[rel="preload"][as="'+ft(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+ft(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(r+='[imagesizes="'+ft(n.imageSizes)+'"]')):r+='[href="'+ft(e)+'"]';var s=r;switch(t){case"style":s=Lh(e);break;case"script":s=Oh(e)}Th.has(s)||(e=c({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Th.set(s,e),null!==i.querySelector(r)||"style"===t&&i.querySelector(Bh(s))||"script"===t&&i.querySelector(Dh(s))||(rh(t=i.createElement("link"),"link",e),He(t),i.head.appendChild(t)))}},m:function(e,t){kh.m(e,t);var n=Rh;if(n&&e){var i=t&&"string"==typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+ft(i)+'"][href="'+ft(e)+'"]',s=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=Oh(e)}if(!Th.has(s)&&(e=c({rel:"modulepreload",href:e},t),Th.set(s,e),null===n.querySelector(r))){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Dh(s)))return}rh(i=n.createElement("link"),"link",e),He(i),n.head.appendChild(i)}}},X:function(e,t){kh.X(e,t);var n=Rh;if(n&&e){var i=Ve(n).hoistableScripts,r=Oh(e),s=i.get(r);s||((s=n.querySelector(Dh(r)))||(e=c({src:e,async:!0},t),(t=Th.get(r))&&Gh(e,t),He(s=n.createElement("script")),rh(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}},S:function(e,t,n){kh.S(e,t,n);var i=Rh;if(i&&e){var r=Ve(i).hoistableStyles,s=Lh(e);t=t||"default";var o=r.get(s);if(!o){var a={loading:0,preload:null};if(o=i.querySelector(Bh(s)))a.loading=5;else{e=c({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Th.get(s))&&zh(e,n);var l=o=i.createElement("link");He(l),rh(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){a.loading|=1}),l.addEventListener("error",function(){a.loading|=2}),a.loading|=4,Uh(o,t,i)}o={type:"stylesheet",instance:o,count:1,state:a},r.set(s,o)}}},M:function(e,t){kh.M(e,t);var n=Rh;if(n&&e){var i=Ve(n).hoistableScripts,r=Oh(e),s=i.get(r);s||((s=n.querySelector(Dh(r)))||(e=c({src:e,async:!0,type:"module"},t),(t=Th.get(r))&&Gh(e,t),He(s=n.createElement("script")),rh(s,"link",e),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}}};var Rh="undefined"==typeof document?null:document;function Ph(e,t,n){var i=Rh;if(i&&"string"==typeof t&&t){var r=ft(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"==typeof n&&(r+='[crossorigin="'+n+'"]'),Ch.has(r)||(Ch.add(r),e={rel:e,crossOrigin:n,href:t},null===i.querySelector(r)&&(rh(t=i.createElement("link"),"link",e),He(t),i.head.appendChild(t)))}}function Mh(e,t,n,r){var s,o,a,l,c=(c=G.current)?Ih(c):null;if(!c)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=Lh(n.href),(r=(n=Ve(c).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=Lh(n.href);var u=Ve(c).hoistableStyles,h=u.get(e);if(h||(c=c.ownerDocument||c,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,h),(u=c.querySelector(Bh(e)))&&!u._p&&(h.instance=u,h.state.loading=5),Th.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Th.set(e,n),u||(s=c,o=e,a=n,l=h.state,s.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=s.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),rh(o,"link",a),He(o),s.head.appendChild(o))))),t&&null===r)throw Error(i(528,""));return h}if(t&&null!==r)throw Error(i(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Oh(n),(r=(n=Ve(c).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Lh(e){return'href="'+ft(e)+'"'}function Bh(e){return'link[rel="stylesheet"]['+e+"]"}function Nh(e){return c({},e,{"data-precedence":e.precedence,precedence:null})}function Oh(e){return'[src="'+ft(e)+'"]'}function Dh(e){return"script[async]"+e}function Fh(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+ft(n.href)+'"]');if(r)return t.instance=r,He(r),r;var s=c({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return He(r=(e.ownerDocument||e).createElement("style")),rh(r,"style",s),Uh(r,n.precedence,e),t.instance=r;case"stylesheet":s=Lh(n.href);var o=e.querySelector(Bh(s));if(o)return t.state.loading|=4,t.instance=o,He(o),o;r=Nh(n),(s=Th.get(s))&&zh(r,s),He(o=(e.ownerDocument||e).createElement("link"));var a=o;return a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),rh(o,"link",r),t.state.loading|=4,Uh(o,n.precedence,e),t.instance=o;case"script":return o=Oh(n.src),(s=e.querySelector(Dh(o)))?(t.instance=s,He(s),s):(r=n,(s=Th.get(o))&&Gh(r=c({},n),s),He(s=(e=e.ownerDocument||e).createElement("script")),rh(s,"link",r),e.head.appendChild(s),t.instance=s);case"void":return null;default:throw Error(i(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Uh(r,n.precedence,e));return t.instance}function Uh(e,t,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,s=r,o=0;o<i.length;o++){var a=i[o];if(a.dataset.precedence===t)s=a;else if(s!==r)break}s?s.parentNode.insertBefore(e,s.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function zh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Gh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Vh=null;function Hh(e,t,n){if(null===Vh){var i=new Map,r=Vh=new Map;r.set(n,i)}else(i=(r=Vh).get(n))||(i=new Map,r.set(n,i));if(i.has(e))return i;for(i.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var s=n[r];if(!(s[De]||s[Re]||"link"===e&&"stylesheet"===s.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==s.namespaceURI){var o=s.getAttribute(t)||"";o=e+o;var a=i.get(o);a?a.push(s):i.set(o,[s])}}return i}function jh(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Wh(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var $h=null;function Xh(){}function qh(){if(this.count--,0===this.count)if(this.stylesheets)Yh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Kh=null;function Yh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Kh=new Map,t.forEach(Jh,e),Kh=null,qh.call(e))}function Jh(e,t){if(!(4&t.state.loading)){var n=Kh.get(e);if(n)var i=n.get(null);else{n=new Map,Kh.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<r.length;s++){var o=r[s];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),i=o)}i&&n.set(null,i)}o=(r=t.instance).getAttribute("data-precedence"),(s=n.get(o)||i)===i&&n.set(null,r),n.set(o,r),this.count++,i=qh.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),s?s.parentNode.insertBefore(r,s.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var Zh={$$typeof:v,Provider:null,Consumer:null,_currentValue:L,_currentValue2:L,_threadCount:0};function Qh(e,t,n,i,r,s,o,a){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=we(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=we(0),this.hiddenUpdates=we(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=s,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function ed(e,t,n,i,r,s,o,a,l,c,u,h){return e=new Qh(e,t,n,o,a,l,c,h),t=1,!0===s&&(t|=24),s=Bi(3,null,null,t),e.current=s,s.stateNode=e,(t=Pr()).refCount++,e.pooledCache=t,t.refCount++,s.memoizedState={element:i,isDehydrated:n,cache:t},es(s),e}function td(e){return e?e=Mi:Mi}function nd(e,t,n,i,r,s){r=td(r),null===i.context?i.context=r:i.pendingContext=r,(i=ns(t)).payload={element:n},null!==(s=void 0===s?null:s)&&(i.callback=s),null!==(n=is(e,i,t))&&(zc(n,0,t),rs(n,e,t))}function id(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function rd(e,t){id(e,t),(e=e.alternate)&&id(e,t)}function sd(e){if(13===e.tag){var t=ki(e,67108864);null!==t&&zc(t,0,67108864),rd(e,67108864)}}var od=!0;function ad(e,t,n,i){var r=P.T;P.T=null;var s=M.p;try{M.p=2,cd(e,t,n,i)}finally{M.p=s,P.T=r}}function ld(e,t,n,i){var r=P.T;P.T=null;var s=M.p;try{M.p=8,cd(e,t,n,i)}finally{M.p=s,P.T=r}}function cd(e,t,n,i){if(od){var r=ud(i);if(null===r)$u(e,t,i,hd,n),wd(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return gd=xd(gd,e,t,n,i,r),!0;case"dragenter":return md=xd(md,e,t,n,i,r),!0;case"mouseover":return yd=xd(yd,e,t,n,i,r),!0;case"pointerover":var s=r.pointerId;return vd.set(s,xd(vd.get(s)||null,e,t,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,_d.set(s,xd(_d.get(s)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(wd(e,i),4&t&&-1<Ed.indexOf(e)){for(;null!==r;){var s=ze(r);if(null!==s)switch(s.tag){case 3:if((s=s.stateNode).current.memoizedState.isDehydrated){var o=ge(s.pendingLanes);if(0!==o){var a=s;for(a.pendingLanes|=2,a.entangledLanes|=2;o;){var l=1<<31-ue(o);a.entanglements[1]|=l,o&=~l}Tu(s),!(6&oc)&&(Tc=Z()+500,Cu(0))}}break;case 13:null!==(a=ki(s,2))&&zc(a,0,2),Wc(),rd(s,2)}if(null===(s=ud(i))&&$u(e,t,i,hd,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else $u(e,t,i,null,n)}}function ud(e){return dd(e=kt(e))}var hd=null;function dd(e){if(hd=null,null!==(e=Ue(e))){var t=s(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=o(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return hd=e,null}function fd(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Q()){case ee:return 2;case te:return 8;case ne:case ie:return 32;case re:return 268435456;default:return 32}default:return 32}}var pd=!1,gd=null,md=null,yd=null,vd=new Map,_d=new Map,bd=[],Ed="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function wd(e,t){switch(e){case"focusin":case"focusout":gd=null;break;case"dragenter":case"dragleave":md=null;break;case"mouseover":case"mouseout":yd=null;break;case"pointerover":case"pointerout":vd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":_d.delete(t.pointerId)}}function xd(e,t,n,i,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=ze(t))&&sd(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ad(e){var t=Ue(e.target);if(null!==t){var n=s(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=o(n)))return e.blockedOn=t,void function(e,t){var n=M.p;try{return M.p=e,t()}finally{M.p=n}}(e.priority,function(){if(13===n.tag){var e=Fc();e=Te(e);var t=ki(n,e);null!==t&&zc(t,0,e),rd(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Sd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=ud(e.nativeEvent);if(null!==n)return null!==(t=ze(n))&&sd(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);It=i,n.target.dispatchEvent(i),It=null,t.shift()}return!0}function Td(e,t,n){Sd(e)&&n.delete(t)}function Cd(){pd=!1,null!==gd&&Sd(gd)&&(gd=null),null!==md&&Sd(md)&&(md=null),null!==yd&&Sd(yd)&&(yd=null),vd.forEach(Td),_d.forEach(Td)}function Id(t,n){t.blockedOn===n&&(t.blockedOn=null,pd||(pd=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Cd)))}var kd=null;function Rd(t){kd!==t&&(kd=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){kd===t&&(kd=null);for(var e=0;e<t.length;e+=3){var n=t[e],i=t[e+1],r=t[e+2];if("function"!=typeof i){if(null===dd(i||n))continue;break}var s=ze(n);null!==s&&(t.splice(e,3),e-=3,ko(s,{pending:!0,data:r,method:n.method,action:i},i,r))}}))}function Pd(e){function t(t){return Id(t,e)}null!==gd&&Id(gd,e),null!==md&&Id(md,e),null!==yd&&Id(yd,e),vd.forEach(t),_d.forEach(t);for(var n=0;n<bd.length;n++){var i=bd[n];i.blockedOn===e&&(i.blockedOn=null)}for(;0<bd.length&&null===(n=bd[0]).blockedOn;)Ad(n),null===n.blockedOn&&bd.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(i=0;i<n.length;i+=3){var r=n[i],s=n[i+1],o=r[Pe]||null;if("function"==typeof s)o||Rd(n);else if(o){var a=null;if(s&&s.hasAttribute("formAction")){if(r=s,o=s[Pe]||null)a=o.formAction;else if(null!==dd(r))continue}else a=o.action;"function"==typeof a?n[i+1]=a:(n.splice(i,3),i-=3),Rd(n)}}}function Md(e){this._internalRoot=e}function Ld(e){this._internalRoot=e}Ld.prototype.render=Md.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));nd(t.current,Fc(),e,t,null,null)},Ld.prototype.unmount=Md.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;nd(e.current,2,null,e,null,null),Wc(),t[Me]=null}},Ld.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ie();e={blockedOn:null,target:e,priority:t};for(var n=0;n<bd.length&&0!==t&&t<bd[n].priority;n++);bd.splice(n,0,e),0===n&&Ad(e)}};var Bd=t.version;if("19.1.1"!==Bd)throw Error(i(527,Bd,"19.1.1"));M.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=s(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var l=o.alternate;if(null===l){if(null!==(r=o.return)){n=r;continue}break}if(o.child===l.child){for(l=o.child;l;){if(l===n)return a(o),e;if(l===r)return a(o),t;l=l.sibling}throw Error(i(188))}if(n.return!==r.return)n=o,r=l;else{for(var c=!1,u=o.child;u;){if(u===n){c=!0,n=o,r=l;break}if(u===r){c=!0,r=o,n=l;break}u=u.sibling}if(!c){for(u=l.child;u;){if(u===n){c=!0,n=l,r=o;break}if(u===r){c=!0,r=l,n=o;break}u=u.sibling}if(!c)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?l(e):null)?null:e.stateNode};var Nd={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.1"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Od=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Od.isDisabled&&Od.supportsFiber)try{ae=Od.inject(Nd),le=Od}catch(Dd){}}return zl.createRoot=function(e,t){if(!r(e))throw Error(i(299));var n=!1,s="",o=ma,a=ya,l=va;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(s=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=ed(e,1,!1,null,0,n,s,o,a,l,0,null),e[Me]=t.current,ju(e),new Md(t)},zl.hydrateRoot=function(e,t,n){if(!r(e))throw Error(i(299));var s=!1,o="",a=ma,l=ya,c=va,u=null;return null!=n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=ed(e,1,!0,t,0,s,o,a,l,c,0,u)).context=td(null),n=t.current,(o=ns(s=Te(s=Fc()))).callback=null,is(n,o,s),n=s,t.current.lanes=n,xe(t,n),Tu(t),e[Me]=t.current,ju(e),new Ld(t)},zl.version="19.1.1",zl}var Zl=(Xl||(Xl=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),Ul.exports=Jl()),Ul.exports);const Ql=he(Zl);function ec(e){return e.map(e=>`${e.lat} ${e.lng}`).join(" ")}async function tc(e,t){var n;if(e.length<3)throw new Error("Polygon must have at least 3 points");const i=ec(e),r=`\n    [out:json][timeout:15];\n    (\n      way["highway"](poly:"${i}");\n      node["traffic_calming"](poly:"${i}");\n    );\n    (._;>;);\n    out body;\n  `;try{const{fetchOverpassPOSTWithFallback:e}=await s(async()=>{const{fetchOverpassPOSTWithFallback:e}=await import("./overpassHelper-D95OiS8Z.js");return{fetchOverpassPOSTWithFallback:e}},[]),i=await e(r,{timeout:20,maxRetries:2,retryDelay:3e3,signal:t}),o={};for(const t of i.elements)"node"===t.type&&(o[t.id]={lat:t.lat,lon:t.lon});const a=[],l=[];for(const t of i.elements)if("way"===t.type)a.push({id:t.id,nodes:(t.nodes||[]).map(e=>o[e]).filter(Boolean),tags:t.tags||{}});else if("node"===t.type&&(null==(n=t.tags)?void 0:n.traffic_calming)){const e=String(t.tags.traffic_calming);["hump","table","chicane","cushion","rumble_strip","island"].includes(e)&&l.push({id:t.id,lat:t.lat,lon:t.lon,kind:e})}return{ways:a,calming:l}}catch(o){if(o instanceof Error)throw"AbortError"===o.name?new Error("OSM-Abfrage wurde abgebrochen"):o.message.includes("Failed to fetch")?new Error("Netzwerkfehler - berprfen Sie Ihre Internetverbindung"):o;throw new Error("Unbekannter Fehler beim Laden der OSM-Daten")}}const nc=new class{constructor(){this.cache=new Map,this.TTL=6e5}getKey(e,t){const n=JSON.stringify(e.map(e=>[e.lat,e.lng]));return`${this.simpleHash(n)}_${t}`}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return Math.abs(t).toString(36)}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>this.TTL?(this.cache.delete(e),null):t.data:null}set(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clear(){this.cache.clear()}},ic=Object.freeze(Object.defineProperty({__proto__:null,fetchOsmBundleForPolygon:tc,osmCache:nc,polygonToOverpassPoly:ec},Symbol.toStringTag,{value:"Module"}));function rc(e){if(!e)return;const t=e.trim().toLowerCase();if("walk"===t)return 7;if("none"===t)return;const n=t.includes("mph"),i=parseFloat(t);return isFinite(i)?n?Math.round(1.60934*i):i:void 0}function sc(e,t){const n=(()=>{switch((e||"").toLowerCase()){case"asphalt":case"concrete":case"concrete:lanes":case"concrete:plates":return.75;case"paving_stones":case"sett":case"cobblestone":case"compacted":return.55;case"gravel":return.45;case"fine_gravel":return.48;case"dirt":case"earth":case"ground":return.35;case"grass":return.3;case"sand":return.25;default:return}})();if(n){if(t){const e=t.toLowerCase();if(e.includes("good")||e.includes("excellent"))return Math.min(.85,n+.02);if(e.includes("bad")||e.includes("horrible"))return Math.max(.2,n-.05)}return n}}function oc(e){switch(e){case"dry":return 1;case"wet":return.75;case"snow":return.3;case"ice":return.15}}function ac(e){switch(e){case"hump":case"table":case"island":return 40;case"chicane":return 35;case"cushion":case"rumble_strip":return 45;default:return}}function lc(e,t){const n=(t.lat-e.lat)*Math.PI/180,i=(t.lng-e.lng)*Math.PI/180,r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e.lat*Math.PI/180)*Math.cos(t.lat*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function cc(e,t,n){const i=e.lat-t.lat,r=e.lng-t.lng,s=n.lat-t.lat,o=n.lng-t.lng,a=i*s+r*o,l=s*s+o*o;if(0===l)return{lat:t.lat,lng:t.lng,distance:lc(e,t)};const c=a/l;let u;return u=c<0?t:c>1?n:{lat:t.lat+c*s,lng:t.lng+c*o},{...u,distance:lc(e,u)}}class uc{constructor(e){this.osmData=null,this.nodeIndex=new Map,this.config=e}setOsmData(e){this.osmData=e,this.nodeIndex.clear(),(null==e?void 0:e.nodes)&&e.nodes.forEach(e=>this.nodeIndex.set(e.id,e))}updateConfig(e){this.config={...this.config,...e}}getConstraintsAt(e){if(!this.osmData)return{};const t={};return this.config.useMaxspeed&&(t.maxspeedCap=this.findMaxspeedAt(e)),this.config.useTrafficCalming&&(t.calmingCap=this.findCalmingCapAt(e)),this.config.useSurface&&(t.frictionMu=this.findFrictionAt(e)),t}findMaxspeedAt(e){var t;if(!this.osmData)return;let n,i=1/0;for(const r of this.osmData.ways){if(!(null==(t=r.tags)?void 0:t.maxspeed))continue;const s=r.tags;this.forEachWaySegment(r,(t,r)=>{const o=cc(e,t,r);if(o.distance<15&&o.distance<i){const e=rc(String(s.maxspeed));void 0!==e&&(n=e,i=o.distance)}})}return n}findCalmingCapAt(e){if(!this.osmData)return;let t;for(const n of this.osmData.calming||[]){if(lc(e,{lat:n.lat,lng:n.lon})<=25){const e=ac(n.kind);void 0!==e&&(t=void 0===t?e:Math.min(t,e))}}return t}findFrictionAt(e){var t;if(!this.osmData)return;let n,i=1/0;for(const r of this.osmData.ways){if(!(null==(t=r.tags)?void 0:t.surface))continue;const s=r.tags;this.forEachWaySegment(r,(t,r)=>{const o=cc(e,t,r);if(o.distance<15&&o.distance<i){const e=sc(String(s.surface),s.smoothness?String(s.smoothness):void 0);void 0!==e&&(n=e*oc(this.config.weather),i=o.distance)}})}return n}forEachWaySegment(e,t){if(e.nodeIds&&!(e.nodeIds.length<2))for(let n=0;n<e.nodeIds.length-1;n++){const i=this.nodeIndex.get(e.nodeIds[n]),r=this.nodeIndex.get(e.nodeIds[n+1]);i&&r&&t({lat:i.lat,lng:i.lon},{lat:r.lat,lng:r.lon})}}applyConstraints(e,t,n){let i=e;if(void 0!==t.maxspeedCap&&(i=Math.min(i,t.maxspeedCap)),void 0!==t.calmingCap&&(i=Math.min(i,t.calmingCap)),void 0!==t.frictionMu&&void 0!==n&&n>0){const e=9.81,r=3.6*Math.sqrt(t.frictionMu*e*.95*n);i=Math.min(i,r)}return i}getFrictionLimitedAcceleration(e,t=0){if(!e.frictionMu)return;const n=9.81*e.frictionMu,i=Math.min(1,Math.abs(t)/n);return n*Math.sqrt(1-i*i)}}var hc=6371008.8,dc={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*hc,kilometers:6371.0088,kilometres:6371.0088,meters:hc,metres:hc,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:hc/1852,radians:1,yards:6967335.223679999};function fc(e,t,n={}){const i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function pc(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_c(e[0])||!_c(e[1]))throw new Error("coordinates must contain numbers");return fc({type:"Point",coordinates:e},t,n)}function gc(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return fc({type:"LineString",coordinates:e},t,n)}function mc(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function yc(e,t="kilometers"){const n=dc[t];if(!n)throw new Error(t+" units is invalid");return e*n}function vc(e){return e%360*Math.PI/180}function _c(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function bc(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ec(e,t,n={}){var i=bc(e),r=bc(t),s=vc(r[1]-i[1]),o=vc(r[0]-i[0]),a=vc(i[1]),l=vc(r[1]),c=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(a)*Math.cos(l);return yc(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}var wc=Ec;const xc=134217729;function Ac(e,t,n,i,r){let s,o,a,l,c=t[0],u=i[0],h=0,d=0;u>c==u>-c?(s=c,c=t[++h]):(s=u,u=i[++d]);let f=0;if(h<e&&d<n)for(u>c==u>-c?(o=c+s,a=s-(o-c),c=t[++h]):(o=u+s,a=s-(o-u),u=i[++d]),s=o,0!==a&&(r[f++]=a);h<e&&d<n;)u>c==u>-c?(o=s+c,l=o-s,a=s-(o-l)+(c-l),c=t[++h]):(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=i[++d]),s=o,0!==a&&(r[f++]=a);for(;h<e;)o=s+c,l=o-s,a=s-(o-l)+(c-l),c=t[++h],s=o,0!==a&&(r[f++]=a);for(;d<n;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=i[++d],s=o,0!==a&&(r[f++]=a);return 0===s&&0!==f||(r[f++]=s),f}function Sc(e){return new Float64Array(e)}const Tc=Sc(4),Cc=Sc(8),Ic=Sc(12),kc=Sc(16),Rc=Sc(4);function Pc(e,t,n,i,r,s){const o=(t-s)*(n-r),a=(e-r)*(i-s),l=o-a,c=Math.abs(o+a);return Math.abs(l)>=33306690738754716e-32*c?l:-function(e,t,n,i,r,s,o){let a,l,c,u,h,d,f,p,g,m,y,v,_,b,E,w,x,A;const S=e-r,T=n-r,C=t-s,I=i-s;b=S*I,d=xc*S,f=d-(d-S),p=S-f,d=xc*I,g=d-(d-I),m=I-g,E=p*m-(b-f*g-p*g-f*m),w=C*T,d=xc*C,f=d-(d-C),p=C-f,d=xc*T,g=d-(d-T),m=T-g,x=p*m-(w-f*g-p*g-f*m),y=E-x,h=E-y,Tc[0]=E-(y+h)+(h-x),v=b+y,h=v-b,_=b-(v-h)+(y-h),y=_-w,h=_-y,Tc[1]=_-(y+h)+(h-w),A=v+y,h=A-v,Tc[2]=v-(A-h)+(y-h),Tc[3]=A;let k=function(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}(4,Tc),R=22204460492503146e-32*o;if(k>=R||-k>=R)return k;if(h=e-S,a=e-(S+h)+(h-r),h=n-T,c=n-(T+h)+(h-r),h=t-C,l=t-(C+h)+(h-s),h=i-I,u=i-(I+h)+(h-s),0===a&&0===l&&0===c&&0===u)return k;if(R=11093356479670487e-47*o+33306690738754706e-32*Math.abs(k),k+=S*u+I*a-(C*c+T*l),k>=R||-k>=R)return k;b=a*I,d=xc*a,f=d-(d-a),p=a-f,d=xc*I,g=d-(d-I),m=I-g,E=p*m-(b-f*g-p*g-f*m),w=l*T,d=xc*l,f=d-(d-l),p=l-f,d=xc*T,g=d-(d-T),m=T-g,x=p*m-(w-f*g-p*g-f*m),y=E-x,h=E-y,Rc[0]=E-(y+h)+(h-x),v=b+y,h=v-b,_=b-(v-h)+(y-h),y=_-w,h=_-y,Rc[1]=_-(y+h)+(h-w),A=v+y,h=A-v,Rc[2]=v-(A-h)+(y-h),Rc[3]=A;const P=Ac(4,Tc,4,Rc,Cc);b=S*u,d=xc*S,f=d-(d-S),p=S-f,d=xc*u,g=d-(d-u),m=u-g,E=p*m-(b-f*g-p*g-f*m),w=C*c,d=xc*C,f=d-(d-C),p=C-f,d=xc*c,g=d-(d-c),m=c-g,x=p*m-(w-f*g-p*g-f*m),y=E-x,h=E-y,Rc[0]=E-(y+h)+(h-x),v=b+y,h=v-b,_=b-(v-h)+(y-h),y=_-w,h=_-y,Rc[1]=_-(y+h)+(h-w),A=v+y,h=A-v,Rc[2]=v-(A-h)+(y-h),Rc[3]=A;const M=Ac(P,Cc,4,Rc,Ic);b=a*u,d=xc*a,f=d-(d-a),p=a-f,d=xc*u,g=d-(d-u),m=u-g,E=p*m-(b-f*g-p*g-f*m),w=l*c,d=xc*l,f=d-(d-l),p=l-f,d=xc*c,g=d-(d-c),m=c-g,x=p*m-(w-f*g-p*g-f*m),y=E-x,h=E-y,Rc[0]=E-(y+h)+(h-x),v=b+y,h=v-b,_=b-(v-h)+(y-h),y=_-w,h=_-y,Rc[1]=_-(y+h)+(h-w),A=v+y,h=A-v,Rc[2]=v-(A-h)+(y-h),Rc[3]=A;const L=Ac(M,Ic,4,Rc,kc);return kc[L-1]}(e,t,n,i,r,s,c)}function Mc(e,t){var n,i,r,s,o,a,l,c,u,h=0,d=e[0],f=e[1],p=t.length;for(n=0;n<p;n++){i=0;var g=t[n],m=g.length-1;if((c=g[0])[0]!==g[m][0]&&c[1]!==g[m][1])throw new Error("First and last coordinates in a ring must be the same");for(s=c[0]-d,o=c[1]-f;i<m;i++){if(a=(u=g[i+1])[0]-d,l=u[1]-f,0===o&&0===l){if(a<=0&&s>=0||s<=0&&a>=0)return 0}else if(l>=0&&o<=0||l<=0&&o>=0){if(0===(r=Pc(s,a,o,l,0,0)))return 0;(r>0&&l>0&&o<=0||r<0&&l<=0&&o>0)&&h++}c=u,o=l,s=a}}return h%2!=0}var Lc=function(e,t,n={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const i=bc(e),r="Feature"===(s=t).type?s.geometry:s;var s;const o=r.type,a=t.bbox;let l=r.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(i,a))return!1;"Polygon"===o&&(l=[l]);let c=!1;for(var u=0;u<l.length;++u){const e=Mc(i,l[u]);if(0===e)return!n.ignoreBoundary;e&&(c=!0)}return c};class Bc{constructor(e=[],t=Nc){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,s=t[r];if(n(i,s)>=0)break;t[e]=s,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1),s=t[i];const o=i+1;if(o<this.length&&n(t[o],s)<0&&(i=o,s=t[o]),n(s,r)>=0)break;t[e]=s,e=i}t[e]=r}}function Nc(e,t){return e<t?-1:e>t?1:0}function Oc(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function Dc(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}let Fc=class{constructor(e,t,n,i){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=n,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}};let Uc=0,zc=0,Gc=0;function Vc(e,t){const n="Feature"===e.type?e.geometry:e;let i=n.coordinates;"Polygon"!==n.type&&"MultiLineString"!==n.type||(i=[i]),"LineString"===n.type&&(i=[[i]]);for(let r=0;r<i.length;r++)for(let e=0;e<i[r].length;e++){let n=i[r][e][0],s=null;zc+=1;for(let o=0;o<i[r][e].length-1;o++){s=i[r][e][o+1];const a=new Fc(n,Uc,zc,Gc),l=new Fc(s,Uc,zc,Gc+1);a.otherEvent=l,l.otherEvent=a,Oc(a,l)>0?(l.isLeftEndpoint=!0,a.isLeftEndpoint=!1):(a.isLeftEndpoint=!0,l.isLeftEndpoint=!1),t.push(a),t.push(l),n=s,Gc+=1}}Uc+=1}class Hc{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function jc(e,t){if(null===e||null===t)return!1;if(e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const n=e.leftSweepEvent.p.x,i=e.leftSweepEvent.p.y,r=e.rightSweepEvent.p.x,s=e.rightSweepEvent.p.y,o=t.leftSweepEvent.p.x,a=t.leftSweepEvent.p.y,l=t.rightSweepEvent.p.x,c=t.rightSweepEvent.p.y,u=(c-a)*(r-n)-(l-o)*(s-i),h=(l-o)*(i-a)-(c-a)*(n-o),d=(r-n)*(i-a)-(s-i)*(n-o);if(0===u)return!1;const f=h/u,p=d/u;if(f>=0&&f<=1&&p>=0&&p<=1){return[n+f*(r-n),i+f*(s-i)]}return!1}var Wc=function(e,t){const n=new Bc([],Oc);return function(e,t){if("FeatureCollection"===e.type){const n=e.features;for(let e=0;e<n.length;e++)Vc(n[e],t)}else Vc(e,t)}(e,n),function(e,t){t=t||!1;const n=[],i=new Bc([],Dc);for(;e.length;){const r=e.pop();if(r.isLeftEndpoint){const e=new Hc(r);for(let s=0;s<i.data.length;s++){const o=i.data[s];if(t&&o.leftSweepEvent.featureId===r.featureId)continue;const a=jc(e,o);!1!==a&&n.push(a)}i.push(e)}else!1===r.isLeftEndpoint&&i.pop()}return n}(n,t)};var $c=function(e,t,n={}){const{removeDuplicates:i=!0,ignoreSelfIntersections:r=!0}=n;let s=[];"FeatureCollection"===e.type?s=s.concat(e.features):"Feature"===e.type?s.push(e):"LineString"!==e.type&&"Polygon"!==e.type&&"MultiLineString"!==e.type&&"MultiPolygon"!==e.type||s.push(fc(e)),"FeatureCollection"===t.type?s=s.concat(t.features):"Feature"===t.type?s.push(t):"LineString"!==t.type&&"Polygon"!==t.type&&"MultiLineString"!==t.type&&"MultiPolygon"!==t.type||s.push(fc(t));const o=Wc(mc(s),r);let a=[];if(i){const e={};o.forEach(t=>{const n=t.join(",");e[n]||(e[n]=!0,a.push(t))})}else a=o;return mc(a.map(e=>pc(e)))};function Xc(e,t,n){if(null!==e)for(var i,r,s,o,a,l,c,u,h=0,d=0,f=e.type,p="FeatureCollection"===f,g="Feature"===f,m=p?e.features.length:1,y=0;y<m;y++){a=(u=!!(c=p?e.features[y].geometry:g?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<a;v++){var _=0,b=0;if(null!==(o=u?c.geometries[v]:c)){l=o.coordinates;var E=o.type;switch(h=0,E){case null:break;case"Point":if(!1===t(l,d,y,_,b))return!1;d++,_++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(!1===t(l[i],d,y,_,b))return!1;d++,"MultiPoint"===E&&_++}"LineString"===E&&_++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(r=0;r<l[i].length-h;r++){if(!1===t(l[i][r],d,y,_,b))return!1;d++}"MultiLineString"===E&&_++,"Polygon"===E&&b++}"Polygon"===E&&_++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(b=0,r=0;r<l[i].length;r++){for(s=0;s<l[i][r].length-h;s++){if(!1===t(l[i][r][s],d,y,_,b))return!1;d++}b++}_++}break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(!1===Xc(o.geometries[i],t))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function qc(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function Kc(e,t){var n,i,r,s,o,a,l,c,u,h,d=0,f="FeatureCollection"===e.type,p="Feature"===e.type,g=f?e.features.length:1;for(n=0;n<g;n++){for(a=f?e.features[n].geometry:p?e.geometry:e,c=f?e.features[n].properties:p?e.properties:{},u=f?e.features[n].bbox:p?e.bbox:void 0,h=f?e.features[n].id:p?e.id:void 0,o=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<o;r++)if(null!==(s=l?a.geometries[r]:a))switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(s,d,c,u,h))return!1;break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===t(s.geometries[i],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}function Yc(e,t){!function(e,t){Kc(e,function(e,n,i,r,s){var o,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==t(fc(e,i,{bbox:r,id:s}),n,0)&&void 0}switch(a){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var l=0;l<e.coordinates.length;l++){var c=e.coordinates[l];if(!1===t(fc({type:o,coordinates:c},i),n,l))return!1}})}(e,function(e,n,i){var r=0;if(e.geometry){var s=e.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var o,a=0,l=0,c=0;return!1!==Xc(e,function(s,u,h,d,f){if(void 0===o||n>a||d>l||f>c)return o=s,a=n,l=d,c=f,void(r=0);var p=gc([o,s],e.properties);if(!1===t(p,n,i,f,r))return!1;r++,o=s})&&void 0}}})}function Jc(e,t={}){const n=function(e,t={}){if(null!=e.bbox&&!0!==t.recompute)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return Xc(e,e=>{n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),n[2]<e[0]&&(n[2]=e[0]),n[3]<e[1]&&(n[3]=e[1])}),n}(e);return pc([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}var Zc,Qc={exports:{}};var eu=(Zc||(Zc=1,Qc.exports=function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function t(e,t,n){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,n||[],l(e).constructor):t.apply(e,n))}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){if(u())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var r=new(e.bind.apply(e,i));return n&&h(r,n.prototype),r}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function s(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=g(e))||t){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},a.apply(null,arguments)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(u=function(){return!!e})()}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t,n,i){var r=a(l(1&i?e.prototype:e),t,n);return 2&i&&"function"==typeof r?function(e){return r.apply(n,e)}:r}function f(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function g(t,n){if(t){if("string"==typeof t)return e(t,n);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}function m(e){var t="function"==typeof Map?new Map:void 0;return m=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return i(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),h(n,e)},m(e)}var y=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=e.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=e.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==e.JOIN_ROUND&&(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(e){this._joinStyle=e}},{key:"setSimplifyFactor",value:function(e){this._simplifyFactor=e<0?0:e}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(e){this._endCapStyle=e}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(e){this._mitreLimit=e}},{key:"setSingleSided",value:function(e){this._isSingleSided=e}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(s),this.setJoinStyle(o),this.setMitreLimit(a)}}},{key:"bufferDistanceError",value:function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)}}])}();y.CAP_ROUND=1,y.CAP_FLAT=2,y.CAP_SQUARE=3,y.JOIN_ROUND=1,y.JOIN_MITRE=2,y.JOIN_BEVEL=3,y.DEFAULT_QUADRANT_SEGMENTS=8,y.DEFAULT_MITRE_LIMIT=5,y.DEFAULT_SIMPLIFY_FACTOR=.01;var v=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({Exception:i})[0],r}return c(i,e),s(i,[{key:"toString",value:function(){return this.message}}])}(m(Error)),_=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({IllegalArgumentException:i})[0],r}return c(i,e),s(i)}(v),b=s(function e(){n(this,e)},[{key:"filter",value:function(e){}}]);function E(){}function w(){}function x(){}var A,S,T,C,I,k,R,P,M=s(function e(){n(this,e)},null,[{key:"equalsWithTolerance",value:function(e,t,n){return Math.abs(e-t)<=n}}]),L=s(function e(t,i){n(this,e),this.low=i||0,this.high=t||0},null,[{key:"toBinaryString",value:function(e){var t,n="";for(t=2147483648;t>0;t>>>=1)n+=(e.high&t)===t?"1":"0";for(t=2147483648;t>0;t>>>=1)n+=(e.low&t)===t?"1":"0";return n}}]);function B(){}function N(){}B.NaN=NaN,B.isNaN=function(e){return Number.isNaN(e)},B.isInfinite=function(e){return!Number.isFinite(e)},B.MAX_VALUE=Number.MAX_VALUE,B.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,B.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,"function"==typeof Float64Array&&"function"==typeof Int32Array?(k=2146435072,R=new Float64Array(1),P=new Int32Array(R.buffer),B.doubleToLongBits=function(e){R[0]=e;var t=0|P[0],n=0|P[1];return(n&k)===k&&1048575&n&&0!==t&&(t=0,n=2146959360),new L(n,t)},B.longBitsToDouble=function(e){return P[0]=e.low,P[1]=e.high,R[0]}):(A=1023,S=Math.log2,T=Math.floor,C=Math.pow,I=function(){for(var e=53;e>0;e--){var t=C(2,e)-1;if(T(S(t))+1===e)return t}return 0}(),B.doubleToLongBits=function(e){var t,n,i,r,s,o,a,l,c;if(e<0||1/e===Number.NEGATIVE_INFINITY?(o=1<<31,e=-e):o=0,0===e)return new L(l=o,c=0);if(e===1/0)return new L(l=2146435072|o,c=0);if(e!=e)return new L(l=2146959360,c=0);if(r=0,c=0,(t=T(e))>1)if(t<=I)(r=T(S(t)))<=20?(c=0,l=t<<20-r&1048575):(c=t%(n=C(2,i=r-20))<<32-i,l=t/n&1048575);else for(i=t,c=0;0!==(i=T(n=i/2));)r++,c>>>=1,c|=(1&l)<<31,l>>>=1,n!==i&&(l|=524288);if(a=r+A,s=0===t,t=e-t,r<52&&0!==t)for(i=0;;){if((n=2*t)>=1?(t=n-1,s?(a--,s=!1):(i<<=1,i|=1,r++)):(t=n,s?0==--a&&(r++,s=!1):(i<<=1,r++)),20===r)l|=i,i=0;else if(52===r){c|=i;break}if(1===n){r<20?l|=i<<20-r:r<52&&(c|=i<<52-r);break}}return l|=a<<20,new L(l|=o,c)},B.longBitsToDouble=function(e){var t,n,i,r,s=e.high,o=e.low,a=s&1<<31?-1:1;for(i=((2146435072&s)>>20)-A,r=0,n=1<<19,t=1;t<=20;t++)s&n&&(r+=C(2,-t)),n>>>=1;for(n=1<<31,t=21;t<=52;t++)o&n&&(r+=C(2,-t)),n>>>=1;if(-1023===i){if(0===r)return 0*a;i=-1022}else{if(1024===i)return 0===r?a/0:NaN;r+=1}return a*r*C(2,i)});var O=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({RuntimeException:i})[0],r}return c(i,e),s(i)}(v),D=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,null,[{key:"constructor_",value:function(){if(0===arguments.length)O.constructor_.call(this);else if(1===arguments.length){var e=arguments[0];O.constructor_.call(this,e)}}}])}(O),F=function(){function e(){n(this,e)}return s(e,null,[{key:"shouldNeverReachHere",value:function(){if(0===arguments.length)e.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new D("Should never reach here"+(null!==t?": "+t:""))}}},{key:"isTrue",value:function(){if(1===arguments.length){var t=arguments[0];e.isTrue(t,null)}else if(2===arguments.length){var n=arguments[1];if(!arguments[0])throw null===n?new D:new D(n)}}},{key:"equals",value:function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];e.equals(t,n,null)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];if(!r.equals(i))throw new D("Expected "+i+" but encountered "+r+(null!==s?": "+s:""))}}}])}(),U=new ArrayBuffer(8),z=new Float64Array(U),G=new Int32Array(U),V=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getM",value:function(){return B.NaN}},{key:"setOrdinate",value:function(t,n){switch(t){case e.X:this.x=n;break;case e.Y:this.y=n;break;case e.Z:this.setZ(n);break;default:throw new _("Invalid ordinate index: "+t)}}},{key:"equals2D",value:function(){if(1===arguments.length){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!M.equalsWithTolerance(this.x,t.x,n)&&!!M.equalsWithTolerance(this.y,t.y,n)}}},{key:"setM",value:function(t){throw new _("Invalid ordinate index: "+e.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(t){switch(t){case e.X:return this.x;case e.Y:return this.y;case e.Z:return this.getZ()}throw new _("Invalid ordinate index: "+t)}},{key:"equals3D",value:function(e){return this.x===e.x&&this.y===e.y&&(this.getZ()===e.getZ()||B.isNaN(this.getZ())&&B.isNaN(e.getZ()))}},{key:"equals",value:function(t){return t instanceof e&&this.equals2D(t)}},{key:"equalInZ",value:function(e,t){return M.equalsWithTolerance(this.getZ(),e.getZ(),t)}},{key:"setX",value:function(e){this.x=e}},{key:"compareTo",value:function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(e){this.z=e}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return F.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw e}}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.getZ()-e.getZ();return Math.sqrt(t*t+n*n+i*i)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(e){this.y=e}},{key:"distance",value:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}},{key:"hashCode",value:function(){var t=17;return 37*(t=37*t+e.hashCode(this.x))+e.hashCode(this.y)}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ()}},{key:"interfaces_",get:function(){return[E,w,x]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)e.constructor_.call(this,0,0);else if(1===arguments.length){var t=arguments[0];e.constructor_.call(this,t.x,t.y,t.getZ())}else if(2===arguments.length){var n=arguments[0],i=arguments[1];e.constructor_.call(this,n,i,e.NULL_ORDINATE)}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this.x=r,this.y=s,this.z=o}}},{key:"hashCode",value:function(e){return z[0]=e,G[0]^G[1]}}])}(),H=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"compare",value:function(t,n){var i=e.compare(t.x,n.x);if(0!==i)return i;var r=e.compare(t.y,n.y);return 0!==r?r:this._dimensionsToTest<=2?0:e.compare(t.getZ(),n.getZ())}},{key:"interfaces_",get:function(){return[N]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,0===arguments.length)e.constructor_.call(this,2);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new _("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}},{key:"compare",value:function(e,t){return e<t?-1:e>t?1:B.isNaN(e)?B.isNaN(t)?0:-1:B.isNaN(t)?1:0}}])}();V.DimensionalComparator=H,V.NULL_ORDINATE=B.NaN,V.X=0,V.Y=1,V.Z=2,V.M=3;var j=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.isNull()?n.isNull():this._maxx===n.getMaxX()&&this._maxy===n.getMaxY()&&this._minx===n.getMinX()&&this._miny===n.getMinY()}},{key:"intersection",value:function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new e;var n=this._minx>t._minx?this._minx:t._minx,i=this._miny>t._miny?this._miny:t._miny;return new e(n,this._maxx<t._maxx?this._maxx:t._maxx,i,this._maxy<t._maxy?this._maxy:t._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(1===arguments.length){if(arguments[0]instanceof V){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof e){var n=arguments[0];return!this.isNull()&&!n.isNull()&&n.getMinX()>=this._minx&&n.getMaxX()<=this._maxx&&n.getMinY()>=this._miny&&n.getMaxY()<=this._maxy}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&i>=this._minx&&i<=this._maxx&&r>=this._miny&&r<=this._maxy}}},{key:"intersects",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof V){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(2===arguments.length){if(arguments[0]instanceof V&&arguments[1]instanceof V){var i=arguments[0],r=arguments[1];return!(this.isNull()||(i.x<r.x?i.x:r.x)>this._maxx||(i.x>r.x?i.x:r.x)<this._minx||(i.y<r.y?i.y:r.y)>this._maxy||(i.y>r.y?i.y:r.y)<this._miny)}if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var s=arguments[0],o=arguments[1];return!this.isNull()&&!(s>this._maxx||s<this._minx||o>this._maxy||o<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return Math.sqrt(e*e+t*t)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(1===arguments.length){if(arguments[0]instanceof V){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this._minx=n.getMinX(),this._maxx=n.getMaxX(),this._miny=n.getMinY(),this._maxy=n.getMaxY()):(n._minx<this._minx&&(this._minx=n._minx),n._maxx>this._maxx&&(this._maxx=n._maxx),n._miny<this._miny&&(this._miny=n._miny),n._maxy>this._maxy&&(this._maxy=n._maxy))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=r,this._maxy=r):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0}},{key:"translate",value:function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)}},{key:"copy",value:function(){return new e(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(e){return!(!this.isNull()&&!e.isNull())||e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t}},{key:"expandBy",value:function(){if(1===arguments.length){var e=arguments[0];this.expandBy(e,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof V){var n=arguments[0];return this.covers(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.covers(i,r)}}},{key:"centre",value:function(){return this.isNull()?null:new V((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof V){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this._minx=n._minx,this._maxx=n._maxx,this._miny=n._miny,this._maxy=n._maxy}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var s=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];s<o?(this._minx=s,this._maxx=o):(this._minx=o,this._maxx=s),a<l?(this._miny=a,this._maxy=l):(this._miny=l,this._maxy=a)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),0===t?n:0===n?t:Math.sqrt(t*t+n*n)}},{key:"hashCode",value:function(){var e=17;return 37*(e=37*(e=37*(e=37*e+V.hashCode(this._minx))+V.hashCode(this._maxx))+V.hashCode(this._miny))+V.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[E,x]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof V){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var s=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];this.init(s,o,a,l)}}},{key:"intersects",value:function(){if(3===arguments.length){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3],a=Math.min(s.x,o.x),l=Math.max(s.x,o.x),c=Math.min(i.x,r.x),u=Math.max(i.x,r.x);return!(c>l||u<a||(a=Math.min(s.y,o.y),l=Math.max(s.y,o.y),c=Math.min(i.y,r.y),u=Math.max(i.y,r.y),c>l||u<a))}}}])}(),W=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(e){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(e){return this===e||this.equalsExact(e,0)}},{key:"geometryChanged",value:function(){this.apply(e.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(e){return null!==e&&this.norm().equalsExact(e.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var e;if(1===arguments.length){var t=arguments[0];return e=t,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return e=n,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(n,i)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(t){if(t.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION)throw new _("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(e,t,n){return 0===n?e.equals(t):e.distance(t)<=n}},{key:"norm",value:function(){var e=this.copy();return e.normalize(),e}},{key:"reverse",value:function(){var e=this.reverseInternal();return null!=this.envelope&&(e.envelope=this.envelope.copy()),e.setSRID(this.getSRID()),e}},{key:"copy",value:function(){var e=this.copyInternal();return e.envelope=null==this._envelope?null:this._envelope.copy(),e._SRID=this._SRID,e._userData=this._userData,e}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new j(this._envelope)}},{key:"setSRID",value:function(e){this._SRID=e}},{key:"setUserData",value:function(e){this._userData=e}},{key:"compare",value:function(e,t){for(var n=e.iterator(),i=t.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),s=i.next(),o=r.compareTo(s);if(0!==o)return o}return n.hasNext()?1:i.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(e){return this.getClass()===e.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===e.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===e.TYPECODE_MULTIPOINT||this.getTypeCode()===e.TYPECODE_MULTILINESTRING||this.getTypeCode()===e.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[w,E,x]}},{key:"getClass",value:function(){return e}}],[{key:"hasNonEmptyElements",value:function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(e){for(var t=0;t<e.length;t++)if(null===e[t])return!0;return!1}}])}();W.constructor_=function(e){e&&(this._envelope=null,this._userData=null,this._factory=e,this._SRID=e.getSRID())},W.TYPECODE_POINT=0,W.TYPECODE_MULTIPOINT=1,W.TYPECODE_LINESTRING=2,W.TYPECODE_LINEARRING=3,W.TYPECODE_MULTILINESTRING=4,W.TYPECODE_POLYGON=5,W.TYPECODE_MULTIPOLYGON=6,W.TYPECODE_GEOMETRYCOLLECTION=7,W.TYPENAME_POINT="Point",W.TYPENAME_MULTIPOINT="MultiPoint",W.TYPENAME_LINESTRING="LineString",W.TYPENAME_LINEARRING="LinearRing",W.TYPENAME_MULTILINESTRING="MultiLineString",W.TYPENAME_POLYGON="Polygon",W.TYPENAME_MULTIPOLYGON="MultiPolygon",W.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",W.geometryChangedFilter={get interfaces_(){return[b]},filter:function(e){e.geometryChangedAction()}};var $=function(){function e(){n(this,e)}return s(e,null,[{key:"toLocationSymbol",value:function(t){switch(t){case e.EXTERIOR:return"e";case e.BOUNDARY:return"b";case e.INTERIOR:return"i";case e.NONE:return"-"}throw new _("Unknown location value: "+t)}}])}();$.INTERIOR=0,$.BOUNDARY=1,$.EXTERIOR=2,$.NONE=-1;var X=s(function e(){n(this,e)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),q=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({NoSuchElementException:i})[0],r}return c(i,e),s(i)}(v),K=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({UnsupportedOperationException:i})[0],r}return c(i,e),s(i)}(v),Y=function(e){function i(){return n(this,i),t(this,i,arguments)}return c(i,e),s(i,[{key:"contains",value:function(){}}])}(X),J=function(e){function i(e){var r;return n(this,i),(r=t(this,i)).map=new Map,e instanceof X&&r.addAll(e),r}return c(i,e),s(i,[{key:"contains",value:function(e){var t=e.hashCode?e.hashCode():e;return!!this.map.has(t)}},{key:"add",value:function(e){var t=e.hashCode?e.hashCode():e;return!this.map.has(t)&&!!this.map.set(t,e)}},{key:"addAll",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.add(i)}}catch(r){n.e(r)}finally{n.f()}return!0}},{key:"remove",value:function(){throw new K}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return 0===this.map.size}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Z(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(Y),Z=s(function e(t){n(this,e),this.iterator=t.values();var i=this.iterator.next(),r=i.done,s=i.value;this.done=r,this.value=s},[{key:"next",value:function(){if(this.done)throw new q;var e=this.value,t=this.iterator.next(),n=t.done,i=t.value;return this.done=n,this.value=i,e}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new K}}]),Q=function(){function e(){n(this,e)}return s(e,null,[{key:"opposite",value:function(t){return t===e.LEFT?e.RIGHT:t===e.RIGHT?e.LEFT:t}}])}();Q.ON=0,Q.LEFT=1,Q.RIGHT=2;var ee=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({EmptyStackException:i})[0],r}return c(i,e),s(i)}(v),te=function(e){function i(e){var r;return n(this,i),(r=t(this,i,[e])).name=Object.keys({IndexOutOfBoundsException:i})[0],r}return c(i,e),s(i)}(v),ne=function(e){function i(){return n(this,i),t(this,i,arguments)}return c(i,e),s(i,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(X),ie=function(e){function i(){var e;return n(this,i),(e=t(this,i)).array=[],e}return c(i,e),s(i,[{key:"add",value:function(e){return this.array.push(e),!0}},{key:"get",value:function(e){if(e<0||e>=this.size())throw new te;return this.array[e]}},{key:"push",value:function(e){return this.array.push(e),e}},{key:"pop",value:function(){if(0===this.array.length)throw new ee;return this.array.pop()}},{key:"peek",value:function(){if(0===this.array.length)throw new ee;return this.array[this.array.length-1]}},{key:"empty",value:function(){return 0===this.array.length}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(e){return this.array.indexOf(e)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(ne);function re(e,t){return e.interfaces_&&e.interfaces_.indexOf(t)>-1}var se=s(function e(t){n(this,e),this.str=t},[{key:"append",value:function(e){this.str+=e}},{key:"setCharAt",value:function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)}},{key:"toString",value:function(){return this.str}}]),oe=function(){function e(t){n(this,e),this.value=t}return s(e,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(e){return this.value<e?-1:this.value>e?1:0}}],[{key:"compare",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"isNan",value:function(e){return Number.isNaN(e)}},{key:"valueOf",value:function(t){return new e(t)}}])}(),ae=s(function e(){n(this,e)},null,[{key:"isWhitespace",value:function(e){return e<=32&&e>=0||127===e}},{key:"toUpperCase",value:function(e){return e.toUpperCase()}}]),le=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"le",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<=e._lo}},{key:"extractSignificantDigits",value:function(t,n){var i=this.abs(),r=e.magnitude(i._hi),s=e.TEN.pow(r);(i=i.divide(s)).gt(e.TEN)?(i=i.divide(e.TEN),r+=1):i.lt(e.ONE)&&(i=i.multiply(e.TEN),r-=1);for(var o=r+1,a=new se,l=e.MAX_PRINT_DIGITS-1,c=0;c<=l;c++){t&&c===o&&a.append(".");var u=Math.trunc(i._hi);if(u<0)break;var h=!1,d=0;u>9?(h=!0,d="9"):d="0"+u,a.append(d),i=i.subtract(e.valueOf(u)).multiply(e.TEN),h&&i.selfAdd(e.TEN);var f=!0,p=e.magnitude(i._hi);if(p<0&&Math.abs(p)>=l-c&&(f=!1),!f)break}return n[0]=r,a.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var n=arguments[0];return this.add(-n)}}},{key:"equals",value:function(){if(1===arguments.length&&arguments[0]instanceof e){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}}},{key:"isZero",value:function(){return 0===this._hi&&0===this._lo}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(e){return this.le(e)?this:e}},{key:"selfDivide",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.selfDivide(n,0)}}else if(2===arguments.length){var i,r,s,o,a=arguments[0],l=arguments[1],c=null,u=null,h=null,d=null;return s=this._hi/a,d=(c=(h=e.SPLIT*s)-(c=h-s))*(u=(d=e.SPLIT*a)-(u=d-a))-(o=s*a)+c*(r=a-u)+(i=s-c)*u+i*r,d=s+(h=(this._hi-o-d+this._lo-s*l)/a),this._hi=d,this._lo=s-d+h,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof e){var t,n,i,r,s=arguments[0],o=null,a=null,l=null,c=null;return t=(i=this._hi/s._hi)-(o=(l=e.SPLIT*i)-(o=l-i)),c=o*(a=(c=e.SPLIT*s._hi)-(a=c-s._hi))-(r=i*s._hi)+o*(n=s._hi-a)+t*a+t*n,new e(c=i+(l=(this._hi-r-c+this._lo-i*s._lo)/s._hi),i-c+l)}if("number"==typeof arguments[0]){var u=arguments[0];return B.isNaN(u)?e.createNaN():e.copy(this).selfDivide(u,0)}}},{key:"ge",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>=e._lo}},{key:"pow",value:function(t){if(0===t)return e.valueOf(1);var n=new e(this),i=e.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&i.selfMultiply(n),(r/=2)>0&&(n=n.sqr());else i=n;return t<0?i.reciprocal():i}},{key:"ceil",value:function(){if(this.isNaN())return e.NaN;var t=Math.ceil(this._hi),n=0;return t===this._hi&&(n=Math.ceil(this._lo)),new e(t,n)}},{key:"compareTo",value:function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var n=arguments[0];return this.init(n),this}}},{key:"max",value:function(e){return this.ge(e)?this:e}},{key:"sqrt",value:function(){if(this.isZero())return e.valueOf(0);if(this.isNegative())return e.NaN;var t=1/Math.sqrt(this._hi),n=this._hi*t,i=e.valueOf(n),r=this.subtract(i.sqr())._hi*(.5*t);return i.add(r)}},{key:"selfAdd",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var n,i,r,s,o,a=arguments[0],l=null;return l=(r=this._hi+a)-(s=r-this._hi),i=(o=(l=a-s+(this._hi-l))+this._lo)+(r-(n=r+o)),this._hi=n+i,this._lo=i+(n-this._hi),this}}else if(2===arguments.length){var c,u,h,d,f=arguments[0],p=arguments[1],g=null,m=null,y=null;h=this._hi+f,u=this._lo+p,m=h-(y=h-this._hi),g=u-(d=u-this._lo);var v=(c=h+(y=(m=f-y+(this._hi-m))+u))+(y=(g=p-d+(this._lo-g))+(y+(h-c))),_=y+(c-v);return this._hi=v,this._lo=_,this}}},{key:"selfMultiply",value:function(){if(1===arguments.length){if(arguments[0]instanceof e){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var n=arguments[0];return this.selfMultiply(n,0)}}else if(2===arguments.length){var i,r,s=arguments[0],o=arguments[1],a=null,l=null,c=null,u=null;a=(c=e.SPLIT*this._hi)-this._hi,u=e.SPLIT*s,a=c-a,i=this._hi-a,l=u-s;var h=(c=this._hi*s)+(u=a*(l=u-l)-c+a*(r=s-l)+i*l+i*r+(this._hi*o+this._lo*s)),d=u+(a=c-h);return this._hi=h,this._lo=d,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return e.NaN;var t=Math.floor(this._hi),n=0;return t===this._hi&&(n=Math.floor(this._lo)),new e(t,n)}},{key:"negate",value:function(){return this.isNaN()?this:new e(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(e){if(e instanceof CloneNotSupportedException)return null;throw e}}},{key:"multiply",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return t.isNaN()?e.createNaN():e.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var n=arguments[0];return B.isNaN(n)?e.createNaN():e.copy(this).selfMultiply(n,0)}}},{key:"isNaN",value:function(){return B.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var t=e.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var t=this.getSpecialNumberString();if(null!==t)return t;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!0,n),r=n[0]+1,s=i;if("."===i.charAt(0))s="0"+i;else if(r<0)s="0."+e.stringOfChar("0",-r)+i;else if(-1===i.indexOf(".")){var o=r-i.length;s=i+e.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+s:s}},{key:"reciprocal",value:function(){var t,n,i,r,s=null,o=null,a=null,l=null;t=(i=1/this._hi)-(s=(a=e.SPLIT*i)-(s=a-i)),o=(l=e.SPLIT*this._hi)-this._hi;var c=i+(a=(1-(r=i*this._hi)-(l=s*(o=l-o)-r+s*(n=this._hi-o)+t*o+t*n)-i*this._lo)/this._hi);return new e(c,i-c+a)}},{key:"toSciNotation",value:function(){if(this.isZero())return e.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!1,n),r=e.SCI_NOT_EXPONENT_CHAR+n[0];if("0"===i.charAt(0))throw new IllegalStateException("Found leading zero: "+i);var s="";i.length>1&&(s=i.substring(1));var o=i.charAt(0)+"."+s;return this.isNegative()?"-"+o+r:o+r}},{key:"abs",value:function(){return this.isNaN()?e.NaN:this.isNegative()?this.negate():new e(this)}},{key:"isPositive",value:function(){return this._hi>0||0===this._hi&&this._lo>0}},{key:"lt",value:function(e){return this._hi<e._hi||this._hi===e._hi&&this._lo<e._lo}},{key:"add",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return e.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var n=arguments[0];return e.copy(this).selfAdd(n)}}},{key:"init",value:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof e){var n=arguments[0];this._hi=n._hi,this._lo=n._lo}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._hi=i,this._lo=r}}},{key:"gt",value:function(e){return this._hi>e._hi||this._hi===e._hi&&this._lo>e._lo}},{key:"isNegative",value:function(){return this._hi<0||0===this._hi&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?e.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[x,E,w]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var i=arguments[0];e.constructor_.call(this,e.parse(i))}}else if(2===arguments.length){var r=arguments[0],s=arguments[1];this.init(r,s)}}},{key:"determinant",value:function(){if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];return e.determinant(e.valueOf(t),e.valueOf(n),e.valueOf(i),e.valueOf(r))}if(arguments[3]instanceof e&&arguments[2]instanceof e&&arguments[0]instanceof e&&arguments[1]instanceof e){var s=arguments[1],o=arguments[2],a=arguments[3];return arguments[0].multiply(a).selfSubtract(s.multiply(o))}}},{key:"sqr",value:function(t){return e.valueOf(t).selfMultiply(t)}},{key:"valueOf",value:function(){if("string"==typeof arguments[0]){var t=arguments[0];return e.parse(t)}if("number"==typeof arguments[0])return new e(arguments[0])}},{key:"sqrt",value:function(t){return e.valueOf(t).sqrt()}},{key:"parse",value:function(t){for(var n=0,i=t.length;ae.isWhitespace(t.charAt(n));)n++;var r=!1;if(n<i){var s=t.charAt(n);"-"!==s&&"+"!==s||(n++,"-"===s&&(r=!0))}for(var o=new e,a=0,l=0,c=0,u=!1;!(n>=i);){var h=t.charAt(n);if(n++,ae.isDigit(h)){var d=h-"0";o.selfMultiply(e.TEN),o.selfAdd(d),a++}else{if("."!==h){if("e"===h||"E"===h){var f=t.substring(n);try{c=oe.parseInt(f)}catch(v){throw v instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+f+" in string "+t):v}break}throw new NumberFormatException("Unexpected character '"+h+"' at position "+n+" in string "+t)}l=a,u=!0}}var p=o;u||(l=a);var g=a-l-c;if(0===g)p=o;else if(g>0){var m=e.TEN.pow(g);p=o.divide(m)}else if(g<0){var y=e.TEN.pow(-g);p=o.multiply(y)}return r?p.negate():p}},{key:"createNaN",value:function(){return new e(B.NaN,B.NaN)}},{key:"copy",value:function(t){return new e(t)}},{key:"magnitude",value:function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=t&&(i+=1),i}},{key:"stringOfChar",value:function(e,t){for(var n=new se,i=0;i<t;i++)n.append(e);return n.toString()}}])}();le.PI=new le(3.141592653589793,12246467991473532e-32),le.TWO_PI=new le(6.283185307179586,24492935982947064e-32),le.PI_2=new le(1.5707963267948966,6123233995736766e-32),le.E=new le(2.718281828459045,14456468917292502e-32),le.NaN=new le(B.NaN,B.NaN),le.EPS=123259516440783e-46,le.SPLIT=134217729,le.MAX_PRINT_DIGITS=32,le.TEN=le.valueOf(10),le.ONE=le.valueOf(1),le.SCI_NOT_EXPONENT_CHAR="E",le.SCI_NOT_ZERO="0.0E0";var ce=function(){function e(){n(this,e)}return s(e,null,[{key:"orientationIndex",value:function(t,n,i){var r=e.orientationIndexFilter(t,n,i);if(r<=1)return r;var s=le.valueOf(n.x).selfAdd(-t.x),o=le.valueOf(n.y).selfAdd(-t.y),a=le.valueOf(i.x).selfAdd(-n.x),l=le.valueOf(i.y).selfAdd(-n.y);return s.selfMultiply(l).selfSubtract(o.selfMultiply(a)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof le&&arguments[2]instanceof le&&arguments[0]instanceof le&&arguments[1]instanceof le){var e=arguments[1],t=arguments[2],n=arguments[3];return arguments[0].multiply(n).selfSubtract(e.multiply(t)).signum()}if("number"==typeof arguments[3]&&"number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3],a=le.valueOf(i),l=le.valueOf(r),c=le.valueOf(s),u=le.valueOf(o);return a.multiply(u).selfSubtract(l.multiply(c)).signum()}}},{key:"intersection",value:function(e,t,n,i){var r=new le(e.y).selfSubtract(t.y),s=new le(t.x).selfSubtract(e.x),o=new le(e.x).selfMultiply(t.y).selfSubtract(new le(t.x).selfMultiply(e.y)),a=new le(n.y).selfSubtract(i.y),l=new le(i.x).selfSubtract(n.x),c=new le(n.x).selfMultiply(i.y).selfSubtract(new le(i.x).selfMultiply(n.y)),u=s.multiply(c).selfSubtract(l.multiply(o)),h=a.multiply(o).selfSubtract(r.multiply(c)),d=r.multiply(l).selfSubtract(a.multiply(s)),f=u.selfDivide(d).doubleValue(),p=h.selfDivide(d).doubleValue();return B.isNaN(f)||B.isInfinite(f)||B.isNaN(p)||B.isInfinite(p)?null:new V(f,p)}},{key:"orientationIndexFilter",value:function(t,n,i){var r=null,s=(t.x-i.x)*(n.y-i.y),o=(t.y-i.y)*(n.x-i.x),a=s-o;if(s>0){if(o<=0)return e.signum(a);r=s+o}else{if(!(s<0))return e.signum(a);if(o>=0)return e.signum(a);r=-s-o}var l=e.DP_SAFE_EPSILON*r;return a>=l||-a>=l?e.signum(a):2}},{key:"signum",value:function(e){return e>0?1:e<0?-1:0}}])}();ce.DP_SAFE_EPSILON=1e-15;var ue=s(function e(){n(this,e)},[{key:"getM",value:function(e){if(this.hasM()){var t=this.getDimension()-this.getMeasures();return this.getOrdinate(e,t)}return B.NaN}},{key:"setOrdinate",value:function(e,t,n){}},{key:"getZ",value:function(e){return this.hasZ()?this.getOrdinate(e,2):B.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(e,t){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(e){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(e){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(e){}},{key:"copy",value:function(){}},{key:"getY",value:function(e){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[w]}}]);ue.X=0,ue.Y=1,ue.Z=2,ue.M=3;var he=function(){function e(){n(this,e)}return s(e,null,[{key:"index",value:function(e,t,n){return ce.orientationIndex(e,t,n)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var t=arguments[0],n=t.length-1;if(n<3)throw new _("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=t[0],r=0,s=1;s<=n;s++){var o=t[s];o.y>i.y&&(i=o,r=s)}var a=r;do{(a-=1)<0&&(a=n)}while(t[a].equals2D(i)&&a!==r);var l=r;do{l=(l+1)%n}while(t[l].equals2D(i)&&l!==r);var c=t[a],u=t[l];if(c.equals2D(i)||u.equals2D(i)||c.equals2D(u))return!1;var h=e.index(c,i,u);return 0===h?c.x>u.x:h>0}if(re(arguments[0],ue)){var d=arguments[0],f=d.size()-1;if(f<3)throw new _("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=d.getCoordinate(0),g=0,m=1;m<=f;m++){var y=d.getCoordinate(m);y.y>p.y&&(p=y,g=m)}var v=null,b=g;do{(b-=1)<0&&(b=f),v=d.getCoordinate(b)}while(v.equals2D(p)&&b!==g);var E=null,w=g;do{w=(w+1)%f,E=d.getCoordinate(w)}while(E.equals2D(p)&&w!==g);if(v.equals2D(p)||E.equals2D(p)||v.equals2D(E))return!1;var x=e.index(v,p,E);return 0===x?v.x>E.x:x>0}}}])}();he.CLOCKWISE=-1,he.RIGHT=he.CLOCKWISE,he.COUNTERCLOCKWISE=1,he.LEFT=he.COUNTERCLOCKWISE,he.COLLINEAR=0,he.STRAIGHT=he.COLLINEAR;var de=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n}},{key:"findRightmostEdgeAtVertex",value:function(){var e=this._minDe.getEdge().getCoordinates();F.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],i=he.index(this._minCoord,n,t),r=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&i===he.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&i===he.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(e,t){var n=e.getEdge().getCoordinates();if(t<0||t+1>=n.length)return-1;if(n[t].y===n[t+1].y)return-1;var i=Q.LEFT;return n[t].y<n[t+1].y&&(i=Q.RIGHT),i}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(e){for(var t=e.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(null===this._minCoord||t[n].x>this._minCoord.x)&&(this._minDe=e,this._minIndex=n,this._minCoord=t[n])}},{key:"findRightmostEdgeAtNode",value:function(){var e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.isForward()&&this.checkForRightmostCoordinate(n)}F.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Q.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),fe=function(e){function i(e,r){var s;return n(this,i),(s=t(this,i,[r?e+" [ "+r+" ]":e])).pt=r?new V(r):void 0,s.name=Object.keys({TopologyException:i})[0],s}return c(i,e),s(i,[{key:"getCoordinate",value:function(){return this.pt}}])}(O),pe=s(function e(){n(this,e),this.array=[]},[{key:"addLast",value:function(e){this.array.push(e)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return 0===this.array.length}}]),ge=function(e){function i(e){var r;return n(this,i),(r=t(this,i)).array=[],e instanceof X&&r.addAll(e),r}return c(i,e),s(i,[{key:"interfaces_",get:function(){return[ne,X]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(e){return 1===arguments.length?this.array.push(e):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.array.push(i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"set",value:function(e,t){var n=this.array[e];return this.array[e]=t,n}},{key:"iterator",value:function(){return new me(this)}},{key:"get",value:function(e){if(e<0||e>=this.size())throw new te;return this.array[e]}},{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"sort",value:function(e){e?this.array.sort(function(t,n){return e.compare(t,n)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(e){for(var t=0,n=this.array.length;t<n;t++)if(this.array[t]===e)return!!this.array.splice(t,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(ne),me=s(function e(t){n(this,e),this.arrayList=t,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new q;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(e){return this.arrayList.set(this.position-1,e)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),ye=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var e=this._dirEdgeList.iterator();e.hasNext();)e.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(e){for(var t=null,n=e.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){t=i;break}}if(null===t)throw new fe("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(t);for(var r=e.getEdges().iterator();r.hasNext();){var s=r.next();s.setVisited(!0),this.copySymDepths(s)}}},{key:"computeDepth",value:function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.getNode(),t.getLabel(),t.setEdgeDepths(Q.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)}},{key:"create",value:function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(Q.RIGHT)>=1&&t.getDepth(Q.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}}},{key:"computeDepths",value:function(e){var t=new J,n=new pe,i=e.getNode();for(n.addLast(i),t.add(i),e.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();t.add(r),this.computeNodeDepth(r);for(var s=r.getEdges().iterator();s.hasNext();){var o=s.next().getSym();if(!o.isVisited()){var a=o.getNode();t.contains(a)||(n.addLast(a),t.add(a))}}}}},{key:"compareTo",value:function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(null===this._env){for(var e=new j,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next().getEdge().getCoordinates(),i=0;i<n.length-1;i++)e.expandToInclude(n[i]);this._env=e}return this._env}},{key:"addReachable",value:function(e){var t=new ie;for(t.add(e);!t.empty();){var n=t.pop();this.add(n,t)}}},{key:"copySymDepths",value:function(e){var t=e.getSym();t.setDepth(Q.LEFT,e.getDepth(Q.RIGHT)),t.setDepth(Q.RIGHT,e.getDepth(Q.LEFT))}},{key:"add",value:function(e,t){e.setVisited(!0),this._nodes.add(e);for(var n=e.getEdges().iterator();n.hasNext();){var i=n.next();this._dirEdgeList.add(i);var r=i.getSym().getNode();r.isVisited()||t.push(r)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new ge,this._nodes=new ge,this._rightMostCoord=null,this._env=null,this._finder=new de}}]),ve=s(function e(){n(this,e)},null,[{key:"intersection",value:function(e,t,n,i){var r=e.x<t.x?e.x:t.x,s=e.y<t.y?e.y:t.y,o=e.x>t.x?e.x:t.x,a=e.y>t.y?e.y:t.y,l=n.x<i.x?n.x:i.x,c=n.y<i.y?n.y:i.y,u=n.x>i.x?n.x:i.x,h=n.y>i.y?n.y:i.y,d=((r>l?r:l)+(o<u?o:u))/2,f=((s>c?s:c)+(a<h?a:h))/2,p=e.x-d,g=e.y-f,m=t.x-d,y=t.y-f,v=n.x-d,_=n.y-f,b=i.x-d,E=i.y-f,w=g-y,x=m-p,A=p*y-m*g,S=_-E,T=b-v,C=v*E-b*_,I=w*T-S*x,k=(x*C-T*A)/I,R=(S*A-w*C)/I;return B.isNaN(k)||B.isInfinite(k)||B.isNaN(R)||B.isInfinite(R)?null:new V(k+d,R+f)}}]),_e=s(function e(){n(this,e)},null,[{key:"arraycopy",value:function(e,t,n,i,r){for(var s=0,o=t;o<t+r;o++)n[i+s]=e[o],s++}},{key:"getProperty",value:function(e){return{"line.separator":"\n"}[e]}}]),be=function(){function e(){n(this,e)}return s(e,null,[{key:"log10",value:function(t){var n=Math.log(t);return B.isInfinite(n)||B.isNaN(n)?n:n/e.LOG_10}},{key:"min",value:function(e,t,n,i){var r=e;return t<r&&(r=t),n<r&&(r=n),i<r&&(r=i),r}},{key:"clamp",value:function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],s=arguments[2];return i<r?r:i>s?s:i}}},{key:"wrap",value:function(e,t){return e<0?t- -e%t:e%t}},{key:"max",value:function(){if(3===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[0];return e>n&&(n=e),t>n&&(n=t),n}if(4===arguments.length){var i=arguments[1],r=arguments[2],s=arguments[3],o=arguments[0];return i>o&&(o=i),r>o&&(o=r),s>o&&(o=s),o}}},{key:"average",value:function(e,t){return(e+t)/2}}])}();be.LOG_10=Math.log(10);var Ee=function(){function e(){n(this,e)}return s(e,null,[{key:"segmentToSegment",value:function(t,n,i,r){if(t.equals(n))return e.pointToSegment(t,i,r);if(i.equals(r))return e.pointToSegment(r,t,n);var s=!1;if(j.intersects(t,n,i,r)){var o=(n.x-t.x)*(r.y-i.y)-(n.y-t.y)*(r.x-i.x);if(0===o)s=!0;else{var a=(t.y-i.y)*(r.x-i.x)-(t.x-i.x)*(r.y-i.y),l=((t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y))/o,c=a/o;(c<0||c>1||l<0||l>1)&&(s=!0)}}else s=!0;return s?be.min(e.pointToSegment(t,i,r),e.pointToSegment(n,i,r),e.pointToSegment(i,t,n),e.pointToSegment(r,t,n)):0}},{key:"pointToSegment",value:function(e,t,n){if(t.x===n.x&&t.y===n.y)return e.distance(t);var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;if(r<=0)return e.distance(t);if(r>=1)return e.distance(n);var s=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/i;return Math.abs(s)*Math.sqrt(i)}},{key:"pointToLinePerpendicular",value:function(e,t,n){var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),r=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/i;return Math.abs(r)*Math.sqrt(i)}},{key:"pointToSegmentString",value:function(t,n){if(0===n.length)throw new _("Line array must contain at least one vertex");for(var i=t.distance(n[0]),r=0;r<n.length-1;r++){var s=e.pointToSegment(t,n[r],n[r+1]);s<i&&(i=s)}return i}}])}(),we=s(function e(){n(this,e)},[{key:"create",value:function(){if(1===arguments.length)arguments[0]instanceof Array||re(arguments[0],ue);else if(2===arguments.length);else if(3===arguments.length){var e=arguments[0],t=arguments[1];return this.create(e,t)}}}]),xe=s(function e(){n(this,e)},[{key:"filter",value:function(e){}}]),Ae=s(function e(){n(this,e)},null,[{key:"ofLine",value:function(e){var t=e.size();if(t<=1)return 0;var n=0,i=new V;e.getCoordinate(0,i);for(var r=i.x,s=i.y,o=1;o<t;o++){e.getCoordinate(o,i);var a=i.x,l=i.y,c=a-r,u=l-s;n+=Math.sqrt(c*c+u*u),r=a,s=l}return n}}]),Se=s(function e(){n(this,e)}),Te=function(){function e(){n(this,e)}return s(e,null,[{key:"copyCoord",value:function(e,t,n,i){for(var r=Math.min(e.getDimension(),n.getDimension()),s=0;s<r;s++)n.setOrdinate(i,s,e.getOrdinate(t,s))}},{key:"isRing",value:function(e){var t=e.size();return 0===t||!(t<=3)&&e.getOrdinate(0,ue.X)===e.getOrdinate(t-1,ue.X)&&e.getOrdinate(0,ue.Y)===e.getOrdinate(t-1,ue.Y)}},{key:"scroll",value:function(){if(2===arguments.length){if(re(arguments[0],ue)&&Number.isInteger(arguments[1])){var t=arguments[0],n=arguments[1];e.scroll(t,n,e.isRing(t))}else if(re(arguments[0],ue)&&arguments[1]instanceof V){var i=arguments[0],r=arguments[1],s=e.indexOf(r,i);if(s<=0)return null;e.scroll(i,s)}}else if(3===arguments.length){var o=arguments[0],a=arguments[1],l=arguments[2];if(a<=0)return null;for(var c=o.copy(),u=l?o.size()-1:o.size(),h=0;h<u;h++)for(var d=0;d<o.getDimension();d++)o.setOrdinate(h,d,c.getOrdinate((a+h)%u,d));if(l)for(var f=0;f<o.getDimension();f++)o.setOrdinate(u,f,o.getOrdinate(0,f))}}},{key:"isEqual",value:function(e,t){var n=e.size();if(n!==t.size())return!1;for(var i=Math.min(e.getDimension(),t.getDimension()),r=0;r<n;r++)for(var s=0;s<i;s++){var o=e.getOrdinate(r,s),a=t.getOrdinate(r,s);if(!(e.getOrdinate(r,s)===t.getOrdinate(r,s)||B.isNaN(o)&&B.isNaN(a)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(1===arguments.length){var t=arguments[0];return e.minCoordinateIndex(t,0,t.size()-1)}if(3===arguments.length){for(var n=arguments[0],i=arguments[2],r=-1,s=null,o=arguments[1];o<=i;o++){var a=n.getCoordinate(o);(null===s||s.compareTo(a)>0)&&(s=a,r=o)}return r}}},{key:"extend",value:function(t,n,i){var r=t.create(i,n.getDimension()),s=n.size();if(e.copy(n,0,r,0,s),s>0)for(var o=s;o<i;o++)e.copy(n,s-1,r,o,1);return r}},{key:"reverse",value:function(t){for(var n=t.size()-1,i=Math.trunc(n/2),r=0;r<=i;r++)e.swap(t,r,n-r)}},{key:"swap",value:function(e,t,n){if(t===n)return null;for(var i=0;i<e.getDimension();i++){var r=e.getOrdinate(t,i);e.setOrdinate(t,i,e.getOrdinate(n,i)),e.setOrdinate(n,i,r)}}},{key:"copy",value:function(t,n,i,r,s){for(var o=0;o<s;o++)e.copyCoord(t,n+o,i,r+o)}},{key:"ensureValidRing",value:function(t,n){var i=n.size();return 0===i?n:i<=3?e.createClosedRing(t,n,4):n.getOrdinate(0,ue.X)===n.getOrdinate(i-1,ue.X)&&n.getOrdinate(0,ue.Y)===n.getOrdinate(i-1,ue.Y)?n:e.createClosedRing(t,n,i+1)}},{key:"indexOf",value:function(e,t){for(var n=0;n<t.size();n++)if(e.x===t.getOrdinate(n,ue.X)&&e.y===t.getOrdinate(n,ue.Y))return n;return-1}},{key:"createClosedRing",value:function(t,n,i){var r=t.create(i,n.getDimension()),s=n.size();e.copy(n,0,r,0,s);for(var o=s;o<i;o++)e.copy(n,0,r,o,1);return r}},{key:"minCoordinate",value:function(e){for(var t=null,n=0;n<e.size();n++){var i=e.getCoordinate(n);(null===t||t.compareTo(i)>0)&&(t=i)}return t}}])}(),Ce=function(){function e(){n(this,e)}return s(e,null,[{key:"toDimensionSymbol",value:function(t){switch(t){case e.FALSE:return e.SYM_FALSE;case e.TRUE:return e.SYM_TRUE;case e.DONTCARE:return e.SYM_DONTCARE;case e.P:return e.SYM_P;case e.L:return e.SYM_L;case e.A:return e.SYM_A}throw new _("Unknown dimension value: "+t)}},{key:"toDimensionValue",value:function(t){switch(ae.toUpperCase(t)){case e.SYM_FALSE:return e.FALSE;case e.SYM_TRUE:return e.TRUE;case e.SYM_DONTCARE:return e.DONTCARE;case e.SYM_P:return e.P;case e.SYM_L:return e.L;case e.SYM_A:return e.A}throw new _("Unknown dimension symbol: "+t)}}])}();Ce.P=0,Ce.L=1,Ce.A=2,Ce.FALSE=-1,Ce.TRUE=-2,Ce.DONTCARE=-3,Ce.SYM_FALSE="F",Ce.SYM_TRUE="T",Ce.SYM_DONTCARE="*",Ce.SYM_P="0",Ce.SYM_L="1",Ce.SYM_A="2";var Ie=s(function e(){n(this,e)},[{key:"filter",value:function(e){}}]),ke=s(function e(){n(this,e)},[{key:"filter",value:function(e,t){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),Re=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new j:this._points.expandEnvelope(new j)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof W){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._points.size()!==n._points.size())return!1;for(var r=0;r<this._points.size();r++)if(!this.equal(this._points.getCoordinate(r),n._points.getCoordinate(r),t))return!1;return!0}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var e=0;e<Math.trunc(this._points.size()/2);e++){var t=this._points.size()-1-e;if(!this._points.getCoordinate(e).equals(this._points.getCoordinate(t))){if(this._points.getCoordinate(e).compareTo(this._points.getCoordinate(t))>0){var n=this._points.copy();Te.reverse(n),this._points=n}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Ce.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var e=this._points.copy();return Te.reverse(e),this.getFactory().createLineString(e)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return W.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Ae.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(1===arguments.length){for(var e=arguments[0],t=0,n=0;t<this._points.size()&&n<e._points.size();){var i=this._points.getCoordinate(t).compareTo(e._points.getCoordinate(n));if(0!==i)return i;t++,n++}return t<this._points.size()?1:n<e._points.size()?-1:0}if(2===arguments.length){var r=arguments[0];return arguments[1].compare(this._points,r._points)}}},{key:"apply",value:function(){if(re(arguments[0],xe))for(var e=arguments[0],t=0;t<this._points.size();t++)e.filter(this._points.getCoordinate(t));else if(re(arguments[0],ke)){var n=arguments[0];if(0===this._points.size())return null;for(var i=0;i<this._points.size()&&(n.filter(this._points,i),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else(re(arguments[0],Ie)||re(arguments[0],b))&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new K}},{key:"isEquivalentClass",value:function(e){return e instanceof i}},{key:"getCoordinateN",value:function(e){return this._points.getCoordinate(e)}},{key:"getGeometryType",value:function(){return W.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return 0===this._points.size()}},{key:"init",value:function(e){if(null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),1===e.size())throw new _("Invalid number of points in LineString (found "+e.size()+" - must be 0 or >= 2)");this._points=e}},{key:"isCoordinate",value:function(e){for(var t=0;t<this._points.size();t++)if(this._points.getCoordinate(t).equals(e))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(e){return this.getFactory().createPoint(this._points.getCoordinate(e))}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){if(this._points=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];W.constructor_.call(this,t),this.init(e)}}}])}(W),Pe=s(function e(){n(this,e)}),Me=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new j;var e=new j;return e.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),e}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new i(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof W){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),t))}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return Ce.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return W.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(null===this.getCoordinate())throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var t=arguments[0];return arguments[1].compare(this._coordinates,t._coordinates)}}},{key:"apply",value:function(){if(re(arguments[0],xe)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.getCoordinate())}else if(re(arguments[0],ke)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else(re(arguments[0],Ie)||re(arguments[0],b))&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return W.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(null===this.getCoordinate())throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return 0===this._coordinates.size()}},{key:"init",value:function(e){null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),F.isTrue(e.size()<=1),this._coordinates=e}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Pe]}}],[{key:"constructor_",value:function(){this._coordinates=null;var e=arguments[0],t=arguments[1];W.constructor_.call(this,t),this.init(e)}}])}(W),Le=function(){function e(){n(this,e)}return s(e,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var t=arguments[0];return Math.abs(e.ofRingSigned(t))}if(re(arguments[0],ue)){var n=arguments[0];return Math.abs(e.ofRingSigned(n))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,i=1;i<e.length-1;i++){var r=e[i].x-n,s=e[i+1].y;t+=r*(e[i-1].y-s)}return t/2}if(re(arguments[0],ue)){var o=arguments[0],a=o.size();if(a<3)return 0;var l=new V,c=new V,u=new V;o.getCoordinate(0,c),o.getCoordinate(1,u);var h=c.x;u.x-=h;for(var d=0,f=1;f<a-1;f++)l.y=c.y,c.x=u.x,c.y=u.y,o.getCoordinate(f+1,u),u.x-=h,d+=c.x*(l.y-u.y);return d/2}}}])}(),Be=s(function e(){n(this,e)},null,[{key:"sort",value:function(){var e=arguments,t=arguments[0];if(1===arguments.length)t.sort(function(e,t){return e.compareTo(t)});else if(2===arguments.length)t.sort(function(t,n){return e[1].compare(t,n)});else if(3===arguments.length){var n=t.slice(arguments[1],arguments[2]);n.sort();var i=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));t.splice(0,t.length);var r,s=o(i);try{for(s.s();!(r=s.n()).done;){var a=r.value;t.push(a)}}catch(f){s.e(f)}finally{s.f()}}else if(4===arguments.length){var l=t.slice(arguments[1],arguments[2]);l.sort(function(t,n){return e[3].compare(t,n)});var c=t.slice(0,arguments[1]).concat(l,t.slice(arguments[2],t.length));t.splice(0,t.length);var u,h=o(c);try{for(h.s();!(u=h.n()).done;){var d=u.value;t.push(d)}}catch(f){h.e(f)}finally{h.f()}}}},{key:"asList",value:function(e){var t,n=new ge,i=o(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n.add(r)}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"copyOf",value:function(e,t){return e.slice(0,t)}}]),Ne=s(function e(){n(this,e)}),Oe=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=this._shell.getCoordinates(),i=0;i<n.length;i++)e[++t]=n[i];for(var r=0;r<this._holes.length;r++)for(var s=this._holes[r].getCoordinates(),o=0;o<s.length;o++)e[++t]=s[o];return e}},{key:"getArea",value:function(){var e=0;e+=Le.ofRing(this._shell.getCoordinateSequence());for(var t=0;t<this._holes.length;t++)e-=Le.ofRing(this._holes[t].getCoordinateSequence());return e}},{key:"copyInternal",value:function(){for(var e=this._shell.copy(),t=new Array(this._holes.length).fill(null),n=0;n<this._holes.length;n++)t[n]=this._holes[n].copy();return new i(e,t,this._factory)}},{key:"isRectangle",value:function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var e=this._shell.getCoordinateSequence(),t=this.getEnvelopeInternal(),n=0;n<5;n++){var i=e.getX(n);if(i!==t.getMinX()&&i!==t.getMaxX())return!1;var r=e.getY(n);if(r!==t.getMinY()&&r!==t.getMaxY())return!1}for(var s=e.getX(0),o=e.getY(0),a=1;a<=4;a++){var l=e.getX(a),c=e.getY(a);if(l!==s==(c!==o))return!1;s=l,o=c}return!0}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof W){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e,r=this._shell,s=n._shell;if(!r.equalsExact(s,t))return!1;if(this._holes.length!==n._holes.length)return!1;for(var o=0;o<this._holes.length;o++)if(!this._holes[o].equalsExact(n._holes[o],t))return!1;return!0}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(0===arguments.length){this._shell=this.normalized(this._shell,!0);for(var e=0;e<this._holes.length;e++)this._holes[e]=this.normalized(this._holes[e],!1);Be.sort(this._holes)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(t.isEmpty())return null;var i=t.getCoordinateSequence(),r=Te.minCoordinateIndex(i,0,i.size()-2);Te.scroll(i,r,!0),he.isCCW(i)===n&&Te.reverse(i)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var e=this.getExteriorRing().reverse(),t=new Array(this.getNumInteriorRing()).fill(null),n=0;n<t.length;n++)t[n]=this.getInteriorRingN(n).reverse();return this.getFactory().createPolygon(e,t)}},{key:"getTypeCode",value:function(){return W.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var e=0;e+=this._shell.getLength();for(var t=0;t<this._holes.length;t++)e+=this._holes[t].getLength();return e}},{key:"getNumPoints",value:function(){for(var e=this._shell.getNumPoints(),t=0;t<this._holes.length;t++)e+=this._holes[t].getNumPoints();return e}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(e,t){var n=e.copy();return this.normalize(n,t),n}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0],t=this._shell,n=e._shell;return t.compareToSameClass(n)}if(2===arguments.length){var i=arguments[1],r=arguments[0],s=this._shell,o=r._shell,a=s.compareToSameClass(o,i);if(0!==a)return a;for(var l=this.getNumInteriorRing(),c=r.getNumInteriorRing(),u=0;u<l&&u<c;){var h=this.getInteriorRingN(u),d=r.getInteriorRingN(u),f=h.compareToSameClass(d,i);if(0!==f)return f;u++}return u<l?1:u<c?-1:0}}},{key:"apply",value:function(){if(re(arguments[0],xe)){var e=arguments[0];this._shell.apply(e);for(var t=0;t<this._holes.length;t++)this._holes[t].apply(e)}else if(re(arguments[0],ke)){var n=arguments[0];if(this._shell.apply(n),!n.isDone())for(var i=0;i<this._holes.length&&(this._holes[i].apply(n),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else if(re(arguments[0],Ie))arguments[0].filter(this);else if(re(arguments[0],b)){var r=arguments[0];r.filter(this),this._shell.apply(r);for(var s=0;s<this._holes.length;s++)this._holes[s].apply(r)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this._holes.length+1).fill(null);e[0]=this._shell;for(var t=0;t<this._holes.length;t++)e[t+1]=this._holes[t];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)}},{key:"getGeometryType",value:function(){return W.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(e){return this._holes[e]}},{key:"interfaces_",get:function(){return[Ne]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(W.constructor_.call(this,n),null===e&&(e=this.getFactory().createLinearRing()),null===t&&(t=[]),W.hasNullElements(t))throw new _("holes must not contain null elements");if(e.isEmpty()&&W.hasNonEmptyElements(t))throw new _("shell is empty but holes are not");this._shell=e,this._holes=t}}])}(W),De=function(e){function i(){return n(this,i),t(this,i,arguments)}return c(i,e),s(i)}(Y),Fe=function(e){function i(e){var r;return n(this,i),(r=t(this,i)).array=[],e instanceof X&&r.addAll(e),r}return c(i,e),s(i,[{key:"contains",value:function(e){var t,n=o(this.array);try{for(n.s();!(t=n.n()).done;)if(0===t.value.compareTo(e))return!0}catch(i){n.e(i)}finally{n.f()}return!1}},{key:"add",value:function(e){if(this.contains(e))return!1;for(var t=0,n=this.array.length;t<n;t++)if(1===this.array[t].compareTo(e))return!!this.array.splice(t,0,e);return this.array.push(e),!0}},{key:"addAll",value:function(e){var t,n=o(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.add(i)}}catch(r){n.e(r)}finally{n.f()}return!0}},{key:"remove",value:function(){throw new K}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return 0===this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Ue(this.array)}}])}(De),Ue=s(function e(t){n(this,e),this.array=t,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new q;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new K}}]),ze=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"computeEnvelopeInternal",value:function(){for(var e=new j,t=0;t<this._geometries.length;t++)e.expandToInclude(this._geometries[t].getEnvelopeInternal());return e}},{key:"getGeometryN",value:function(e){return this._geometries[e]}},{key:"getCoordinates",value:function(){for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=0;n<this._geometries.length;n++)for(var i=this._geometries[n].getCoordinates(),r=0;r<i.length;r++)e[++t]=i[r];return e}},{key:"getArea",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getArea();return e}},{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof W){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._geometries.length!==n._geometries.length)return!1;for(var r=0;r<this._geometries.length;r++)if(!this._geometries[r].equalsExact(n._geometries[r],t))return!1;return!0}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var e=0;e<this._geometries.length;e++)this._geometries[e].normalize();Be.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var e=Ce.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getBoundaryDimension());return e}},{key:"reverseInternal",value:function(){for(var e=this._geometries.length,t=new ge(e),n=0;n<e;n++)t.add(this._geometries[n].reverse());return this.getFactory().buildGeometry(t)}},{key:"getTypeCode",value:function(){return W.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var e=Ce.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getDimension());return e}},{key:"getLength",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getLength();return e}},{key:"getNumPoints",value:function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getNumPoints();return e}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(1===arguments.length){var e=arguments[0],t=new Fe(Be.asList(this._geometries)),n=new Fe(Be.asList(e._geometries));return this.compare(t,n)}if(2===arguments.length){for(var i=arguments[1],r=arguments[0],s=this.getNumGeometries(),o=r.getNumGeometries(),a=0;a<s&&a<o;){var l=this.getGeometryN(a),c=r.getGeometryN(a),u=l.compareToSameClass(c,i);if(0!==u)return u;a++}return a<s?1:a<o?-1:0}}},{key:"apply",value:function(){if(re(arguments[0],xe))for(var e=arguments[0],t=0;t<this._geometries.length;t++)this._geometries[t].apply(e);else if(re(arguments[0],ke)){var n=arguments[0];if(0===this._geometries.length)return null;for(var i=0;i<this._geometries.length&&(this._geometries[i].apply(n),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else if(re(arguments[0],Ie)){var r=arguments[0];r.filter(this);for(var s=0;s<this._geometries.length;s++)this._geometries[s].apply(r)}else if(re(arguments[0],b)){var o=arguments[0];o.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(o)}}},{key:"getBoundary",value:function(){return W.checkNotGeometryCollection(this),F.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return W.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];if(W.constructor_.call(this,t),null===e&&(e=[]),W.hasNullElements(e))throw new _("geometries must not contain null elements");this._geometries=e}}}])}(W),Ge=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof W){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(i,"equalsExact",this,1).call(this,e,t)}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(1===arguments.length&&Number.isInteger(arguments[0])){var e=arguments[0];return this._geometries[e].getCoordinate()}return d(i,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return Ce.FALSE}},{key:"getTypeCode",value:function(){return W.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return W.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Pe]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];ze.constructor_.call(this,e,t)}}])}(ze),Ve=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return Ce.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||d(i,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var e=this._points.copy();return Te.reverse(e),this.getFactory().createLinearRing(e)}},{key:"getTypeCode",value:function(){return W.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!d(i,"isClosed",this,1).call(this))throw new _("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<i.MINIMUM_VALID_SIZE)throw new _("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return W.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Re.constructor_.call(this,e,t),this.validateConstruction()}}])}(Re);Ve.MINIMUM_VALID_SIZE=4;var He=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"setOrdinate",value:function(e,t){switch(e){case i.X:this.x=t;break;case i.Y:this.y=t;break;default:throw new _("Invalid ordinate index: "+e)}}},{key:"getZ",value:function(){return V.NULL_ORDINATE}},{key:"getOrdinate",value:function(e){switch(e){case i.X:return this.x;case i.Y:return this.y}throw new _("Invalid ordinate index: "+e)}},{key:"setZ",value:function(e){throw new _("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ()}}],[{key:"constructor_",value:function(){if(0===arguments.length)V.constructor_.call(this);else if(1===arguments.length){if(arguments[0]instanceof i){var e=arguments[0];V.constructor_.call(this,e.x,e.y)}else if(arguments[0]instanceof V){var t=arguments[0];V.constructor_.call(this,t.x,t.y)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];V.constructor_.call(this,n,r,V.NULL_ORDINATE)}}}])}(V);He.X=0,He.Y=1,He.Z=-1,He.M=-1;var je=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(e,t){switch(e){case i.X:this.x=t;break;case i.Y:this.y=t;break;case i.M:this._m=t;break;default:throw new _("Invalid ordinate index: "+e)}}},{key:"setM",value:function(e){this._m=e}},{key:"getZ",value:function(){return V.NULL_ORDINATE}},{key:"getOrdinate",value:function(e){switch(e){case i.X:return this.x;case i.Y:return this.y;case i.M:return this._m}throw new _("Invalid ordinate index: "+e)}},{key:"setZ",value:function(e){throw new _("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ(),this._m=e.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,0===arguments.length)V.constructor_.call(this),this._m=0;else if(1===arguments.length){if(arguments[0]instanceof i){var e=arguments[0];V.constructor_.call(this,e.x,e.y),this._m=e._m}else if(arguments[0]instanceof V){var t=arguments[0];V.constructor_.call(this,t.x,t.y),this._m=this.getM()}}else if(3===arguments.length){var n=arguments[0],r=arguments[1],s=arguments[2];V.constructor_.call(this,n,r,V.NULL_ORDINATE),this._m=s}}}])}(V);je.X=0,je.Y=1,je.Z=-1,je.M=2;var We=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(e,t){switch(e){case V.X:this.x=t;break;case V.Y:this.y=t;break;case V.Z:this.z=t;break;case V.M:this._m=t;break;default:throw new _("Invalid ordinate index: "+e)}}},{key:"setM",value:function(e){this._m=e}},{key:"getOrdinate",value:function(e){switch(e){case V.X:return this.x;case V.Y:return this.y;case V.Z:return this.getZ();case V.M:return this.getM()}throw new _("Invalid ordinate index: "+e)}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(e){this.x=e.x,this.y=e.y,this.z=e.getZ(),this._m=e.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,0===arguments.length)V.constructor_.call(this),this._m=0;else if(1===arguments.length){if(arguments[0]instanceof i){var e=arguments[0];V.constructor_.call(this,e),this._m=e._m}else if(arguments[0]instanceof V){var t=arguments[0];V.constructor_.call(this,t),this._m=this.getM()}}else if(4===arguments.length){var n=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3];V.constructor_.call(this,n,r,s),this._m=o}}}])}(V),$e=function(){function e(){n(this,e)}return s(e,null,[{key:"measures",value:function(e){return e instanceof He?0:e instanceof je||e instanceof We?1:0}},{key:"dimension",value:function(e){return e instanceof He?2:e instanceof je?3:e instanceof We?4:3}},{key:"create",value:function(){if(1===arguments.length){var t=arguments[0];return e.create(t,0)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return 2===n?new He:3===n&&0===i?new V:3===n&&1===i?new je:4===n&&1===i?new We:new V}}}])}(),Xe=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"getCoordinate",value:function(e){return this.get(e)}},{key:"addAll",value:function(){if(2===arguments.length&&"boolean"==typeof arguments[1]&&re(arguments[0],X)){for(var e=arguments[1],t=!1,n=arguments[0].iterator();n.hasNext();)this.add(n.next(),e),t=!0;return t}return d(i,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var e=d(i,"clone",this,1).call(this),t=0;t<this.size();t++)e.add(t,this.get(t).clone());return e}},{key:"toCoordinateArray",value:function(){if(0===arguments.length)return this.toArray(i.coordArrayType);if(1===arguments.length){if(arguments[0])return this.toArray(i.coordArrayType);for(var e=this.size(),t=new Array(e).fill(null),n=0;n<e;n++)t[n]=this.get(e-n-1);return t}}},{key:"add",value:function(){if(1===arguments.length){var e=arguments[0];return d(i,"add",this,1).call(this,e)}if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var t=arguments[0],n=arguments[1];return this.add(t,n,!0),!0}if(arguments[0]instanceof V&&"boolean"==typeof arguments[1]){var r=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(r))return null;d(i,"add",this,1).call(this,r)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var s=arguments[0],o=arguments[1];return this.add(s,o),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var a=arguments[0],l=arguments[1];if(arguments[2])for(var c=0;c<a.length;c++)this.add(a[c],l);else for(var u=a.length-1;u>=0;u--)this.add(a[u],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof V){var h=arguments[0],f=arguments[1];if(!arguments[2]){var p=this.size();if(p>0){if(h>0&&this.get(h-1).equals2D(f))return null;if(h<p&&this.get(h).equals2D(f))return null}}d(i,"add",this,1).call(this,h,f)}}else if(4===arguments.length){var g=arguments[0],m=arguments[1],y=arguments[2],v=arguments[3],_=1;y>v&&(_=-1);for(var b=y;b!==v;b+=_)this.add(g[b],m);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var e=this.get(0).copy();this.add(e,!1)}}}],[{key:"constructor_",value:function(){if(0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.ensureCapacity(t.length),this.add(t,n)}}}])}(ge);Xe.coordArrayType=new Array(0).fill(null);var qe=function(){function e(){n(this,e)}return s(e,null,[{key:"isRing",value:function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))}},{key:"ptNotInList",value:function(t,n){for(var i=0;i<t.length;i++){var r=t[i];if(e.indexOf(r,n)<0)return r}return null}},{key:"scroll",value:function(t,n){var i=e.indexOf(n,t);if(i<0)return null;var r=new Array(t.length).fill(null);_e.arraycopy(t,i,r,0,t.length-i),_e.arraycopy(t,0,r,t.length-i,i),_e.arraycopy(r,0,t,0,t.length)}},{key:"equals",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var o=0;o<i.length;o++)if(0!==s.compare(i[o],r[o]))return!1;return!0}}},{key:"intersection",value:function(e,t){for(var n=new Xe,i=0;i<e.length;i++)t.intersects(e[i])&&n.add(e[i],!0);return n.toCoordinateArray()}},{key:"measures",value:function(e){if(null===e||0===e.length)return 0;var t,n=0,i=o(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=Math.max(n,$e.measures(r))}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"hasRepeatedPoints",value:function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(t){return e.hasRepeatedPoints(t)?new Xe(t,!1).toCoordinateArray():t}},{key:"reverse",value:function(e){for(var t=e.length-1,n=Math.trunc(t/2),i=0;i<=n;i++){var r=e[i];e[i]=e[t-i],e[t-i]=r}}},{key:"removeNull",value:function(e){for(var t=0,n=0;n<e.length;n++)null!==e[n]&&t++;var i=new Array(t).fill(null);if(0===t)return i;for(var r=0,s=0;s<e.length;s++)null!==e[s]&&(i[r++]=e[s]);return i}},{key:"copyDeep",value:function(){if(1===arguments.length){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=e[n].copy();return t}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3],a=arguments[4],l=0;l<a;l++)s[o+l]=i[r+l].copy()}},{key:"isEqualReversed",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=t[e.length-n-1];if(0!==i.compareTo(r))return!1}return!0}},{key:"envelope",value:function(e){for(var t=new j,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t}},{key:"toCoordinateArray",value:function(t){return t.toArray(e.coordArrayType)}},{key:"dimension",value:function(e){if(null===e||0===e.length)return 3;var t,n=0,i=o(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=Math.max(n,$e.dimension(r))}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"atLeastNCoordinatesOrNothing",value:function(e,t){return t.length>=e?t:[]}},{key:"indexOf",value:function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1}},{key:"increasingDirection",value:function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,i=e[t].compareTo(e[n]);if(0!==i)return i}return 1}},{key:"compare",value:function(e,t){for(var n=0;n<e.length&&n<t.length;){var i=e[n].compareTo(t[n]);if(0!==i)return i;n++}return n<t.length?-1:n<e.length?1:0}},{key:"minCoordinate",value:function(e){for(var t=null,n=0;n<e.length;n++)(null===t||t.compareTo(e[n])>0)&&(t=e[n]);return t}},{key:"extract",value:function(e,t,n){t=be.clamp(t,0,e.length);var i=(n=be.clamp(n,-1,e.length))-t+1;n<0&&(i=0),t>=e.length&&(i=0),n<t&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var s=0,o=t;o<=n;o++)r[s++]=e[o];return r}}])}(),Ke=s(function e(){n(this,e)},[{key:"compare",value:function(e,t){var n=e,i=t;return qe.compare(n,i)}},{key:"interfaces_",get:function(){return[N]}}]),Ye=s(function e(){n(this,e)},[{key:"compare",value:function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=qe.compare(n,i);return qe.isEqualReversed(n,i)?0:r}},{key:"OLDcompare",value:function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=qe.increasingDirection(n),s=qe.increasingDirection(i),o=r>0?0:n.length-1,a=s>0?0:n.length-1,l=0;l<n.length;l++){var c=n[o].compareTo(i[a]);if(0!==c)return c;o+=r,a+=s}return 0}},{key:"interfaces_",get:function(){return[N]}}]);qe.ForwardComparator=Ke,qe.BidirectionalComparator=Ye,qe.coordArrayType=new Array(0).fill(null);var Je=s(function e(t){n(this,e),this.str=t},[{key:"append",value:function(e){this.str+=e}},{key:"setCharAt",value:function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)}},{key:"toString",value:function(){return this.str}}]),Ze=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getM",value:function(e){return this.hasM()?this._coordinates[e].getM():B.NaN}},{key:"setOrdinate",value:function(e,t,n){switch(t){case ue.X:this._coordinates[e].x=n;break;case ue.Y:this._coordinates[e].y=n;break;default:this._coordinates[e].setOrdinate(t,n)}}},{key:"getZ",value:function(e){return this.hasZ()?this._coordinates[e].getZ():B.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(e,t){switch(t){case ue.X:return this._coordinates[e].x;case ue.Y:return this._coordinates[e].y;default:return this._coordinates[e].getOrdinate(t)}}},{key:"getCoordinate",value:function(){if(1===arguments.length){var e=arguments[0];return this._coordinates[e]}if(2===arguments.length){var t=arguments[0];arguments[1].setCoordinate(this._coordinates[t])}}},{key:"getCoordinateCopy",value:function(e){var t=this.createCoordinate();return t.setCoordinate(this._coordinates[e]),t}},{key:"createCoordinate",value:function(){return $e.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(e){return this._coordinates[e].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(e){for(var t=0;t<this._coordinates.length;t++)e.expandToInclude(this._coordinates[t]);return e}},{key:"copy",value:function(){for(var t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++){var i=this.createCoordinate();i.setCoordinate(this._coordinates[n]),t[n]=i}return new e(t,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var e=new Je(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(this._coordinates[t]);return e.append(")"),e.toString()}return"()"}},{key:"getY",value:function(e){return this._coordinates[e].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[ue,x]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];e.constructor_.call(this,t,qe.dimension(t),qe.measures(t))}else if(Number.isInteger(arguments[0])){var n=arguments[0];this._coordinates=new Array(n).fill(null);for(var i=0;i<n;i++)this._coordinates[i]=new V}else if(re(arguments[0],ue)){var r=arguments[0];if(null===r)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._measures=r.getMeasures(),this._coordinates=new Array(r.size()).fill(null);for(var s=0;s<this._coordinates.length;s++)this._coordinates[s]=r.getCoordinateCopy(s)}}else if(2===arguments.length){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],a=arguments[1];e.constructor_.call(this,o,a,qe.measures(o))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var l=arguments[0],c=arguments[1];this._coordinates=new Array(l).fill(null),this._dimension=c;for(var u=0;u<l;u++)this._coordinates[u]=$e.create(c)}}else if(3===arguments.length)if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var h=arguments[0],d=arguments[1],f=arguments[2];this._dimension=d,this._measures=f,this._coordinates=null===h?new Array(0).fill(null):h}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var p=arguments[0],g=arguments[1],m=arguments[2];this._coordinates=new Array(p).fill(null),this._dimension=g,this._measures=m;for(var y=0;y<p;y++)this._coordinates[y]=this.createCoordinate()}}}])}(),Qe=function(){function e(){n(this,e)}return s(e,[{key:"readResolve",value:function(){return e.instance()}},{key:"create",value:function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new Ze(arguments[0]);if(re(arguments[0],ue))return new Ze(arguments[0])}else{if(2===arguments.length){var e=arguments[1];return e>3&&(e=3),e<2&&(e=2),new Ze(arguments[0],e)}if(3===arguments.length){var t=arguments[2],n=arguments[1]-t;return t>1&&(t=1),n>3&&(n=3),n<2&&(n=2),new Ze(arguments[0],n+t,t)}}}},{key:"interfaces_",get:function(){return[we,x]}}],[{key:"instance",value:function(){return e.instanceObject}}])}();Qe.instanceObject=new Qe;var et=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof W){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(i,"equalsExact",this,1).call(this,e,t)}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return W.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new ge,t=0;t<this._geometries.length;t++)for(var n=this._geometries[t].getBoundary(),i=0;i<n.getNumGeometries();i++)e.add(n.getGeometryN(i));var r=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(r))}},{key:"getGeometryType",value:function(){return W.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Ne]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];ze.constructor_.call(this,e,t)}}])}(ze),tt=s(function e(){n(this,e)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),nt=function(e){function i(){var e;return n(this,i),(e=t(this,i)).map=new Map,e}return c(i,e),s(i,[{key:"get",value:function(e){return this.map.get(e)||null}},{key:"put",value:function(e,t){return this.map.set(e,t),t}},{key:"values",value:function(){for(var e=new ge,t=this.map.values(),n=t.next();!n.done;)e.add(n.value),n=t.next();return e}},{key:"entrySet",value:function(){var e=new J;return this.map.entries().forEach(function(t){return e.add(t)}),e}},{key:"size",value:function(){return this.map.size()}}])}(tt),it=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this._modelType===n._modelType&&this._scale===n._scale}},{key:"compareTo",value:function(e){var t=e,n=this.getMaximumSignificantDigits(),i=t.getMaximumSignificantDigits();return oe.compare(n,i)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===e.FLOATING||this._modelType===e.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var t="UNKNOWN";return this._modelType===e.FLOATING?t="Floating":this._modelType===e.FLOATING_SINGLE?t="Floating-Single":this._modelType===e.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t}},{key:"makePrecise",value:function(){if("number"==typeof arguments[0]){var t=arguments[0];return B.isNaN(t)||this._modelType===e.FLOATING_SINGLE?t:this._modelType===e.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof V){var n=arguments[0];if(this._modelType===e.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}}},{key:"getMaximumSignificantDigits",value:function(){var t=16;return this._modelType===e.FLOATING?t=16:this._modelType===e.FLOATING_SINGLE?t=6:this._modelType===e.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t}},{key:"setScale",value:function(e){this._scale=Math.abs(e)}},{key:"interfaces_",get:function(){return[x,E]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=e.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof rt){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var i=arguments[0];this._modelType=i._modelType,this._scale=i._scale}}},{key:"mostPrecise",value:function(e,t){return e.compareTo(t)>=0?e:t}}])}(),rt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"readResolve",value:function(){return e.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){this._name=null;var t=arguments[0];this._name=t,e.nameToTypeMap.put(t,this)}}])}();rt.nameToTypeMap=new nt,it.Type=rt,it.FIXED=new rt("FIXED"),it.FLOATING=new rt("FLOATING"),it.FLOATING_SINGLE=new rt("FLOATING SINGLE"),it.maximumPreciseValue=9007199254740992;var st=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"copyInternal",value:function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)}},{key:"equalsExact",value:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof W){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&d(i,"equalsExact",this,1).call(this,e,t)}return d(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Ce.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return W.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new K}},{key:"getGeometryType",value:function(){return W.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];ze.constructor_.call(this,e,t)}}])}(ze),ot=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"createEmpty",value:function(e){switch(e){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new _("Invalid dimension: "+e)}}},{key:"toGeometry",value:function(e){return e.isNull()?this.createPoint():e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new V(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new V(e.getMinX(),e.getMinY()),new V(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new V(e.getMinX(),e.getMinY()),new V(e.getMinX(),e.getMaxY()),new V(e.getMaxX(),e.getMaxY()),new V(e.getMaxX(),e.getMinY()),new V(e.getMinX(),e.getMinY())]),null)}},{key:"createLineString",value:function(){if(0===arguments.length)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLineString(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(re(arguments[0],ue))return new Re(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return 0===arguments.length?new st(null,this):1===arguments.length?new st(arguments[0],this):void 0}},{key:"buildGeometry",value:function(t){for(var n=null,i=!1,r=!1,s=t.iterator();s.hasNext();){var o=s.next(),a=o.getTypeCode();null===n&&(n=a),a!==n&&(i=!0),o instanceof ze&&(r=!0)}if(null===n)return this.createGeometryCollection();if(i||r)return this.createGeometryCollection(e.toGeometryArray(t));var l=t.iterator().next();if(t.size()>1){if(l instanceof Oe)return this.createMultiPolygon(e.toPolygonArray(t));if(l instanceof Re)return this.createMultiLineString(e.toLineStringArray(t));if(l instanceof Me)return this.createMultiPoint(e.toPointArray(t));F.shouldNeverReachHere("Unhandled geometry type: "+l.getGeometryType())}return l}},{key:"createMultiPointFromCoords",value:function(e){return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)}},{key:"createPoint",value:function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof V){var e=arguments[0];return this.createPoint(null!==e?this.getCoordinateSequenceFactory().create([e]):null)}if(re(arguments[0],ue))return new Me(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(0===arguments.length)return this.createPolygon(null,null);if(1===arguments.length){if(re(arguments[0],ue)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Ve){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length)return new Oe(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return 0===arguments.length?new ze(null,this):1===arguments.length?new ze(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(re(arguments[0],ue))return new Ve(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return 0===arguments.length?new et(null,this):1===arguments.length?new et(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(0===arguments.length)return new Ge(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Ge(arguments[0],this);if(re(arguments[0],ue)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var t=new Array(e.size()).fill(null),n=0;n<e.size();n++){var i=this.getCoordinateSequenceFactory().create(1,e.getDimension(),e.getMeasures());Te.copy(e,n,i,0,1),t[n]=this.createPoint(i)}return this.createMultiPoint(t)}}}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,0===arguments.length)e.constructor_.call(this,new it,0);else if(1===arguments.length){if(re(arguments[0],we)){var t=arguments[0];e.constructor_.call(this,new it,0,t)}else if(arguments[0]instanceof it){var n=arguments[0];e.constructor_.call(this,n,0,e.getDefaultCoordinateSequenceFactory())}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];e.constructor_.call(this,i,r,e.getDefaultCoordinateSequenceFactory())}else if(3===arguments.length){var s=arguments[0],o=arguments[1],a=arguments[2];this._precisionModel=s,this._coordinateSequenceFactory=a,this._SRID=o}}},{key:"toMultiPolygonArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toGeometryArray",value:function(e){if(null===e)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Qe.instance()}},{key:"toMultiLineStringArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toLineStringArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toMultiPointArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toLinearRingArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toPointArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"toPolygonArray",value:function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)}},{key:"createPointFromInternalCoord",value:function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)}}])}(),at="XY",lt="XYZ",ct="XYM",ut="XYZM",ht={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},dt="EMPTY",ft=1,pt=2,gt=3,mt=4,yt=5,vt=6;for(var _t in ht)ht[_t].toUpperCase();var bt=s(function e(t){n(this,e),this.wkt=t,this.index_=-1},[{key:"isAlpha_",value:function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}},{key:"isNumeric_",value:function(e,t){return e>="0"&&e<="9"||"."==e&&!(void 0!==t&&t)}},{key:"isWhiteSpace_",value:function(e){return" "==e||"\t"==e||"\r"==e||"\n"==e}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var e,t=this.nextChar_(),n=this.index_,i=t;if("("==t)e=pt;else if(","==t)e=yt;else if(")"==t)e=gt;else if(this.isNumeric_(t)||"-"==t)e=mt,i=this.readNumber_();else if(this.isAlpha_(t))e=ft,i=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);e=vt}return{position:n,value:i,type:e}}},{key:"readNumber_",value:function(){var e,t=this.index_,n=!1,i=!1;do{"."==e?n=!0:"e"!=e&&"E"!=e||(i=!0),e=this.nextChar_()}while(this.isNumeric_(e,n)||!i&&("e"==e||"E"==e)||i&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))}},{key:"readText_",value:function(){var e,t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}]),Et=s(function e(t,i){n(this,e),this.lexer_=t,this.token_,this.layout_=at,this.factory=i},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(e){return this.token_.type==e}},{key:"match",value:function(e){var t=this.isTokenType(e);return t&&this.consume_(),t}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var e=at,t=this.token_;if(this.isTokenType(ft)){var n=t.value;"Z"===n?e=lt:"M"===n?e=ct:"ZM"===n&&(e=ut),e!==at&&this.consume_()}return e}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(pt)){var e=[];do{e.push(this.parseGeometry_())}while(this.match(yt));if(this.match(gt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(pt)){var e=this.parsePoint_();if(this.match(gt))return e}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(pt)){var e=this.parsePointList_();if(this.match(gt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(pt)){var e=this.parseLineStringTextList_();if(this.match(gt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var e;if(this.match(pt)){if(e=this.token_.type==pt?this.parsePointTextList_():this.parsePointList_(),this.match(gt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(pt)){var e=this.parseLineStringTextList_();if(this.match(gt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(pt)){var e=this.parsePolygonTextList_();if(this.match(gt))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var e=[],t=this.layout_.length,n=0;n<t;++n){var i=this.token_;if(!this.match(mt))break;e.push(i.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var e=[this.parsePoint_()];this.match(yt);)e.push(this.parsePoint_());return e}},{key:"parsePointTextList_",value:function(){for(var e=[this.parsePointText_()];this.match(yt);)e.push(this.parsePointText_());return e}},{key:"parseLineStringTextList_",value:function(){for(var e=[this.parseLineStringText_()];this.match(yt);)e.push(this.parseLineStringText_());return e}},{key:"parsePolygonTextList_",value:function(){for(var e=[this.parsePolygonText_()];this.match(yt);)e.push(this.parsePolygonText_());return e}},{key:"isEmptyGeometry_",value:function(){var e=this.isTokenType(ft)&&this.token_.value==dt;return e&&this.consume_(),e}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var e=this.factory,t=function(e){return i(V,f(e))},n=function(n){var i=n.map(function(n){return e.createLinearRing(n.map(t))});return i.length>1?e.createPolygon(i[0],i.slice(1)):e.createPolygon(i[0])},r=this.token_;if(this.match(ft)){var s=r.value;if(this.layout_=this.parseGeometryLayout_(),"GEOMETRYCOLLECTION"==s){var o=this.parseGeometryCollectionText_();return e.createGeometryCollection(o)}switch(s){case"POINT":var a=this.parsePointText_();return a?e.createPoint(i(V,f(a))):e.createPoint();case"LINESTRING":var l=this.parseLineStringText_().map(t);return e.createLineString(l);case"LINEARRING":var c=this.parseLineStringText_().map(t);return e.createLinearRing(c);case"POLYGON":var u=this.parsePolygonText_();return u&&0!==u.length?n(u):e.createPolygon();case"MULTIPOINT":var h=this.parseMultiPointText_();if(!h||0===h.length)return e.createMultiPoint();var d=h.map(t).map(function(t){return e.createPoint(t)});return e.createMultiPoint(d);case"MULTILINESTRING":var p=this.parseMultiLineStringText_().map(function(n){return e.createLineString(n.map(t))});return e.createMultiLineString(p);case"MULTIPOLYGON":var g=this.parseMultiPolygonText_();if(!g||0===g.length)return e.createMultiPolygon();var m=g.map(n);return e.createMultiPolygon(m);default:throw new Error("Invalid geometry type: "+s)}}throw new Error(this.formatErrorMessage_())}}]);function wt(e){if(e.isEmpty())return"";var t=e.getCoordinate(),n=[t.x,t.y];return void 0===t.z||Number.isNaN(t.z)||n.push(t.z),void 0===t.m||Number.isNaN(t.m)||n.push(t.m),n.join(" ")}function xt(e){for(var t=e.getCoordinates().map(function(e){var t=[e.x,e.y];return void 0===e.z||Number.isNaN(e.z)||t.push(e.z),void 0===e.m||Number.isNaN(e.m)||t.push(e.m),t}),n=[],i=0,r=t.length;i<r;++i)n.push(t[i].join(" "));return n.join(", ")}function At(e){var t=[];t.push("("+xt(e.getExteriorRing())+")");for(var n=0,i=e.getNumInteriorRing();n<i;++n)t.push("("+xt(e.getInteriorRingN(n))+")");return t.join(", ")}var St={Point:wt,LineString:xt,LinearRing:xt,Polygon:At,MultiPoint:function(e){for(var t=[],n=0,i=e.getNumGeometries();n<i;++n)t.push("("+wt(e.getGeometryN(n))+")");return t.join(", ")},MultiLineString:function(e){for(var t=[],n=0,i=e.getNumGeometries();n<i;++n)t.push("("+xt(e.getGeometryN(n))+")");return t.join(", ")},MultiPolygon:function(e){for(var t=[],n=0,i=e.getNumGeometries();n<i;++n)t.push("("+At(e.getGeometryN(n))+")");return t.join(", ")},GeometryCollection:function(e){for(var t=[],n=0,i=e.getNumGeometries();n<i;++n)t.push(Tt(e.getGeometryN(n)));return t.join(", ")}};function Tt(e){var t=e.getGeometryType(),n=St[t];t=t.toUpperCase();var i=function(e){var t="";if(e.isEmpty())return t;var n=e.getCoordinate();return void 0===n.z||Number.isNaN(n.z)||(t+="Z"),void 0===n.m||Number.isNaN(n.m)||(t+="M"),t}(e);return i.length>0&&(t+=" "+i),e.isEmpty()?t+" "+dt:t+" ("+n(e)+")"}var Ct=s(function e(t){n(this,e),this.geometryFactory=t||new ot,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(e){var t=new bt(e);return new Et(t,this.geometryFactory).parse()}},{key:"write",value:function(e){return Tt(e)}}]),It=s(function e(t){n(this,e),this.parser=new Ct(t)},[{key:"write",value:function(e){return this.parser.write(e)}}],[{key:"toLineString",value:function(e,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"}}]),kt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getIndexAlongSegment",value:function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]}},{key:"getTopologySummary",value:function(){var e=new Je;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()}},{key:"computeIntersection",value:function(e,t,n,i){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(e,t,n,i)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var e=arguments[0];this.getEdgeDistance(e,0)>this.getEdgeDistance(e,1)?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"isInteriorIntersection",value:function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],t=0;t<this._result;t++)if(!this._intPt[t].equals2D(this._inputLines[e][0])&&!this._intPt[t].equals2D(this._inputLines[e][1]))return!0;return!1}}},{key:"getIntersection",value:function(e){return this._intPt[e]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==e.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(t,n){return e.computeEdgeDistance(this._intPt[n],this._inputLines[t][0],this._inputLines[t][1])}},{key:"isCollinear",value:function(){return this._result===e.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return It.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+It.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(e,t){return this._inputLines[e][t]}},{key:"isIntersection",value:function(e){for(var t=0;t<this._result;t++)if(this._intPt[t].equals2D(e))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new V,this._intPt[1]=new V,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(e,t,n){var i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),s=-1;if(e.equals(t))s=0;else if(e.equals(n))s=i>r?i:r;else{var o=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);0!==(s=i>r?o:a)||e.equals(t)||(s=Math.max(o,a))}return F.isTrue(!(0===s&&!e.equals(t)),"Bad distance calculation"),s}},{key:"nonRobustComputeEdgeDistance",value:function(e,t,n){var i=e.x-t.x,r=e.y-t.y,s=Math.sqrt(i*i+r*r);return F.isTrue(!(0===s&&!e.equals(t)),"Invalid distance calculation"),s}}])}();kt.DONT_INTERSECT=0,kt.DO_INTERSECT=1,kt.COLLINEAR=2,kt.NO_INTERSECTION=0,kt.POINT_INTERSECTION=1,kt.COLLINEAR_INTERSECTION=2;var Rt=function(e){function i(){return n(this,i),t(this,i)}return c(i,e),s(i,[{key:"isInSegmentEnvelopes",value:function(e){var t=new j(this._inputLines[0][0],this._inputLines[0][1]),n=new j(this._inputLines[1][0],this._inputLines[1][1]);return t.contains(e)&&n.contains(e)}},{key:"computeIntersection",value:function(){if(3!==arguments.length)return d(i,"computeIntersection",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1],n=arguments[2];if(this._isProper=!1,j.intersects(t,n,e)&&0===he.index(t,n,e)&&0===he.index(n,t,e))return this._isProper=!0,(e.equals(t)||e.equals(n))&&(this._isProper=!1),this._result=kt.POINT_INTERSECTION,null;this._result=kt.NO_INTERSECTION}},{key:"intersection",value:function(e,t,n,r){var s=this.intersectionSafe(e,t,n,r);return this.isInSegmentEnvelopes(s)||(s=new V(i.nearestEndpoint(e,t,n,r))),null!==this._precisionModel&&this._precisionModel.makePrecise(s),s}},{key:"checkDD",value:function(e,t,n,i,r){var s=ce.intersection(e,t,n,i),o=this.isInSegmentEnvelopes(s);_e.out.println("DD in env = "+o+"  --------------------- "+s),r.distance(s)>1e-4&&_e.out.println("Distance = "+r.distance(s))}},{key:"intersectionSafe",value:function(e,t,n,r){var s=ve.intersection(e,t,n,r);return null===s&&(s=i.nearestEndpoint(e,t,n,r)),s}},{key:"computeCollinearIntersection",value:function(e,t,n,i){var r=j.intersects(e,t,n),s=j.intersects(e,t,i),o=j.intersects(n,i,e),a=j.intersects(n,i,t);return r&&s?(this._intPt[0]=n,this._intPt[1]=i,kt.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=e,this._intPt[1]=t,kt.COLLINEAR_INTERSECTION):r&&o?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||s||a?kt.COLLINEAR_INTERSECTION:kt.POINT_INTERSECTION):r&&a?(this._intPt[0]=n,this._intPt[1]=t,!n.equals(t)||s||o?kt.COLLINEAR_INTERSECTION:kt.POINT_INTERSECTION):s&&o?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||r||a?kt.COLLINEAR_INTERSECTION:kt.POINT_INTERSECTION):s&&a?(this._intPt[0]=i,this._intPt[1]=t,!i.equals(t)||r||o?kt.COLLINEAR_INTERSECTION:kt.POINT_INTERSECTION):kt.NO_INTERSECTION}},{key:"computeIntersect",value:function(e,t,n,i){if(this._isProper=!1,!j.intersects(e,t,n,i))return kt.NO_INTERSECTION;var r=he.index(e,t,n),s=he.index(e,t,i);if(r>0&&s>0||r<0&&s<0)return kt.NO_INTERSECTION;var o=he.index(n,i,e),a=he.index(n,i,t);return o>0&&a>0||o<0&&a<0?kt.NO_INTERSECTION:0===r&&0===s&&0===o&&0===a?this.computeCollinearIntersection(e,t,n,i):(0===r||0===s||0===o||0===a?(this._isProper=!1,e.equals2D(n)||e.equals2D(i)?this._intPt[0]=e:t.equals2D(n)||t.equals2D(i)?this._intPt[0]=t:0===r?this._intPt[0]=new V(n):0===s?this._intPt[0]=new V(i):0===o?this._intPt[0]=new V(e):0===a&&(this._intPt[0]=new V(t))):(this._isProper=!0,this._intPt[0]=this.intersection(e,t,n,i)),kt.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(e,t,n,i){var r=e,s=Ee.pointToSegment(e,n,i),o=Ee.pointToSegment(t,n,i);return o<s&&(s=o,r=t),(o=Ee.pointToSegment(n,e,t))<s&&(s=o,r=n),(o=Ee.pointToSegment(i,e,t))<s&&(s=o,r=i),r}}])}(kt),Pt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"countSegment",value:function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,i=t.x;return n>i&&(n=t.x,i=e.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var r=he.index(e,t,this._p);if(r===he.COLLINEAR)return this._isPointOnSegment=!0,null;t.y<e.y&&(r=-r),r===he.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==$.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?$.BOUNDARY:this._crossingCount%2==1?$.INTERIOR:$.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof V&&re(arguments[1],ue)){for(var t=arguments[1],n=new e(arguments[0]),i=new V,r=new V,s=1;s<t.size();s++)if(t.getCoordinate(s,i),t.getCoordinate(s-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof V&&arguments[1]instanceof Array){for(var o=arguments[1],a=new e(arguments[0]),l=1;l<o.length;l++){var c=o[l],u=o[l-1];if(a.countSegment(c,u),a.isOnSegment())return a.getLocation()}return a.getLocation()}}}])}(),Mt=function(){function e(){n(this,e)}return s(e,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof V&&re(arguments[1],ue)){for(var e=arguments[0],t=arguments[1],n=new Rt,i=new V,r=new V,s=t.size(),o=1;o<s;o++)if(t.getCoordinate(o-1,i),t.getCoordinate(o,r),n.computeIntersection(e,i,r),n.hasIntersection())return!0;return!1}if(arguments[0]instanceof V&&arguments[1]instanceof Array){for(var a=arguments[0],l=arguments[1],c=new Rt,u=1;u<l.length;u++){var h=l[u-1],d=l[u];if(c.computeIntersection(a,h,d),c.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(e,t){return Pt.locatePointInRing(e,t)}},{key:"isInRing",value:function(t,n){return e.locateInRing(t,n)!==$.EXTERIOR}}])}(),Lt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"setAllLocations",value:function(e){for(var t=0;t<this.location.length;t++)this.location[t]=e}},{key:"isNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==$.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(e){for(var t=0;t<this.location.length;t++)this.location[t]===$.NONE&&(this.location[t]=e)}},{key:"isLine",value:function(){return 1===this.location.length}},{key:"merge",value:function(e){if(e.location.length>this.location.length){var t=new Array(3).fill(null);t[Q.ON]=this.location[Q.ON],t[Q.LEFT]=$.NONE,t[Q.RIGHT]=$.NONE,this.location=t}for(var n=0;n<this.location.length;n++)this.location[n]===$.NONE&&n<e.location.length&&(this.location[n]=e.location[n])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var e=this.location[Q.LEFT];this.location[Q.LEFT]=this.location[Q.RIGHT],this.location[Q.RIGHT]=e}},{key:"toString",value:function(){var e=new se;return this.location.length>1&&e.append($.toLocationSymbol(this.location[Q.LEFT])),e.append($.toLocationSymbol(this.location[Q.ON])),this.location.length>1&&e.append($.toLocationSymbol(this.location[Q.RIGHT])),e.toString()}},{key:"setLocations",value:function(e,t,n){this.location[Q.ON]=e,this.location[Q.LEFT]=t,this.location[Q.RIGHT]=n}},{key:"get",value:function(e){return e<this.location.length?this.location[e]:$.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===$.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(1===arguments.length){var e=arguments[0];this.setLocation(Q.ON,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.location[t]=n}}},{key:"init",value:function(e){this.location=new Array(e).fill(null),this.setAllLocations($.NONE)}},{key:"isEqualOnSide",value:function(e,t){return this.location[t]===e.location[t]}},{key:"allPositionsEqual",value:function(e){for(var t=0;t<this.location.length;t++)if(this.location[t]!==e)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[Q.ON]=n}else if(arguments[0]instanceof e){var i=arguments[0];if(this.init(i.location.length),null!==i)for(var r=0;r<this.location.length;r++)this.location[r]=i.location[r]}}else if(3===arguments.length){var s=arguments[0],o=arguments[1],a=arguments[2];this.init(3),this.location[Q.ON]=s,this.location[Q.LEFT]=o,this.location[Q.RIGHT]=a}}}])}(),Bt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getGeometryCount",value:function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e}},{key:"setAllLocations",value:function(e,t){this.elt[e].setAllLocations(t)}},{key:"isNull",value:function(e){return this.elt[e].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(1===arguments.length){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}}},{key:"isLine",value:function(e){return this.elt[e].isLine()}},{key:"merge",value:function(e){for(var t=0;t<2;t++)null===this.elt[t]&&null!==e.elt[t]?this.elt[t]=new Lt(e.elt[t]):this.elt[t].merge(e.elt[t])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(1===arguments.length){var e=arguments[0];return this.elt[e].get(Q.ON)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}}},{key:"toString",value:function(){var e=new se;return null!==this.elt[0]&&(e.append("A:"),e.append(this.elt[0].toString())),null!==this.elt[1]&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()}},{key:"isArea",value:function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var e=arguments[0];return this.elt[e].isArea()}}},{key:"isAnyNull",value:function(e){return this.elt[e].isAnyNull()}},{key:"setLocation",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(Q.ON,t)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}}},{key:"isEqualOnSide",value:function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)}},{key:"allPositionsEqual",value:function(e,t){return this.elt[e].allPositionsEqual(t)}},{key:"toLine",value:function(e){this.elt[e].isArea()&&(this.elt[e]=new Lt(this.elt[e].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Lt(t),this.elt[1]=new Lt(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new Lt(n.elt[0]),this.elt[1]=new Lt(n.elt[1])}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.elt[0]=new Lt($.NONE),this.elt[1]=new Lt($.NONE),this.elt[i].setLocation(r)}else if(3===arguments.length){var s=arguments[0],o=arguments[1],a=arguments[2];this.elt[0]=new Lt(s,o,a),this.elt[1]=new Lt(s,o,a)}else if(4===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2],h=arguments[3];this.elt[0]=new Lt($.NONE,$.NONE,$.NONE),this.elt[1]=new Lt($.NONE,$.NONE,$.NONE),this.elt[l].setLocations(c,u,h)}}},{key:"toLineLabel",value:function(t){for(var n=new e($.NONE),i=0;i<2;i++)n.setLocation(i,t.getLocation(i));return n}}])}(),Nt=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(null!==this._ring)return null;for(var e=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)e[t]=this._pts.get(t);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=he.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return 1===this._label.getGeometryCount()}},{key:"computePoints",value:function(e){this._startDe=e;var t=e,n=!0;do{if(null===t)throw new fe("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new fe("Directed Edge visited twice during ring-building at "+t.getCoordinate());this._edges.add(t);var i=t.getLabel();F.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(t.getEdge(),t.isForward(),n),n=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(e){return this._pts.get(e)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var e=this._startDe;do{var t=e.getNode().getEdges().getOutgoingDegree(this);t>this._maxNodeDegree&&(this._maxNodeDegree=t),e=this.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(e,t,n){var i=e.getCoordinates();if(t){var r=1;n&&(r=0);for(var s=r;s<i.length;s++)this._pts.add(i[s])}else{var o=i.length-2;n&&(o=i.length-1);for(var a=o;a>=0;a--)this._pts.add(i[a])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var e=this._startDe;do{e.getEdge().setInResult(!0),e=e.getNext()}while(e!==this._startDe)}},{key:"containsPoint",value:function(e){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(e))return!1;if(!Mt.isInRing(e,t.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(e))return!1;return!0}},{key:"addHole",value:function(e){this._holes.add(e)}},{key:"isShell",value:function(){return null===this._shell}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(1===arguments.length){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(2===arguments.length){var t=arguments[1],n=arguments[0].getLocation(t,Q.RIGHT);if(n===$.NONE)return null;if(this._label.getLocation(t)===$.NONE)return this._label.setLocation(t,n),null}}},{key:"setShell",value:function(e){this._shell=e,null!==e&&e.addHole(this)}},{key:"toPolygon",value:function(e){for(var t=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)t[n]=this._holes.get(n).getLinearRing();return e.createPolygon(this.getLinearRing(),t)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new ge,this._pts=new ge,this._label=new Bt($.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new ge,this._geometryFactory=null,0===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()}}}]),Ot=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"setEdgeRing",value:function(e,t){e.setMinEdgeRing(t)}},{key:"getNext",value:function(e){return e.getNextMin()}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Nt.constructor_.call(this,e,t)}}])}(Nt),Dt=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"buildMinimalRings",value:function(){var e=new ge,t=this._startDe;do{if(null===t.getMinEdgeRing()){var n=new Ot(t,this._geometryFactory);e.add(n)}t=t.getNext()}while(t!==this._startDe);return e}},{key:"setEdgeRing",value:function(e,t){e.setEdgeRing(t)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var e=this._startDe;do{e.getNode().getEdges().linkMinimalDirectedEdges(this),e=e.getNext()}while(e!==this._startDe)}},{key:"getNext",value:function(e){return e.getNext()}}],[{key:"constructor_",value:function(){var e=arguments[0],t=arguments[1];Nt.constructor_.call(this,e,t)}}])}(Nt),Ft=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(e){this._isVisited=e}},{key:"setInResult",value:function(e){this._isInResult=e}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(e){this._label=e}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(e){this._isCovered=e,this._isCoveredSet=!0}},{key:"updateIM",value:function(e){F.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._label=e}}}]),Ut=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"isIncidentEdgeInResult",value:function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();)if(e.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return 1===this._label.getGeometryCount()}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(e){e.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(e){}},{key:"computeMergedLocation",value:function(e,t){var n=$.NONE;if(n=this._label.getLocation(t),!e.isNull(t)){var i=e.getLocation(t);n!==$.BOUNDARY&&(n=i)}return n}},{key:"setLabel",value:function(){if(2!==arguments.length||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return d(i,"setLabel",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1];null===this._label?this._label=new Bt(e,t):this._label.setLocation(e,t)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof i){var e=arguments[0];this.mergeLabel(e._label)}else if(arguments[0]instanceof Bt)for(var t=arguments[0],n=0;n<2;n++){var r=this.computeMergedLocation(t,n);this._label.getLocation(n)===$.NONE&&this._label.setLocation(n,r)}}},{key:"add",value:function(e){this._edges.insert(e),e.setNode(this)}},{key:"setLabelBoundary",value:function(e){if(null===this._label)return null;var t=$.NONE;null!==this._label&&(t=this._label.getLocation(e));var n=null;switch(t){case $.BOUNDARY:n=$.INTERIOR;break;case $.INTERIOR:default:n=$.BOUNDARY}this._label.setLocation(e,n)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var e=arguments[0],t=arguments[1];this._coord=e,this._edges=t,this._label=new Bt(0,$.NONE)}}])}(Ft),zt=function(e){function i(){return n(this,i),t(this,i,arguments)}return c(i,e),s(i)}(tt);function Gt(e){return null==e?0:e.color}function Vt(e){return null==e?null:e.parent}function Ht(e,t){null!==e&&(e.color=t)}function jt(e){return null==e?null:e.left}function Wt(e){return null==e?null:e.right}var $t=function(e){function i(){var e;return n(this,i),(e=t(this,i)).root_=null,e.size_=0,e}return c(i,e),s(i,[{key:"get",value:function(e){for(var t=this.root_;null!==t;){var n=e.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return t.value;t=t.right}}return null}},{key:"put",value:function(e,t){if(null===this.root_)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,(i=e.compareTo(r.key))<0)r=r.left;else{if(!(i>0)){var s=r.value;return r.value=t,s}r=r.right}}while(null!==r);var o={key:e,left:null,right:null,value:t,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=o:n.right=o,this.fixAfterInsertion(o),this.size_++,null}},{key:"fixAfterInsertion",value:function(e){var t;for(e.color=1;null!=e&&e!==this.root_&&1===e.parent.color;)Vt(e)===jt(Vt(Vt(e)))?1===Gt(t=Wt(Vt(Vt(e))))?(Ht(Vt(e),0),Ht(t,0),Ht(Vt(Vt(e)),1),e=Vt(Vt(e))):(e===Wt(Vt(e))&&(e=Vt(e),this.rotateLeft(e)),Ht(Vt(e),0),Ht(Vt(Vt(e)),1),this.rotateRight(Vt(Vt(e)))):1===Gt(t=jt(Vt(Vt(e))))?(Ht(Vt(e),0),Ht(t,0),Ht(Vt(Vt(e)),1),e=Vt(Vt(e))):(e===jt(Vt(e))&&(e=Vt(e),this.rotateRight(e)),Ht(Vt(e),0),Ht(Vt(Vt(e)),1),this.rotateLeft(Vt(Vt(e))));this.root_.color=0}},{key:"values",value:function(){var e=new ge,t=this.getFirstEntry();if(null!==t)for(e.add(t.value);null!==(t=i.successor(t));)e.add(t.value);return e}},{key:"entrySet",value:function(){var e=new J,t=this.getFirstEntry();if(null!==t)for(e.add(t);null!==(t=i.successor(t));)e.add(t);return e}},{key:"rotateLeft",value:function(e){if(null!=e){var t=e.right;e.right=t.left,null!=t.left&&(t.left.parent=e),t.parent=e.parent,null==e.parent?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}}},{key:"rotateRight",value:function(e){if(null!=e){var t=e.left;e.left=t.right,null!=t.right&&(t.right.parent=e),t.parent=e.parent,null==e.parent?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}}},{key:"getFirstEntry",value:function(){var e=this.root_;if(null!=e)for(;null!=e.left;)e=e.left;return e}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(e){for(var t=this.root_;null!==t;){var n=e.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return!0;t=t.right}}return!1}}],[{key:"successor",value:function(e){var t;if(null===e)return null;if(null!==e.right){for(t=e.right;null!==t.left;)t=t.left;return t}t=e.parent;for(var n=e;null!==t&&n===t.right;)n=t,t=t.parent;return t}}])}(zt),Xt=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"find",value:function(e){return this.nodeMap.get(e)}},{key:"addNode",value:function(){if(arguments[0]instanceof V){var e=arguments[0],t=this.nodeMap.get(e);return null===t&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}if(arguments[0]instanceof Ut){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return null===i?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}}},{key:"print",value:function(e){for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(e){for(var t=new ge,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(e)===$.BOUNDARY&&t.add(i)}return t}},{key:"add",value:function(e){var t=e.getCoordinate();this.addNode(t).add(e)}}],[{key:"constructor_",value:function(){this.nodeMap=new $t,this.nodeFact=null;var e=arguments[0];this.nodeFact=e}}]),qt=function(){function e(){n(this,e)}return s(e,null,[{key:"isNorthern",value:function(t){return t===e.NE||t===e.NW}},{key:"isOpposite",value:function(e,t){return e!==t&&2==(e-t+4)%4}},{key:"commonHalfPlane",value:function(e,t){if(e===t)return e;if(2==(e-t+4)%4)return-1;var n=e<t?e:t;return 0===n&&3===(e>t?e:t)?3:n}},{key:"isInHalfPlane",value:function(t,n){return n===e.SE?t===e.SE||t===e.SW:t===n||t===n+1}},{key:"quadrant",value:function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];if(0===t&&0===n)throw new _("Cannot compute the quadrant for point ( "+t+", "+n+" )");return t>=0?n>=0?e.NE:e.SE:n>=0?e.NW:e.SW}if(arguments[0]instanceof V&&arguments[1]instanceof V){var i=arguments[0],r=arguments[1];if(r.x===i.x&&r.y===i.y)throw new _("Cannot compute the quadrant for two identical points "+i);return r.x>=i.x?r.y>=i.y?e.NE:e.SE:r.y>=i.y?e.NW:e.SW}}}])}();qt.NE=0,qt.NW=1,qt.SW=2,qt.SE=3;var Kt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"compareDirection",value:function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:he.index(e._p0,e._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(e){this._node=e}},{key:"print",value:function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);e.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)}},{key:"compareTo",value:function(e){var t=e;return this.compareDirection(t)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label}},{key:"computeLabel",value:function(e){}},{key:"init",value:function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=qt.quadrant(this._dx,this._dy),F.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];e.constructor_.call(this,n,i,r,null)}else if(4===arguments.length){var s=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];e.constructor_.call(this,s),this.init(o,a),this._label=l}}}])}(),Yt=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(e){return this._depth[e]}},{key:"setVisited",value:function(e){this._isVisited=e}},{key:"computeDirectedLabel",value:function(){this._label=new Bt(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(e,t){if(-999!==this._depth[e]&&this._depth[e]!==t)throw new fe("assigned depths do not match",this.getCoordinate());this._depth[e]=t}},{key:"isInteriorAreaEdge",value:function(){for(var e=!0,t=0;t<2;t++)this._label.isArea(t)&&this._label.getLocation(t,Q.LEFT)===$.INTERIOR&&this._label.getLocation(t,Q.RIGHT)===$.INTERIOR||(e=!1);return e}},{key:"setNextMin",value:function(e){this._nextMin=e}},{key:"print",value:function(e){d(i,"print",this,1).call(this,e),e.print(" "+this._depth[Q.LEFT]+"/"+this._depth[Q.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")}},{key:"setMinEdgeRing",value:function(e){this._minEdgeRing=e}},{key:"isLineEdge",value:function(){var e=this._label.isLine(0)||this._label.isLine(1),t=!this._label.isArea(0)||this._label.allPositionsEqual(0,$.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,$.EXTERIOR);return e&&t&&n}},{key:"setEdgeRing",value:function(e){this._edgeRing=e}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var e=this._edge.getDepthDelta();return this._isForward||(e=-e),e}},{key:"setInResult",value:function(e){this._isInResult=e}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(e){this.print(e),e.print(" "),this._isForward?this._edge.print(e):this._edge.printReverse(e)}},{key:"setSym",value:function(e){this._sym=e}},{key:"setVisitedEdge",value:function(e){this.setVisited(e),this._sym.setVisited(e)}},{key:"setEdgeDepths",value:function(e,t){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var i=1;e===Q.LEFT&&(i=-1);var r=Q.opposite(e),s=t+n*i;this.setDepth(e,t),this.setDepth(r,s)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(e){this._next=e}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var e=arguments[0],t=arguments[1];if(Kt.constructor_.call(this,e),this._isForward=t,t)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var n=e.getNumPoints()-1;this.init(e.getCoordinate(n),e.getCoordinate(n-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(e,t){return e===$.EXTERIOR&&t===$.INTERIOR?1:e===$.INTERIOR&&t===$.EXTERIOR?-1:0}}])}(Kt),Jt=s(function e(){n(this,e)},[{key:"createNode",value:function(e){return new Ut(e,null)}}]),Zt=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(e){e.println("Edges:");for(var t=0;t<this._edges.size();t++){e.println("edge "+t+":");var n=this._edges.get(t);n.print(e),n.eiList.print(e)}}},{key:"find",value:function(e){return this._nodes.find(e)}},{key:"addNode",value:function(){if(arguments[0]instanceof Ut){var e=arguments[0];return this._nodes.addNode(e)}if(arguments[0]instanceof V){var t=arguments[0];return this._nodes.addNode(t)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(e){_e.out.println(e)}},{key:"isBoundaryNode",value:function(e,t){var n=this._nodes.find(t);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(e)===$.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(e,t,n,i){return!!e.equals(n)&&he.index(e,t,i)===he.COLLINEAR&&qt.quadrant(e,t)===qt.quadrant(n,i)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(e){_e.out.print(e)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(e,t){for(var n=0;n<this._edges.size();n++){var i=this._edges.get(n),r=i.getCoordinates();if(this.matchInSameDirection(e,t,r[0],r[1]))return i;if(this.matchInSameDirection(e,t,r[r.length-1],r[r.length-2]))return i}return null}},{key:"insertEdge",value:function(e){this._edges.add(e)}},{key:"findEdgeEnd",value:function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null}},{key:"addEdges",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();this._edges.add(n);var i=new Yt(n,!0),r=new Yt(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}}},{key:"add",value:function(e){this._nodes.add(e),this._edgeEndList.add(e)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(e,t){for(var n=0;n<this._edges.size();n++){var i=this._edges.get(n),r=i.getCoordinates();if(e.equals(r[0])&&t.equals(r[1]))return i}return null}}],[{key:"constructor_",value:function(){if(this._edges=new ge,this._nodes=null,this._edgeEndList=new ge,0===arguments.length)this._nodes=new Xt(new Jt);else if(1===arguments.length){var e=arguments[0];this._nodes=new Xt(e)}}},{key:"linkResultDirectedEdges",value:function(e){for(var t=e.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()}}]),Qt=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"sortShellsAndHoles",value:function(e,t,n){for(var i=e.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):t.add(r)}}},{key:"computePolygons",value:function(e){for(var t=new ge,n=e.iterator();n.hasNext();){var i=n.next().toPolygon(this._geometryFactory);t.add(i)}return t}},{key:"placeFreeHoles",value:function(t,n){for(var i=n.iterator();i.hasNext();){var r=i.next();if(null===r.getShell()){var s=e.findEdgeRingContaining(r,t);if(null===s)throw new fe("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(s)}}}},{key:"buildMinimalEdgeRings",value:function(e,t,n){for(var i=new ge,r=e.iterator();r.hasNext();){var s=r.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();var o=s.buildMinimalRings(),a=this.findShell(o);null!==a?(this.placePolygonHoles(a,o),t.add(a)):n.addAll(o)}else i.add(s)}return i}},{key:"buildMaximalEdgeRings",value:function(e){for(var t=new ge,n=e.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new Dt(i,this._geometryFactory);t.add(r),r.setInResult()}}return t}},{key:"placePolygonHoles",value:function(e,t){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(e)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(e){for(var t=0,n=null,i=e.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,t++)}return F.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n}},{key:"add",value:function(){if(1===arguments.length){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(2===arguments.length){var t=arguments[0],n=arguments[1];Zt.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(t),r=new ge,s=this.buildMinimalEdgeRings(i,this._shellList,r);this.sortShellsAndHoles(s,this._shellList,r),this.placeFreeHoles(this._shellList,r)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new ge;var e=arguments[0];this._geometryFactory=e}},{key:"findEdgeRingContaining",value:function(e,t){for(var n=e.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),s=null,o=null,a=t.iterator();a.hasNext();){var l=a.next(),c=l.getLinearRing(),u=c.getEnvelopeInternal();if(!u.equals(i)&&u.contains(i)){r=qe.ptNotInList(n.getCoordinates(),c.getCoordinates());var h=!1;Mt.isInRing(r,c.getCoordinates())&&(h=!0),h&&(null===s||o.contains(u))&&(o=(s=l).getLinearRing().getEnvelopeInternal())}}return s}}])}(),en=s(function e(){n(this,e)},[{key:"getBounds",value:function(){}}]),tn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[en,x]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t}}]),nn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(e){for(var t=null,n=this._items.get(e);2*e<=this._size&&((t=2*e)!==this._size&&this._items.get(t+1).compareTo(this._items.get(t))<0&&t++,this._items.get(t).compareTo(n)<0);e=t)this._items.set(e,this._items.get(t));this._items.set(e,n)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return 0===this._size}},{key:"add",value:function(e){this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)this._items.set(t,this._items.get(Math.trunc(t/2)));this._items.set(t,e)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new ge,this._items.add(null)}}]),rn=s(function e(){n(this,e)},[{key:"insert",value:function(e,t){}},{key:"remove",value:function(e,t){}},{key:"query",value:function(){}}]),sn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(e){F.isTrue(null===this._bounds),this._childBoundables.add(e)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[en,x]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new ge,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._level=e}}}]),on={reverseOrder:function(){return{compare:function(e,t){return t.compareTo(e)}}},min:function(e){return on.sort(e),e.get(0)},sort:function(e,t){var n=e.toArray();t?Be.sort(n,t):Be.sort(n);for(var i=e.iterator(),r=0,s=n.length;r<s;r++)i.next(),i.set(n[r])},singletonList:function(e){var t=new ge;return t.add(e),t}},an=function(){function e(){n(this,e)}return s(e,null,[{key:"maxDistance",value:function(t,n,i,r,s,o,a,l){var c=e.distance(t,n,s,o);return c=Math.max(c,e.distance(t,n,a,l)),c=Math.max(c,e.distance(i,r,s,o)),Math.max(c,e.distance(i,r,a,l))}},{key:"distance",value:function(e,t,n,i){var r=n-e,s=i-t;return Math.sqrt(r*r+s*s)}},{key:"maximumDistance",value:function(t,n){var i=Math.min(t.getMinX(),n.getMinX()),r=Math.min(t.getMinY(),n.getMinY()),s=Math.max(t.getMaxX(),n.getMaxX()),o=Math.max(t.getMaxY(),n.getMaxY());return e.distance(i,r,s,o)}},{key:"minMaxDistance",value:function(t,n){var i=t.getMinX(),r=t.getMinY(),s=t.getMaxX(),o=t.getMaxY(),a=n.getMinX(),l=n.getMinY(),c=n.getMaxX(),u=n.getMaxY(),h=e.maxDistance(i,r,i,o,a,l,a,u);return h=Math.min(h,e.maxDistance(i,r,i,o,a,l,c,l)),h=Math.min(h,e.maxDistance(i,r,i,o,c,u,a,u)),h=Math.min(h,e.maxDistance(i,r,i,o,c,u,c,l)),h=Math.min(h,e.maxDistance(i,r,s,r,a,l,a,u)),h=Math.min(h,e.maxDistance(i,r,s,r,a,l,c,l)),h=Math.min(h,e.maxDistance(i,r,s,r,c,u,a,u)),h=Math.min(h,e.maxDistance(i,r,s,r,c,u,c,l)),h=Math.min(h,e.maxDistance(s,o,i,o,a,l,a,u)),h=Math.min(h,e.maxDistance(s,o,i,o,a,l,c,l)),h=Math.min(h,e.maxDistance(s,o,i,o,c,u,a,u)),h=Math.min(h,e.maxDistance(s,o,i,o,c,u,c,l)),h=Math.min(h,e.maxDistance(s,o,s,r,a,l,a,u)),h=Math.min(h,e.maxDistance(s,o,s,r,a,l,c,l)),h=Math.min(h,e.maxDistance(s,o,s,r,c,u,a,u)),Math.min(h,e.maxDistance(s,o,s,r,c,u,c,l))}}])}(),ln=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"maximumDistance",value:function(){return an.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(t,n){var i=e.isComposite(this._boundable1),r=e.isComposite(this._boundable2);if(i&&r)return e.area(this._boundable1)>e.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,t,n),null):(this.expand(this._boundable2,this._boundable1,!0,t,n),null);if(i)return this.expand(this._boundable1,this._boundable2,!1,t,n),null;if(r)return this.expand(this._boundable2,this._boundable1,!0,t,n),null;throw new _("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(e.isComposite(this._boundable1)||e.isComposite(this._boundable2))}},{key:"compareTo",value:function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0}},{key:"expand",value:function(t,n,i,r,s){for(var o=t.getChildBoundables().iterator();o.hasNext();){var a=o.next(),l=null;(l=i?new e(n,a,this._itemDistance):new e(a,n,this._itemDistance)).getDistance()<s&&r.add(l)}}},{key:"getBoundable",value:function(e){return 0===e?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()}},{key:"area",value:function(e){return e.getBounds().getArea()}},{key:"isComposite",value:function(e){return e instanceof sn}}])}(),cn=s(function e(){n(this,e)},[{key:"visitItem",value:function(e){}}]),un=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"queryInternal",value:function(){if(re(arguments[2],cn)&&arguments[0]instanceof Object&&arguments[1]instanceof sn)for(var e=arguments[0],t=arguments[2],n=arguments[1].getChildBoundables(),i=0;i<n.size();i++){var r=n.get(i);this.getIntersectsOp().intersects(r.getBounds(),e)&&(r instanceof sn?this.queryInternal(e,r,t):r instanceof tn?t.visitItem(r.getItem()):F.shouldNeverReachHere())}else if(re(arguments[2],ne)&&arguments[0]instanceof Object&&arguments[1]instanceof sn)for(var s=arguments[0],o=arguments[2],a=arguments[1].getChildBoundables(),l=0;l<a.size();l++){var c=a.get(l);this.getIntersectsOp().intersects(c.getBounds(),s)&&(c instanceof sn?this.queryInternal(s,c,o):c instanceof tn?o.add(c.getItem()):F.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(e){return e.get(e.size()-1)}},{key:"size",value:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();n instanceof sn?e+=this.size(n):n instanceof tn&&(e+=1)}return e}}},{key:"removeItem",value:function(e,t){for(var n=null,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof tn&&r.getItem()===t&&(n=r)}return null!==n&&(e.getChildBoundables().remove(n),!0)}},{key:"itemsTree",value:function(){if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new ge:e}if(1===arguments.length){for(var t=arguments[0],n=new ge,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof sn){var s=this.itemsTree(r);null!==s&&n.add(s)}else r instanceof tn?n.add(r.getItem()):F.shouldNeverReachHere()}return n.size()<=0?null:n}}},{key:"insert",value:function(e,t){F.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new tn(e,t))}},{key:"boundablesAtLevel",value:function(){if(1===arguments.length){var e=arguments[0],t=new ge;return this.boundablesAtLevel(e,this._root,t),t}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(F.isTrue(n>-2),i.getLevel()===n)return r.add(i),null;for(var s=i.getChildBoundables().iterator();s.hasNext();){var o=s.next();o instanceof sn?this.boundablesAtLevel(n,o,r):(F.isTrue(o instanceof tn),-1===n&&r.add(o))}return null}}},{key:"query",value:function(){if(1===arguments.length){var e=arguments[0];this.build();var t=new ge;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.queryInternal(e,this._root,t),t}if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.queryInternal(n,this._root,i)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,t)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=this.removeItem(i,r);if(s)return!0;for(var o=null,a=i.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(this.getIntersectsOp().intersects(l.getBounds(),n)&&l instanceof sn&&(s=this.remove(n,l,r))){o=l;break}}return null!==o&&o.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(o),s}}},{key:"createHigherLevels",value:function(e,t){F.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,t+1)}},{key:"depth",value:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();if(n instanceof sn){var i=this.depth(n);i>e&&(e=i)}}return e+1}}},{key:"createParentBoundables",value:function(e,t){F.isTrue(!e.isEmpty());var n=new ge;n.add(this.createNode(t));var i=new ge(e);on.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var s=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(s)}return n}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new ge,this._nodeCapacity=null,0===arguments.length)e.constructor_.call(this,e.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];F.isTrue(t>1,"Node capacity must be greater than 1"),this._nodeCapacity=t}}},{key:"compareDoubles",value:function(e,t){return e>t?1:e<t?-1:0}}])}();un.IntersectsOp=function(){},un.DEFAULT_NODE_CAPACITY=10;var hn=s(function e(){n(this,e)},[{key:"distance",value:function(e,t){}}]),dn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"createParentBoundablesFromVerticalSlices",value:function(e,t){F.isTrue(e.length>0);for(var n=new ge,i=0;i<e.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(e[i],t));return n}},{key:"nearestNeighbourK",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.nearestNeighbourK(e,B.POSITIVE_INFINITY,t)}if(3===arguments.length){var n=arguments[0],r=arguments[2],s=arguments[1],o=new nn;o.add(n);for(var a=new nn;!o.isEmpty()&&s>=0;){var l=o.poll(),c=l.getDistance();if(c>=s)break;l.isLeaves()?a.size()<r?a.add(l):(a.peek().getDistance()>c&&(a.poll(),a.add(l)),s=a.peek().getDistance()):l.expandToQueue(o,s)}return i.getItems(a)}}},{key:"createNode",value:function(e){return new fn(e)}},{key:"size",value:function(){return 0===arguments.length?d(i,"size",this,1).call(this):d(i,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof j))return d(i,"insert",this,1).apply(this,arguments);var e=arguments[0],t=arguments[1];if(e.isNull())return null;d(i,"insert",this,1).call(this,e,t)}},{key:"getIntersectsOp",value:function(){return i.intersectsOp}},{key:"verticalSlices",value:function(e,t){for(var n=Math.trunc(Math.ceil(e.size()/t)),i=new Array(t).fill(null),r=e.iterator(),s=0;s<t;s++){i[s]=new ge;for(var o=0;r.hasNext()&&o<n;){var a=r.next();i[s].add(a),o++}}return i}},{key:"query",value:function(){if(1===arguments.length){var e=arguments[0];return d(i,"query",this,1).call(this,e)}if(2===arguments.length){var t=arguments[0],n=arguments[1];d(i,"query",this,1).call(this,t,n)}}},{key:"getComparator",value:function(){return i.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(e,t){return d(i,"createParentBoundables",this,1).call(this,e,t)}},{key:"remove",value:function(){if(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof j){var e=arguments[0],t=arguments[1];return d(i,"remove",this,1).call(this,e,t)}return d(i,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return 0===arguments.length?d(i,"depth",this,1).call(this):d(i,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(e,t){F.isTrue(!e.isEmpty());var n=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),r=new ge(e);on.sort(r,i.xComparator);var s=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(s,t)}},{key:"nearestNeighbour",value:function(){if(1===arguments.length){if(re(arguments[0],hn)){var e=arguments[0];if(this.isEmpty())return null;var t=new ln(this.getRoot(),this.getRoot(),e);return this.nearestNeighbour(t)}if(arguments[0]instanceof ln){var n=arguments[0],i=B.POSITIVE_INFINITY,r=null,s=new nn;for(s.add(n);!s.isEmpty()&&i>0;){var o=s.poll(),a=o.getDistance();if(a>=i)break;o.isLeaves()?(i=a,r=o):o.expandToQueue(s,i)}return null===r?null:[r.getBoundable(0).getItem(),r.getBoundable(1).getItem()]}}else{if(2===arguments.length){var l=arguments[0],c=arguments[1];if(this.isEmpty()||l.isEmpty())return null;var u=new ln(this.getRoot(),l.getRoot(),c);return this.nearestNeighbour(u)}if(3===arguments.length){var h=arguments[2],d=new tn(arguments[0],arguments[1]),f=new ln(this.getRoot(),d,h);return this.nearestNeighbour(f)[0]}if(4===arguments.length){var p=arguments[2],g=arguments[3],m=new tn(arguments[0],arguments[1]),y=new ln(this.getRoot(),m,p);return this.nearestNeighbourK(y,g)}}}},{key:"isWithinDistance",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],n=B.POSITIVE_INFINITY,i=new nn;for(i.add(e);!i.isEmpty();){var r=i.poll(),s=r.getDistance();if(s>t)return!1;if(r.maximumDistance()<=t)return!0;if(r.isLeaves()){if((n=s)<=t)return!0}else r.expandToQueue(i,n)}return!1}if(3===arguments.length){var o=arguments[0],a=arguments[1],l=arguments[2],c=new ln(this.getRoot(),o.getRoot(),a);return this.isWithinDistance(c,l)}}},{key:"interfaces_",get:function(){return[rn,x]}}],[{key:"constructor_",value:function(){if(0===arguments.length)i.constructor_.call(this,i.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var e=arguments[0];un.constructor_.call(this,e)}}},{key:"centreX",value:function(e){return i.avg(e.getMinX(),e.getMaxX())}},{key:"avg",value:function(e,t){return(e+t)/2}},{key:"getItems",value:function(e){for(var t=new Array(e.size()).fill(null),n=0;!e.isEmpty();){var i=e.poll();t[n]=i.getBoundable(0).getItem(),n++}return t}},{key:"centreY",value:function(e){return i.avg(e.getMinY(),e.getMaxY())}}])}(un),fn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"computeBounds",value:function(){for(var e=null,t=this.getChildBoundables().iterator();t.hasNext();){var n=t.next();null===e?e=new j(n.getBounds()):e.expandToInclude(n.getBounds())}return e}}],[{key:"constructor_",value:function(){var e=arguments[0];sn.constructor_.call(this,e)}}])}(sn);dn.STRtreeNode=fn,dn.xComparator=new(s(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[N]}},{key:"compare",value:function(e,t){return un.compareDoubles(dn.centreX(e.getBounds()),dn.centreX(t.getBounds()))}}])),dn.yComparator=new(s(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[N]}},{key:"compare",value:function(e,t){return un.compareDoubles(dn.centreY(e.getBounds()),dn.centreY(t.getBounds()))}}])),dn.intersectsOp=new(s(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(e,t){return e.intersects(t)}}])),dn.DEFAULT_NODE_CAPACITY=10;var pn=function(){function e(){n(this,e)}return s(e,null,[{key:"relativeSign",value:function(e,t){return e<t?-1:e>t?1:0}},{key:"compare",value:function(t,n,i){if(n.equals2D(i))return 0;var r=e.relativeSign(n.x,i.x),s=e.relativeSign(n.y,i.y);switch(t){case 0:return e.compareValue(r,s);case 1:return e.compareValue(s,r);case 2:return e.compareValue(s,-r);case 3:return e.compareValue(-r,s);case 4:return e.compareValue(-r,-s);case 5:return e.compareValue(-s,-r);case 6:return e.compareValue(-s,r);case 7:return e.compareValue(r,-s)}return F.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0}}])}(),gn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:this._isInterior?t._isInterior?pn.compare(this._segmentOctant,this.coord,t.coord):1:-1}},{key:"isEndPoint",value:function(e){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===e}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._segString=e,this.coord=new V(t),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!t.equals2D(e.getCoordinate(n))}}]),mn=s(function e(){n(this,e)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),yn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var e=new Xe;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next();this.addEdgeCoordinates(n,i,e),n=i}return e.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var e=new ge;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var t=e.iterator();t.hasNext();){var n=t.next().intValue();this.add(this._edge.getCoordinate(n),n)}}},{key:"createSplitEdgePts",value:function(e,t){var n=t.segmentIndex-e.segmentIndex+2;if(2===n)return[new V(e.coord),new V(t.coord)];var i=this._edge.getCoordinate(t.segmentIndex),r=t.isInterior()||!t.coord.equals2D(i);r||n--;var s=new Array(n).fill(null),o=0;s[o++]=new V(e.coord);for(var a=e.segmentIndex+1;a<=t.segmentIndex;a++)s[o++]=this._edge.getCoordinate(a);return r&&(s[o]=new V(t.coord)),s}},{key:"print",value:function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"findCollapsesFromExistingVertices",value:function(e){for(var t=0;t<this._edge.size()-2;t++){var n=this._edge.getCoordinate(t);this._edge.getCoordinate(t+1);var i=this._edge.getCoordinate(t+2);n.equals2D(i)&&e.add(oe.valueOf(t+1))}}},{key:"addEdgeCoordinates",value:function(e,t,n){var i=this.createSplitEdgePts(e,t);n.add(i,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(e){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);e.add(r),n=i}}},{key:"findCollapseIndex",value:function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var i=t.segmentIndex-e.segmentIndex;return t.isInterior()||i--,1===i&&(n[0]=e.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(e){for(var t=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,t)&&e.add(oe.valueOf(t[0])),i=r}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)}},{key:"createSplitEdge",value:function(e,t){var n=this.createSplitEdgePts(e,t);return new En(n,this._edge.getData())}},{key:"add",value:function(e,t){var n=new gn(this._edge,e,t,this._edge.getSegmentOctant(t)),i=this._nodeMap.get(n);return null!==i?(F.isTrue(i.coord.equals2D(e),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)}},{key:"checkSplitEdgesCorrectness",value:function(e){var t=this._edge.getCoordinates(),n=e.get(0).getCoordinate(0);if(!n.equals2D(t[0]))throw new O("bad split edge start point at "+n);var i=e.get(e.size()-1).getCoordinates(),r=i[i.length-1];if(!r.equals2D(t[t.length-1]))throw new O("bad split edge end point at "+r)}}],[{key:"constructor_",value:function(){this._nodeMap=new $t,this._edge=null;var e=arguments[0];this._edge=e}}]),vn=function(){function e(){n(this,e)}return s(e,null,[{key:"octant",value:function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];if(0===t&&0===n)throw new _("Cannot compute the octant for point ( "+t+", "+n+" )");var i=Math.abs(t),r=Math.abs(n);return t>=0?n>=0?i>=r?0:1:i>=r?7:6:n>=0?i>=r?3:2:i>=r?4:5}if(arguments[0]instanceof V&&arguments[1]instanceof V){var s=arguments[0],o=arguments[1],a=o.x-s.x,l=o.y-s.y;if(0===a&&0===l)throw new _("Cannot compute the octant for two identical points "+s);return e.octant(a,l)}}}])}(),_n=s(function e(){n(this,e)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(e){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(e){}},{key:"getData",value:function(){}}]),bn=s(function e(){n(this,e)},[{key:"addIntersection",value:function(e,t){}},{key:"interfaces_",get:function(){return[_n]}}]),En=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(e){return this._pts[e]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))}},{key:"setData",value:function(e){this._data=e}},{key:"safeOctant",value:function(e,t){return e.equals2D(t)?0:vn.octant(e,t)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(4===arguments.length){var n=arguments[1],i=arguments[3],r=new V(arguments[0].getIntersection(i));this.addIntersection(r,n)}}},{key:"toString",value:function(){return It.toLineString(new Ze(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(e,t){var n=t,i=n+1;if(i<this._pts.length){var r=this._pts[i];e.equals2D(r)&&(n=i)}return this._nodeList.add(e,n)}},{key:"addIntersections",value:function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++)this.addIntersection(e,t,n,i)}},{key:"interfaces_",get:function(){return[bn]}}],[{key:"constructor_",value:function(){this._nodeList=new yn(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t}},{key:"getNodedSubstrings",value:function(){if(1===arguments.length){var t=arguments[0],n=new ge;return e.getNodedSubstrings(t,n),n}if(2===arguments.length)for(var i=arguments[1],r=arguments[0].iterator();r.hasNext();)r.next().getNodeList().addSplitEdges(i)}}])}(),wn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof e){var t=arguments[0],n=he.index(this.p0,this.p1,t.p0),i=he.index(this.p0,this.p1,t.p1);return n>=0&&i>=0||n<=0&&i<=0?Math.max(n,i):0}if(arguments[0]instanceof V){var r=arguments[0];return he.index(this.p0,this.p1,r)}}},{key:"toGeometry",value:function(e){return e.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(t){if(!(t instanceof e))return!1;var n=t;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)}},{key:"intersection",value:function(e){var t=new Rt;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof V){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new V(t);var n=this.projectionFactor(t),i=new V;return i.x=this.p0.x+n*(this.p1.x-this.p0.x),i.y=this.p0.y+n*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof e){var r=arguments[0],s=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(s>=1&&o>=1)return null;if(s<=0&&o<=0)return null;var a=this.project(r.p0);s<0&&(a=this.p0),s>1&&(a=this.p1);var l=this.project(r.p1);return o<0&&(l=this.p0),o>1&&(l=this.p1),new e(a,l)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(e){return 0===e?this.p0:this.p1}},{key:"distancePerpendicular",value:function(e){return Ee.pointToLinePerpendicular(e,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return e.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=t*t+n*n;return i<=0?B.NaN:((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/i}},{key:"closestPoints",value:function(e){var t=this.intersection(e);if(null!==t)return[t,t];var n=new Array(2).fill(null),i=B.MAX_VALUE,r=null,s=this.closestPoint(e.p0);i=s.distance(e.p0),n[0]=s,n[1]=e.p0;var o=this.closestPoint(e.p1);(r=o.distance(e.p1))<i&&(i=r,n[0]=o,n[1]=e.p1);var a=e.closestPoint(this.p0);(r=a.distance(this.p0))<i&&(i=r,n[0]=this.p0,n[1]=a);var l=e.closestPoint(this.p1);return(r=l.distance(this.p1))<i&&(i=r,n[0]=this.p1,n[1]=l),n}},{key:"closestPoint",value:function(e){var t=this.projectionFactor(e);return t>0&&t<1?this.project(e):this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(e){var t=e,n=this.p0.compareTo(t.p0);return 0!==n?n:this.p1.compareTo(t.p1)}},{key:"reverse",value:function(){var e=this.p0;this.p0=this.p1,this.p1=e}},{key:"equalsTopo",value:function(e){return this.p0.equals(e.p0)&&this.p1.equals(e.p1)||this.p0.equals(e.p1)&&this.p1.equals(e.p0)}},{key:"lineIntersection",value:function(e){return ve.intersection(this.p0,this.p1,e.p0,e.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),i=this.p0.y+e*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y,o=Math.sqrt(r*r+s*s),a=0,l=0;if(0!==t){if(o<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");a=t*r/o,l=t*s/o}return new V(n-l,i+a)}},{key:"setCoordinates",value:function(){if(1===arguments.length){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}}},{key:"segmentFraction",value:function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||B.isNaN(t))&&(t=1),t}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(e){var t=this.p1.getY()-this.p0.getY(),n=this.p0.getX()-this.p1.getX(),i=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),r=t*t+n*n,s=t*t-n*n,o=e.getX(),a=e.getY();return new V((-s*o-2*t*n*a-2*t*i)/r,(s*a-2*t*n*o-2*n*i)/r)}},{key:"distance",value:function(){if(arguments[0]instanceof e){var t=arguments[0];return Ee.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof V){var n=arguments[0];return Ee.pointToSegment(n,this.p0,this.p1)}}},{key:"pointAlong",value:function(e){var t=new V;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t}},{key:"hashCode",value:function(){var e=B.doubleToLongBits(this.p0.x);e^=31*B.doubleToLongBits(this.p0.y);var t=Math.trunc(e)^Math.trunc(e>>32),n=B.doubleToLongBits(this.p1.x);return n^=31*B.doubleToLongBits(this.p1.y),t^Math.trunc(n)^Math.trunc(n>>32)}},{key:"interfaces_",get:function(){return[E,x]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,0===arguments.length)e.constructor_.call(this,new V,new V);else if(1===arguments.length){var t=arguments[0];e.constructor_.call(this,t.p0,t.p1)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.p0=n,this.p1=i}else if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];e.constructor_.call(this,new V(r,s),new V(o,a))}}},{key:"midPoint",value:function(e,t){return new V((e.x+t.x)/2,(e.y+t.y)/2)}}])}(),xn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(2===arguments.length);else if(4===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[3];arguments[0].getLineSegment(e,this._overlapSeg1),t.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new wn,this._overlapSeg2=new wn}}]),An=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]}},{key:"computeSelect",value:function(e,t,n,i){var r=this._pts[t],s=this._pts[n];if(n-t==1)return i.select(this,t),null;if(!e.intersects(r,s))return null;var o=Math.trunc((t+n)/2);t<o&&this.computeSelect(e,t,o,i),o<n&&this.computeSelect(e,o,n,i)}},{key:"getCoordinates",value:function(){for(var e=new Array(this._end-this._start+1).fill(null),t=0,n=this._start;n<=this._end;n++)e[t++]=this._pts[n];return e}},{key:"computeOverlaps",value:function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.computeOverlaps(this._start,this._end,e,e._start,e._end,t)}else if(6===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=arguments[3],o=arguments[4],a=arguments[5];if(i-n==1&&o-s==1)return a.overlap(this,n,r,s),null;if(!this.overlaps(n,i,r,s,o))return null;var l=Math.trunc((n+i)/2),c=Math.trunc((s+o)/2);n<l&&(s<c&&this.computeOverlaps(n,l,r,s,c,a),c<o&&this.computeOverlaps(n,l,r,c,o,a)),l<i&&(s<c&&this.computeOverlaps(l,i,r,s,c,a),c<o&&this.computeOverlaps(l,i,r,c,o,a))}}},{key:"setId",value:function(e){this._id=e}},{key:"select",value:function(e,t){this.computeSelect(e,this._start,this._end,t)}},{key:"getEnvelope",value:function(){if(null===this._env){var e=this._pts[this._start],t=this._pts[this._end];this._env=new j(e,t)}return this._env}},{key:"overlaps",value:function(e,t,n,i,r){return j.intersects(this._pts[e],this._pts[t],n._pts[i],n._pts[r])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=i}}]),Sn=function(){function e(){n(this,e)}return s(e,null,[{key:"findChainEnd",value:function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var i=qt.quadrant(e[n],e[n+1]),r=t+1;r<e.length&&(e[r-1].equals2D(e[r])||qt.quadrant(e[r-1],e[r])===i);)r++;return r-1}},{key:"getChains",value:function(){if(1===arguments.length){var t=arguments[0];return e.getChains(t,null)}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new ge,s=0;do{var o=e.findChainEnd(n,s),a=new An(n,s,o,i);r.add(a),s=o}while(s<n.length-1);return r}}}])}(),Tn=s(function e(){n(this,e)},[{key:"computeNodes",value:function(e){}},{key:"getNodedSubstrings",value:function(){}}]),Cn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(e){this._segInt=e}},{key:"interfaces_",get:function(){return[Tn]}}],[{key:"constructor_",value:function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setSegmentIntersector(e)}}}]),In=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return En.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(e){for(var t=Sn.getChains(e.getCoordinates(),e).iterator();t.hasNext();){var n=t.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}}},{key:"computeNodes",value:function(e){this._nodedSegStrings=e;for(var t=e.iterator();t.hasNext();)this.add(t.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var e=new kn(this._segInt),t=this._monoChains.iterator();t.hasNext();)for(var n=t.next(),i=this._index.query(n.getEnvelope()).iterator();i.hasNext();){var r=i.next();if(r.getId()>n.getId()&&(n.computeOverlaps(r,e),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new ge,this._index=new dn,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,0===arguments.length);else if(1===arguments.length){var e=arguments[0];Cn.constructor_.call(this,e)}}}])}(Cn),kn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"overlap",value:function(){if(4!==arguments.length)return d(i,"overlap",this,1).apply(this,arguments);var e=arguments[1],t=arguments[2],n=arguments[3],r=arguments[0].getContext(),s=t.getContext();this._si.processIntersections(r,e,s,n)}}],[{key:"constructor_",value:function(){this._si=null;var e=arguments[0];this._si=e}}])}(xn);In.SegmentOverlapAction=kn;var Rn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"isDeletable",value:function(e,t,n,i){var r=this._inputLine[e],s=this._inputLine[t],o=this._inputLine[n];return!!this.isConcave(r,s,o)&&!!this.isShallow(r,s,o,i)&&this.isShallowSampled(r,s,e,n,i)}},{key:"deleteShallowConcavities",value:function(){for(var t=1,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n),r=!1;i<this._inputLine.length;){var s=!1;this.isDeletable(t,n,i,this._distanceTol)&&(this._isDeleted[n]=e.DELETE,s=!0,r=!0),t=s?i:n,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n)}return r}},{key:"isShallowConcavity",value:function(e,t,n,i){return he.index(e,t,n)===this._angleOrientation&&Ee.pointToSegment(t,e,n)<i}},{key:"isShallowSampled",value:function(t,n,i,r,s){var o=Math.trunc((r-i)/e.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var a=i;a<r;a+=o)if(!this.isShallow(t,n,this._inputLine[a],s))return!1;return!0}},{key:"isConcave",value:function(e,t,n){return he.index(e,t,n)===this._angleOrientation}},{key:"simplify",value:function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=he.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(t){for(var n=t+1;n<this._inputLine.length&&this._isDeleted[n]===e.DELETE;)n++;return n}},{key:"isShallow",value:function(e,t,n,i){return Ee.pointToSegment(t,e,n)<i}},{key:"collapseLine",value:function(){for(var t=new Xe,n=0;n<this._inputLine.length;n++)this._isDeleted[n]!==e.DELETE&&t.add(this._inputLine[n]);return t.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=he.COUNTERCLOCKWISE;var e=arguments[0];this._inputLine=e}},{key:"simplify",value:function(t,n){return new e(t).simplify(n)}}])}();Rn.INIT=0,Rn.DELETE=1,Rn.KEEP=1,Rn.NUM_PTS_TO_CHECK=10;var Pn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getCoordinates",value:function(){return this._ptList.toArray(e.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(e){this._precisionModel=e}},{key:"addPt",value:function(e){var t=new V(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(e,t){if(t)for(var n=0;n<e.length;n++)this.addPt(e[n]);else for(var i=e.length-1;i>=0;i--)this.addPt(e[i])}},{key:"isRedundant",value:function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1);return e.distance(t)<this._minimimVertexDistance}},{key:"toString",value:function(){return(new ot).createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var e=new V(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)}},{key:"setMinimumVertexDistance",value:function(e){this._minimimVertexDistance=e}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new ge}}])}();Pn.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Mn=function(){function e(){n(this,e)}return s(e,null,[{key:"toDegrees",value:function(e){return 180*e/Math.PI}},{key:"normalize",value:function(t){for(;t>Math.PI;)t-=e.PI_TIMES_2;for(;t<=-Math.PI;)t+=e.PI_TIMES_2;return t}},{key:"angle",value:function(){if(1===arguments.length){var e=arguments[0];return Math.atan2(e.y,e.x)}if(2===arguments.length){var t=arguments[0],n=arguments[1],i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)}}},{key:"isAcute",value:function(e,t,n){var i=e.x-t.x,r=e.y-t.y;return i*(n.x-t.x)+r*(n.y-t.y)>0}},{key:"isObtuse",value:function(e,t,n){var i=e.x-t.x,r=e.y-t.y;return i*(n.x-t.x)+r*(n.y-t.y)<0}},{key:"interiorAngle",value:function(t,n,i){var r=e.angle(n,t),s=e.angle(n,i);return Math.abs(s-r)}},{key:"normalizePositive",value:function(t){if(t<0){for(;t<0;)t+=e.PI_TIMES_2;t>=e.PI_TIMES_2&&(t=0)}else{for(;t>=e.PI_TIMES_2;)t-=e.PI_TIMES_2;t<0&&(t=0)}return t}},{key:"angleBetween",value:function(t,n,i){var r=e.angle(n,t),s=e.angle(n,i);return e.diff(r,s)}},{key:"diff",value:function(e,t){var n=null;return(n=e<t?t-e:e-t)>Math.PI&&(n=2*Math.PI-n),n}},{key:"toRadians",value:function(e){return e*Math.PI/180}},{key:"getTurn",value:function(t,n){var i=Math.sin(n-t);return i>0?e.COUNTERCLOCKWISE:i<0?e.CLOCKWISE:e.NONE}},{key:"angleBetweenOriented",value:function(t,n,i){var r=e.angle(n,t),s=e.angle(n,i)-r;return s<=-Math.PI?s+e.PI_TIMES_2:s>Math.PI?s-e.PI_TIMES_2:s}}])}();Mn.PI_TIMES_2=2*Math.PI,Mn.PI_OVER_2=Math.PI/2,Mn.PI_OVER_4=Math.PI/4,Mn.COUNTERCLOCKWISE=he.COUNTERCLOCKWISE,Mn.CLOCKWISE=he.CLOCKWISE,Mn.NONE=he.COLLINEAR;var Ln=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"addNextSegment",value:function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=he.index(this._s0,this._s1,this._s2),i=n===he.CLOCKWISE&&this._side===Q.LEFT||n===he.COUNTERCLOCKWISE&&this._side===Q.RIGHT;0===n?this.addCollinear(t):i?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)}},{key:"addLineEndCap",value:function(e,t){var n=new wn(e,t),i=new wn;this.computeOffsetSegment(n,Q.LEFT,this._distance,i);var r=new wn;this.computeOffsetSegment(n,Q.RIGHT,this._distance,r);var s=t.x-e.x,o=t.y-e.y,a=Math.atan2(o,s);switch(this._bufParams.getEndCapStyle()){case y.CAP_ROUND:this._segList.addPt(i.p1),this.addDirectedFillet(t,a+Math.PI/2,a-Math.PI/2,he.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case y.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(r.p1);break;case y.CAP_SQUARE:var l=new V;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var c=new V(i.p1.x+l.x,i.p1.y+l.y),u=new V(r.p1.x+l.x,r.p1.y+l.y);this._segList.addPt(c),this._segList.addPt(u)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(e,t,n,i){var r=ve.intersection(t.p0,t.p1,n.p0,n.p1);if(null!==r&&(i<=0?1:r.distance(e)/Math.abs(i))<=this._bufParams.getMitreLimit())return this._segList.addPt(r),null;this.addLimitedMitreJoin(t,n,i,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(t,n){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*e.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===y.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===y.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(n&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(e){this._segList.addPt(new V(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new V(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new V(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new V(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(e,t){this._segList.addPts(e,t)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(e,t,n,i,r){var s=t.x-e.x,o=t.y-e.y,a=Math.atan2(o,s),l=n.x-e.x,c=n.y-e.y,u=Math.atan2(c,l);i===he.CLOCKWISE?a<=u&&(a+=2*Math.PI):a>=u&&(a-=2*Math.PI),this._segList.addPt(t),this.addDirectedFillet(e,a,u,i,r),this._segList.addPt(n)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(e,t,n,i){var r=this._seg0.p1,s=Mn.angle(r,this._seg0.p0),o=Mn.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1)/2,a=Mn.normalize(s+o),l=Mn.normalize(a+Math.PI),c=i*n,u=n-c*Math.abs(Math.sin(o)),h=r.x+c*Math.cos(l),d=r.y+c*Math.sin(l),f=new V(h,d),p=new wn(r,f),g=p.pointAlongOffset(1,u),m=p.pointAlongOffset(1,-u);this._side===Q.LEFT?(this._segList.addPt(g),this._segList.addPt(m)):(this._segList.addPt(m),this._segList.addPt(g))}},{key:"addDirectedFillet",value:function(e,t,n,i,r){var s=i===he.CLOCKWISE?-1:1,o=Math.abs(t-n),a=Math.trunc(o/this._filletAngleQuantum+.5);if(a<1)return null;for(var l=o/a,c=new V,u=0;u<a;u++){var h=t+s*u*l;c.x=e.x+r*Math.cos(h),c.y=e.y+r*Math.sin(h),this._segList.addPt(c)}}},{key:"computeOffsetSegment",value:function(e,t,n,i){var r=t===Q.LEFT?1:-1,s=e.p1.x-e.p0.x,o=e.p1.y-e.p0.y,a=Math.sqrt(s*s+o*o),l=r*n*s/a,c=r*n*o/a;i.p0.x=e.p0.x-c,i.p0.y=e.p0.y+l,i.p1.x=e.p1.x-c,i.p1.y=e.p1.y+l}},{key:"addInsideTurn",value:function(t,n){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*e.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new V((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var r=new V((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(e){var t=new V(e.x+this._distance,e.y);this._segList.addPt(t),this.addDirectedFillet(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)}},{key:"init",value:function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Pn,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*e.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===y.JOIN_BEVEL||this._bufParams.getJoinStyle()===y.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,he.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new wn,this._seg1=new wn,this._offset0=new wn,this._offset1=new wn,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new Rt,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===y.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)}}])}();Ln.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Ln.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Ln.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Ln.MAX_CLOSING_SEG_LEN_FACTOR=80;var Bn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getOffsetCurve",value:function(e,t){if(this._distance=t,0===t)return null;var n=t<0,i=Math.abs(t),r=this.getSegGen(i);e.length<=1?this.computePointCurve(e[0],r):this.computeOffsetCurve(e,n,r);var s=r.getCoordinates();return n&&qe.reverse(s),s}},{key:"computeSingleSidedBufferCurve",value:function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var r=Rn.simplify(e,-i),s=r.length-1;n.initSideSegments(r[s],r[s-1],Q.LEFT),n.addFirstSegment();for(var o=s-2;o>=0;o--)n.addNextSegment(r[o],!0)}else{n.addSegments(e,!1);var a=Rn.simplify(e,i),l=a.length-1;n.initSideSegments(a[0],a[1],Q.LEFT),n.addFirstSegment();for(var c=2;c<=l;c++)n.addNextSegment(a[c],!0)}n.addLastSegment(),n.closeRing()}},{key:"computeRingBufferCurve",value:function(e,t,n){var i=this.simplifyTolerance(this._distance);t===Q.RIGHT&&(i=-i);var r=Rn.simplify(e,i),s=r.length-1;n.initSideSegments(r[s-1],r[0],t);for(var o=1;o<=s;o++){var a=1!==o;n.addNextSegment(r[o],a)}n.closeRing()}},{key:"computeLineBufferCurve",value:function(e,t){var n=this.simplifyTolerance(this._distance),i=Rn.simplify(e,n),r=i.length-1;t.initSideSegments(i[0],i[1],Q.LEFT);for(var s=2;s<=r;s++)t.addNextSegment(i[s],!0);t.addLastSegment(),t.addLineEndCap(i[r-1],i[r]);var o=Rn.simplify(e,-n),a=o.length-1;t.initSideSegments(o[a],o[a-1],Q.LEFT);for(var l=a-2;l>=0;l--)t.addNextSegment(o[l],!0);t.addLastSegment(),t.addLineEndCap(o[1],o[0]),t.closeRing()}},{key:"computePointCurve",value:function(e,t){switch(this._bufParams.getEndCapStyle()){case y.CAP_ROUND:t.createCircle(e);break;case y.CAP_SQUARE:t.createSquare(e)}}},{key:"getLineCurve",value:function(e,t){if(this._distance=t,this.isLineOffsetEmpty(t))return null;var n=Math.abs(t),i=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],i);else if(this._bufParams.isSingleSided()){var r=t<0;this.computeSingleSidedBufferCurve(e,r,i)}else this.computeLineBufferCurve(e,i);return i.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(e){return e*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(t,n,i){if(this._distance=i,t.length<=2)return this.getLineCurve(t,i);if(0===i)return e.copyCoordinates(t);var r=this.getSegGen(i);return this.computeRingBufferCurve(t,n,r),r.getCoordinates()}},{key:"computeOffsetCurve",value:function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){var r=Rn.simplify(e,-i),s=r.length-1;n.initSideSegments(r[s],r[s-1],Q.LEFT),n.addFirstSegment();for(var o=s-2;o>=0;o--)n.addNextSegment(r[o],!0)}else{var a=Rn.simplify(e,i),l=a.length-1;n.initSideSegments(a[0],a[1],Q.LEFT),n.addFirstSegment();for(var c=2;c<=l;c++)n.addNextSegment(a[c],!0)}n.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(e){return 0===e||e<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(e){return new Ln(this._precisionModel,this._bufParams,e)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t}},{key:"copyCoordinates",value:function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new V(e[n]);return t}}])}(),Nn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(1===arguments.length){for(var e=arguments[0],t=new ge,n=this._subgraphs.iterator();n.hasNext();){var i=n.next(),r=i.getEnvelope();e.y<r.getMinY()||e.y>r.getMaxY()||this.findStabbedSegments(e,i.getDirectedEdges(),t)}return t}if(3===arguments.length)if(re(arguments[2],ne)&&arguments[0]instanceof V&&arguments[1]instanceof Yt){for(var s=arguments[0],o=arguments[1],a=arguments[2],l=o.getEdge().getCoordinates(),c=0;c<l.length-1;c++)if(this._seg.p0=l[c],this._seg.p1=l[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<s.x||this._seg.isHorizontal()||s.y<this._seg.p0.y||s.y>this._seg.p1.y||he.index(this._seg.p0,this._seg.p1,s)===he.RIGHT)){var u=o.getDepth(Q.LEFT);this._seg.p0.equals(l[c])||(u=o.getDepth(Q.RIGHT));var h=new On(this._seg,u);a.add(h)}}else if(re(arguments[2],ne)&&arguments[0]instanceof V&&re(arguments[1],ne))for(var d=arguments[0],f=arguments[2],p=arguments[1].iterator();p.hasNext();){var g=p.next();g.isForward()&&this.findStabbedSegments(d,g,f)}}},{key:"getDepth",value:function(e){var t=this.findStabbedSegments(e);return 0===t.size()?0:on.min(t)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new wn;var e=arguments[0];this._subgraphs=e}}]),On=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return 0!==n||0!=(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(t._upwardSeg)}},{key:"compareX",value:function(e,t){var n=e.p0.compareTo(t.p0);return 0!==n?n:e.p1.compareTo(t.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new wn(e),this._leftDepth=t}}]);Nn.DepthSegment=On;var Dn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,null,[{key:"constructor_",value:function(){v.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(v),Fn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getY",value:function(){var e=this.y/this.w;if(B.isNaN(e)||B.isInfinite(e))throw new Dn;return e}},{key:"getX",value:function(){var e=this.x/this.w;if(B.isNaN(e)||B.isInfinite(e))throw new Dn;return e}},{key:"getCoordinate",value:function(){var e=new V;return e.x=this.getX(),e.y=this.getY(),e}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var r=arguments[0],s=arguments[1];this.x=r.y*s.w-s.y*r.w,this.y=s.x*r.w-r.x*s.w,this.w=r.x*s.y-s.x*r.y}else if(arguments[0]instanceof V&&arguments[1]instanceof V){var o=arguments[0],a=arguments[1];this.x=o.y-a.y,this.y=a.x-o.x,this.w=o.x*a.y-a.x*o.y}}else if(3===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2];this.x=l,this.y=c,this.w=u}else if(4===arguments.length){var h=arguments[0],d=arguments[1],f=arguments[2],p=arguments[3],g=h.y-d.y,m=d.x-h.x,y=h.x*d.y-d.x*h.y,v=f.y-p.y,_=p.x-f.x,b=f.x*p.y-p.x*f.y;this.x=m*b-_*y,this.y=v*y-g*b,this.w=g*_-v*m}}}])}(),Un=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"area",value:function(){return e.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return e.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(t){if(null===t)throw new _("Supplied point is null.");return e.interpolateZ(t,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return e.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return e.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return e.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return e.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return e.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return e.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.p0=e,this.p1=t,this.p2=n}},{key:"area",value:function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)}},{key:"signedArea",value:function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2}},{key:"det",value:function(e,t,n,i){return e*i-t*n}},{key:"interpolateZ",value:function(e,t,n,i){var r=t.x,s=t.y,o=n.x-r,a=i.x-r,l=n.y-s,c=i.y-s,u=o*c-a*l,h=e.x-r,d=e.y-s,f=(c*h-a*d)/u,p=(-l*h+o*d)/u;return t.getZ()+f*(n.getZ()-t.getZ())+p*(i.getZ()-t.getZ())}},{key:"longestSideLength",value:function(e,t,n){var i=e.distance(t),r=t.distance(n),s=n.distance(e),o=i;return r>o&&(o=r),s>o&&(o=s),o}},{key:"circumcentreDD",value:function(e,t,n){var i=le.valueOf(e.x).subtract(n.x),r=le.valueOf(e.y).subtract(n.y),s=le.valueOf(t.x).subtract(n.x),o=le.valueOf(t.y).subtract(n.y),a=le.determinant(i,r,s,o).multiply(2),l=i.sqr().add(r.sqr()),c=s.sqr().add(o.sqr()),u=le.determinant(r,l,o,c),h=le.determinant(i,l,s,c),d=le.valueOf(n.x).subtract(u.divide(a)).doubleValue(),f=le.valueOf(n.y).add(h.divide(a)).doubleValue();return new V(d,f)}},{key:"isAcute",value:function(e,t,n){return!!Mn.isAcute(e,t,n)&&!!Mn.isAcute(t,n,e)&&!!Mn.isAcute(n,e,t)}},{key:"circumcentre",value:function(t,n,i){var r=i.x,s=i.y,o=t.x-r,a=t.y-s,l=n.x-r,c=n.y-s,u=2*e.det(o,a,l,c),h=e.det(a,o*o+a*a,c,l*l+c*c),d=e.det(o,o*o+a*a,l,l*l+c*c);return new V(r-h/u,s+d/u)}},{key:"perpendicularBisector",value:function(e,t){var n=t.x-e.x,i=t.y-e.y,r=new Fn(e.x+n/2,e.y+i/2,1),s=new Fn(e.x-i+n/2,e.y+n+i/2,1);return new Fn(r,s)}},{key:"angleBisector",value:function(e,t,n){var i=t.distance(e),r=i/(i+t.distance(n)),s=n.x-e.x,o=n.y-e.y;return new V(e.x+r*s,e.y+r*o)}},{key:"area3D",value:function(e,t,n){var i=t.x-e.x,r=t.y-e.y,s=t.getZ()-e.getZ(),o=n.x-e.x,a=n.y-e.y,l=n.getZ()-e.getZ(),c=r*l-s*a,u=s*o-i*l,h=i*a-r*o,d=c*c+u*u+h*h;return Math.sqrt(d)/2}},{key:"centroid",value:function(e,t,n){var i=(e.x+t.x+n.x)/3,r=(e.y+t.y+n.y)/3;return new V(i,r)}},{key:"inCentre",value:function(e,t,n){var i=t.distance(n),r=e.distance(n),s=e.distance(t),o=i+r+s,a=(i*e.x+r*t.x+s*n.x)/o,l=(i*e.y+r*t.y+s*n.y)/o;return new V(a,l)}}])}(),zn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(e,t,n,i,r){if(0===t&&e.length<Ve.MINIMUM_VALID_SIZE)return null;var s=i,o=r;e.length>=Ve.MINIMUM_VALID_SIZE&&he.isCCW(e)&&(s=r,o=i,n=Q.opposite(n));var a=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(a,s,o)}},{key:"addRingBothSides",value:function(e,t){this.addRingSide(e,t,Q.LEFT,$.EXTERIOR,$.INTERIOR),this.addRingSide(e,t,Q.RIGHT,$.INTERIOR,$.EXTERIOR)}},{key:"addPoint",value:function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,$.EXTERIOR,$.INTERIOR)}},{key:"addPolygon",value:function(e){var t=this._distance,n=Q.LEFT;this._distance<0&&(t=-this._distance,n=Q.RIGHT);var i=e.getExteriorRing(),r=qe.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance))return null;if(this._distance<=0&&r.length<3)return null;this.addRingSide(r,t,n,$.EXTERIOR,$.INTERIOR);for(var s=0;s<e.getNumInteriorRing();s++){var o=e.getInteriorRingN(s),a=qe.removeRepeatedPoints(o.getCoordinates());this._distance>0&&this.isErodedCompletely(o,-this._distance)||this.addRingSide(a,t,Q.opposite(n),$.INTERIOR,$.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(e,t){var n=new Un(e[0],e[1],e[2]),i=n.inCentre();return Ee.pointToSegment(i,n.p0,n.p1)<Math.abs(t)}},{key:"addLineString",value:function(e){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var t=qe.removeRepeatedPoints(e.getCoordinates());if(qe.isRing(t)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(t,this._distance);else{var n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,$.EXTERIOR,$.INTERIOR)}}},{key:"addCurve",value:function(e,t,n){if(null===e||e.length<2)return null;var i=new En(e,new Bt(0,$.BOUNDARY,t,n));this._curveList.add(i)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(e){if(e.isEmpty())return null;if(e instanceof Oe)this.addPolygon(e);else if(e instanceof Re)this.addLineString(e);else if(e instanceof Me)this.addPoint(e);else if(e instanceof Ge)this.addCollection(e);else if(e instanceof st)this.addCollection(e);else if(e instanceof et)this.addCollection(e);else{if(!(e instanceof ze))throw new K(e.getGeometryType());this.addCollection(e)}}},{key:"isErodedCompletely",value:function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(4===n.length)return this.isTriangleErodedCompletely(n,t);var i=e.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return t<0&&2*Math.abs(t)>r}},{key:"addCollection",value:function(e){for(var t=0;t<e.getNumGeometries();t++){var n=e.getGeometryN(t);this.add(n)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new ge;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n}}]),Gn=s(function e(){n(this,e)},[{key:"locate",value:function(e){}}]),Vn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,e.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new q;var t=this._parent.getGeometryN(this._index++);return t instanceof ze?(this._subcollectionIterator=new e(t),this._subcollectionIterator.next()):t}},{key:"remove",value:function(){throw new K(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[mn]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()}},{key:"isAtomic",value:function(e){return!(e instanceof ze)}}])}(),Hn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"locate",value:function(t){return e.locate(t,this._geom)}},{key:"interfaces_",get:function(){return[Gn]}}],[{key:"constructor_",value:function(){this._geom=null;var e=arguments[0];this._geom=e}},{key:"locatePointInPolygon",value:function(t,n){if(n.isEmpty())return $.EXTERIOR;var i=n.getExteriorRing(),r=e.locatePointInRing(t,i);if(r!==$.INTERIOR)return r;for(var s=0;s<n.getNumInteriorRing();s++){var o=n.getInteriorRingN(s),a=e.locatePointInRing(t,o);if(a===$.BOUNDARY)return $.BOUNDARY;if(a===$.INTERIOR)return $.EXTERIOR}return $.INTERIOR}},{key:"locatePointInRing",value:function(e,t){return t.getEnvelopeInternal().intersects(e)?Mt.locateInRing(e,t.getCoordinates()):$.EXTERIOR}},{key:"containsPointInPolygon",value:function(t,n){return $.EXTERIOR!==e.locatePointInPolygon(t,n)}},{key:"locateInGeometry",value:function(t,n){if(n instanceof Oe)return e.locatePointInPolygon(t,n);if(n instanceof ze)for(var i=new Vn(n);i.hasNext();){var r=i.next();if(r!==n){var s=e.locateInGeometry(t,r);if(s!==$.EXTERIOR)return s}}return $.EXTERIOR}},{key:"isContained",value:function(t,n){return $.EXTERIOR!==e.locate(t,n)}},{key:"locate",value:function(t,n){return n.isEmpty()?$.EXTERIOR:n.getEnvelopeInternal().intersects(t)?e.locateInGeometry(t,n):$.EXTERIOR}}])}(),jn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return 0===t&&(n=this._edgeList.size()-1),this._edgeList.get(n)}},{key:"propagateSideLabels",value:function(e){for(var t=$.NONE,n=this.iterator();n.hasNext();){var i=n.next().getLabel();i.isArea(e)&&i.getLocation(e,Q.LEFT)!==$.NONE&&(t=i.getLocation(e,Q.LEFT))}if(t===$.NONE)return null;for(var r=t,s=this.iterator();s.hasNext();){var o=s.next(),a=o.getLabel();if(a.getLocation(e,Q.ON)===$.NONE&&a.setLocation(e,Q.ON,r),a.isArea(e)){var l=a.getLocation(e,Q.LEFT),c=a.getLocation(e,Q.RIGHT);if(c!==$.NONE){if(c!==r)throw new fe("side location conflict",o.getCoordinate());l===$.NONE&&F.shouldNeverReachHere("found single null side (at "+o.getCoordinate()+")"),r=l}else F.isTrue(a.getLocation(e,Q.LEFT)===$.NONE,"found single null side"),a.setLocation(e,Q.RIGHT,r),a.setLocation(e,Q.LEFT,r)}}}},{key:"getCoordinate",value:function(){var e=this.iterator();return e.hasNext()?e.next().getCoordinate():null}},{key:"print",value:function(e){_e.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"isAreaLabelsConsistent",value:function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,i=t.get(n).getLabel().getLocation(e,Q.LEFT);F.isTrue(i!==$.NONE,"Found unlabelled area edge");for(var r=i,s=this.iterator();s.hasNext();){var o=s.next().getLabel();F.isTrue(o.isArea(e),"Found non-area edge");var a=o.getLocation(e,Q.LEFT),l=o.getLocation(e,Q.RIGHT);if(a===l)return!1;if(l!==r)return!1;r=a}return!0}},{key:"findIndex",value:function(e){this.iterator();for(var t=0;t<this._edgeList.size();t++)if(this._edgeList.get(t)===e)return t;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return null===this._edgeList&&(this._edgeList=new ge(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(e,t,n){return this._ptInAreaLocation[e]===$.NONE&&(this._ptInAreaLocation[e]=Hn.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]}},{key:"toString",value:function(){var e=new se;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append("\n");for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append("\n")}return e.toString()}},{key:"computeEdgeEndLabels",value:function(e){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(e)}},{key:"computeLabelling",value:function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next().getLabel(),r=0;r<2;r++)i.isLine(r)&&i.getLocation(r)===$.BOUNDARY&&(t[r]=!0);for(var s=this.iterator();s.hasNext();)for(var o=s.next(),a=o.getLabel(),l=0;l<2;l++)if(a.isAnyNull(l)){var c=$.NONE;if(t[l])c=$.EXTERIOR;else{var u=o.getCoordinate();c=this.getLocation(l,u,e)}a.setAllLocationsIfNull(l,c)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(e,t){this._edgeMap.put(e,t),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new $t,this._edgeList=null,this._ptInAreaLocation=[$.NONE,$.NONE]}}]),Wn=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var e=null,t=null,n=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var r=this._resultAreaEdgeList.get(i),s=r.getSym();if(r.getLabel().isArea())switch(null===e&&r.isInResult()&&(e=r),n){case this._SCANNING_FOR_INCOMING:if(!s.isInResult())continue;t=s,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!r.isInResult())continue;t.setNext(r),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===e)throw new fe("no outgoing dirEdge found",this.getCoordinate());F.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),t.setNext(e)}}},{key:"insert",value:function(e){var t=e;this.insertEdgeEnd(t,t)}},{key:"getRightmostEdge",value:function(){var e=this.getEdges(),t=e.size();if(t<1)return null;var n=e.get(0);if(1===t)return n;var i=e.get(t-1),r=n.getQuadrant(),s=i.getQuadrant();return qt.isNorthern(r)&&qt.isNorthern(s)?n:qt.isNorthern(r)||qt.isNorthern(s)?0!==n.getDy()?n:0!==i.getDy()?i:(F.shouldNeverReachHere("found two horizontal edges incident on node"),null):i}},{key:"print",value:function(e){_e.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();e.print("out "),n.print(e),e.println(),e.print("in "),n.getSym().print(e),e.println()}}},{key:"getResultAreaEdges",value:function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new ge;for(var e=this.iterator();e.hasNext();){var t=e.next();(t.isInResult()||t.getSym().isInResult())&&this._resultAreaEdgeList.add(t)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(e){for(var t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.setAllLocationsIfNull(0,e.getLocation(0)),n.setAllLocationsIfNull(1,e.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var e=null,t=null,n=this._edgeList.size()-1;n>=0;n--){var i=this._edgeList.get(n),r=i.getSym();null===t&&(t=r),null!==e&&r.setNext(e),e=i}t.setNext(e)}},{key:"computeDepths",value:function(){if(1===arguments.length){var e=arguments[0],t=this.findIndex(e),n=e.getDepth(Q.LEFT),i=e.getDepth(Q.RIGHT),r=this.computeDepths(t+1,this._edgeList.size(),n);if(this.computeDepths(0,t,r)!==i)throw new fe("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var s=arguments[1],o=arguments[2],a=arguments[0];a<s;a++){var l=this._edgeList.get(a);l.setEdgeDepths(Q.RIGHT,o),o=l.getDepth(Q.LEFT)}return o}}},{key:"mergeSymLabels",value:function(){for(var e=this.iterator();e.hasNext();){var t=e.next();t.getLabel().merge(t.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(e){for(var t=null,n=null,i=this._SCANNING_FOR_INCOMING,r=this._resultAreaEdgeList.size()-1;r>=0;r--){var s=this._resultAreaEdgeList.get(r),o=s.getSym();switch(null===t&&s.getEdgeRing()===e&&(t=s),i){case this._SCANNING_FOR_INCOMING:if(o.getEdgeRing()!==e)continue;n=o,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(s.getEdgeRing()!==e)continue;n.setNextMin(s),i=this._SCANNING_FOR_INCOMING}}i===this._LINKING_TO_OUTGOING&&(F.isTrue(null!==t,"found null for first outgoing dirEdge"),F.isTrue(t.getEdgeRing()===e,"unable to link last incoming dirEdge"),n.setNextMin(t))}},{key:"getOutgoingDegree",value:function(){if(0===arguments.length){for(var e=0,t=this.iterator();t.hasNext();)t.next().isInResult()&&e++;return e}if(1===arguments.length){for(var n=arguments[0],i=0,r=this.iterator();r.hasNext();)r.next().getEdgeRing()===n&&i++;return i}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var e=$.NONE,t=this.iterator();t.hasNext();){var n=t.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){e=$.INTERIOR;break}if(i.isInResult()){e=$.EXTERIOR;break}}}if(e===$.NONE)return null;for(var r=e,s=this.iterator();s.hasNext();){var o=s.next(),a=o.getSym();o.isLineEdge()?o.getEdge().setCovered(r===$.INTERIOR):(o.isInResult()&&(r=$.EXTERIOR),a.isInResult()&&(r=$.INTERIOR))}}},{key:"computeLabelling",value:function(e){d(i,"computeLabelling",this,1).call(this,e),this._label=new Bt($.NONE);for(var t=this.iterator();t.hasNext();)for(var n=t.next().getEdge().getLabel(),r=0;r<2;r++){var s=n.getLocation(r);s!==$.INTERIOR&&s!==$.BOUNDARY||this._label.setLocation(r,$.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(jn),$n=function(e){function i(){return n(this,i),t(this,i)}return c(i,e),s(i,[{key:"createNode",value:function(e){return new Ut(e,new Wn)}}])}(Jt),Xn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"compareTo",value:function(t){var n=t;return e.compareOriented(this._pts,this._orientation,n._pts,n._orientation)}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)}},{key:"orientation",value:function(e){return 1===qe.increasingDirection(e)}},{key:"compareOriented",value:function(e,t,n,i){for(var r=t?1:-1,s=i?1:-1,o=t?e.length:-1,a=i?n.length:-1,l=t?0:e.length-1,c=i?0:n.length-1;;){var u=e[l].compareTo(n[c]);if(0!==u)return u;var h=(l+=r)===o,d=(c+=s)===a;if(h&&!d)return-1;if(!h&&d)return 1;if(h&&d)return 0}}}])}(),qn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"print",value:function(e){e.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var n=this._edges.get(t);t>0&&e.print(","),e.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&e.print(","),e.print(i[r].x+" "+i[r].y);e.println(")")}e.print(")  ")}},{key:"addAll",value:function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next())}},{key:"findEdgeIndex",value:function(e){for(var t=0;t<this._edges.size();t++)if(this._edges.get(t).equals(e))return t;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(e){return this._edges.get(e)}},{key:"findEqualEdge",value:function(e){var t=new Xn(e.getCoordinates());return this._ocaMap.get(t)}},{key:"add",value:function(e){this._edges.add(e);var t=new Xn(e.getCoordinates());this._ocaMap.put(t,e)}}],[{key:"constructor_",value:function(){this._edges=new ge,this._ocaMap=new $t}}]),Kn=s(function e(){n(this,e)},[{key:"processIntersections",value:function(e,t,n,i){}},{key:"isDone",value:function(){}}]),Yn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"isTrivialIntersection",value:function(t,n,i,r){if(t===i&&1===this._li.getIntersectionNum()){if(e.isAdjacentSegments(n,r))return!0;if(t.isClosed()){var s=t.size()-1;if(0===n&&r===s||0===r&&n===s)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(e,t,n,i){if(e===n&&t===i)return null;this.numTests++;var r=e.getCoordinates()[t],s=e.getCoordinates()[t+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this._li.computeIntersection(r,s,o,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,i)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Kn]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e}},{key:"isAdjacentSegments",value:function(e,t){return 1===Math.abs(e-t)}}])}(),Jn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)}},{key:"compareTo",value:function(e){var t=e;return this.compare(t.segmentIndex,t.dist)}},{key:"isEndPoint",value:function(e){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===e}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new V(e),this.segmentIndex=t,this.dist=n}}]),Zn=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"print",value:function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(e){this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);e.add(r),n=i}}},{key:"addEndpoints",value:function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)}},{key:"createSplitEdge",value:function(e,t){var n=t.segmentIndex-e.segmentIndex+2,i=this.edge.pts[t.segmentIndex],r=t.dist>0||!t.coord.equals2D(i);r||n--;var s=new Array(n).fill(null),o=0;s[o++]=new V(e.coord);for(var a=e.segmentIndex+1;a<=t.segmentIndex;a++)s[o++]=this.edge.pts[a];return r&&(s[o]=t.coord),new ri(s,new Bt(this.edge._label))}},{key:"add",value:function(e,t,n){var i=new Jn(e,t,n),r=this._nodeMap.get(i);return null!==r?r:(this._nodeMap.put(i,i),i)}},{key:"isIntersection",value:function(e){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(e))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new $t,this.edge=null;var e=arguments[0];this.edge=e}}]),Qn=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(e.isTrue(this._matrix[$.INTERIOR][$.INTERIOR])||e.isTrue(this._matrix[$.INTERIOR][$.BOUNDARY])||e.isTrue(this._matrix[$.BOUNDARY][$.INTERIOR])||e.isTrue(this._matrix[$.BOUNDARY][$.BOUNDARY]))&&this._matrix[$.EXTERIOR][$.INTERIOR]===Ce.FALSE&&this._matrix[$.EXTERIOR][$.BOUNDARY]===Ce.FALSE}},{key:"isCoveredBy",value:function(){return(e.isTrue(this._matrix[$.INTERIOR][$.INTERIOR])||e.isTrue(this._matrix[$.INTERIOR][$.BOUNDARY])||e.isTrue(this._matrix[$.BOUNDARY][$.INTERIOR])||e.isTrue(this._matrix[$.BOUNDARY][$.BOUNDARY]))&&this._matrix[$.INTERIOR][$.EXTERIOR]===Ce.FALSE&&this._matrix[$.BOUNDARY][$.EXTERIOR]===Ce.FALSE}},{key:"set",value:function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<e.length;t++){var n=Math.trunc(t/3),i=t%3;this._matrix[n][i]=Ce.toDimensionValue(e.charAt(t))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this._matrix[r][s]=o}}},{key:"isContains",value:function(){return e.isTrue(this._matrix[$.INTERIOR][$.INTERIOR])&&this._matrix[$.EXTERIOR][$.INTERIOR]===Ce.FALSE&&this._matrix[$.EXTERIOR][$.BOUNDARY]===Ce.FALSE}},{key:"setAtLeast",value:function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<e.length;t++){var n=Math.trunc(t/3),i=t%3;this.setAtLeast(n,i,Ce.toDimensionValue(e.charAt(t)))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this._matrix[r][s]<o&&(this._matrix[r][s]=o)}}},{key:"setAtLeastIfValid",value:function(e,t,n){e>=0&&t>=0&&this.setAtLeast(e,t,n)}},{key:"isWithin",value:function(){return e.isTrue(this._matrix[$.INTERIOR][$.INTERIOR])&&this._matrix[$.INTERIOR][$.EXTERIOR]===Ce.FALSE&&this._matrix[$.BOUNDARY][$.EXTERIOR]===Ce.FALSE}},{key:"isTouches",value:function(t,n){return t>n?this.isTouches(n,t):(t===Ce.A&&n===Ce.A||t===Ce.L&&n===Ce.L||t===Ce.L&&n===Ce.A||t===Ce.P&&n===Ce.A||t===Ce.P&&n===Ce.L)&&this._matrix[$.INTERIOR][$.INTERIOR]===Ce.FALSE&&(e.isTrue(this._matrix[$.INTERIOR][$.BOUNDARY])||e.isTrue(this._matrix[$.BOUNDARY][$.INTERIOR])||e.isTrue(this._matrix[$.BOUNDARY][$.BOUNDARY]))}},{key:"isOverlaps",value:function(t,n){return t===Ce.P&&n===Ce.P||t===Ce.A&&n===Ce.A?e.isTrue(this._matrix[$.INTERIOR][$.INTERIOR])&&e.isTrue(this._matrix[$.INTERIOR][$.EXTERIOR])&&e.isTrue(this._matrix[$.EXTERIOR][$.INTERIOR]):t===Ce.L&&n===Ce.L&&1===this._matrix[$.INTERIOR][$.INTERIOR]&&e.isTrue(this._matrix[$.INTERIOR][$.EXTERIOR])&&e.isTrue(this._matrix[$.EXTERIOR][$.INTERIOR])}},{key:"isEquals",value:function(t,n){return t===n&&e.isTrue(this._matrix[$.INTERIOR][$.INTERIOR])&&this._matrix[$.INTERIOR][$.EXTERIOR]===Ce.FALSE&&this._matrix[$.BOUNDARY][$.EXTERIOR]===Ce.FALSE&&this._matrix[$.EXTERIOR][$.INTERIOR]===Ce.FALSE&&this._matrix[$.EXTERIOR][$.BOUNDARY]===Ce.FALSE}},{key:"toString",value:function(){for(var e=new Je("123456789"),t=0;t<3;t++)for(var n=0;n<3;n++)e.setCharAt(3*t+n,Ce.toDimensionSymbol(this._matrix[t][n]));return e.toString()}},{key:"setAll",value:function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++)this._matrix[t][n]=e}},{key:"get",value:function(e,t){return this._matrix[e][t]}},{key:"transpose",value:function(){var e=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=e,e=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=e,e=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=e,this}},{key:"matches",value:function(t){if(9!==t.length)throw new _("Should be length 9: "+t);for(var n=0;n<3;n++)for(var i=0;i<3;i++)if(!e.matches(this._matrix[n][i],t.charAt(3*n+i)))return!1;return!0}},{key:"add",value:function(e){for(var t=0;t<3;t++)for(var n=0;n<3;n++)this.setAtLeast(t,n,e.get(t,n))}},{key:"isDisjoint",value:function(){return this._matrix[$.INTERIOR][$.INTERIOR]===Ce.FALSE&&this._matrix[$.INTERIOR][$.BOUNDARY]===Ce.FALSE&&this._matrix[$.BOUNDARY][$.INTERIOR]===Ce.FALSE&&this._matrix[$.BOUNDARY][$.BOUNDARY]===Ce.FALSE}},{key:"isCrosses",value:function(t,n){return t===Ce.P&&n===Ce.L||t===Ce.P&&n===Ce.A||t===Ce.L&&n===Ce.A?e.isTrue(this._matrix[$.INTERIOR][$.INTERIOR])&&e.isTrue(this._matrix[$.INTERIOR][$.EXTERIOR]):t===Ce.L&&n===Ce.P||t===Ce.A&&n===Ce.P||t===Ce.A&&n===Ce.L?e.isTrue(this._matrix[$.INTERIOR][$.INTERIOR])&&e.isTrue(this._matrix[$.EXTERIOR][$.INTERIOR]):t===Ce.L&&n===Ce.L&&0===this._matrix[$.INTERIOR][$.INTERIOR]}},{key:"interfaces_",get:function(){return[w]}}],[{key:"constructor_",value:function(){if(this._matrix=null,0===arguments.length)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(Ce.FALSE);else if(1===arguments.length)if("string"==typeof arguments[0]){var t=arguments[0];e.constructor_.call(this),this.set(t)}else if(arguments[0]instanceof e){var n=arguments[0];e.constructor_.call(this),this._matrix[$.INTERIOR][$.INTERIOR]=n._matrix[$.INTERIOR][$.INTERIOR],this._matrix[$.INTERIOR][$.BOUNDARY]=n._matrix[$.INTERIOR][$.BOUNDARY],this._matrix[$.INTERIOR][$.EXTERIOR]=n._matrix[$.INTERIOR][$.EXTERIOR],this._matrix[$.BOUNDARY][$.INTERIOR]=n._matrix[$.BOUNDARY][$.INTERIOR],this._matrix[$.BOUNDARY][$.BOUNDARY]=n._matrix[$.BOUNDARY][$.BOUNDARY],this._matrix[$.BOUNDARY][$.EXTERIOR]=n._matrix[$.BOUNDARY][$.EXTERIOR],this._matrix[$.EXTERIOR][$.INTERIOR]=n._matrix[$.EXTERIOR][$.INTERIOR],this._matrix[$.EXTERIOR][$.BOUNDARY]=n._matrix[$.EXTERIOR][$.BOUNDARY],this._matrix[$.EXTERIOR][$.EXTERIOR]=n._matrix[$.EXTERIOR][$.EXTERIOR]}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&"string"==typeof arguments[1]){var t=arguments[0],n=arguments[1];return n===Ce.SYM_DONTCARE||n===Ce.SYM_TRUE&&(t>=0||t===Ce.TRUE)||n===Ce.SYM_FALSE&&t===Ce.FALSE||n===Ce.SYM_P&&t===Ce.P||n===Ce.SYM_L&&t===Ce.L||n===Ce.SYM_A&&t===Ce.A}if("string"==typeof arguments[0]&&"string"==typeof arguments[1]){var i=arguments[1];return new e(arguments[0]).matches(i)}}},{key:"isTrue",value:function(e){return e>=0||e===Ce.TRUE}}])}(),ei=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(e){return null===e||0===e.length?null:(this.ensureCapacity(this._size+e.length),_e.arraycopy(e,0,this._data,this._size,e.length),void(this._size+=e.length))}},{key:"ensureCapacity",value:function(e){if(e<=this._data.length)return null;var t=Math.max(e,2*this._data.length);this._data=Be.copyOf(this._data,t)}},{key:"toArray",value:function(){var e=new Array(this._size).fill(null);return _e.arraycopy(this._data,0,e,0,this._size),e}},{key:"add",value:function(e){this.ensureCapacity(this._size+1),this._data[this._size]=e,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,0===arguments.length)e.constructor_.call(this,10);else if(1===arguments.length){var t=arguments[0];this._data=new Array(t).fill(null)}}}])}(),ti=function(){function e(){n(this,e)}return s(e,[{key:"getChainStartIndices",value:function(e){var t=0,n=new ei(Math.trunc(e.length/2));n.add(t);do{var i=this.findChainEnd(e,t);n.add(i),t=i}while(t<e.length-1);return n.toArray()}},{key:"findChainEnd",value:function(e,t){for(var n=qt.quadrant(e[t],e[t+1]),i=t+1;i<e.length&&qt.quadrant(e[i-1],e[i])===n;)i++;return i-1}},{key:"OLDgetChainStartIndices",value:function(t){var n=0,i=new ge;i.add(n);do{var r=this.findChainEnd(t,n);i.add(r),n=r}while(n<t.length-1);return e.toIntArray(i)}}],[{key:"toIntArray",value:function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t}}])}(),ni=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n}},{key:"getMinX",value:function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n}},{key:"computeIntersectsForChain",value:function(){if(4===arguments.length){var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3],l=arguments[4],c=arguments[5];if(s-r==1&&l-a==1)return c.addIntersections(this.e,r,o.e,a),null;if(!this.overlaps(r,s,o,a,l))return null;var u=Math.trunc((r+s)/2),h=Math.trunc((a+l)/2);r<u&&(a<h&&this.computeIntersectsForChain(r,u,o,a,h,c),h<l&&this.computeIntersectsForChain(r,u,o,h,l,c)),u<s&&(a<h&&this.computeIntersectsForChain(u,s,o,a,h,c),h<l&&this.computeIntersectsForChain(u,s,o,h,l,c))}}},{key:"overlaps",value:function(e,t,n,i,r){return j.intersects(this.pts[e],this.pts[t],n.pts[i],n.pts[r])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(e,t){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<e.startIndex.length-1;i++)this.computeIntersectsForChain(n,e,i,t)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new ti;this.startIndex=t.getChainStartIndices(this.pts)}}]),ii=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"getDepth",value:function(e,t){return this._depth[e][t]}},{key:"setDepth",value:function(e,t,n){this._depth[e][t]=n}},{key:"isNull",value:function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(this._depth[t][n]!==e.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this._depth[i][1]===e.NULL_VALUE}if(2===arguments.length){var r=arguments[0],s=arguments[1];return this._depth[r][s]===e.NULL_VALUE}}},{key:"normalize",value:function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var t=this._depth[e][1];this._depth[e][2]<t&&(t=this._depth[e][2]),t<0&&(t=0);for(var n=1;n<3;n++){var i=0;this._depth[e][n]>t&&(i=1),this._depth[e][n]=i}}}},{key:"getDelta",value:function(e){return this._depth[e][Q.RIGHT]-this._depth[e][Q.LEFT]}},{key:"getLocation",value:function(e,t){return this._depth[e][t]<=0?$.EXTERIOR:$.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(1===arguments.length)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);r!==$.EXTERIOR&&r!==$.INTERIOR||(this.isNull(n,i)?this._depth[n][i]=e.depthAtLocation(r):this._depth[n][i]+=e.depthAtLocation(r))}else if(3===arguments.length){var s=arguments[0],o=arguments[1];arguments[2]===$.INTERIOR&&this._depth[s][o]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var n=0;n<3;n++)this._depth[t][n]=e.NULL_VALUE}},{key:"depthAtLocation",value:function(t){return t===$.EXTERIOR?0:t===$.INTERIOR?1:e.NULL_VALUE}}])}();ii.NULL_VALUE=-1;var ri=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var e=new Array(2).fill(null);return e[0]=this.pts[0],e[1]=this.pts[1],new i(e,Bt.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(e){this._isIsolated=e}},{key:"setName",value:function(e){this._name=e}},{key:"equals",value:function(e){if(!(e instanceof i))return!1;var t=e;if(this.pts.length!==t.pts.length)return!1;for(var n=!0,r=!0,s=this.pts.length,o=0;o<this.pts.length;o++)if(this.pts[o].equals2D(t.pts[o])||(n=!1),this.pts[o].equals2D(t.pts[--s])||(r=!1),!n&&!r)return!1;return!0}},{key:"getCoordinate",value:function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var e=arguments[0];return this.pts[e]}}},{key:"print",value:function(e){e.print("edge "+this._name+": "),e.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.print(","),e.print(this.pts[t].x+" "+this.pts[t].y);e.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(e){i.updateIM(this._label,e)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(e){e.print("edge "+this._name+": ");for(var t=this.pts.length-1;t>=0;t--)e.print(this.pts[t]+" ");e.println("")}},{key:"getMonotoneChainEdge",value:function(){return null===this._mce&&(this._mce=new ni(this)),this._mce}},{key:"getEnvelope",value:function(){if(null===this._env){this._env=new j;for(var e=0;e<this.pts.length;e++)this._env.expandToInclude(this.pts[e])}return this._env}},{key:"addIntersection",value:function(e,t,n,i){var r=new V(e.getIntersection(i)),s=t,o=e.getEdgeDistance(n,i),a=s+1;if(a<this.pts.length){var l=this.pts[a];r.equals2D(l)&&(s=a,o=0)}this.eiList.add(r,s,o)}},{key:"toString",value:function(){var e=new Je;e.append("edge "+this._name+": "),e.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.append(","),e.append(this.pts[t].x+" "+this.pts[t].y);return e.append(")  "+this._label+" "+this._depthDelta),e.toString()}},{key:"isPointwiseEqual",value:function(e){if(this.pts.length!==e.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(e.pts[t]))return!1;return!0}},{key:"setDepthDelta",value:function(e){this._depthDelta=e}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++)this.addIntersection(e,t,n,i)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Zn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ii,this._depthDelta=0,1===arguments.length){var e=arguments[0];i.constructor_.call(this,e,null)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.pts=t,this._label=n}}},{key:"updateIM",value:function(){if(!(2===arguments.length&&arguments[1]instanceof Qn&&arguments[0]instanceof Bt))return d(i,"updateIM",this).apply(this,arguments);var e=arguments[0],t=arguments[1];t.setAtLeastIfValid(e.getLocation(0,Q.ON),e.getLocation(1,Q.ON),1),e.isArea()&&(t.setAtLeastIfValid(e.getLocation(0,Q.LEFT),e.getLocation(1,Q.LEFT),2),t.setAtLeastIfValid(e.getLocation(0,Q.RIGHT),e.getLocation(1,Q.RIGHT),2))}}])}(Ft),si=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"setWorkingPrecisionModel",value:function(e){this._workingPrecisionModel=e}},{key:"insertUniqueEdge",value:function(t){var n=this._edgeList.findEqualEdge(t);if(null!==n){var i=n.getLabel(),r=t.getLabel();n.isPointwiseEqual(t)||(r=new Bt(t.getLabel())).flip(),i.merge(r);var s=e.depthDelta(r),o=n.getDepthDelta()+s;n.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(e.depthDelta(t.getLabel()))}},{key:"buildSubgraphs",value:function(e,t){for(var n=new ge,i=e.iterator();i.hasNext();){var r=i.next(),s=r.getRightmostCoordinate(),o=new Nn(n).getDepth(s);r.computeDepth(o),r.findResultEdges(),n.add(r),t.add(r.getDirectedEdges(),r.getNodes())}}},{key:"createSubgraphs",value:function(e){for(var t=new ge,n=e.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new ye;r.create(i),t.add(r)}}return on.sort(t,on.reverseOrder()),t}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(e){if(null!==this._workingNoder)return this._workingNoder;var t=new In,n=new Rt;return n.setPrecisionModel(e),t.setSegmentIntersector(new Yn(n)),t}},{key:"buffer",value:function(e,t){var n=this._workingPrecisionModel;null===n&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var i=new Bn(n,this._bufParams),r=new zn(e,t,i).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,n),this._graph=new Zt(new $n),this._graph.addEdges(this._edgeList.getEdges());var s=this.createSubgraphs(this._graph),o=new Qt(this._geomFact);this.buildSubgraphs(s,o);var a=o.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)}},{key:"computeNodedEdges",value:function(e,t){var n=this.getNoder(t);n.computeNodes(e);for(var i=n.getNodedSubstrings().iterator();i.hasNext();){var r=i.next(),s=r.getCoordinates();if(2!==s.length||!s[0].equals2D(s[1])){var o=r.getData(),a=new ri(r.getCoordinates(),new Bt(o));this.insertUniqueEdge(a)}}}},{key:"setNoder",value:function(e){this._workingNoder=e}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new qn;var e=arguments[0];this._bufParams=e}},{key:"depthDelta",value:function(e){var t=e.getLocation(0,Q.LEFT),n=e.getLocation(0,Q.RIGHT);return t===$.INTERIOR&&n===$.EXTERIOR?1:t===$.EXTERIOR&&n===$.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(e){for(var t=new ot,n=new ge;e.hasNext();){var i=e.next(),r=t.createLineString(i.getCoordinates());n.add(r)}return t.buildGeometry(n)}}])}(),oi=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"rescale",value:function(){if(re(arguments[0],X))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.rescale(t.getCoordinates())}else if(arguments[0]instanceof Array){for(var n=arguments[0],i=0;i<n.length;i++)n[i].x=n[i].x/this._scaleFactor+this._offsetX,n[i].y=n[i].y/this._scaleFactor+this._offsetY;2===n.length&&n[0].equals2D(n[1])&&_e.out.println(n)}}},{key:"scale",value:function(){if(re(arguments[0],X)){for(var e=arguments[0],t=new ge(e.size()),n=e.iterator();n.hasNext();){var i=n.next();t.add(new En(this.scale(i.getCoordinates()),i.getData()))}return t}if(arguments[0]instanceof Array){for(var r=arguments[0],s=new Array(r.length).fill(null),o=0;o<r.length;o++)s[o]=new V(Math.round((r[o].x-this._offsetX)*this._scaleFactor),Math.round((r[o].y-this._offsetY)*this._scaleFactor),r[o].getZ());return qe.removeRepeatedPoints(s)}}},{key:"isIntegerPrecision",value:function(){return 1===this._scaleFactor}},{key:"getNodedSubstrings",value:function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e}},{key:"computeNodes",value:function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)}},{key:"interfaces_",get:function(){return[Tn]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],n=arguments[1];e.constructor_.call(this,t,n,0,0)}else if(4===arguments.length){var i=arguments[0],r=arguments[1];this._noder=i,this._scaleFactor=r,this._isScaled=!this.isIntegerPrecision()}}}])}(),ai=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"checkEndPtVertexIntersections",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next().getCoordinates();this.checkEndPtVertexIntersections(t[0],this._segStrings),this.checkEndPtVertexIntersections(t[t.length-1],this._segStrings)}else if(2===arguments.length)for(var n=arguments[0],i=arguments[1].iterator();i.hasNext();)for(var r=i.next().getCoordinates(),s=1;s<r.length-1;s++)if(r[s].equals(n))throw new O("found endpt/interior pt intersection at index "+s+" :pt "+n)}},{key:"checkInteriorIntersections",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var t=e.next(),n=this._segStrings.iterator();n.hasNext();){var i=n.next();this.checkInteriorIntersections(t,i)}else if(2===arguments.length)for(var r=arguments[0],s=arguments[1],o=r.getCoordinates(),a=s.getCoordinates(),l=0;l<o.length-1;l++)for(var c=0;c<a.length-1;c++)this.checkInteriorIntersections(r,l,s,c);else if(4===arguments.length){var u=arguments[0],h=arguments[1],d=arguments[2],f=arguments[3];if(u===d&&h===f)return null;var p=u.getCoordinates()[h],g=u.getCoordinates()[h+1],m=d.getCoordinates()[f],y=d.getCoordinates()[f+1];if(this._li.computeIntersection(p,g,m,y),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,p,g)||this.hasInteriorIntersection(this._li,m,y)))throw new O("found non-noded intersection at "+p+"-"+g+" and "+m+"-"+y)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next();this.checkCollapses(t)}else if(1===arguments.length)for(var n=arguments[0].getCoordinates(),i=0;i<n.length-2;i++)this.checkCollapse(n[i],n[i+1],n[i+2])}},{key:"hasInteriorIntersection",value:function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++){var r=e.getIntersection(i);if(!r.equals(t)&&!r.equals(n))return!0}return!1}},{key:"checkCollapse",value:function(t,n,i){if(t.equals(i))throw new O("found non-noded collapse at "+e.fact.createLineString([t,n,i]))}}],[{key:"constructor_",value:function(){this._li=new Rt,this._segStrings=null;var e=arguments[0];this._segStrings=e}}])}();ai.fact=new ot;var li=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"intersectsScaled",value:function(e,t){var n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),r=Math.min(e.y,t.y),s=Math.max(e.y,t.y),o=this._maxx<n||this._minx>i||this._maxy<r||this._miny>s;if(o)return!1;var a=this.intersectsToleranceSquare(e,t);return F.isTrue(!(o&&a),"Found bad envelope test"),a}},{key:"initCorners",value:function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new V(this._maxx,this._maxy),this._corner[1]=new V(this._minx,this._maxy),this._corner[2]=new V(this._minx,this._miny),this._corner[3]=new V(this._maxx,this._miny)}},{key:"intersects",value:function(e,t){return 1===this._scaleFactor?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(e){return Math.round(e*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)}},{key:"getSafeEnvelope",value:function(){if(null===this._safeEnv){var t=e.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new j(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))))}},{key:"intersectsToleranceSquare",value:function(e,t){var n=!1,i=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper()||n&&i||e.equals(this._pt)||t.equals(this._pt)))))}},{key:"addSnappedNode",value:function(e,t){var n=e.getCoordinate(t),i=e.getCoordinate(t+1);return!!this.intersects(n,i)&&(e.addIntersection(this.getCoordinate(),t),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new _("Scale factor must be non-zero");1!==t&&(this._pt=new V(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new V,this._p1Scaled=new V),this.initCorners(this._pt)}}])}();li.SAFE_ENV_EXPANSION_FACTOR=.75;var ci=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(1===arguments.length);else if(2===arguments.length){var e=arguments[1];arguments[0].getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new wn}}]),ui=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(1===arguments.length){var e=arguments[0];return this.snap(e,null,-1)}if(3===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2],o=t.getSafeEnvelope(),a=new hi(t,i,r);return this._index.query(o,new(s(function e(){n(this,e)},[{key:"interfaces_",get:function(){return[cn]}},{key:"visitItem",value:function(e){e.select(o,a)}}]))),a.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var e=arguments[0];this._index=e}}]),hi=function(e){function i(){var e;return n(this,i),e=t(this,i),i.constructor_.apply(e,arguments),e}return c(i,e),s(i,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(2===arguments.length&&Number.isInteger(arguments[1])&&arguments[0]instanceof An))return d(i,"select",this,1).apply(this,arguments);var e=arguments[1],t=arguments[0].getContext();if(this._parentEdge===t&&(e===this._hotPixelVertexIndex||e+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(t,e)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=t,this._hotPixelVertexIndex=n}}])}(ci);ui.HotPixelSnapAction=hi;var di=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(e,t,n,i){if(e===n&&t===i)return null;var r=e.getCoordinates()[t],s=e.getCoordinates()[t+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];if(this._li.computeIntersection(r,s,o,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Kn]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new ge}}]),fi=s(function e(){n(this,e),e.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(e){var t=En.getNodedSubstrings(e),n=new ai(t);try{n.checkValid()}catch(i){if(!(i instanceof v))throw i;i.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return En.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)}},{key:"findInteriorIntersections",value:function(e,t){var n=new di(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(re(arguments[0],X))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.computeVertexSnaps(t)}else if(arguments[0]instanceof En)for(var n=arguments[0],i=n.getCoordinates(),r=0;r<i.length;r++){var s=new li(i[r],this._scaleFactor,this._li);this._pointSnapper.snap(s,n,r)&&n.addIntersection(i[r],r)}}},{key:"computeNodes",value:function(e){this._nodedSegStrings=e,this._noder=new In,this._pointSnapper=new ui(this._noder.getIndex()),this.snapRound(e,this._li)}},{key:"computeIntersectionSnaps",value:function(e){for(var t=e.iterator();t.hasNext();){var n=t.next(),i=new li(n,this._scaleFactor,this._li);this._pointSnapper.snap(i)}}},{key:"interfaces_",get:function(){return[Tn]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Rt,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()}}]),pi=function(){function e(){n(this,e),e.constructor_.apply(this,arguments)}return s(e,[{key:"bufferFixedPrecision",value:function(e){var t=new oi(new fi(new it(1)),e.getScale()),n=new si(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(0===arguments.length){for(var t=e.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(s){if(!(s instanceof fe))throw s;this._saveException=s}if(null!==this._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],i=e.precisionScaleFactor(this._argGeom,this._distance,n),r=new it(i);this.bufferFixedPrecision(r)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===it.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(e){this._bufParams.setQuadrantSegments(e)}},{key:"bufferOriginalPrecision",value:function(){try{var e=new si(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof O))throw t;this._saveException=t}}},{key:"getResultGeometry",value:function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(e){this._bufParams.setEndCapStyle(e)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new y,this._resultGeometry=null,this._saveException=null,1===arguments.length){var e=arguments[0];this._argGeom=e}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}}},{key:"bufferOp",value:function(){if(2===arguments.length){var t=arguments[1];return new e(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof W&&"number"==typeof arguments[1]){var n=arguments[1],i=arguments[2],r=new e(arguments[0]);return r.setQuadrantSegments(i),r.getResultGeometry(n)}if(arguments[2]instanceof y&&arguments[0]instanceof W&&"number"==typeof arguments[1]){var s=arguments[1];return new e(arguments[0],arguments[2]).getResultGeometry(s)}}else if(4===arguments.length){var o=arguments[1],a=arguments[2],l=arguments[3],c=new e(arguments[0]);return c.setQuadrantSegments(a),c.setEndCapStyle(l),c.getResultGeometry(o)}}},{key:"precisionScaleFactor",value:function(e,t,n){var i=e.getEnvelopeInternal(),r=be.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY()))+2*(t>0?t:0),s=n-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,s)}}])}();pi.CAP_ROUND=y.CAP_ROUND,pi.CAP_BUTT=y.CAP_FLAT,pi.CAP_FLAT=y.CAP_FLAT,pi.CAP_SQUARE=y.CAP_SQUARE,pi.MAX_PRECISION_DIGITS=12;var gi=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],mi=s(function e(t){n(this,e),this.geometryFactory=t||new ot},[{key:"read",value:function(e){var t,n=(t="string"==typeof e?JSON.parse(e):e).type;if(!yi[n])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==gi.indexOf(n)?yi[n].call(this,t.coordinates):"GeometryCollection"===n?yi[n].call(this,t.geometries):yi[n].call(this,t)}},{key:"write",value:function(e){var t=e.getGeometryType();if(!vi[t])throw new Error("Geometry is not supported");return vi[t].call(this,e)}}]),yi={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var i=e.geometry.type;if(!yi[i])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=yi.bbox.call(this,e.bbox)),t},FeatureCollection:function(e){var t={};if(e.features){t.features=[];for(var n=0;n<e.features.length;++n)t.features.push(this.read(e.features[n]))}return e.bbox&&(t.bbox=this.parse.bbox.call(this,e.bbox)),t},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(i(V,f(r)))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new V(e[0],e[1]),new V(e[2],e[1]),new V(e[2],e[3]),new V(e[0],e[3]),new V(e[0],e[1])])},Point:function(e){var t=i(V,f(e));return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=[],n=0;n<e.length;++n)t.push(yi.Point.call(this,e[n]));return this.geometryFactory.createMultiPoint(t)},LineString:function(e){var t=yi.coordinates.call(this,e);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=[],n=0;n<e.length;++n)t.push(yi.LineString.call(this,e[n]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(e){for(var t=yi.coordinates.call(this,e[0]),n=this.geometryFactory.createLinearRing(t),i=[],r=1;r<e.length;++r){var s=e[r],o=yi.coordinates.call(this,s),a=this.geometryFactory.createLinearRing(o);i.push(a)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(yi.Polygon.call(this,i))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(this.read(i))}return this.geometryFactory.createGeometryCollection(t)}},vi={coordinate:function(e){var t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t},Point:function(e){return{type:"Point",coordinates:vi.coordinate.call(this,e.getCoordinate())}},MultiPoint:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],r=vi.Point.call(this,i);t.push(r.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(e){for(var t=[],n=e.getCoordinates(),i=0;i<n.length;++i){var r=n[i];t.push(vi.coordinate.call(this,r))}return{type:"LineString",coordinates:t}},MultiLineString:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],r=vi.LineString.call(this,i);t.push(r.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(e){var t=[],n=vi.LineString.call(this,e._shell);t.push(n.coordinates);for(var i=0;i<e._holes.length;++i){var r=e._holes[i],s=vi.LineString.call(this,r);t.push(s.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],r=vi.Polygon.call(this,i);t.push(r.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],r=i.getGeometryType();t.push(vi[r].call(this,i))}return{type:"GeometryCollection",geometries:t}}};return{BufferOp:pi,GeoJSONReader:s(function e(t){n(this,e),this.parser=new mi(t||new ot)},[{key:"read",value:function(e){return this.parser.read(e)}}]),GeoJSONWriter:s(function e(){n(this,e),this.parser=new mi(this.geometryFactory)},[{key:"write",value:function(e){return this.parser.write(e)}}])}}()),Qc.exports);const tu=he(eu);function nu(){return new iu}function iu(){this.reset()}iu.prototype={constructor:iu,reset:function(){this.s=this.t=0},add:function(e){su(ru,e,this.t),su(this,ru.s,this.s),this.s?this.t+=ru.t:this.s=ru.t},valueOf:function(){return this.s}};var ru=new iu;function su(e,t,n){var i=e.s=t+n,r=i-t,s=i-r;e.t=t-s+(n-r)}var ou=1e-6,au=Math.PI,lu=au/2,cu=au/4,uu=2*au,hu=180/au,du=au/180,fu=Math.abs,pu=Math.atan,gu=Math.atan2,mu=Math.cos,yu=Math.sin,vu=Math.sqrt;function _u(e){return e>1?0:e<-1?au:Math.acos(e)}function bu(e){return e>1?lu:e<-1?-lu:Math.asin(e)}function Eu(){}function wu(e,t){e&&Tu.hasOwnProperty(e.type)&&Tu[e.type](e,t)}var xu,Au,Su={Feature:function(e,t){wu(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)wu(n[i].geometry,t)}},Tu={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Cu(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Cu(n[i],t,0)},Polygon:function(e,t){Iu(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Iu(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)wu(n[i],t)}};function Cu(e,t,n){var i,r=-1,s=e.length-n;for(t.lineStart();++r<s;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function Iu(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Cu(e[n],t,1);t.polygonEnd()}function ku(e){return[gu(e[1],e[0]),bu(e[2])]}function Ru(e){var t=e[0],n=e[1],i=mu(n);return[i*mu(t),i*yu(t),yu(n)]}function Pu(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Mu(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Lu(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Bu(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Nu(e){var t=vu(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Ou(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&e.invert(n[0],n[1])}),n}function Du(e,t){return[e>au?e-uu:e<-au?e+uu:e,t]}function Fu(e){return function(t,n){return[(t+=e)>au?t-uu:t<-au?t+uu:t,n]}}function Uu(e){var t=Fu(e);return t.invert=Fu(-e),t}function zu(e,t){var n=mu(e),i=yu(e),r=mu(t),s=yu(t);function o(e,t){var o=mu(t),a=mu(e)*o,l=yu(e)*o,c=yu(t),u=c*n+a*i;return[gu(l*r-u*s,a*n-c*i),bu(u*r+l*s)]}return o.invert=function(e,t){var o=mu(t),a=mu(e)*o,l=yu(e)*o,c=yu(t),u=c*r-l*s;return[gu(l*r+c*s,a*n+u*i),bu(u*n-a*i)]},o}function Gu(e,t){(t=Ru(t))[0]-=e,Nu(t);var n=_u(-t[1]);return((-t[2]<0?-n:n)+uu-ou)%uu}function Vu(){var e,t=[];return{point:function(t,n){e.push([t,n])},lineStart:function(){t.push(e=[])},lineEnd:Eu,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Hu(e,t){return fu(e[0]-t[0])<ou&&fu(e[1]-t[1])<ou}function ju(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Wu(e,t,n,i,r){var s,o,a=[],l=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n,i=e[0],o=e[t];if(Hu(i,o)){for(r.lineStart(),s=0;s<t;++s)r.point((i=e[s])[0],i[1]);r.lineEnd()}else a.push(n=new ju(i,e,null,!0)),l.push(n.o=new ju(i,null,n,!1)),a.push(n=new ju(o,e,null,!1)),l.push(n.o=new ju(o,null,n,!0))}}),a.length){for(l.sort(t),$u(a),$u(l),s=0,o=l.length;s<o;++s)l[s].e=n=!n;for(var c,u,h=a[0];;){for(var d=h,f=!0;d.v;)if((d=d.n)===h)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(s=0,o=c.length;s<o;++s)r.point((u=c[s])[0],u[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(f)for(c=d.p.z,s=c.length-1;s>=0;--s)r.point((u=c[s])[0],u[1]);else i(d.x,d.p.x,-1,r);d=d.p}c=(d=d.o).z,f=!f}while(!d.v);r.lineEnd()}}}function $u(e){if(t=e.length){for(var t,n,i=0,r=e[0];++i<t;)r.n=n=e[i],n.p=r,r=n;r.n=n=e[0],n.p=r}}function Xu(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function qu(e){for(var t,n,i,r=e.length,s=-1,o=0;++s<r;)o+=e[s].length;for(n=new Array(o);--r>=0;)for(t=(i=e[r]).length;--t>=0;)n[--o]=i[t];return n}nu(),nu(),nu(),Du.invert=Du,1===(xu=Xu).length&&(Au=xu,xu=function(e,t){return Xu(Au(e),t)});var Ku=1e9,Yu=-Ku;function Ju(e,t,n,i){function r(r,s){return e<=r&&r<=n&&t<=s&&s<=i}function s(r,s,a,c){var u=0,h=0;if(null==r||(u=o(r,a))!==(h=o(s,a))||l(r,s)<0^a>0)do{c.point(0===u||3===u?e:n,u>1?i:t)}while((u=(u+a+4)%4)!==h);else c.point(s[0],s[1])}function o(i,r){return fu(i[0]-e)<ou?r>0?0:3:fu(i[0]-n)<ou?r>0?2:1:fu(i[1]-t)<ou?r>0?1:0:r>0?3:2}function a(e,t){return l(e.x,t.x)}function l(e,t){var n=o(e,1),i=o(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var l,c,u,h,d,f,p,g,m,y,v,_=o,b=Vu(),E={point:w,lineStart:function(){E.point=x,c&&c.push(u=[]);y=!0,m=!1,p=g=NaN},lineEnd:function(){l&&(x(h,d),f&&m&&b.rejoin(),l.push(b.result()));E.point=w,m&&_.lineEnd()},polygonStart:function(){_=b,l=[],c=[],v=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,r=c.length;n<r;++n)for(var s,o,a=c[n],l=1,u=a.length,h=a[0],d=h[0],f=h[1];l<u;++l)s=d,o=f,d=(h=a[l])[0],f=h[1],o<=i?f>i&&(d-s)*(i-o)>(f-o)*(e-s)&&++t:f<=i&&(d-s)*(i-o)<(f-o)*(e-s)&&--t;return t}(),n=v&&t,r=(l=qu(l)).length;(n||r)&&(o.polygonStart(),n&&(o.lineStart(),s(null,null,1,o),o.lineEnd()),r&&Wu(l,a,t,s,o),o.polygonEnd());_=o,l=c=u=null}};function w(e,t){r(e,t)&&_.point(e,t)}function x(s,o){var a=r(s,o);if(c&&u.push([s,o]),y)h=s,d=o,f=a,y=!1,a&&(_.lineStart(),_.point(s,o));else if(a&&m)_.point(s,o);else{var l=[p=Math.max(Yu,Math.min(Ku,p)),g=Math.max(Yu,Math.min(Ku,g))],b=[s=Math.max(Yu,Math.min(Ku,s)),o=Math.max(Yu,Math.min(Ku,o))];!function(e,t,n,i,r,s){var o,a=e[0],l=e[1],c=0,u=1,h=t[0]-a,d=t[1]-l;if(o=n-a,h||!(o>0)){if(o/=h,h<0){if(o<c)return;o<u&&(u=o)}else if(h>0){if(o>u)return;o>c&&(c=o)}if(o=r-a,h||!(o<0)){if(o/=h,h<0){if(o>u)return;o>c&&(c=o)}else if(h>0){if(o<c)return;o<u&&(u=o)}if(o=i-l,d||!(o>0)){if(o/=d,d<0){if(o<c)return;o<u&&(u=o)}else if(d>0){if(o>u)return;o>c&&(c=o)}if(o=s-l,d||!(o<0)){if(o/=d,d<0){if(o>u)return;o>c&&(c=o)}else if(d>0){if(o<c)return;o<u&&(u=o)}return c>0&&(e[0]=a+c*h,e[1]=l+c*d),u<1&&(t[0]=a+u*h,t[1]=l+u*d),!0}}}}}(l,b,e,t,n,i)?a&&(_.lineStart(),_.point(s,o),v=!1):(m||(_.lineStart(),_.point(l[0],l[1])),_.point(b[0],b[1]),a||_.lineEnd(),v=!1)}p=s,g=o,m=a}return E}}var Zu=nu();function Qu(e){return e}nu(),nu(),nu();var eh=1/0,th=eh,nh=-eh,ih=nh,rh={point:function(e,t){e<eh&&(eh=e);e>nh&&(nh=e);t<th&&(th=t);t>ih&&(ih=t)},lineStart:Eu,lineEnd:Eu,polygonStart:Eu,polygonEnd:Eu,result:function(){var e=[[eh,th],[nh,ih]];return nh=ih=-(th=eh=1/0),e}};function sh(e,t,n,i){return function(r,s){var o,a,l,c=t(s),u=r.invert(i[0],i[1]),h=Vu(),d=t(h),f=!1,p={point:g,lineStart:y,lineEnd:v,polygonStart:function(){p.point=_,p.lineStart=b,p.lineEnd=E,a=[],o=[]},polygonEnd:function(){p.point=g,p.lineStart=y,p.lineEnd=v,a=qu(a);var e=function(e,t){var n=t[0],i=t[1],r=[yu(n),-mu(n),0],s=0,o=0;Zu.reset();for(var a=0,l=e.length;a<l;++a)if(u=(c=e[a]).length)for(var c,u,h=c[u-1],d=h[0],f=h[1]/2+cu,p=yu(f),g=mu(f),m=0;m<u;++m,d=v,p=b,g=E,h=y){var y=c[m],v=y[0],_=y[1]/2+cu,b=yu(_),E=mu(_),w=v-d,x=w>=0?1:-1,A=x*w,S=A>au,T=p*b;if(Zu.add(gu(T*x*yu(A),g*E+T*mu(A))),s+=S?w+x*uu:w,S^d>=n^v>=n){var C=Mu(Ru(h),Ru(y));Nu(C);var I=Mu(r,C);Nu(I);var k=(S^w>=0?-1:1)*bu(I[2]);(i>k||i===k&&(C[0]||C[1]))&&(o+=S^w>=0?1:-1)}}return(s<-ou||s<ou&&Zu<-ou)^1&o}(o,u);a.length?(f||(s.polygonStart(),f=!0),Wu(a,ah,e,n,s)):e&&(f||(s.polygonStart(),f=!0),s.lineStart(),n(null,null,1,s),s.lineEnd()),f&&(s.polygonEnd(),f=!1),a=o=null},sphere:function(){s.polygonStart(),s.lineStart(),n(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function g(t,n){var i=r(t,n);e(t=i[0],n=i[1])&&s.point(t,n)}function m(e,t){var n=r(e,t);c.point(n[0],n[1])}function y(){p.point=m,c.lineStart()}function v(){p.point=g,c.lineEnd()}function _(e,t){l.push([e,t]);var n=r(e,t);d.point(n[0],n[1])}function b(){d.lineStart(),l=[]}function E(){_(l[0][0],l[0][1]),d.lineEnd();var e,t,n,i,r=d.clean(),c=h.result(),u=c.length;if(l.pop(),o.push(l),l=null,u)if(1&r){if((t=(n=c[0]).length-1)>0){for(f||(s.polygonStart(),f=!0),s.lineStart(),e=0;e<t;++e)s.point((i=n[e])[0],i[1]);s.lineEnd()}}else u>1&&2&r&&c.push(c.pop().concat(c.shift())),a.push(c.filter(oh))}return p}}function oh(e){return e.length>1}function ah(e,t){return((e=e.x)[0]<0?e[1]-lu-ou:lu-e[1])-((t=t.x)[0]<0?t[1]-lu-ou:lu-t[1])}nu();const lh=sh(function(){return!0},function(e){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(s,o){var a=s>0?au:-au,l=fu(s-n);fu(l-au)<ou?(e.point(n,i=(i+o)/2>0?lu:-lu),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(a,i),e.point(s,i),t=0):r!==a&&l>=au&&(fu(n-r)<ou&&(n-=r*ou),fu(s-a)<ou&&(s-=a*ou),i=function(e,t,n,i){var r,s,o=yu(e-n);return fu(o)>ou?pu((yu(t)*(s=mu(i))*yu(n)-yu(i)*(r=mu(t))*yu(e))/(r*s*o)):(t+i)/2}(n,i,s,o),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(a,i),t=0),e.point(n=s,i=o),r=a},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}},function(e,t,n,i){var r;if(null==e)r=n*lu,i.point(-au,r),i.point(0,r),i.point(au,r),i.point(au,0),i.point(au,-r),i.point(0,-r),i.point(-au,-r),i.point(-au,0),i.point(-au,r);else if(fu(e[0]-t[0])>ou){var s=e[0]<t[0]?au:-au;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])},[-au,-lu]);function ch(e,t){var n=mu(e),i=n>0,r=fu(n)>ou;function s(e,t){return mu(e)*mu(t)>n}function o(e,t,i){var r=[1,0,0],s=Mu(Ru(e),Ru(t)),o=Pu(s,s),a=s[0],l=o-a*a;if(!l)return!i&&e;var c=n*o/l,u=-n*a/l,h=Mu(r,s),d=Bu(r,c);Lu(d,Bu(s,u));var f=h,p=Pu(d,f),g=Pu(f,f),m=p*p-g*(Pu(d,d)-1);if(!(m<0)){var y=vu(m),v=Bu(f,(-p-y)/g);if(Lu(v,d),v=ku(v),!i)return v;var _,b=e[0],E=t[0],w=e[1],x=t[1];E<b&&(_=b,b=E,E=_);var A=E-b,S=fu(A-au)<ou;if(!S&&x<w&&(_=w,w=x,x=_),S||A<ou?S?w+x>0^v[1]<(fu(v[0]-b)<ou?w:x):w<=v[1]&&v[1]<=x:A>au^(b<=v[0]&&v[0]<=E)){var T=Bu(f,(-p+y)/g);return Lu(T,d),[v,ku(T)]}}}function a(t,n){var r=i?e:au-e,s=0;return t<-r?s|=1:t>r&&(s|=2),n<-r?s|=4:n>r&&(s|=8),s}return sh(s,function(e){var t,n,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(h,d){var f,p=[h,d],g=s(h,d),m=i?g?0:a(h,d):g?a(h+(h<0?au:-au),d):0;if(!t&&(c=l=g)&&e.lineStart(),g!==l&&(!(f=o(t,p))||Hu(t,f)||Hu(p,f))&&(p[0]+=ou,p[1]+=ou,g=s(p[0],p[1])),g!==l)u=0,g?(e.lineStart(),f=o(p,t),e.point(f[0],f[1])):(f=o(t,p),e.point(f[0],f[1]),e.lineEnd()),t=f;else if(r&&t&&i^g){var y;m&n||!(y=o(p,t,!0))||(u=0,i?(e.lineStart(),e.point(y[0][0],y[0][1]),e.point(y[1][0],y[1][1]),e.lineEnd()):(e.point(y[1][0],y[1][1]),e.lineEnd(),e.lineStart(),e.point(y[0][0],y[0][1])))}!g||t&&Hu(t,p)||e.point(p[0],p[1]),t=p,l=g,n=m},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return u|(c&&l)<<1}}},function(n,i,r,s){!function(e,t,n,i,r,s){if(n){var o=mu(t),a=yu(t),l=i*n;null==r?(r=t+i*uu,s=t-l/2):(r=Gu(o,r),s=Gu(o,s),(i>0?r<s:r>s)&&(r+=i*uu));for(var c,u=r;i>0?u>s:u<s;u-=l)c=ku([o,-a*mu(u),-a*yu(u)]),e.point(c[0],c[1])}}(s,e,t,r,n,i)},i?[0,-e]:[-au,e-au])}function uh(e){return function(t){var n=new hh;for(var i in e)n[i]=e[i];return n.stream=t,n}}function hh(){}function dh(e,t,n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],s=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),null!=s&&e.clipExtent(null),function(e,t){e&&Su.hasOwnProperty(e.type)?Su[e.type](e,t):wu(e,t)}(n,e.stream(rh));var o=rh.result(),a=Math.min(i/(o[1][0]-o[0][0]),r/(o[1][1]-o[0][1])),l=+t[0][0]+(i-a*(o[1][0]+o[0][0]))/2,c=+t[0][1]+(r-a*(o[1][1]+o[0][1]))/2;return null!=s&&e.clipExtent(s),e.scale(150*a).translate([l,c])}hh.prototype={constructor:hh,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var fh=mu(30*du);function ph(e,t){return+t?function(e,t){function n(i,r,s,o,a,l,c,u,h,d,f,p,g,m){var y=c-i,v=u-r,_=y*y+v*v;if(_>4*t&&g--){var b=o+d,E=a+f,w=l+p,x=vu(b*b+E*E+w*w),A=bu(w/=x),S=fu(fu(w)-1)<ou||fu(s-h)<ou?(s+h)/2:gu(E,b),T=e(S,A),C=T[0],I=T[1],k=C-i,R=I-r,P=v*k-y*R;(P*P/_>t||fu((y*k+v*R)/_-.5)>.3||o*d+a*f+l*p<fh)&&(n(i,r,s,o,a,l,C,I,S,b/=x,E/=x,w,g,m),m.point(C,I),n(C,I,S,b,E,w,c,u,h,d,f,p,g,m))}}return function(t){var i,r,s,o,a,l,c,u,h,d,f,p,g={point:m,lineStart:y,lineEnd:_,polygonStart:function(){t.polygonStart(),g.lineStart=b},polygonEnd:function(){t.polygonEnd(),g.lineStart=y}};function m(n,i){n=e(n,i),t.point(n[0],n[1])}function y(){u=NaN,g.point=v,t.lineStart()}function v(i,r){var s=Ru([i,r]),o=e(i,r);n(u,h,c,d,f,p,u=o[0],h=o[1],c=i,d=s[0],f=s[1],p=s[2],16,t),t.point(u,h)}function _(){g.point=m,t.lineEnd()}function b(){y(),g.point=E,g.lineEnd=w}function E(e,t){v(i=e,t),r=u,s=h,o=d,a=f,l=p,g.point=v}function w(){n(u,h,c,d,f,p,r,s,i,o,a,l,16,t),g.lineEnd=_,_()}return g}}(e,t):function(e){return uh({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var gh=uh({point:function(e,t){this.stream.point(e*du,t*du)}});function mh(e){return function(e){var t,n,i,r,s,o,a,l,c,u,h=150,d=480,f=250,p=0,g=0,m=0,y=0,v=0,_=null,b=lh,E=null,w=Qu,x=.5,A=ph(C,x);function S(e){return[(e=s(e[0]*du,e[1]*du))[0]*h+n,i-e[1]*h]}function T(e){return(e=s.invert((e[0]-n)/h,(i-e[1])/h))&&[e[0]*hu,e[1]*hu]}function C(e,r){return[(e=t(e,r))[0]*h+n,i-e[1]*h]}function I(){s=Ou(r=function(e,t,n){return(e%=uu)?t||n?Ou(Uu(e),zu(t,n)):Uu(e):t||n?zu(t,n):Du}(m,y,v),t);var e=t(p,g);return n=d-e[0]*h,i=f+e[1]*h,k()}function k(){return c=u=null,S}return S.stream=function(e){return c&&u===e?c:c=gh(b(r,A(w(u=e))))},S.clipAngle=function(e){return arguments.length?(b=+e?ch(_=e*du,6*du):(_=null,lh),k()):_*hu},S.clipExtent=function(e){return arguments.length?(w=null==e?(E=o=a=l=null,Qu):Ju(E=+e[0][0],o=+e[0][1],a=+e[1][0],l=+e[1][1]),k()):null==E?null:[[E,o],[a,l]]},S.scale=function(e){return arguments.length?(h=+e,I()):h},S.translate=function(e){return arguments.length?(d=+e[0],f=+e[1],I()):[d,f]},S.center=function(e){return arguments.length?(p=e[0]%360*du,g=e[1]%360*du,I()):[p*hu,g*hu]},S.rotate=function(e){return arguments.length?(m=e[0]%360*du,y=e[1]%360*du,v=e.length>2?e[2]%360*du:0,I()):[m*hu,y*hu,v*hu]},S.precision=function(e){return arguments.length?(A=ph(C,x=e*e),k()):vu(x)},S.fitExtent=function(e,t){return dh(S,e,t)},S.fitSize=function(e,t){return function(e,t,n){return dh(e,[[0,0],t],n)}(S,e,t)},function(){return t=e.apply(this,arguments),S.invert=t.invert&&T,I()}}(function(){return e})()}function yh(e){return function(t,n){var i=mu(t),r=mu(n),s=e(i*r);return[s*r*yu(t),s*yu(n)]}}function vh(e){return function(t,n){var i=vu(t*t+n*n),r=e(i),s=yu(r),o=mu(r);return[gu(t*s,i*o),bu(i&&n*s/i)]}}yh(function(e){return vu(2/(1+e))}).invert=vh(function(e){return 2*bu(e/2)});var _h=yh(function(e){return(e=_u(e))&&e/yu(e)});function bh(e,t){return[e,t]}_h.invert=vh(function(e){return e}),bh.invert=bh;var{BufferOp:Eh,GeoJSONReader:wh,GeoJSONWriter:xh}=tu;function Ah(e,t,n,i){var r=e.properties||{},s="Feature"===e.type?e.geometry:e;if("GeometryCollection"===s.type){var o=[];return Kc(e,function(e){var r=Ah(e,t,n,i);r&&o.push(r)}),mc(o)}var a=function(e){var t=Jc(e).geometry.coordinates,n=[-t[0],-t[1]];return mh(_h).scale(79.4188).clipAngle(179.999).rotate(n).scale(hc)}(s),l={type:s.type,coordinates:Th(s.coordinates,a)},c=(new wh).read(l),u=yc(function(e,t="kilometers"){const n=dc[t];if(!n)throw new Error(t+" units is invalid");return e/n}(t,n),"meters"),h=Eh.bufferOp(c,u,i);if(!Sh((h=(new xh).write(h)).coordinates))return fc({type:h.type,coordinates:Ch(h.coordinates,a)},r)}function Sh(e){return Array.isArray(e[0])?Sh(e[0]):isNaN(e[0])}function Th(e,t){return"object"!=typeof e[0]?t(e):e.map(function(e){return Th(e,t)})}function Ch(e,t){return"object"!=typeof e[0]?t.invert(e):e.map(function(e){return Ch(e,t)})}var Ih=function(e,t,n){var i=(n=n||{}).units||"kilometers",r=n.steps||8;if(!e)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(void 0===t)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var s=[];switch(e.type){case"GeometryCollection":return Kc(e,function(e){var n=Ah(e,t,i,r);n&&s.push(n)}),mc(s);case"FeatureCollection":return qc(e,function(e){var n=Ah(e,t,i,r);n&&qc(n,function(e){e&&s.push(e)})}),mc(s)}return Ah(e,t,i,r)};var kh=function(e,t={}){return function(e,t,n){var i=n,r=!1;return Yc(e,function(e,s,o,a,l){i=!1===r&&void 0===n?e:t(i,e,s,o,a,l),r=!0}),i}(e,(e,n)=>{const i=n.geometry.coordinates;return e+Ec(i[0],i[1],t)},0)};function Rh(e,t=30){return Ih(e,t,{units:"meters"})}function Ph(e,t){return Lc(pc(t),e)}function Mh(e,t){return $c(e,t).features.map(e=>e.geometry.coordinates)}function Lh(e){return kh(e,{units:"meters"})}function Bh(e){if(e.length<3)return 1;let t=0;for(let n=1;n<e.length-1;n++){const i=e[n-1],r=Nh(e[n],i,e[n+1]);t+=Math.abs(Math.PI-r)}return 1-Math.min(t/(Math.PI*(e.length-2)),1)}function Nh(e,t,n){const i=[t[0]-e[0],t[1]-e[1]],r=[n[0]-e[0],n[1]-e[1]],s=i[0]*r[0]+i[1]*r[1],o=Math.hypot(i[0],i[1]),a=Math.hypot(r[0],r[1]);return Math.acos(Math.max(-1,Math.min(1,s/(o*a))))}function Oh(e,t){const n=String(e),i=String(t);return n<i?`${n}_${i}`:`${i}_${n}`}class Dh{constructor(e,t=50){if(this.grid=new Map,this.cellSize=e.size<100?Math.min(t,.001):t,0===e.size)return this.minX=0,void(this.minY=0);let n=1/0,i=1/0,r=-1/0,s=-1/0;for(const o of e.values())n=Math.min(n,o.lon),i=Math.min(i,o.lat),r=Math.max(r,o.lon),s=Math.max(s,o.lat);this.minX=n,this.minY=i}cellKey(e,t){return`${Math.floor((e-this.minX)/this.cellSize)},${Math.floor((t-this.minY)/this.cellSize)}`}index(e){for(const[t,n]of e){const e=this.cellKey(n.lon,n.lat);this.grid.has(e)||this.grid.set(e,[]),this.grid.get(e).push(t)}}nearNodes(e,t,n){const i=n/111e3,r=Math.max(1,Math.ceil(i/this.cellSize)),s=this.cellKey(e,t),[o,a]=s.split(",").map(Number),l=[];for(let c=-r;c<=r;c++)for(let e=-r;e<=r;e++){const t=`${o+c},${a+e}`,n=this.grid.get(t);n&&l.push(...n)}return l}}const Fh=new Map;function Uh(e){var t,n;return`v1:${`${e.nodes.length}-${null==(t=e.nodes[0])?void 0:t.id}`}:${`${e.ways.length}-${null==(n=e.ways[0])?void 0:n.id}`}`}function zh(e,t,n=!0){if(n){const n=Uh({nodes:e,ways:t}),i=Fh.get(n);if(i)return i}const i={adj:new Map,nodes:new Map(e.map(e=>[e.id,e])),ways:new Map(t.map(e=>[e.id,e])),edgeWays:new Map};for(const r of e)i.adj.has(r.id)||i.adj.set(r.id,new Set);for(const r of t)for(let e=0;e<r.nodeIds.length-1;e++){const t=r.nodeIds[e],n=r.nodeIds[e+1];i.adj.has(t)||i.adj.set(t,new Set),i.adj.has(n)||i.adj.set(n,new Set),i.adj.get(t).add(n),i.adj.get(n).add(t);const s=Oh(t,n),o=i.edgeWays.get(s)??[];o.push(r.id),i.edgeWays.set(s,o)}if(n){const n=Uh({nodes:e,ways:t});Fh.set(n,i)}return i}function Gh(e,t){return gc(t.map(t=>{const n=e.nodes.get(t);if(!n)throw new Error("missing node "+t);return[n.lon,n.lat]}))}function Vh(e,t,n,i=4e3){if(!e.nodes.get(n))return{visitedCount:0};const r=new Set([n]),s=[n],o=new Map([[n,null]]),a=new Map([[n,0]]);let l=0,c=0;const u=t.geometry.coordinates[0],h=[u.reduce((e,t)=>e+t[0],0)/u.length,u.reduce((e,t)=>e+t[1],0)/u.length];for(;s.length&&l<i;){l++;let n=0,i=1/0;for(let t=0;t<s.length;t++){const r=s[t],o=e.nodes.get(r);if(!o)continue;const l=wc(pc([o.lon,o.lat]),pc(h),{units:"meters"}),c=(a.get(r)||0)+l;c<i&&(i=c,n=t)}const u=s.splice(n,1)[0];c++;const d=e.adj.get(u);if(d)for(const l of d){if(r.has(l))continue;r.add(l);const n=e.nodes.get(l);if(!n)continue;const i=(a.get(u)||0)+wc(pc([n.lon,n.lat]),pc([e.nodes.get(u).lon,e.nodes.get(u).lat]),{units:"meters"}),h=Mh(Gh(e,[u,l]),t);if(h.length>0){const e=[];let t=u;for(;null!==t;)e.push(t),t=o.get(t)??null;return e.reverse(),e.push(l),{path:e,hitPoint:h[0],visitedCount:c}}o.set(l,u),a.set(l,i),s.push(l)}}return{visitedCount:c}}function Hh(e,t){var n;if(0===t.length)return 0;let i=0;for(const s of t){const t=(null==(n=e.adj.get(s))?void 0:n.size)??0;i+=Math.min(t,4)}const r=i/t.length;return Math.min(r/4,1)}function jh(e,t,n,i,r,s){var o,a,l,c;const u=Math.min(e/200,1),h=.1*Math.min(i/10,1),d=.4*u+.3*t+.3*n;let f=.5,p=0;for(const m of r){const e=s.ways.get(m);if(!e)continue;p++;const t=null==(o=e.tags)?void 0:o.highway;if(t){f+={motorway:1,trunk:.95,primary:.9,secondary:.85,tertiary:.8,residential:.7,service:.6,track:.5,path:.3,footway:.2}[t]||.5}const n=null==(a=e.tags)?void 0:a.maxspeed;if(n&&!isNaN(parseFloat(n))){const e=parseFloat(n);e<=30?f+=.1:e<=50&&(f+=.05)}"paved"!==(null==(l=e.tags)?void 0:l.surface)&&"asphalt"!==(null==(c=e.tags)?void 0:c.surface)||(f+=.05)}p>0?f/=p:f=.5;const g=.7*d+.3*f+h;return Math.max(0,Math.min(1,g))}function Wh(e){const t=[],n=[];if(e.nodes&&Array.isArray(e.nodes)&&e.nodes.length>0&&void 0!==e.nodes[0].id)return{nodes:e.nodes,ways:e.ways||[]};for(const i of e.ways||[]){if(!i.nodes||!Array.isArray(i.nodes))continue;const e=[];for(let n=0;n<i.nodes.length;n++){const r=i.nodes[n];if(r&&"number"==typeof r.lon&&"number"==typeof r.lat){const s=`${i.id}-${n}`,o={id:s,lon:r.lon,lat:r.lat};t.push(o),e.push(s)}else if("number"==typeof r||"string"==typeof r)break}if(e.length>0){const t={id:i.id||`way-${n.length}`,nodeIds:e,tags:i.tags||{}};n.push(t)}}return{nodes:t,ways:n}}const $h=Object.freeze(Object.defineProperty({__proto__:null,buildGraph:zh,convertFromExistingOsmData:Wh,detectEntryCandidates:function(e){const t=performance.now(),{polygon:n,osm:i,outerBufferMeters:r=30,maxSearchMeters:s=5*r}=e,o=zh(i.nodes,i.ways),a=function(e,t,n,i){const r=new Set,s=e.nodes.size<100?5e-4:50,o=new Dh(e.nodes,s);o.index(e.nodes);const a=t.geometry.coordinates[0],l=a.reduce((e,t)=>e+t[0],0)/a.length,c=a.reduce((e,t)=>e+t[1],0)/a.length;for(const h of e.ways.values()){const n=h.nodeIds;for(let i=0;i<n.length-1;i++){const s=n[i],o=n[i+1],a=e.nodes.get(s),l=e.nodes.get(o);if(!a||!l)continue;const c=[a.lon,a.lat],u=[l.lon,l.lat],h=Ph(t,c);if(h!==Ph(t,u)){const e=h?o:s;r.add(e)}}}const u=Math.max(i,n);for(let h=n;h<=u;h+=n){const n=Rh(t,h),i=o.nearNodes(l,c,h);let s=0,a=0,u=0;for(const o of i){const i=e.nodes.get(o);if(!i)continue;s++;const l=[i.lon,i.lat],c=!Ph(t,l),h=Ph(n,l);c&&a++,h&&u++,c&&h&&r.add(o)}if(r.size>=12)break}if(0===r.size&&e.nodes.size<1e4){const n=Rh(t,u);let i=0,s=0;for(const[o,a]of e.nodes){i++;const e=[a.lon,a.lat];!Ph(t,e)&&Ph(n,e)&&(r.add(o),s++)}}return Array.from(r)}(o,n,r,s),l=new Map;let c=0;const u=a.slice(0,1e3);for(const p of u){const e=Vh(o,n,p);if(!e.path||!e.hitPoint){0;continue}c+=e.visitedCount||0;const t=Gh(o,e.path),i=Lh(t),r=Bh(t.geometry.coordinates),s=Hh(o,e.path),a=new Set;for(let n=0;n<e.path.length-1;n++){const t=Oh(e.path[n],e.path[n+1]);(o.edgeWays.get(t)??[]).forEach(e=>a.add(String(e)))}const u=jh(i,r,s,e.path.length,Array.from(a),o),h=`${Math.round(1e3*e.hitPoint[0])},${Math.round(1e3*e.hitPoint[1])}`;l.has(h)||l.set(h,[]);const d=l.get(h);d.push({id:`entry-${d.length>0?d.length+1:"1"}-${h}`,intersectionPoint:e.hitPoint,pathNodeIds:e.path,path:t,distanceMeters:i,straightness:r,continuity:s,confidence:u,wayIds:Array.from(a)})}const h=[];for(const[p,g]of l)g.length>0&&(g.sort((e,t)=>t.confidence-e.confidence),h.push(g[0]));const d=performance.now()-t,f=Array.from(o.edgeWays.values()).reduce((e,t)=>e+t.length,0);return h.length,a.length,{candidates:h.sort((e,t)=>t.confidence-e.confidence),processingTimeMs:d,graphStats:{nodeCount:o.nodes.size,wayCount:o.ways.size,edgeCount:f}}}},Symbol.toStringTag,{value:"Module"}));const Xh=new class{constructor(){this.candidates=[],this.loading=!1,this.error=null,this.lastResult=null,this.manualCandidates=[]}async detectEntries(e,t){if(!e||!t)return this.error="Missing polygon or OSM data",this.candidates=[],void this.notifyUpdate();this.loading=!0,this.error=null,this.notifyUpdate();try{const n=function(e,t,n=30){try{if(!e||!t)return null;let i,r;if(t.nodes&&t.ways)i=t.nodes,r=t.ways;else{const e=Wh(t);i=e.nodes,r=e.ways}return 0===i.length||0===r.length?null:{polygon:e,osm:{nodes:i,ways:r},outerBufferMeters:n,maxSearchMeters:Math.max(4*n,120)}}catch(i){return null}}(this.convertLeafletPolygonToGeoJSON(e),t,30);if(!n)throw new Error("Failed to prepare detection input");const i=await this.runEntryDetection(n);this.candidates=[...i.candidates,...this.manualCandidates],this.lastResult=i,this.error=null}catch(n){const e=String((null==n?void 0:n.message)??n);this.error=e,this.candidates=[]}finally{this.loading=!1,this.notifyUpdate()}}clearCandidates(e=!1){e||(this.manualCandidates=[]),this.candidates=e?[...this.manualCandidates]:[],this.lastResult=null,this.error=null,this.notifyUpdate()}deleteCandidate(e){const t=this.candidates.length,n=this.removeManualCandidateInternal(e);this.candidates=this.candidates.filter(t=>t.id!==e),(this.candidates.length<t||n)&&this.notifyUpdate()}addManualCandidate(e){const t={...e,manual:!0};this.manualCandidates.push(t),this.candidates=[...this.candidates,t],this.notifyUpdate()}clearManualCandidates(){0!==this.manualCandidates.length&&(this.manualCandidates=[],this.candidates=this.candidates.filter(e=>!e.manual),this.notifyUpdate())}setOnUpdate(e){this.onUpdateCallback=e}notifyUpdate(){this.onUpdateCallback&&this.onUpdateCallback(this.candidates)}removeManualCandidateInternal(e){const t=this.manualCandidates.length;return this.manualCandidates=this.manualCandidates.filter(t=>t.id!==e),this.manualCandidates.length<t}convertLeafletPolygonToGeoJSON(e){const t=e.getLatLngs()[0].map(e=>[e.lng,e.lat]);if(t.length>0){const e=t[0],n=t[t.length-1];e[0]===n[0]&&e[1]===n[1]||t.push([e[0],e[1]])}return{type:"Feature",geometry:{type:"Polygon",coordinates:[t]},properties:{}}}async runEntryDetection(e){const{detectEntryCandidates:t}=await s(async()=>{const{detectEntryCandidates:e}=await Promise.resolve().then(()=>$h);return{detectEntryCandidates:e}},void 0);return t(e)}};async function qh(e,t,n,i){return i._parse(e,t,n,i)}function Kh(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const Yh=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),Jh="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Jh&&parseFloat(Jh[1]);const Zh=globalThis,Qh=globalThis.process||{},ed=globalThis.navigator||{};function td(e){var t,n;if("undefined"!=typeof window&&"renderer"===(null==(t=window.process)?void 0:t.type))return!0;if("undefined"!=typeof process&&Boolean(null==(n=process.versions)?void 0:n.electron))return!0;const i="undefined"!=typeof navigator&&navigator.userAgent;return Boolean(i&&i.indexOf("Electron")>=0)}function nd(){return!("object"==typeof process&&"[object process]"===String(process)&&!(null==process?void 0:process.browser))||td()}const id="4.1.0";class rd{constructor(e,t,n="sessionStorage"){this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(dy){return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var sd,od;(od=sd||(sd={}))[od.BLACK=30]="BLACK",od[od.RED=31]="RED",od[od.GREEN=32]="GREEN",od[od.YELLOW=33]="YELLOW",od[od.BLUE=34]="BLUE",od[od.MAGENTA=35]="MAGENTA",od[od.CYAN=36]="CYAN",od[od.WHITE=37]="WHITE",od[od.BRIGHT_BLACK=90]="BRIGHT_BLACK",od[od.BRIGHT_RED=91]="BRIGHT_RED",od[od.BRIGHT_GREEN=92]="BRIGHT_GREEN",od[od.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",od[od.BRIGHT_BLUE=94]="BRIGHT_BLUE",od[od.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",od[od.BRIGHT_CYAN=96]="BRIGHT_CYAN",od[od.BRIGHT_WHITE=97]="BRIGHT_WHITE";function ad(e){return"string"!=typeof e?e:(e=e.toUpperCase(),sd[e]||sd.WHITE)}function ld(e,t){if(!e)throw new Error("Assertion failed")}function cd(){var e,t,n;let i;if(nd()&&Zh.performance)i=null==(t=null==(e=null==Zh?void 0:Zh.performance)?void 0:e.now)?void 0:t.call(e);else if("hrtime"in Qh){const e=null==(n=null==Qh?void 0:Qh.hrtime)?void 0:n.call(Qh);i=1e3*e[0]+e[1]/1e6}else i=Date.now();return i}const ud={debug:nd()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},hd={enabled:!0,level:0};function dd(){}const fd={},pd={once:!0};class gd{constructor({id:e}={id:""}){this.VERSION=id,this._startTs=cd(),this._deltaTs=cd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new rd(`__probe-${this.id}__`,hd),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),r=e;for(const s of i){const n=r[s];"function"==typeof n&&(t.find(e=>s===e)||(r[s]=n.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((cd()-this._startTs).toPrecision(10))}getDelta(){return Number((cd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ud.warn,arguments,pd)}error(e){return this._getLogFunction(0,e,ud.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,ud.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ud.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,ud.debug||ud.info,arguments,pd)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||dd,n&&[n],{tag:vd(t)}):dd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||dd)}group(e,t,n={collapsed:!1}){const i=yd({logLevel:e,message:t,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||dd)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=md(e)}_getLogFunction(e,t,n,i,r){if(this._shouldLog(e)){r=yd({logLevel:e,message:t,args:i,opts:r}),ld(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=cd();const s=r.tag||r.message;if(r.once&&s){if(fd[s])return dd;fd[s]=cd()}return t=function(e,t,n){if("string"==typeof t){const i=n.time?function(e,t=8){const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(n.total)):"";t=function(e,t,n){nd||"string"!=typeof e||(t&&(e=`[${ad(t)}m${e}[39m`),n&&(e=`[${ad(n)+10}m${e}[49m`));return e}(t=n.time?`${e}: ${i}  ${t}`:`${e}: ${t}`,n.color,n.background)}return t}(this.id,r.message,r),n.bind(console,t,...r.args)}return dd}}function md(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return ld(Number.isFinite(t)&&t>=0),t}function yd(e){const{logLevel:t,message:n}=e;e.logLevel=md(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return ld("string"===r||"object"===r),Object.assign(e,{args:i},e.opts)}function vd(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}gd.VERSION=id,globalThis.probe={};const _d=new gd({id:"@probe.gl/log"}),bd="4.3.3",Ed=bd[0]>="0"&&bd[0]<="9"?`v${bd}`:"";const wd=function(){const e=new gd({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=Ed,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}();function xd(e,t){return Ad(e||{},t)}function Ad(e,t,n=0){if(n>3)return t;const i={...e};for(const[r,s]of Object.entries(t))s&&"object"==typeof s&&!Array.isArray(s)?i[r]=Ad(i[r]||{},t[r],n+1):i[r]=t[r];return i}const Sd=((null==(Td=globalThis._loadersgl_)?void 0:Td.version)||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version);var Td;function Cd(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Id="object"!=typeof process||"[object process]"!==String(process)||process.browser,kd="function"==typeof importScripts,Rd="undefined"!=typeof window&&void 0!==window.orientation,Pd="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Pd&&parseFloat(Pd[1]);class Md{constructor(e,t){i(this,"name"),i(this,"workerThread"),i(this,"isRunning",!0),i(this,"result"),i(this,"_resolve",()=>{}),i(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Cd(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Cd(this.isRunning),this.isRunning=!1,this._reject(e)}}class Ld{terminate(){}}const Bd=new Map;function Nd(e){Cd(e.source&&!e.url||!e.source&&e.url);let t=Bd.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return Od((t=e,`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`));var t}(e.url),Bd.set(e.url,t)),e.source&&(t=Od(e.source),Bd.set(e.source,t))),Cd(t),t}function Od(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Dd(e,t=!0,n){const i=n||new Set;if(e){if(Fd(e))i.add(e);else if(Fd(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const r in e)Dd(e[r],t,i)}else;return void 0===n?Array.from(i):[]}function Fd(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const Ud=()=>{};class zd{constructor(e){i(this,"name"),i(this,"source"),i(this,"url"),i(this,"terminated",!1),i(this,"worker"),i(this,"onMessage"),i(this,"onError"),i(this,"_loadableURL","");const{name:t,source:n,url:r}=e;Cd(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=Ud,this.onError=e=>{},this.worker=Id?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return"undefined"!=typeof Worker&&Id||void 0!==Ld&&!Id}destroy(){this.onMessage=Ud,this.onError=Ud,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||Dd(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=Nd({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>{},e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Ld(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Ld(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class Gd{constructor(e){i(this,"name","unnamed"),i(this,"source"),i(this,"url"),i(this,"maxConcurrency",1),i(this,"maxMobileConcurrency",1),i(this,"onDebug",()=>{}),i(this,"reuseWorkers",!0),i(this,"props",{}),i(this,"jobQueue",[]),i(this,"idleQueue",[]),i(this,"count",0),i(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return zd.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,n)=>e.done(n),n=(e,t)=>e.error(t)){const i=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:i}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new Md(t.name,e);e.onMessage=e=>t.onMessage(i,e.type,e.payload),e.onError=e=>t.onError(i,e),t.onStart(i);try{await i.result}catch(n){}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Id||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new zd({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Rd?this.maxMobileConcurrency:this.maxConcurrency}}const Vd={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Hd=class e{constructor(e){i(this,"props"),i(this,"workerPools",new Map),this.props={...Vd},this.setProps(e),this.workerPools=new Map}static isSupported(){return zd.isSupported()}static getWorkerFarm(t={}){return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let r=this.workerPools.get(t);return r||(r=new Gd({name:t,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};i(Hd,"_workerFarm");let jd=Hd;const Wd={};async function $d(e,t=null,n={},i=null){return t&&(e=function(e,t,n={},i=null){if(!n.useLocalLibraries&&e.startsWith("http"))return e;i=i||e;const r=n.modules||{};if(r[i])return r[i];if(!Id)return`modules/${t}/dist/libs/${i}`;if(n.CDN)return Cd(n.CDN.startsWith("http")),`${n.CDN}/${t}@${Sd}/dist/libs/${i}`;if(kd)return`../src/libs/${i}`;return`modules/${t}/src/libs/${i}`}(e,t,n,i)),Wd[e]=Wd[e]||async function(e){if(e.endsWith("wasm"))return await async function(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};if(Id||!t||e.startsWith("http")){const t=await fetch(e);return await t.arrayBuffer()}return await t(e)}(e);if(!Id)try{const{requireFromFile:t}=globalThis.loaders||{};return await(null==t?void 0:t(e))}catch(n){return null}if(kd)return importScripts(e);const t=await async function(e){const{readFileAsText:t}=globalThis.loaders||{};if(Id||!t||e.startsWith("http")){const t=await fetch(e);return await t.text()}return await t(e)}(e);return function(e,t){if(!Id){const{requireFromString:n}=globalThis.loaders||{};return null==n?void 0:n(e,t)}if(kd)return eval.call(globalThis,e),null;const n=document.createElement("script");n.id=t;try{n.appendChild(document.createTextNode(e))}catch(dy){n.text=e}return document.body.appendChild(n),null}(t,e)}(e),await Wd[e]}async function Xd(e,t,n,i,r){const s=e.id,o=function(e,t={}){const n=t[e.id]||{},i=Id?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r=Id?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let t=e.version;"latest"===t&&(t="latest");const n=t?`@${t}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${i}`}return Cd(r),r}(e,n),a=jd.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",qd.bind(null,r));l.postMessage("process",{input:t,options:n,context:i});const c=await l.result;return await c.result}async function qd(e,t,n,i){switch(n){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:n,input:s,options:o}=i;try{const i=await e(s,o);t.postMessage("done",{id:n,result:i})}catch(r){const e=r instanceof Error?r.message:"unknown error";t.postMessage("error",{id:n,error:e})}}}function Kd(e,t,n){if(e.byteLength<=t+n)return"";const i=new DataView(e);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(t+s));return r}function Yd(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON from data starting with "${function(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Kd(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return Kd(e,0,t);return""}(e)}"`)}}function Jd(...e){return function(e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),n=t.reduce((e,t)=>e+t.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of t)i.set(s,r),r+=s.byteLength;return i.buffer}(e)}function Zd(e,t,n){const i=void 0!==n?new Uint8Array(e).subarray(t,t+n):new Uint8Array(e).subarray(t);return new Uint8Array(i).buffer}function Qd(e,t){return Kh(e>=0),Kh(t>0),e+(t-1)&-4}function ef(e,t,n){let i;if(e instanceof ArrayBuffer)i=new Uint8Array(e);else{const t=e.byteOffset,n=e.byteLength;i=new Uint8Array(e.buffer||e.arrayBuffer,t,n)}return t.set(i,n),n+Qd(i.byteLength,4)}function tf(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class nf{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=tf(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(tf()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class rf{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(e=>this._getOrCreate(e))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(i=e instanceof nf?e:new nf(t,n),this.stats[t]=i),i}}const sf={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class of{constructor(e={}){i(this,"props"),i(this,"stats"),i(this,"activeRequestCount",0),i(this,"requestQueue",[]),i(this,"requestMap",new Map),i(this,"updateTimer",null),this.props={...sf,...e},this.stats=new rf({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise(e=>(n.resolve=e,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:r}):Promise.resolve({done:r})}_issueNewRequests(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){const e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((e,t)=>e.priority-t.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}const af={};function lf(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function cf(){var e;if("undefined"!=typeof process&&void 0!==process.cwd)return process.cwd();const t=null==(e=window.location)?void 0:e.pathname;return(null==t?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function uf(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function hf(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function df(...e){const t=[];for(let s=0;s<e.length;s++)t[s]=e[s];let n,i="",r=!1;for(let s=t.length-1;s>=-1&&!r;s--){let e;s>=0?e=t[s]:(void 0===n&&(n=cf()),e=n),0!==e.length&&(i=`${e}/${i}`,r=e.charCodeAt(0)===ff)}return i=function(e,t){let n,i="",r=-1,s=0,o=!1;for(let a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(n===ff)break;n=ff}if(n===ff){if(r===a-1||1===s);else if(r!==a-1&&2===s){if(i.length<2||!o||i.charCodeAt(i.length-1)!==pf||i.charCodeAt(i.length-2)!==pf)if(i.length>2){const e=i.length-1;let t=e;for(;t>=0&&i.charCodeAt(t)!==ff;--t);if(t!==e){i=-1===t?"":i.slice(0,t),r=a,s=0,o=!1;continue}}else if(2===i.length||1===i.length){i="",r=a,s=0,o=!1;continue}t&&(i.length>0?i+="/..":i="..",o=!0)}else{const t=e.slice(r+1,a);i.length>0?i+=`/${t}`:i=t,o=!1}r=a,s=0}else n===pf&&-1!==s?++s:s=-1}return i}(i,!r),r?`/${i}`:i.length>0?i:"."}const ff=47,pf=46;const gf=e=>"function"==typeof e,mf=e=>null!==e&&"object"==typeof e,yf=e=>mf(e)&&e.constructor==={}.constructor,vf=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,_f=e=>"undefined"!=typeof Blob&&e instanceof Blob,bf=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||mf(e)&&gf(e.tee)&&gf(e.cancel)&&gf(e.getReader))(e)||(e=>mf(e)&&gf(e.read)&&gf(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e);class Ef extends Error{constructor(e,t){super(e),i(this,"reason"),i(this,"url"),i(this,"response"),this.reason=t.reason,this.url=t.url,this.response=t.response}}const wf=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,xf=/^([-\w.]+\/[-\w.+]+)/;function Af(e,t){return e.toLowerCase()===t.toLowerCase()}function Sf(e){const t=wf.exec(e);return t?t[1]:""}const Tf=/\?.*/;function Cf(e){return e.replace(Tf,"")}function If(e){if(vf(e)){return e.url}if(_f(e)){return e.name||""}return"string"==typeof e?e:""}function kf(e){if(vf(e)){const t=e,n=t.headers.get("content-type")||"",i=Cf(t.url);return function(e){const t=xf.exec(e);return t?t[1]:e}(n)||Sf(i)}if(_f(e)){return e.type||""}return"string"==typeof e?Sf(e):""}async function Rf(e){if(vf(e))return e;const t={},n=function(e){if(vf(e))return e.headers["content-length"]||-1;if(_f(e))return e.size;return"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const i=If(e),r=kf(e);r&&(t["content-type"]=r);const s=await async function(e){const t=5;if("string"==typeof e)return`data:,${e.slice(0,t)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const n=new FileReader;n.onload=t=>{var n;return e(null==(n=null==t?void 0:t.target)?void 0:n.result)},n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){return`data:base64,${function(e){let t="";const n=new Uint8Array(e);for(let i=0;i<n.byteLength;i++)t+=String.fromCharCode(n[i]);return btoa(t)}(e.slice(0,t))}`}return null}(e);s&&(t["x-first-bytes"]=s),"string"==typeof e&&(e=(new TextEncoder).encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:i}),o}async function Pf(e){if(!e.ok){const t=await async function(e){const n=function(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}(e.url);let i=`Failed to fetch resource (${e.status}) ${e.statusText}: ${n}`;i=i.length>100?`${i.slice(0,100)}...`:i;const r={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");r.reason=!e.bodyUsed&&(null==t?void 0:t.includes("application/json"))?await e.json():await e.text()}catch(t){}return new Ef(i,r)}(e);throw t}}async function Mf(e,t){var n,i;if("string"==typeof e){const r=function(e){for(const t in af)if(e.startsWith(t)){const n=af[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(r)&&(null==(n=globalThis.loaders)?void 0:n.fetchNode)?null==(i=globalThis.loaders)?void 0:i.fetchNode(r,t):await fetch(r,t)}return await Rf(e)}const Lf=new gd({id:"loaders.gl"});class Bf{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const Nf={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){i(this,"console"),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Yh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Of={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Df(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Ff(){const e=Df();return e.globalOptions=e.globalOptions||{...Nf},e.globalOptions}function Uf(e,t,n,i){return n=n||[],function(e,t){zf(e,null,Nf,Of,t);for(const n of t){const i=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};zf(i,n.id,r,s,t)}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){const i=e.options||{},r={...i};(function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)})(r,n),null===r.log&&(r.log=new Bf);return Vf(r,Ff()),Vf(r,t),r}(t,e,i)}function zf(e,t,n,i,r){const s=t||"Top level",o=t?`${t}.`:"";for(const a in e){const l=!t&&mf(e[a]);if(!(a in n)&&!("baseUri"===a&&!t)&&!("workerUrl"===a&&t))if(a in i)Lf.warn(`${s} loader option '${o}${a}' no longer supported, use '${i[a]}'`)();else if(!l){const e=Gf(a,r);Lf.warn(`${s} loader option '${o}${a}' not recognized. ${e}`)()}}}function Gf(e,t){const n=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return`Did you mean '${r.id}.${t}'?`;const s=t.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(i=i||`Did you mean '${r.id}.${t}'?`)}return i}function Vf(e,t){for(const n in t)if(n in t){const i=t[n];yf(i)&&yf(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function Hf(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null==e?void 0:e.extensions)}function jf(e){let t;return Kh(e,"null loader"),Kh(Hf(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),((null==e?void 0:e.parseTextSync)||(null==e?void 0:e.parseText))&&(e.text=!0),e.text||(e.binary=!0),e}const Wf=()=>{const e=Df();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function $f(e){const t=Wf();e=Array.isArray(e)?e:[e];for(const n of e){const e=jf(n);t.find(t=>e===t)||t.unshift(e)}}const Xf=/\.([^.]+)$/;function qf(e,t=[],n,i){if(!Kf(e))return null;if(t&&!Array.isArray(t))return jf(t);let r=[];t&&(r=r.concat(t)),(null==n?void 0:n.ignoreRegisteredLoaders)||r.push(...Wf()),function(e){for(const t of e)jf(t)}(r);const s=function(e,t,n,i){const r=If(e),s=kf(e),o=Cf(r)||(null==i?void 0:i.url);let a=null,l="";(null==n?void 0:n.mimeType)&&(a=Jf(t,null==n?void 0:n.mimeType),l=`match forced by supplied MIME type ${null==n?void 0:n.mimeType}`);a=a||function(e,t){const n=t&&Xf.exec(t),i=n&&n[1];return i?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,i):null}(t,o),l=l||(a?`matched url ${o}`:""),a=a||Jf(t,s),l=l||(a?`matched MIME type ${s}`:""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(Zf(t,n))return n}else if(ArrayBuffer.isView(t)){if(Qf(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(Qf(t,0,n))return n}return null}(t,e),l=l||(a?`matched initial data ${ep(e)}`:""),(null==n?void 0:n.fallbackMimeType)&&(a=a||Jf(t,null==n?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:""));l&&wd.log(1,`selectLoader selected ${null==a?void 0:a.name}: ${l}.`);return a}(e,r,n,i);if(!s&&!(null==n?void 0:n.nothrow))throw new Error(Yf(e));return s}function Kf(e){return!(e instanceof Response&&204===e.status)}function Yf(e){const t=If(e),n=kf(e);let i="No valid loader found (";i+=t?`${uf(t)}, `:"no url provided, ",i+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?ep(e):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function Jf(e,t){var n;for(const i of e){if(null==(n=i.mimeTypes)?void 0:n.some(e=>Af(t,e)))return i;if(Af(t,`application/x.${i.id}`))return i}return null}function Zf(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function Qf(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(n=>function(e,t,n,i){if(i instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":return i===tp(e,t,i.length);default:return!1}}(e,t,0,n))}function ep(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return tp(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return tp(e,0,t)}return""}function tp(e,t,n){if(e.byteLength<t+n)return"";const i=new DataView(e);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(t+s));return r}const np=262144;function ip(e,t){return Yh?async function*(e,t){const n=e.getReader();let i;try{for(;;){const e=i||n.read();(null==t?void 0:t._streamReadAhead)&&(i=n.read());const{done:r,value:s}=await e;if(r)return;yield lf(s)}}catch(r){n.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield lf(t)}(e)}function rp(e,t){if("string"==typeof e)return function*(e,t){const n=(null==t?void 0:t.chunkSize)||262144;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,n),s=e.slice(i,i+t);i+=t,yield r.encode(s)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=np}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,n),r=new ArrayBuffer(t),s=new Uint8Array(e,i,t);new Uint8Array(r).set(s),i+=t,yield r}}(e,t);if(_f(e))return async function*(e,t){const n=(null==t?void 0:t.chunkSize)||1048576;let i=0;for(;i<e.size;){const t=i+n,r=await e.slice(i,t).arrayBuffer();i=t,yield r}}(e,t);if(bf(e))return ip(e,t);if(vf(e)){return ip(e.body,t)}throw new Error("makeIterator")}const sp="Cannot convert supplied data type";async function op(e,t,n){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t){if(t.text&&"string"==typeof e)return e;var n;if((n=e)&&"object"==typeof n&&n.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(sp)}(e,t);if(_f(e)&&(e=await Rf(e)),vf(e)){const n=e;return await Pf(n),t.binary?await n.arrayBuffer():await n.text()}if(bf(e)&&(e=rp(e,n)),r=e,Boolean(r)&&"function"==typeof r[Symbol.iterator]||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return async function(e){const t=[];for await(const n of e)t.push(n);return Jd(...t)}(e);var r;throw new Error(sp)}function ap(e,t){const n=Ff(),i=e||n;return"function"==typeof i.fetch?i.fetch:mf(i.fetch)?e=>Mf(e,i.fetch):(null==t?void 0:t.fetch)?null==t?void 0:t.fetch:Mf}function lp(e,t,n){if(n)return n;const i={fetch:ap(t,e),...e};if(i.url){const e=Cf(i.url);i.baseUrl=e,i.queryString=function(e){const t=e.match(Tf);return t&&t[0]}(i.url),i.filename=uf(e),i.baseUrl=hf(e)}return Array.isArray(i.loaders)||(i.loaders=null),i}async function cp(e,t,n,i){!t||Array.isArray(t)||Hf(t)||(i=void 0,n=t,t=void 0),n=n||{};const r=If(e=await e),s=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,i),o=await async function(e,t=[],n,i){if(!Kf(e))return null;let r=qf(e,t,{...n,nothrow:!0},i);if(r)return r;if(_f(e)&&(r=qf(e=await e.slice(0,10).arrayBuffer(),t,n,i)),!r&&!(null==n?void 0:n.nothrow))throw new Error(Yf(e));return r}(e,s,n);return o?(i=lp({url:r,_parse:cp,loaders:s},n=Uf(n,o,s,r),i||null),await async function(e,t,n,i){if(function(e){Cd(e,"no worker provided");const t=e.version}(e),n=xd(e.options,n),vf(t)){const e=t,{ok:n,redirected:r,status:s,statusText:o,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());i.response={headers:c,ok:n,redirected:r,status:s,statusText:o,type:a,url:l}}t=await op(t,e,n);const r=e;if(r.parseTextSync&&"string"==typeof t)return r.parseTextSync(t,n,i);if(function(e,t){return!!jd.isSupported()&&!(!Id&&!(null==t?void 0:t._nodeWorkers))&&e.worker&&(null==t?void 0:t.worker)}(e,n))return await Xd(e,t,n,i,cp);if(r.parseText&&"string"==typeof t)return await r.parseText(t,n,i);if(r.parse)return await r.parse(t,n,i);throw Cd(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(o,e,n,i)):null}function up(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;const a=e.POSITION?e.POSITION.value:[],l=a&&a.length;for(let c=0;c<l;c+=3){const e=a[c],l=a[c+1],u=a[c+2];t=e<t?e:t,n=l<n?l:n,i=u<i?u:i,r=e>r?e:r,s=l>s?l:s,o=u>o?u:o}return[[t,n,i],[r,s,o]]}function hp(e,t,n){const i=function(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}(t.value),r=n||function(e){const t={};"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10));"byteStride"in e&&(t.byteStride=e.byteStride.toString(10));"normalized"in e&&(t.normalized=e.normalized.toString());return t}(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:i}]},nullable:!1,metadata:r}}async function dp(e,t,n,i){let r,s;Array.isArray(t)||Hf(t)?(r=t,s=n):(r=[],s=t);const o=ap(s);let a=e;return"string"==typeof e&&(a=await o(e)),_f(e)&&(a=await o(e)),Array.isArray(r),await cp(a,r,s)}const fp=null==(e=globalThis.loaders)?void 0:e.parseImageNode,pp="undefined"!=typeof Image,gp="undefined"!=typeof ImageBitmap,mp=Boolean(fp),yp=!!Yh||mp;function vp(e){const t=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"==typeof e&&e.data&&e.width&&e.height)return"data";return null}(e);if(!t)throw new Error("Not an image");return t}function _p(e){switch(vp(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}const bp=/^data:image\/svg\+xml/,Ep=/\.svg((\?|#).*)?$/;function wp(e){return e&&(bp.test(e)||Ep.test(e))}function xp(e,t){if(wp(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Ap(e,t,n){const i=function(e,t){if(wp(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return xp(e,t)}(e,n),r=self.URL||self.webkitURL,s="string"!=typeof i&&r.createObjectURL(i);try{return await async function(e,t){const n=new Image;if(n.src=e,t.image&&t.image.decode&&n.decode)return await n.decode(),n;return await new Promise((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(i){t(i)}})}(s||i,t)}finally{s&&r.revokeObjectURL(s)}}const Sp={};let Tp=!0;async function Cp(e,t,n){let i;if(wp(n)){i=await Ap(e,t,n)}else i=xp(e,n);const r=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||Sp)return!1;return!0}(t)&&Tp||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(n){Tp=!1}return await createImageBitmap(e)}(i,r)}function Ip(e){return function(e,t,n=0){const i=(r=t,[...r].map(e=>e.charCodeAt(0)));var r;for(let s=0;s<i.length;++s)if(i[s]!==e[s+n])return!1;return!0}(e,"ftyp",4)&&96&e[8]?function(e){switch((t=e,n=8,i=12,String.fromCharCode(...t.slice(n,i))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t,n,i}(e):null}const kp=!1,Rp=!0;function Pp(e){const t=Mp(e);return function(e){const t=Mp(e),n=t.byteLength>=24&&2303741511===t.getUint32(0,kp);if(!n)return null;return{mimeType:"image/png",width:t.getUint32(16,kp),height:t.getUint32(20,kp)}}(t)||function(e){const t=Mp(e),n=t.byteLength>=3&&65496===t.getUint16(0,kp)&&255===t.getUint8(2);if(!n)return null;const{tableMarkers:i,sofMarkers:r}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let s=2;for(;s+9<t.byteLength;){const e=t.getUint16(s,kp);if(r.has(e))return{mimeType:"image/jpeg",height:t.getUint16(s+5,kp),width:t.getUint16(s+7,kp)};if(!i.has(e))return null;s+=2,s+=t.getUint16(s,kp)}return null}(t)||function(e){const t=Mp(e),n=t.byteLength>=10&&1195984440===t.getUint32(0,kp);if(!n)return null;return{mimeType:"image/gif",width:t.getUint16(6,Rp),height:t.getUint16(8,Rp)}}(t)||function(e){const t=Mp(e),n=t.byteLength>=14&&16973===t.getUint16(0,kp)&&t.getUint32(2,Rp)===t.byteLength;if(!n)return null;return{mimeType:"image/bmp",width:t.getUint32(18,Rp),height:t.getUint32(22,Rp)}}(t)||function(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=Ip(t);if(!n)return null;return{mimeType:n.mimeType,width:0,height:0}}(t)}function Mp(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Lp={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const i=((t=t||{}).image||{}).type||"auto",{url:r}=n||{};let s;switch(function(e){switch(e){case"auto":case"data":return function(){if(gp)return"imagebitmap";if(pp)return"image";if(yp)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return gp||pp||yp;case"imagebitmap":return gp;case"image":return pp;case"data":return yp;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(i)){case"imagebitmap":s=await Cp(e,t,r);break;case"image":s=await Ap(e,t,r);break;case"data":s=await async function(e){var t;const{mimeType:n}=Pp(e)||{},i=null==(t=globalThis.loaders)?void 0:t.parseImageNode;return Kh(i),await i(e,n)}(e);break;default:Kh(!1)}return"data"===i&&(s=_p(s)),s},tests:[e=>Boolean(Pp(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},Bp={};function Np(e){if(void 0===Bp[e]){const t=Yh?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{const t=document.createElement("canvas");return 0===t.toDataURL(e).indexOf(`data:${e}`)}catch{return!1}}(e);default:return!0}}(e):function(e){var t,n;const i=["image/png","image/jpeg","image/gif"],r=(null==(t=globalThis.loaders)?void 0:t.imageFormatsNode)||i,s=null==(n=globalThis.loaders)?void 0:n.parseImageNode;return Boolean(s)&&r.includes(e)}(e);Bp[e]=t}return Bp[e]}const Op=new gd({id:"deck"});let Dp={};function Fp(e){Dp=e}function Up(e,t,n,i){Op.level>0&&Dp[e]&&Dp[e].call(null,t,n,i)}const zp={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse};const Gp=function(){const e="9.2.2",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Op.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Op,_registerLoggers:Fp},$f([zp,[Lp,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}();function Vp(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const Hp={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function jp(e){let t=Wp(e);if("object"!==t)return{value:e,...Hp[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Hp[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=Wp(e.value),{...e,...Hp[t],type:t}):{type:"object",value:null};throw new Error("props")}function Wp(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const $p={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Xp=/void\s+main\s*\([^)]*\)\s*\{\n?/,qp=/}\n?[^{}]*$/,Kp=[],Yp="__LUMA_INJECT_DECLARATIONS__";function Jp(e){const t={vertex:{},fragment:{}};for(const n in e){let i=e[n];"string"==typeof i&&(i={order:0,injection:i}),t[Zp(n)][n]=i}return t}function Zp(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Qp(e,t,n,i=!1){const r="vertex"===t;for(const s in n){const t=n[s];t.sort((e,t)=>e.order-t.order),Kp.length=t.length;for(let e=0,n=t.length;e<n;++e)Kp[e]=t[e].injection;const i=`${Kp.join("\n")}\n`;switch(s){case"vs:#decl":r&&(e=e.replace(Yp,i));break;case"vs:#main-start":r&&(e=e.replace(Xp,e=>e+i));break;case"vs:#main-end":r&&(e=e.replace(qp,e=>i+e));break;case"fs:#decl":r||(e=e.replace(Yp,i));break;case"fs:#main-start":r||(e=e.replace(Xp,e=>e+i));break;case"fs:#main-end":r||(e=e.replace(qp,e=>i+e));break;default:e=e.replace(s,e=>e+i)}}return e=e.replace(Yp,""),i&&(e=e.replace(/\}\s*$/,e=>e+$p[t])),e}function eg(e){e.map(e=>function(e){if(e.instance)return;eg(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:i={}}=e,r={normalizedInjections:Jp(i),parsedDeprecations:ng(n)};t&&(r.propValidators=function(e){const t={};for(const[n,i]of Object.entries(e))t[n]=jp(i);return t}(t));e.instance=r;let s={};t&&(s=Object.entries(t).reduce((e,[t,n])=>{const i=null==n?void 0:n.value;return i&&(e[t]=i),e},{}));e.defaultUniforms={...e.defaultUniforms,...s}}(e))}function tg(e,t,n){var i;null==(i=e.deprecations)||i.forEach(e=>{var i;(null==(i=e.regex)?void 0:i.test(t))&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())})}function ng(e){return e.forEach(e=>{if("function"===e.type)e.regex=new RegExp(`\\b${e.old}\\(`);else e.regex=new RegExp(`${e.type} ${e.old};`)}),e}function ig(e){eg(e);const t={},n={};rg({modules:e,level:0,moduleMap:t,moduleDepth:n});const i=Object.keys(n).sort((e,t)=>n[t]-n[e]).map(e=>t[e]);return eg(i),i}function rg(e){const{modules:t,level:n,moduleMap:i,moduleDepth:r}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)i[s.name]=s,(void 0===r[s.name]||r[s.name]<n)&&(r[s.name]=n);for(const s of t)s.dependencies&&rg({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}const sg=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],og=[...sg,[cg("attribute"),"in $1"],[cg("varying"),"out $1"]],ag=[...sg,[cg("varying"),"in $1"]];function lg(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}function cg(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function ug(e,t){let n="";for(const i in e){const r=e[i];if(n+=`void ${r.signature} {\n`,r.header&&(n+=`  ${r.header}`),t[i]){const e=t[i];e.sort((e,t)=>e.order-t.order);for(const t of e)n+=`  ${t.injection}\n`}r.footer&&(n+=`  ${r.footer}`),n+="}\n"}return n}function hg(e){const t={vertex:{},fragment:{}};for(const n of e){let e,i;"string"!=typeof n?(e=n,i=e.hook):(e={},i=n),i=i.trim();const[r,s]=i.split(":"),o=i.replace(/\(.+/,""),a=Object.assign(e,{signature:s});switch(r){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(r)}}return t}function dg(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function fg(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const pg=`\n\n${Yp}\n`;function gg(e,t){var n;const{source:i,stage:r,modules:s,hookFunctions:o=[],inject:a={},log:l}=t;Vp("string"==typeof i,"shader source must be a string");const c=i;let u="";const h=hg(o),d={},f={},p={};for(const m in a){const e="string"==typeof a[m]?{injection:a[m],order:0}:a[m],t=/^(v|f)s:(#)?([\w-]+)$/.exec(m);if(t){const n=t[2],i=t[3];n?"decl"===i?f[m]=[e]:p[m]=[e]:d[m]=[e]}else p[m]=[e]}const g=s;for(const m of g){l&&tg(m,c,l);u+=vg(m,"wgsl");const e=(null==(n=m.injections)?void 0:n[r])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?f:p;i[t]=i[t]||[],i[t].push(e[t])}else d[t]=d[t]||[],d[t].push(e[t])}}return u+=pg,u=Qp(u,r,f),u+=ug(h[r],d),u+=c,u=Qp(u,r,p),u}function mg(e,t){var n;const{source:i,stage:r,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;Vp("string"==typeof i,"shader source must be a string");const d="glsl"===s?function(e,t){return{name:dg(e,t),language:"glsl",version:fg(e)}}(i).version:-1,f=e.shaderLanguageVersion,p=100===d?"#version 100":"#version 300 es",g=i.split("\n").slice(1).join("\n"),m={};o.forEach(e=>{Object.assign(m,e.defines)}),Object.assign(m,a);let y="";switch(s){case"wgsl":break;case"glsl":y=u?`${p}\n\n// ----- PROLOGUE -------------------------\n#define SHADER_TYPE_${r.toUpperCase()}\n\n${function(e){switch(null==e?void 0:e.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===r?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(const n in e){const i=e[n];(i||Number.isFinite(i))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(m)}\n\n`:`${p}\n`}const v=hg(l),_={},b={},E={};for(const w in c){const e="string"==typeof c[w]?{injection:c[w],order:0}:c[w],t=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(t){const n=t[2],i=t[3];n?"decl"===i?b[w]=[e]:E[w]=[e]:_[w]=[e]}else E[w]=[e]}for(const w of o){h&&tg(w,g,h);y+=vg(w,r);const e=(null==(n=w.instance)?void 0:n.normalizedInjections[r])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?b:E;i[t]=i[t]||[],i[t].push(e[t])}else _[t]=_[t]||[],_[t].push(e[t])}}return y+="// ----- MAIN SHADER SOURCE -------------------------",y+=pg,y=Qp(y,r,b),y+=ug(v[r],_),y+=g,y=Qp(y,r,E),"glsl"===s&&d!==f&&(y=function(e,t){var n;if(300!==Number((null==(n=e.match(/^#version[ \t]+(\d+)/m))?void 0:n[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return lg(e,og);case"fragment":return lg(e,ag);default:throw new Error(t)}}(y,r)),y.trim()}function yg(e){return function(t){var n;const i={};for(const r of e){const e=null==(n=r.getUniforms)?void 0:n.call(r,t,i);Object.assign(i,e)}return i}}function vg(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:Vp(!1)}if(!e.name)throw new Error("Shader module must have a name");const i=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${e.name} ---------------\n\n`;return"wgsl"!==t&&(r+=`#define MODULE_${i}\n`),r+=`${n}\n`,r}const _g=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,bg=/^\s*\#\s*endif\s*$/;const Eg=class e{constructor(){i(this,"_hookFunctions",[]),i(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return e.defaultShaderAssembler=e.defaultShaderAssembler||new e,e.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:r}=function(e){const t=ig(e.modules||[]);return{source:gg(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:yg(t)}}({...e,source:e.source,modules:t,hookFunctions:n}),s="wgsl"===e.platformInfo.shaderLanguage?function(e,t){var n;const i=e.split("\n"),r=[];let s=!0,o=null;for(const a of i){const e=a.match(_g),i=a.match(bg);e?(o=e[1],s=Boolean(null==(n=null==t?void 0:t.defines)?void 0:n[o])):i?s=!0:s&&r.push(a)}return r.join("\n")}(i):i;return{source:s,getUniforms:r,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=function(e){const{vs:t,fs:n}=e,i=ig(e.modules||[]);return{vs:mg(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:mg(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:yg(i)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n});return{...i,modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let r=0,s=this._defaultModules.length;r<s;++r){const e=this._defaultModules[r],s=e.name;t[i++]=e,n[s]=!0}for(let r=0,s=e.length;r<s;++r){const s=e[r],o=s.name;n[o]||(t[i++]=s,n[o]=!0)}return t.length=i,eg(t),t}};i(Eg,"defaultShaderAssembler");let wg=Eg;function xg(e){const{input:t,inputChannels:n,output:i}={};if(!t)return"#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";if(!n)throw new Error("inputChannels");return`#version 300 es\nin ${function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(n)} ${t};\nout vec4 ${i};\nvoid main() {\n  ${i} = ${function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,n)};\n}`}const Ag=new class{constructor(){i(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new rf({id:e})),this.stats.get(e)}},Sg=new gd({id:"luma.gl"}),Tg={};function Cg(e="id"){Tg[e]=Tg[e]||1;return`${e}-${Tg[e]++}`}let Ig=(t=class{constructor(e,t,n){if(i(this,"id"),i(this,"props"),i(this,"userData",{}),i(this,"_device"),i(this,"destroyed",!1),i(this,"allocatedBytes",0),i(this,"_attachedResources",new Set),!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const i in e)void 0!==e[i]&&(n[i]=e[i]);return n}(t,n);const r="undefined"!==this.props.id?this.props.id:Cg(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},i(t,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),t);const kg=class e extends Ig{constructor(t,n){const r={...n};(n.usage||0)&e.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?r.indexType="uint32":n.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data,super(t,r,e.defaultProps),i(this,"usage"),i(this,"indexType"),i(this,"updateTimestamp"),i(this,"debugData",new ArrayBuffer(0)),this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(e){return this.device.createBuffer({...this.props,...e})}_setDebugData(t,n,i){const r=ArrayBuffer.isView(t)?t.buffer:t,s=Math.min(t?t.byteLength:i,e.DEBUG_DATA_MAX_LENGTH);null===r?this.debugData=new ArrayBuffer(s):0===n&&i===r.byteLength?this.debugData=r.slice(0,s):this.debugData=r.slice(n,n+s)}};i(kg,"INDEX",16),i(kg,"VERTEX",32),i(kg,"UNIFORM",64),i(kg,"STORAGE",128),i(kg,"INDIRECT",256),i(kg,"QUERY_RESOLVE",512),i(kg,"MAP_READ",1),i(kg,"MAP_WRITE",2),i(kg,"COPY_SRC",4),i(kg,"COPY_DST",8),i(kg,"DEBUG_DATA_MAX_LENGTH",32),i(kg,"defaultProps",{...Ig.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0});let Rg=kg;function Pg(e){const[t,n,i]=Ng[e],r=e.includes("norm");return{signedType:t,primitiveType:n,byteLength:i,normalized:r,integer:!r&&!e.startsWith("float"),signed:e.startsWith("s")}}function Mg(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}function Lg(e){const t=ArrayBuffer.isView(e)?e.constructor:e;if(t===Uint8ClampedArray)return"uint8";const n=Object.values(Ng).find(e=>t===e[4]);if(!n)throw new Error(t.name);return n[0]}function Bg(e){const[,,,,t]=Ng[e];return t}const Ng={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Og(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,i]=e.split("x"),r=n,s=i?parseInt(i):1,o=Pg(r),a={type:r,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(a.webglOnly=!0),a}function Dg(e,t,n){if(!t||t>4)throw new Error(`size ${t}`);const i=t;return function(e,t,n){const i=n?function(e){const t=e;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}(e):e;switch(i){case"unorm8":return 1===t?"unorm8":3===t?"unorm8x3-webgl":`${i}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(1===t||3===t)throw new Error(`size: ${t}`);return`${i}x${t}`;default:return 1===t?i:`${i}x${t}`}}(Lg(e),i,n)}const Fg="texture-compression-bc",Ug="texture-compression-astc",zg="texture-compression-etc2",Gg="texture-compression-pvrtc-webgl",Vg="texture-compression-atc-webgl",Hg="float32-renderable-webgl",jg="float16-renderable-webgl",Wg="snorm8-renderable-webgl",$g="norm16-renderable-webgl",Xg="snorm16-renderable-webgl",qg="float32-filterable",Kg="float16-filterable-webgl";function Yg(e){const t=Jg[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const Jg={...{r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Wg},rg8snorm:{render:Wg},"rgb8snorm-webgl":{},rgba8snorm:{render:Wg},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:$g},rg16unorm:{render:$g},"rgb16unorm-webgl":{f:$g},rgba16unorm:{render:$g},r16snorm:{f:Xg},rg16snorm:{render:Xg},"rgb16snorm-webgl":{f:$g},rgba16snorm:{render:Xg},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:jg,filter:"float16-filterable-webgl"},rg16float:{render:jg,filter:Kg},rgba16float:{render:jg,filter:Kg},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Hg,filter:qg},rg32float:{render:!1,filter:qg},"rgb32float-webgl":{render:Hg,filter:qg},rgba32float:{render:Hg,filter:qg},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Hg},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},...{"bc1-rgb-unorm-webgl":{f:Fg},"bc1-rgb-unorm-srgb-webgl":{f:Fg},"bc1-rgba-unorm":{f:Fg},"bc1-rgba-unorm-srgb":{f:Fg},"bc2-rgba-unorm":{f:Fg},"bc2-rgba-unorm-srgb":{f:Fg},"bc3-rgba-unorm":{f:Fg},"bc3-rgba-unorm-srgb":{f:Fg},"bc4-r-unorm":{f:Fg},"bc4-r-snorm":{f:Fg},"bc5-rg-unorm":{f:Fg},"bc5-rg-snorm":{f:Fg},"bc6h-rgb-ufloat":{f:Fg},"bc6h-rgb-float":{f:Fg},"bc7-rgba-unorm":{f:Fg},"bc7-rgba-unorm-srgb":{f:Fg},"etc2-rgb8unorm":{f:zg},"etc2-rgb8unorm-srgb":{f:zg},"etc2-rgb8a1unorm":{f:zg},"etc2-rgb8a1unorm-srgb":{f:zg},"etc2-rgba8unorm":{f:zg},"etc2-rgba8unorm-srgb":{f:zg},"eac-r11unorm":{f:zg},"eac-r11snorm":{f:zg},"eac-rg11unorm":{f:zg},"eac-rg11snorm":{f:zg},"astc-4x4-unorm":{f:Ug},"astc-4x4-unorm-srgb":{f:Ug},"astc-5x4-unorm":{f:Ug},"astc-5x4-unorm-srgb":{f:Ug},"astc-5x5-unorm":{f:Ug},"astc-5x5-unorm-srgb":{f:Ug},"astc-6x5-unorm":{f:Ug},"astc-6x5-unorm-srgb":{f:Ug},"astc-6x6-unorm":{f:Ug},"astc-6x6-unorm-srgb":{f:Ug},"astc-8x5-unorm":{f:Ug},"astc-8x5-unorm-srgb":{f:Ug},"astc-8x6-unorm":{f:Ug},"astc-8x6-unorm-srgb":{f:Ug},"astc-8x8-unorm":{f:Ug},"astc-8x8-unorm-srgb":{f:Ug},"astc-10x5-unorm":{f:Ug},"astc-10x5-unorm-srgb":{f:Ug},"astc-10x6-unorm":{f:Ug},"astc-10x6-unorm-srgb":{f:Ug},"astc-10x8-unorm":{f:Ug},"astc-10x8-unorm-srgb":{f:Ug},"astc-10x10-unorm":{f:Ug},"astc-10x10-unorm-srgb":{f:Ug},"astc-12x10-unorm":{f:Ug},"astc-12x10-unorm-srgb":{f:Ug},"astc-12x12-unorm":{f:Ug},"astc-12x12-unorm-srgb":{f:Ug},"pvrtc-rgb4unorm-webgl":{f:Gg},"pvrtc-rgba4unorm-webgl":{f:Gg},"pvrtc-rbg2unorm-webgl":{f:Gg},"pvrtc-rgba2unorm-webgl":{f:Gg},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:Vg},"atc-rgba-unorm-webgl":{f:Vg},"atc-rgbai-unorm-webgl":{f:Vg}}},Zg=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Qg=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;const em=new class{getInfo(e){return tm(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return Zg.some(t=>e.startsWith(t))}getCapabilities(e){const t=Yg(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},i=tm(e),r=e.startsWith("depth")||e.startsWith("stencil"),s=null==i?void 0:i.signed,o=null==i?void 0:i.integer,a=null==i?void 0:i.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!(r||s||o||a)),n}};function tm(e){let t=function(e){var t;const n=Yg(e),i=n.bytesPerPixel||1,r=n.bitsPerChannel||[8,8,8,8];delete n.bitsPerChannel,delete n.bytesPerPixel,delete n.f,delete n.render,delete n.filter,delete n.blend,delete n.store;const s={...n,format:e,attachment:n.attachment||"color",channels:n.channels||"r",components:n.components||(null==(t=n.channels)?void 0:t.length)||1,bytesPerPixel:i,bitsPerChannel:r,dataType:n.dataType||"uint8",srgb:n.srgb??!1,packed:n.packed??!1,webgl:n.webgl??!1,integer:n.integer??!1,signed:n.signed??!1,normalized:n.normalized??!1,compressed:n.compressed??!1};return s}(e);if(em.isCompressed(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=function(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const n=Qg.exec(e);if(n){const[,i,r,s,o,a]=n,l=Pg(`${s}${r}`),c=8*l.byteLength,u=i.length,h=[c,u>=2?c:0,u>=3?c:0,u>=4?c:0];t={format:e,attachment:t.attachment,dataType:l.signedType,components:u,channels:i,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:h,bytesPerPixel:l.byteLength*i.length,packed:t.packed,srgb:t.srgb},"-webgl"===a&&(t.webgl=!0),"-srgb"===o&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}class nm{}class im{constructor(e=[],t){i(this,"features"),i(this,"disabledFeatures"),this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!(null==(t=this.disabledFeatures)?void 0:t[e])&&this.features.has(e)}}const rm=class e{constructor(t){i(this,"id"),i(this,"props"),i(this,"userData",{}),i(this,"statsManager",Ag),i(this,"timestamp",0),i(this,"_reused",!1),i(this,"_lumaData",{}),i(this,"_textureCaps",{}),this.props={...e.defaultProps,...t},this.id=this.props.id||Cg(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}getVertexFormatInfo(e){return Og(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return em.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const n=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,n=1){const i=Math.max(e,t,n);return 1+Math.floor(Math.log2(i))}isExternalImage(e){return function(e){return"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}(e)}getExternalImageSize(e){return function(e){if("undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if("undefined"!=typeof VideoFrame&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return em.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){var e;null==(e=this.commandEncoder)||e.popDebugGroup()}insertDebugMarker(e){var t;null==(t=this.commandEncoder)||t.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...n){return this.props.onError(e,t)?()=>{}:Sg.error(e.message,t,...n)}debug(){if(this.props.debug);else{const e="'Type luma.log.set({debug: true}) in console to enable debug breakpoints',\nor create a device with the 'debug: true' prop.";Sg.once(0,e)()}}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=em.getCapabilities(e),n=e=>("string"==typeof e?this.features.has(e):e)??!0,i=n(t.create);return{format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&Rg.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}};i(rm,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[n,i]=e.getDevicePixelSize();Sg.log(1,`${e} resized => ${n}x${i}px`)()},onPositionChange:(e,t)=>{const[n,i]=e.getPosition();Sg.log(1,`${e} repositioned => ${n},${i}`)()},onVisibilityChange:e=>Sg.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>Sg.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:Sg.get("debug")||void 0,debugShaders:Sg.get("debug-shaders")||void 0,debugFramebuffers:Boolean(Sg.get("debug-framebuffers")),debugFactories:Boolean(Sg.get("debug-factories")),debugWebGL:Boolean(Sg.get("debug-webgl")),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});let sm=rm;const om="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",am=class e{constructor(){if(i(this,"stats",Ag),i(this,"log",Sg),i(this,"VERSION","9.2.2"),i(this,"spector"),i(this,"preregisteredAdapters",new Map),globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Sg.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Sg.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Sg.error("This version of luma.gl has already been initialized")()}Sg.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(t={}){const n={...e.defaultProps,...t},i=this.selectAdapter(n.type,n.adapters);if(!i)throw new Error(om);return n.waitForPageLoad&&await i.pageLoaded,await i.create(n)}async attachDevice(e,t){var n;const i=this._getTypeFromHandle(e,t.adapters),r=i&&this.selectAdapter(i,t.adapters);if(!r)throw new Error(om);return await(null==(n=null==r?void 0:r.attach)?void 0:n.call(r,e,t))}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,e])=>e).filter(e=>{var t;return null==(t=e.isSupported)?void 0:t.call(e)}).map(e=>e.type)}getBestAvailableAdapterType(e=[]){var t,n;const i=["webgpu","webgl","null"],r=this._getAdapterMap(e);for(const s of i)if(null==(n=null==(t=r.get(s))?void 0:t.isSupported)?void 0:n.call(t))return s;return null}selectAdapter(e,t=[]){let n=e;"best-available"===e&&(n=this.getBestAvailableAdapterType(t));const i=this._getAdapterMap(t);return n&&i.get(n)||null}enforceWebGL2(e=!0,t=[]){var n;const i=this._getAdapterMap(t).get("webgl");i||Sg.warn("enforceWebGL2: webgl adapter not found")(),null==(n=null==i?void 0:i.enforceWebGL2)||n.call(i,e)}setDefaultDeviceProps(t){Object.assign(e.defaultProps,t)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":"undefined"!=typeof GPUDevice&&e instanceof GPUDevice||(null==e?void 0:e.queue)?"webgpu":null===e?"null":(e instanceof WebGLRenderingContext?Sg.warn("WebGL1 is not supported",e)():Sg.warn("Unknown handle type",e)(),null)}};i(am,"defaultProps",{...sm.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});const lm=new am;class cm{get pageLoaded(){return function(){dm||(dm=hm()||"undefined"==typeof window?Promise.resolve():new Promise(e=>window.addEventListener("load",()=>e())));return dm}()}}const um=nd()&&"undefined"!=typeof document,hm=()=>um&&"complete"===document.readyState;let dm=null;const fm=class e{constructor(t){var n,r;if(i(this,"id"),i(this,"props"),i(this,"canvas"),i(this,"htmlCanvas"),i(this,"offscreenCanvas"),i(this,"type"),i(this,"initialized"),i(this,"isInitialized",!1),i(this,"isVisible",!0),i(this,"cssWidth"),i(this,"cssHeight"),i(this,"devicePixelRatio"),i(this,"devicePixelWidth"),i(this,"devicePixelHeight"),i(this,"drawingBufferWidth"),i(this,"drawingBufferHeight"),i(this,"_initializedResolvers",function(){let e,t;return{promise:new Promise((n,i)=>{e=n,t=i}),resolve:e,reject:t}}()),i(this,"_resizeObserver"),i(this,"_intersectionObserver"),i(this,"_position"),i(this,"destroyed",!1),this.props={...e.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,nd()?t.canvas?"string"==typeof t.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!pm.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}(t.canvas):this.canvas=t.canvas:this.canvas=function(e){const{width:t,height:n}=e,i=document.createElement("canvas");i.id=Cg("lumagl-auto-created-canvas"),i.width=t||1,i.height=n||1,i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(n)?`${n}px`:"100%",(null==e?void 0:e.visible)||(i.style.visibility="hidden");const r=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}if(e)return e;return document.body}((null==e?void 0:e.container)||null);return r.insertBefore(i,r.firstChild),i}(t):this.canvas={width:t.width||1,height:t.height||1},e.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):e.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=(null==(n=this.htmlCanvas)?void 0:n.clientWidth)||this.canvas.width,this.cssHeight=(null==(r=this.htmlCanvas)?void 0:r.clientHeight)||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],e.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(e=>this._handleIntersection(e)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(e=>this._handleResize(e));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}static isHTMLCanvas(e){return"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return"undefined"!=typeof window&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[i,r]=this.getDrawingBufferSize();return function(e,t,n,i,r){const s=e,o=gm(s[0],t,n);let a=mm(s[1],t,i,r),l=gm(s[0]+1,t,n);const c=l===n-1?l:l-1;let u;l=mm(s[1]+1,t,i,r),r?(l=0===l?l:l+1,u=a,a=l):u=l===i-1?l:l-1;return{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}(e,n,i,r,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){var t;"lumagl-auto-created-canvas"===(null==(t=this.htmlCanvas)?void 0:t.id)&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(e=>e.target===this.canvas);if(!t)return;const n=t.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(e){var t,n;const i=e.find(e=>e.target===this.canvas);if(!i)return;this.cssWidth=i.contentBoxSize[0].inlineSize,this.cssHeight=i.contentBoxSize[0].blockSize;const r=this.getDevicePixelSize(),s=(null==(t=i.devicePixelContentBoxSize)?void 0:t[0].inlineSize)||i.contentBoxSize[0].inlineSize*devicePixelRatio,o=(null==(n=i.devicePixelContentBoxSize)?void 0:n[0].blockSize)||i.contentBoxSize[0].blockSize*devicePixelRatio,[a,l]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(s,a)),this.devicePixelHeight=Math.max(1,Math.min(o,l)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:r})}_updateDrawingBufferSize(){if(this.props.autoResize){if("number"==typeof this.props.useDevicePixels){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){var e,t,n;const i=null==(e=this.htmlCanvas)?void 0:e.getBoundingClientRect();if(i){const e=[i.left,i.top];this._position??(this._position=e);if(e[0]!==this._position[0]||e[1]!==this._position[1]){const i=this._position;this._position=e,null==(n=(t=this.device.props).onPositionChange)||n.call(t,this,{oldPosition:i})}}}};i(fm,"defaultProps",{id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1});let pm=fm;function gm(e,t,n){return Math.min(Math.round(e*t),n-1)}function mm(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}const ym=class e extends Ig{get[Symbol.toStringTag](){return"Sampler"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};i(ym,"defaultProps",{...Ig.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let vm=ym;const _m={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},bm=class e extends Ig{constructor(t,n){if(super(t,n=e.normalizeProps(t,n),e.defaultProps),i(this,"dimension"),i(this,"baseDimension"),i(this,"format"),i(this,"width"),i(this,"height"),i(this,"depth"),i(this,"mipLevels"),i(this,"updateTimestamp"),this.dimension=this.props.dimension,this.baseDimension=_m[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,void 0===this.props.width||void 0===this.props.height)if(t.isExternalImage(n.data)){const e=t.getExternalImageSize(n.data);this.width=(null==e?void 0:e.width)||1,this.height=(null==e?void 0:e.height)||1}else this.width=1,this.height=1,void 0!==this.props.width&&void 0!==this.props.height||Sg.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}setSampler(e){this.sampler=e instanceof vm?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:i,height:r}=n;return"number"==typeof i&&(n.width=Math.max(1,Math.ceil(i))),"number"==typeof r&&(n.height=Math.max(1,Math.ceil(r))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:n,height:i,depth:r}=this,s={...e.defaultCopyDataOptions,width:n,height:i,depth:r,...t},o=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!o.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return s.bytesPerRow=t.bytesPerRow||n*(o.bytesPerPixel||4),s.rowsPerImage=t.rowsPerImage||i,s}_normalizeCopyExternalImageOptions(t){const n=this.device.getExternalImageSize(t.image),i={...e.defaultCopyExternalImageOptions,...n,...t};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}};i(bm,"SAMPLE",4),i(bm,"STORAGE",8),i(bm,"RENDER",16),i(bm,"COPY_SRC",1),i(bm,"COPY_DST",2),i(bm,"TEXTURE",4),i(bm,"RENDER_ATTACHMENT",16),i(bm,"defaultProps",{...Ig.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:bm.TEXTURE|bm.RENDER_ATTACHMENT|bm.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),i(bm,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),i(bm,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let Em=bm;const wm=class e extends Ig{get[Symbol.toStringTag](){return"TextureView"}constructor(t,n){super(t,n,e.defaultProps)}};i(wm,"defaultProps",{...Ig.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let xm=wm;function Am(e,t,n,i){if(null==i?void 0:i.inlineSource){const i=function(e,t,n){let i="";for(let r=t-2;r<=t;r++){const s=e[r-1];void 0!==s&&(i+=Sm(s,t,n))}return i}(t,n);return`\n${i}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}const r="error"===e.type?"red":"#8B4000";return(null==i?void 0:i.html)?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function Sm(e,t,n){const i=(null==n?void 0:n.html)?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return`${function(e,t){let n="";for(let i=e.length;i<t;++i)n+=" ";return n+e}(String(t),4)}: ${i}${(null==n?void 0:n.html)?"<br/>":"\n"}`}const Tm=class e extends Ig{constructor(t,n){super(t,{id:Im(n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"}),...n},e.defaultProps),i(this,"stage"),i(this,"source"),i(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===e&&0===(null==t?void 0:t.length)||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){var n;if("undefined"==typeof document||!(null==document?void 0:document.createElement))return;const i=t,r=`${this.stage} shader "${i}"`;let s=function(e,t,n){let i="";const r=t.split(/\r?\n/),s=e.slice().sort((e,t)=>e.lineNum-t.lineNum);switch((null==n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=r.length;e++)for(i+=Sm(r[e-1],e,n);s.length>t&&s[t].lineNum===e;){const e=s[t++];i+=Am(e,r,e.lineNum,{...n,inlineSource:!1})}for(;s.length>t;)i+=Am(s[t++],[],0,{...n,inlineSource:!1});return i;case"issues":case"no":for(const s of e)i+=Am(s,r,s.lineNum,{inlineSource:"no"!==(null==n?void 0:n.showSourceCode)});return i}}(e,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`\n<h1>Compilation error in ${r}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${s}\n</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);null==(n=document.getElementsByClassName("luma-compiler-log-error")[0])||n.scrollIntoView(),a.onclick=()=>{const e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}};i(Tm,"defaultProps",{...Ig.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Cm=Tm;function Im(e){return function(e,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}(e.source)||e.id||Cg(`unnamed ${e.stage}-shader`)}const km=class e extends Ig{constructor(t,n={}){super(t,n,e.defaultProps),i(this,"width"),i(this,"height"),this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(e){const t=this.colorAttachments.map(t=>t.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:n})}resize(e){let t=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(Sg.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,t)=>{if("string"==typeof e){const n=this.createColorTexture(e,t);return this.attachResource(n),n.view}return e instanceof Em?e.view:e});const e=this.props.depthStencilAttachment;if(e)if("string"==typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof Em?e.view:e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:Em.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Em.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}};i(km,"defaultProps",{...Ig.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Rm=km;const Pm=class e extends Ig{constructor(t,n){super(t,n,e.defaultProps),i(this,"shaderLayout"),i(this,"bufferLayout"),i(this,"linkStatus","pending"),i(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}};i(Pm,"defaultProps",{...Ig.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});let Mm=Pm;const Lm=class e extends Ig{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};i(Lm,"defaultClearColor",[0,0,0,1]),i(Lm,"defaultClearDepth",1),i(Lm,"defaultClearStencil",0),i(Lm,"defaultProps",{...Ig.defaultProps,framebuffer:null,parameters:void 0,clearColor:Lm.defaultClearColor,clearColors:void 0,clearDepth:Lm.defaultClearDepth,clearStencil:Lm.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Bm=Lm;const Nm=class e extends Ig{constructor(t,n){super(t,n,e.defaultProps),i(this,"hash",""),i(this,"shaderLayout"),this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};i(Nm,"defaultProps",{...Ig.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Om=Nm;const Dm=class e extends Ig{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,n){super(t,n,e.defaultProps)}};i(Dm,"defaultProps",{...Ig.defaultProps,measureExecutionTime:void 0});let Fm=Dm;const Um=class e extends Ig{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,n){super(t,n,e.defaultProps)}};i(Um,"defaultProps",{...Ig.defaultProps});let zm=Um;function Gm(e){return jm[e]}const Vm={f32:4,f16:2,i32:4,u32:4},Hm={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},jm={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function Wm(e,t){const n={};for(const i of e.attributes){const r=$m(e,t,i.name);r&&(n[i.name]=r)}return n}function $m(e,t,n){const i=function(e,t){const n=e.attributes.find(e=>e.name===t);n||Sg.warn(`shader layout attribute "${t}" not present in shader`);return n||null}(e,n),r=function(e,t){!function(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&Sg.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);if(n)return n;if(n=function(e,t){var n;for(const i of e){let e=i.byteStride;if("number"!=typeof i.byteStride)for(const t of i.attributes||[]){e+=Og(t.format).byteLength}const r=null==(n=i.attributes)?void 0:n.find(e=>e.attribute===t);if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:e}}return null}(e,t),n)return n;return Sg.warn(`layout for attribute "${t}" not present in buffer layout`),null}(t,n);if(!i)return null;const s=function(e){const[t,n]=Hm[e],i="i32"===t||"u32"===t,r="u32"!==t;return{primitiveType:t,components:n,byteLength:Vm[t]*n,integer:i,signed:r}}(i.type),o=function(e){let t;switch(e.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e.components<=2?"float16x2":"float16x4"}return 1===e.components?t:`${t}x${e.components}`}(s),a=(null==r?void 0:r.vertexFormat)||o,l=Og(a);return{attributeName:(null==r?void 0:r.attributeName)||i.name,bufferName:(null==r?void 0:r.bufferName)||i.name,location:i.location,shaderType:i.type,primitiveType:s.primitiveType,shaderComponents:s.components,vertexFormat:a,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:(null==r?void 0:r.stepMode)||i.stepMode||"vertex",byteOffset:(null==r?void 0:r.byteOffset)||0,byteStride:(null==r?void 0:r.byteStride)||0}}const Xm=class e extends Ig{constructor(t,n){super(t,n,e.defaultProps),i(this,"maxVertexAttributes"),i(this,"attributeInfos"),i(this,"indexBuffer",null),i(this,"attributes"),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=function(e,t,n=16){const i=Wm(e,t),r=new Array(n).fill(null);for(const s of Object.values(i))r[s.location]=s;return r}(n.shaderLayout,n.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}};i(Xm,"defaultProps",{...Ig.defaultProps,shaderLayout:void 0,bufferLayout:[]});let qm=Xm;const Km=class e extends Ig{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,n){super(t,n,e.defaultProps)}};i(Km,"defaultProps",{...Ig.defaultProps,layout:void 0,buffers:{}});let Ym=Km;const Jm=class e extends Ig{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,n){super(t,n,e.defaultProps)}};i(Jm,"defaultProps",{...Ig.defaultProps,type:void 0,count:void 0});let Zm,Qm=Jm;function ey(e){return(!Zm||Zm.byteLength<e)&&(Zm=new ArrayBuffer(e)),Zm}function ty(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class ny{constructor(e,t={}){i(this,"layout",{}),i(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const e=Gm(s),{type:r,components:o}=e,a=o*((null==t?void 0:t[i])??1);n=Mg(n,a);const l=n;n+=a,this.layout[i]={type:r,size:a,offset:l}}n+=(4-n%4)%4;const r=4*n;this.byteLength=Math.max(r,1024)}getData(e){const t=ey(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[i,r]of Object.entries(e)){const e=this.layout[i];if(!e){Sg.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:t,size:s,offset:o}=e,a=n[t];if(1===s){if("number"!=typeof r&&"boolean"!=typeof r){Sg.warn(`Supplied value for single component uniform ${i} is not a number: ${r}`)();continue}a[o]=Number(r)}else{if(!ty(r)){Sg.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${r}`)();continue}a.set(r,o)}}return new Uint8Array(t,0,this.byteLength)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class iy{constructor(e){var t;if(i(this,"name"),i(this,"uniforms",{}),i(this,"modifiedUniforms",{}),i(this,"modified",!0),i(this,"bindingLayout",{}),i(this,"needsRedraw","initialized"),this.name=(null==e?void 0:e.name)||"unnamed",(null==e?void 0:e.name)&&(null==e?void 0:e.shaderLayout)){const n=null==(t=null==e?void 0:e.shaderLayout.bindings)?void 0:t.find(t=>"uniform"===t.type&&t.name===(null==e?void 0:e.name));if(!n)throw new Error(null==e?void 0:e.name);const i=n;for(const e of i.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){var n;(function(e,t){if(e!==t)return!1;const n=e,i=t;if(!ty(n))return!1;if(ty(i)&&n.length===i.length)for(let r=0;r<n.length;++r)if(i[r]!==n[r])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=ty(n=t)?n.slice():n,this.modifiedUniforms[e]=!0,this.modified=!0)}}class ry{constructor(e){i(this,"uniformBlocks",new Map),i(this,"uniformBufferLayouts",new Map),i(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const e=t,i=new ny(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(e,i);const r=new iy({name:t});r.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,r)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,i]of Object.entries(e))null==(t=this.uniformBlocks.get(n))||t.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return(null==(t=this.uniformBufferLayouts.get(e))?void 0:t.byteLength)||0}getUniformBufferData(e){var t,n;const i=(null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms())||{};return null==(n=this.uniformBufferLayouts.get(e))?void 0:n.getData(i)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:Rg.UNIFORM|Rg.COPY_DST,byteLength:i}),s=this.getUniformBufferData(t);return r.write(s),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Rg.UNIFORM|Rg.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&Sg.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var t;const n=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),r=!1;if(i&&(null==n?void 0:n.needsRedraw)){r||(r=n.needsRedraw);const s=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),null==i||i.write(s);const o=null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms();Sg.log(4,`Writing to uniform buffer ${String(e)}`,s,o)()}return r}}let sy=class{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}},oy=class{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}};class ay extends sy{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ly extends sy{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class cy extends sy{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class uy extends sy{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}var hy,dy;(dy=hy||(hy={}))[dy.Uniform=0]="Uniform",dy[dy.Storage=1]="Storage",dy[dy.Texture=2]="Texture",dy[dy.Sampler=3]="Sampler",dy[dy.StorageTexture=4]="StorageTexture";class fy{constructor(e,t,n,i,r,s,o){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=r,this.resourceType=s,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class py{constructor(e,t){this.name=e,this.type=t}}class gy{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class my{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class yy{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class vy{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class _y{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class by{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function Ey(e){var t=(32768&e)>>15,n=(31744&e)>>10,i=1023&e;return 0==n?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==n?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+i/Math.pow(2,10))}const wy=new Float32Array(1),xy=new Int32Array(wy.buffer),Ay=new Uint16Array(1);function Sy(e){wy[0]=e;const t=xy[0],n=t>>31&1;let i=t>>23&255,r=8388607&t;if(255===i)return Ay[0]=n<<15|31744|(0!==r?512:0),Ay[0];if(0===i){if(0===r)return Ay[0]=n<<15,Ay[0];r|=8388608;let e=113;for(;!(8388608&r);)r<<=1,e--;return i=127-e,r&=8388607,i>0?(r=(r>>126-i)+(r>>127-i&1),Ay[0]=n<<15|i<<10|r>>13,Ay[0]):(Ay[0]=n<<15,Ay[0])}return i=i-127+15,i>=31?(Ay[0]=n<<15|31744,Ay[0]):i<=0?i<-10?(Ay[0]=n<<15,Ay[0]):(r=(8388608|r)>>1-i,Ay[0]=n<<15|r>>13,Ay[0]):(r>>=13,Ay[0]=n<<15|i<<10|r,Ay[0])}const Ty=new Uint32Array(1),Cy=new Float32Array(Ty.buffer,0,1);function Iy(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return Ty[0]=t,Cy[0]}function ky(e,t,n,i){const r=[0,0,0,0];for(let s=0;s<i;++s)switch(n){case"8unorm":r[s]=e[t]/255,t++;break;case"8snorm":r[s]=e[t]/255*2-1,t++;break;case"8uint":r[s]=e[t],t++;break;case"8sint":r[s]=e[t]-127,t++;break;case"16uint":r[s]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":r[s]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":r[s]=Ey(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":r[s]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":r[s]=new Float32Array(e.buffer,t,1)[0],t+=4}return r}function Ry(e,t,n,i,r){for(let s=0;s<i;++s)switch(n){case"8unorm":e[t]=255*r[s],t++;break;case"8snorm":e[t]=.5*(r[s]+1)*255,t++;break;case"8uint":e[t]=r[s],t++;break;case"8sint":e[t]=r[s]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=r[s],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=r[s],t+=2;break;case"16float":{const n=Sy(r[s]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=r[s],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=r[s],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=r[s],t+=4}return r}const Py={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class My{constructor(){this.id=My._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Ly.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(By.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}My._id=0;class Ly extends My{}Ly.instance=new Ly;class By extends My{}By.instance=new By;const Ny=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Oy extends My{constructor(){super()}}class Dy extends Oy{constructor(e,t,n,i,r,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=r,this.endLine=s}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class Fy extends Oy{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Uy extends Oy{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class zy extends Oy{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Gy extends Oy{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(i=this.increment)||void 0===i||i.search(e),this.searchBlock(this.body,e)}}class Vy extends Oy{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class Hy extends Oy{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class jy extends Oy{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class Wy extends Oy{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var $y,Xy,qy,Ky;(e=>{e.increment="++",e.decrement="--"})($y||($y={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})($y||($y={}));class Yy extends Oy{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(Xy||(Xy={})),(Xy||(Xy={})).parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t};class Jy extends Oy{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Zy extends Oy{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return Ny.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class Qy extends Oy{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null===(t=this.continuing)||void 0===t||t.search(e)}}class ev extends Oy{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class tv extends Oy{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class nv extends Oy{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class iv extends Oy{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class rv extends Oy{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class sv extends Oy{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class ov extends Oy{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class av extends Oy{constructor(){super()}get astNodeType(){return"discard"}}class lv extends Oy{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class cv extends Oy{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class uv extends Oy{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=uv._priority.get(t.name);uv._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?uv.i32:t}getTypeName(){return this.name}}uv.x32=new uv("x32"),uv.f32=new uv("f32"),uv.i32=new uv("i32"),uv.u32=new uv("u32"),uv.f16=new uv("f16"),uv.bool=new uv("bool"),uv.void=new uv("void"),uv._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class hv extends uv{constructor(e){super(e)}}class dv extends uv{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class fv extends uv{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}fv.vec2f=new fv("vec2",uv.f32,null),fv.vec3f=new fv("vec3",uv.f32,null),fv.vec4f=new fv("vec4",uv.f32,null),fv.vec2i=new fv("vec2",uv.i32,null),fv.vec3i=new fv("vec3",uv.i32,null),fv.vec4i=new fv("vec4",uv.i32,null),fv.vec2u=new fv("vec2",uv.u32,null),fv.vec3u=new fv("vec3",uv.u32,null),fv.vec4u=new fv("vec4",uv.u32,null),fv.vec2h=new fv("vec2",uv.f16,null),fv.vec3h=new fv("vec3",uv.f16,null),fv.vec4h=new fv("vec4",uv.f16,null),fv.vec2b=new fv("vec2",uv.bool,null),fv.vec3b=new fv("vec3",uv.bool,null),fv.vec4b=new fv("vec4",uv.bool,null),fv.mat2x2f=new fv("mat2x2",uv.f32,null),fv.mat2x3f=new fv("mat2x3",uv.f32,null),fv.mat2x4f=new fv("mat2x4",uv.f32,null),fv.mat3x2f=new fv("mat3x2",uv.f32,null),fv.mat3x3f=new fv("mat3x3",uv.f32,null),fv.mat3x4f=new fv("mat3x4",uv.f32,null),fv.mat4x2f=new fv("mat4x2",uv.f32,null),fv.mat4x3f=new fv("mat4x3",uv.f32,null),fv.mat4x4f=new fv("mat4x4",uv.f32,null),fv.mat2x2h=new fv("mat2x2",uv.f16,null),fv.mat2x3h=new fv("mat2x3",uv.f16,null),fv.mat2x4h=new fv("mat2x4",uv.f16,null),fv.mat3x2h=new fv("mat3x2",uv.f16,null),fv.mat3x3h=new fv("mat3x3",uv.f16,null),fv.mat3x4h=new fv("mat3x4",uv.f16,null),fv.mat4x2h=new fv("mat4x2",uv.f16,null),fv.mat4x3h=new fv("mat4x3",uv.f16,null),fv.mat4x4h=new fv("mat4x4",uv.f16,null),fv.mat2x2i=new fv("mat2x2",uv.i32,null),fv.mat2x3i=new fv("mat2x3",uv.i32,null),fv.mat2x4i=new fv("mat2x4",uv.i32,null),fv.mat3x2i=new fv("mat3x2",uv.i32,null),fv.mat3x3i=new fv("mat3x3",uv.i32,null),fv.mat3x4i=new fv("mat3x4",uv.i32,null),fv.mat4x2i=new fv("mat4x2",uv.i32,null),fv.mat4x3i=new fv("mat4x3",uv.i32,null),fv.mat4x4i=new fv("mat4x4",uv.i32,null),fv.mat2x2u=new fv("mat2x2",uv.u32,null),fv.mat2x3u=new fv("mat2x3",uv.u32,null),fv.mat2x4u=new fv("mat2x4",uv.u32,null),fv.mat3x2u=new fv("mat3x2",uv.u32,null),fv.mat3x3u=new fv("mat3x3",uv.u32,null),fv.mat3x4u=new fv("mat3x4",uv.u32,null),fv.mat4x2u=new fv("mat4x2",uv.u32,null),fv.mat4x3u=new fv("mat4x3",uv.u32,null),fv.mat4x4u=new fv("mat4x4",uv.u32,null);class pv extends uv{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class gv extends uv{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class mv extends uv{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class yv extends My{constructor(){super(),this.postfix=null}}class vv extends yv{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class _v extends yv{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class bv extends yv{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Ny.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Ev extends yv{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class wv extends yv{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class xv extends yv{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof zv}get isVector(){return this.value instanceof Vv||this.value instanceof Hv}get scalarValue(){return this.value instanceof zv?this.value.value:0}get vectorValue(){return this.value instanceof Vv||this.value instanceof Hv?this.value.data:new Float32Array(0)}}class Av extends yv{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Sv extends yv{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Tv extends yv{constructor(){super()}}class Cv extends Tv{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Iv extends Tv{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?uv.f32:"u32"===e.name||"u32"===t.name?uv.u32:uv.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class kv extends My{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Rv extends yv{constructor(){super()}get astNodeType(){return"default"}}class Pv extends kv{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Mv extends kv{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Lv extends My{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class Bv extends My{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Nv extends My{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Ov extends My{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Dv{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Dv._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,i){}getSubData(e,t,n){return null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Dv._id=0;class Fv extends Dv{constructor(){super(new sy("void",null),null)}toString(){return"void"}}Fv.void=new Fv;class Uv extends Dv{constructor(e){super(new cy("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,i){this.reference.setDataValue(e,t,n,i)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class zv extends Dv{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):("f32"===this.typeInfo.name||"f16"===this.typeInfo.name)&&(this.data=new Float32Array([e]))}clone(){if(this.data instanceof Float32Array)return new zv(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new zv(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new zv(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,i){if(n)return;if(!(t instanceof zv))return;let r=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?r=Math.floor(r):"bool"===this.typeInfo.name&&(r=r?1:0),this.data[0]=r}getSubData(e,t,n){return t?null:this}toString(){return`${this.value}`}}function Gv(e,t,n){const i=t.length;return 2===i?"f32"===n?new Vv(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new Vv(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new Vv(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new Vv(new Float32Array(t),e.getTypeInfo("vec2h")):null:3===i?"f32"===n?new Vv(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new Vv(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new Vv(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new Vv(new Float32Array(t),e.getTypeInfo("vec3h")):null:4===i?"f32"===n?new Vv(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new Vv(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new Vv(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new Vv(new Float32Array(t),e.getTypeInfo("vec4h")):null:null}class Vv extends Dv{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):("vec2"===t||"vec3"===t||"vec4"===t)&&(this.data=new Float32Array(e))}}clone(){if(this.data instanceof Float32Array)return new Vv(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Vv(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Vv(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,i){n instanceof vv||t instanceof Vv&&(this.data=t.data)}getSubData(e,t,n){if(null===t)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof uy)i=this.typeInfo.format||i;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?i=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?i=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?i=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?i=e.getTypeInfo("u32"):("vec2h"===t||"vec3h"===t||"vec4h"===t)&&(i=e.getTypeInfo("f16"))}let r=this;for(;null!==t&&null!==r;){if(t instanceof Sv){const s=t.index;let o=-1;if(s instanceof xv){if(!(s.value instanceof zv))return null;o=s.value.value}else{const t=e.evalExpression(s,n);if(!(t instanceof zv))return null;o=t.value}if(o<0||o>=r.data.length)return null;if(r.data instanceof Float32Array){const e=new Float32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new zv(e,i)}if(r.data instanceof Int32Array){const e=new Int32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new zv(e,i)}if(r.data instanceof Uint32Array){const e=new Uint32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new zv(e,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof vv))return null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new zv(t,i,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new zv(t,i,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new zv(t,i,this)}}const s=[];for(const e of n)"x"===e||"r"===e?s.push(this.data[0]):"y"===e||"g"===e?s.push(this.data[1]):"z"===e||"b"===e?s.push(this.data[2]):("w"===e||"a"===e)&&s.push(this.data[3]);r=Gv(e,s,i.name)}t=t.postfix}return r}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Hv extends Dv{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Hv(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,i){n instanceof vv||t instanceof Hv&&(this.data=t.data)}getSubData(e,t,n){if(null===t)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof uy)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return null;e.getTypeInfo("f16")}if(t instanceof Sv){const r=t.index;let s=-1;if(r instanceof xv){if(!(r.value instanceof zv))return null;s=r.value.value}else{const t=e.evalExpression(r,n);if(!(t instanceof zv))return null;s=t.value}if(s<0||s>=this.data.length)return null;const o=i.endsWith("h")?"h":"f";let a;if("mat2x2"===i||"mat2x2f"===i||"mat2x2h"===i||"mat3x2"===i||"mat3x2f"===i||"mat3x2h"===i||"mat4x2"===i||"mat4x2f"===i||"mat4x2h"===i)a=new Vv(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),e.getTypeInfo(`vec2${o}`));else if("mat2x3"===i||"mat2x3f"===i||"mat2x3h"===i||"mat3x3"===i||"mat3x3f"===i||"mat3x3h"===i||"mat4x3"===i||"mat4x3f"===i||"mat4x3h"===i)a=new Vv(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),e.getTypeInfo(`vec3${o}`));else{if("mat2x4"!==i&&"mat2x4f"!==i&&"mat2x4h"!==i&&"mat3x4"!==i&&"mat3x4f"!==i&&"mat3x4h"!==i&&"mat4x4"!==i&&"mat4x4f"!==i&&"mat4x4h"!==i)return null;a=new Vv(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?a.getSubData(e,t.postfix,n):a}return null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class jv extends Dv{constructor(e,t,n=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new jv(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,i){if(null===t)return;let r=this.offset,s=this.typeInfo;for(;n;){if(n instanceof Sv){if(s instanceof ly){const t=n.index;if(t instanceof xv){if(!(t.value instanceof zv))return;r+=t.value.value*s.stride}else{const n=e.evalExpression(t,i);if(!(n instanceof zv))return;r+=n.value*s.stride}s=s.format}}else{if(!(n instanceof vv))return;{const e=n.value;if(s instanceof ay){let t=!1;for(const n of s.members)if(n.name===e){r+=n.offset,s=n.type,t=!0;break}if(!t)return}else if(s instanceof sy){const n=s.getTypeName();let i=0;if("x"===e||"r"===e)i=0;else if("y"===e||"g"===e)i=1;else if("z"===e||"b"===e)i=2;else{if("w"!==e&&"a"!==e)return;i=3}if(!(t instanceof zv))return;const o=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,r,2)[i]=o):"vec3f"===n?void(new Float32Array(this.buffer,r,3)[i]=o):"vec4f"===n?void(new Float32Array(this.buffer,r,4)[i]=o):"vec2i"===n?void(new Int32Array(this.buffer,r,2)[i]=o):"vec3i"===n?void(new Int32Array(this.buffer,r,3)[i]=o):"vec4i"===n?void(new Int32Array(this.buffer,r,4)[i]=o):"vec2u"===n?void(new Uint32Array(this.buffer,r,2)[i]=o):"vec3u"===n?void(new Uint32Array(this.buffer,r,3)[i]=o):"vec4u"===n?void(new Uint32Array(this.buffer,r,4)[i]=o):void 0}}}n=n.postfix}this.setData(e,t,s,r,i)}setData(e,t,n,i,r){const s=n.getTypeName();if("f32"!==s&&"f16"!==s)if("i32"!==s&&"atomic<i32>"!==s&&"x32"!==s)if("u32"!==s&&"atomic<u32>"!==s)if("bool"!==s){if("vec2f"===s||"vec2h"===s){const e=new Float32Array(this.buffer,i,2);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===s||"vec3h"===s){const e=new Float32Array(this.buffer,i,3);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===s||"vec4h"===s){const e=new Float32Array(this.buffer,i,4);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===s){const e=new Int32Array(this.buffer,i,2);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===s){const e=new Int32Array(this.buffer,i,3);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===s){const e=new Int32Array(this.buffer,i,4);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===s){const e=new Uint32Array(this.buffer,i,2);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===s){const e=new Uint32Array(this.buffer,i,3);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===s){const e=new Uint32Array(this.buffer,i,4);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===s){const e=new Uint32Array(this.buffer,i,2);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===s){const e=new Uint32Array(this.buffer,i,3);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===s){const e=new Uint32Array(this.buffer,i,4);return void(t instanceof Vv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===s||"mat2x2h"===s){const e=new Float32Array(this.buffer,i,4);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===s||"mat2x3h"===s){const e=new Float32Array(this.buffer,i,6);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===s||"mat2x4h"===s){const e=new Float32Array(this.buffer,i,8);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===s||"mat3x2h"===s){const e=new Float32Array(this.buffer,i,6);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===s||"mat3x3h"===s){const e=new Float32Array(this.buffer,i,9);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===s||"mat3x4h"===s){const e=new Float32Array(this.buffer,i,12);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===s||"mat4x2h"===s){const e=new Float32Array(this.buffer,i,8);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===s||"mat4x3h"===s){const e=new Float32Array(this.buffer,i,12);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===s||"mat4x4h"===s){const e=new Float32Array(this.buffer,i,16);return void(t instanceof Hv?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof jv&&n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer))}else t instanceof zv&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof zv&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof zv&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof zv&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,n){var i,r;if(null===t)return this;let s=this.offset,o=this.typeInfo;for(;t;){if(t instanceof Sv){const i=t.index,r=i instanceof yv?e.evalExpression(i,n):i;let a=0;if(r instanceof zv?a=r.value:"number"==typeof r&&(a=r),o instanceof ly)s+=a*o.stride,o=o.format;else{const t=o.getTypeName();("mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t)&&(s+=16*a,o=e.getTypeInfo("vec4f"))}}else{if(!(t instanceof vv))return null;{const n=t.value;if(o instanceof ay){let e=!1;for(const t of o.members)if(t.name===n){s+=t.offset,o=t.type,e=!0;break}if(!e)return null}else if(o instanceof sy){const t=o.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let i="f";const r=[];for(let o=0;o<n.length;++o){const a=n[o].toLowerCase();let l=0;if("x"===a||"r"===a)l=0;else if("y"===a||"g"===a)l=1;else if("z"===a||"b"===a)l=2;else{if("w"!==a&&"a"!==a)return null;l=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<s+4*l+4?null:new zv(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new zv(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new zv(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new zv(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new zv(new Uint32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)r.push(new Float32Array(this.buffer,s,2)[l]);else if("vec3f"===t){if(s+12>=this.buffer.byteLength)return null;const e=new Float32Array(this.buffer,s,3);r.push(e[l])}else if("vec4f"===t)r.push(new Float32Array(this.buffer,s,4)[l]);else if("vec2i"===t)i="i",r.push(new Int32Array(this.buffer,s,2)[l]);else if("vec3i"===t)i="i",r.push(new Int32Array(this.buffer,s,3)[l]);else if("vec4i"===t)i="i",r.push(new Int32Array(this.buffer,s,4)[l]);else if("vec2u"===t){i="u";const e=new Uint32Array(this.buffer,s,2);r.push(e[l])}else"vec3u"===t?(i="u",r.push(new Uint32Array(this.buffer,s,3)[l])):"vec4u"===t&&(i="u",r.push(new Uint32Array(this.buffer,s,4)[l]))}return 2===r.length?o=e.getTypeInfo(`vec2${i}`):3===r.length?o=e.getTypeInfo(`vec3${i}`):4===r.length&&(o=e.getTypeInfo(`vec4${i}`)),new Vv(r,o,null)}return null}return null}}}t=t.postfix}const a=o.getTypeName();return"f32"===a?new zv(new Float32Array(this.buffer,s,1),o,this):"i32"===a?new zv(new Int32Array(this.buffer,s,1),o,this):"u32"===a?new zv(new Uint32Array(this.buffer,s,1),o,this):"vec2f"===a?new Vv(new Float32Array(this.buffer,s,2),o,this):"vec3f"===a?new Vv(new Float32Array(this.buffer,s,3),o,this):"vec4f"===a?new Vv(new Float32Array(this.buffer,s,4),o,this):"vec2i"===a?new Vv(new Int32Array(this.buffer,s,2),o,this):"vec3i"===a?new Vv(new Int32Array(this.buffer,s,3),o,this):"vec4i"===a?new Vv(new Int32Array(this.buffer,s,4),o,this):"vec2u"===a?new Vv(new Uint32Array(this.buffer,s,2),o,this):"vec3u"===a?new Vv(new Uint32Array(this.buffer,s,3),o,this):"vec4u"===a?new Vv(new Uint32Array(this.buffer,s,4),o,this):o instanceof uy&&"atomic"===o.name?"u32"===(null===(i=o.format)||void 0===i?void 0:i.name)?new zv(new Uint32Array(this.buffer,s,1)[0],o.format,this):"i32"===(null===(r=o.format)||void 0===r?void 0:r.name)?new zv(new Int32Array(this.buffer,s,1)[0],o.format,this):null:new jv(this.buffer,o,s,this)}toString(){let e="";if(this.typeInfo instanceof ly)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof ay?e+="{...}":e="[...]";return e}}class Wv extends Dv{constructor(e,t,n,i){super(t,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new Wv(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=Py[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Py[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Py[e],n=this.width;if(!e||n<=0||!t)return-1;const i=this.height,r=this.depthOrArrayLayers,s=this.dimension;return n/t.blockWidth*("1d"===s?1:i/t.blockHeight)*t.bytesPerBlock*r}getPixel(e,t,n=0,i=0){const r=this.texelByteSize,s=this.bytesPerRow,o=this.height,a=this.data[i];return function(e,t,n,i,r,s,o,a,l){const c=i*(o>>=r)*(s>>=r)+n*o+t*a;switch(l){case"r8unorm":return[ky(e,c,"8unorm",1)[0]];case"r8snorm":return[ky(e,c,"8snorm",1)[0]];case"r8uint":return[ky(e,c,"8uint",1)[0]];case"r8sint":return[ky(e,c,"8sint",1)[0]];case"rg8unorm":{const t=ky(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=ky(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=ky(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=ky(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=ky(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=ky(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=ky(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=ky(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=ky(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[ky(e,c,"16uint",1)[0]];case"r16sint":return[ky(e,c,"16sint",1)[0]];case"r16float":return[ky(e,c,"16float",1)[0]];case"rg16uint":{const t=ky(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=ky(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=ky(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=ky(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=ky(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=ky(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[ky(e,c,"32uint",1)[0]];case"r32sint":return[ky(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[ky(e,c,"32float",1)[0]];case"rg32uint":{const t=ky(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=ky(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=ky(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=ky(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=ky(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=ky(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,c,1)[0],n=(4192256&t)>>11,i=(4290772992&t)>>22;return[Iy(2047&t),Iy(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return Ty[0]=t,Cy[0]}(i),1]}}return null}(new Uint8Array(a),e,t,n,i,o,s,r,this.format)}setPixel(e,t,n,i,r){const s=this.texelByteSize,o=this.bytesPerRow,a=this.height,l=this.data[i];!function(e,t,n,i,r,s,o,a,l,c){const u=i*(o>>=r)*(s>>=r)+n*o+t*a;switch(l){case"r8unorm":return void Ry(e,u,"8unorm",1,c);case"r8snorm":return void Ry(e,u,"8snorm",1,c);case"r8uint":return void Ry(e,u,"8uint",1,c);case"r8sint":return void Ry(e,u,"8sint",1,c);case"rg8unorm":return void Ry(e,u,"8unorm",2,c);case"rg8snorm":return void Ry(e,u,"8snorm",2,c);case"rg8uint":return void Ry(e,u,"8uint",2,c);case"rg8sint":return void Ry(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Ry(e,u,"8unorm",4,c);case"rgba8snorm":return void Ry(e,u,"8snorm",4,c);case"rgba8uint":return void Ry(e,u,"8uint",4,c);case"rgba8sint":return void Ry(e,u,"8sint",4,c);case"r16uint":return void Ry(e,u,"16uint",1,c);case"r16sint":return void Ry(e,u,"16sint",1,c);case"r16float":return void Ry(e,u,"16float",1,c);case"rg16uint":return void Ry(e,u,"16uint",2,c);case"rg16sint":return void Ry(e,u,"16sint",2,c);case"rg16float":return void Ry(e,u,"16float",2,c);case"rgba16uint":return void Ry(e,u,"16uint",4,c);case"rgba16sint":return void Ry(e,u,"16sint",4,c);case"rgba16float":return void Ry(e,u,"16float",4,c);case"r32uint":return void Ry(e,u,"32uint",1,c);case"r32sint":return void Ry(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Ry(e,u,"32float",1,c);case"rg32uint":return void Ry(e,u,"32uint",2,c);case"rg32sint":return void Ry(e,u,"32sint",2,c);case"rg32float":return void Ry(e,u,"32float",2,c);case"rgba32uint":return void Ry(e,u,"32uint",4,c);case"rgba32sint":return void Ry(e,u,"32sint",4,c);case"rgba32float":Ry(e,u,"32float",4,c)}}(new Uint8Array(l),e,t,n,i,a,o,s,this.format,r)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(Ky||(Ky={}));class $v{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Xv{}qy=Xv,Xv.none=new $v("",Ky.reserved,""),Xv.eof=new $v("EOF",Ky.token,""),Xv.reserved={asm:new $v("asm",Ky.reserved,"asm"),bf16:new $v("bf16",Ky.reserved,"bf16"),do:new $v("do",Ky.reserved,"do"),enum:new $v("enum",Ky.reserved,"enum"),f16:new $v("f16",Ky.reserved,"f16"),f64:new $v("f64",Ky.reserved,"f64"),handle:new $v("handle",Ky.reserved,"handle"),i8:new $v("i8",Ky.reserved,"i8"),i16:new $v("i16",Ky.reserved,"i16"),i64:new $v("i64",Ky.reserved,"i64"),mat:new $v("mat",Ky.reserved,"mat"),premerge:new $v("premerge",Ky.reserved,"premerge"),regardless:new $v("regardless",Ky.reserved,"regardless"),typedef:new $v("typedef",Ky.reserved,"typedef"),u8:new $v("u8",Ky.reserved,"u8"),u16:new $v("u16",Ky.reserved,"u16"),u64:new $v("u64",Ky.reserved,"u64"),unless:new $v("unless",Ky.reserved,"unless"),using:new $v("using",Ky.reserved,"using"),vec:new $v("vec",Ky.reserved,"vec"),void:new $v("void",Ky.reserved,"void")},Xv.keywords={array:new $v("array",Ky.keyword,"array"),atomic:new $v("atomic",Ky.keyword,"atomic"),bool:new $v("bool",Ky.keyword,"bool"),f32:new $v("f32",Ky.keyword,"f32"),i32:new $v("i32",Ky.keyword,"i32"),mat2x2:new $v("mat2x2",Ky.keyword,"mat2x2"),mat2x3:new $v("mat2x3",Ky.keyword,"mat2x3"),mat2x4:new $v("mat2x4",Ky.keyword,"mat2x4"),mat3x2:new $v("mat3x2",Ky.keyword,"mat3x2"),mat3x3:new $v("mat3x3",Ky.keyword,"mat3x3"),mat3x4:new $v("mat3x4",Ky.keyword,"mat3x4"),mat4x2:new $v("mat4x2",Ky.keyword,"mat4x2"),mat4x3:new $v("mat4x3",Ky.keyword,"mat4x3"),mat4x4:new $v("mat4x4",Ky.keyword,"mat4x4"),ptr:new $v("ptr",Ky.keyword,"ptr"),sampler:new $v("sampler",Ky.keyword,"sampler"),sampler_comparison:new $v("sampler_comparison",Ky.keyword,"sampler_comparison"),struct:new $v("struct",Ky.keyword,"struct"),texture_1d:new $v("texture_1d",Ky.keyword,"texture_1d"),texture_2d:new $v("texture_2d",Ky.keyword,"texture_2d"),texture_2d_array:new $v("texture_2d_array",Ky.keyword,"texture_2d_array"),texture_3d:new $v("texture_3d",Ky.keyword,"texture_3d"),texture_cube:new $v("texture_cube",Ky.keyword,"texture_cube"),texture_cube_array:new $v("texture_cube_array",Ky.keyword,"texture_cube_array"),texture_multisampled_2d:new $v("texture_multisampled_2d",Ky.keyword,"texture_multisampled_2d"),texture_storage_1d:new $v("texture_storage_1d",Ky.keyword,"texture_storage_1d"),texture_storage_2d:new $v("texture_storage_2d",Ky.keyword,"texture_storage_2d"),texture_storage_2d_array:new $v("texture_storage_2d_array",Ky.keyword,"texture_storage_2d_array"),texture_storage_3d:new $v("texture_storage_3d",Ky.keyword,"texture_storage_3d"),texture_depth_2d:new $v("texture_depth_2d",Ky.keyword,"texture_depth_2d"),texture_depth_2d_array:new $v("texture_depth_2d_array",Ky.keyword,"texture_depth_2d_array"),texture_depth_cube:new $v("texture_depth_cube",Ky.keyword,"texture_depth_cube"),texture_depth_cube_array:new $v("texture_depth_cube_array",Ky.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new $v("texture_depth_multisampled_2d",Ky.keyword,"texture_depth_multisampled_2d"),texture_external:new $v("texture_external",Ky.keyword,"texture_external"),u32:new $v("u32",Ky.keyword,"u32"),vec2:new $v("vec2",Ky.keyword,"vec2"),vec3:new $v("vec3",Ky.keyword,"vec3"),vec4:new $v("vec4",Ky.keyword,"vec4"),bitcast:new $v("bitcast",Ky.keyword,"bitcast"),block:new $v("block",Ky.keyword,"block"),break:new $v("break",Ky.keyword,"break"),case:new $v("case",Ky.keyword,"case"),continue:new $v("continue",Ky.keyword,"continue"),continuing:new $v("continuing",Ky.keyword,"continuing"),default:new $v("default",Ky.keyword,"default"),diagnostic:new $v("diagnostic",Ky.keyword,"diagnostic"),discard:new $v("discard",Ky.keyword,"discard"),else:new $v("else",Ky.keyword,"else"),enable:new $v("enable",Ky.keyword,"enable"),fallthrough:new $v("fallthrough",Ky.keyword,"fallthrough"),false:new $v("false",Ky.keyword,"false"),fn:new $v("fn",Ky.keyword,"fn"),for:new $v("for",Ky.keyword,"for"),function:new $v("function",Ky.keyword,"function"),if:new $v("if",Ky.keyword,"if"),let:new $v("let",Ky.keyword,"let"),const:new $v("const",Ky.keyword,"const"),loop:new $v("loop",Ky.keyword,"loop"),while:new $v("while",Ky.keyword,"while"),private:new $v("private",Ky.keyword,"private"),read:new $v("read",Ky.keyword,"read"),read_write:new $v("read_write",Ky.keyword,"read_write"),return:new $v("return",Ky.keyword,"return"),requires:new $v("requires",Ky.keyword,"requires"),storage:new $v("storage",Ky.keyword,"storage"),switch:new $v("switch",Ky.keyword,"switch"),true:new $v("true",Ky.keyword,"true"),alias:new $v("alias",Ky.keyword,"alias"),type:new $v("type",Ky.keyword,"type"),uniform:new $v("uniform",Ky.keyword,"uniform"),var:new $v("var",Ky.keyword,"var"),override:new $v("override",Ky.keyword,"override"),workgroup:new $v("workgroup",Ky.keyword,"workgroup"),write:new $v("write",Ky.keyword,"write"),r8unorm:new $v("r8unorm",Ky.keyword,"r8unorm"),r8snorm:new $v("r8snorm",Ky.keyword,"r8snorm"),r8uint:new $v("r8uint",Ky.keyword,"r8uint"),r8sint:new $v("r8sint",Ky.keyword,"r8sint"),r16uint:new $v("r16uint",Ky.keyword,"r16uint"),r16sint:new $v("r16sint",Ky.keyword,"r16sint"),r16float:new $v("r16float",Ky.keyword,"r16float"),rg8unorm:new $v("rg8unorm",Ky.keyword,"rg8unorm"),rg8snorm:new $v("rg8snorm",Ky.keyword,"rg8snorm"),rg8uint:new $v("rg8uint",Ky.keyword,"rg8uint"),rg8sint:new $v("rg8sint",Ky.keyword,"rg8sint"),r32uint:new $v("r32uint",Ky.keyword,"r32uint"),r32sint:new $v("r32sint",Ky.keyword,"r32sint"),r32float:new $v("r32float",Ky.keyword,"r32float"),rg16uint:new $v("rg16uint",Ky.keyword,"rg16uint"),rg16sint:new $v("rg16sint",Ky.keyword,"rg16sint"),rg16float:new $v("rg16float",Ky.keyword,"rg16float"),rgba8unorm:new $v("rgba8unorm",Ky.keyword,"rgba8unorm"),rgba8unorm_srgb:new $v("rgba8unorm_srgb",Ky.keyword,"rgba8unorm_srgb"),rgba8snorm:new $v("rgba8snorm",Ky.keyword,"rgba8snorm"),rgba8uint:new $v("rgba8uint",Ky.keyword,"rgba8uint"),rgba8sint:new $v("rgba8sint",Ky.keyword,"rgba8sint"),bgra8unorm:new $v("bgra8unorm",Ky.keyword,"bgra8unorm"),bgra8unorm_srgb:new $v("bgra8unorm_srgb",Ky.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new $v("rgb10a2unorm",Ky.keyword,"rgb10a2unorm"),rg11b10float:new $v("rg11b10float",Ky.keyword,"rg11b10float"),rg32uint:new $v("rg32uint",Ky.keyword,"rg32uint"),rg32sint:new $v("rg32sint",Ky.keyword,"rg32sint"),rg32float:new $v("rg32float",Ky.keyword,"rg32float"),rgba16uint:new $v("rgba16uint",Ky.keyword,"rgba16uint"),rgba16sint:new $v("rgba16sint",Ky.keyword,"rgba16sint"),rgba16float:new $v("rgba16float",Ky.keyword,"rgba16float"),rgba32uint:new $v("rgba32uint",Ky.keyword,"rgba32uint"),rgba32sint:new $v("rgba32sint",Ky.keyword,"rgba32sint"),rgba32float:new $v("rgba32float",Ky.keyword,"rgba32float"),static_assert:new $v("static_assert",Ky.keyword,"static_assert")},Xv.tokens={decimal_float_literal:new $v("decimal_float_literal",Ky.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new $v("hex_float_literal",Ky.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new $v("int_literal",Ky.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new $v("uint_literal",Ky.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new $v("name",Ky.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new $v("ident",Ky.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new $v("and",Ky.token,"&"),and_and:new $v("and_and",Ky.token,"&&"),arrow:new $v("arrow ",Ky.token,"->"),attr:new $v("attr",Ky.token,"@"),forward_slash:new $v("forward_slash",Ky.token,"/"),bang:new $v("bang",Ky.token,"!"),bracket_left:new $v("bracket_left",Ky.token,"["),bracket_right:new $v("bracket_right",Ky.token,"]"),brace_left:new $v("brace_left",Ky.token,"{"),brace_right:new $v("brace_right",Ky.token,"}"),colon:new $v("colon",Ky.token,":"),comma:new $v("comma",Ky.token,","),equal:new $v("equal",Ky.token,"="),equal_equal:new $v("equal_equal",Ky.token,"=="),not_equal:new $v("not_equal",Ky.token,"!="),greater_than:new $v("greater_than",Ky.token,">"),greater_than_equal:new $v("greater_than_equal",Ky.token,">="),shift_right:new $v("shift_right",Ky.token,">>"),less_than:new $v("less_than",Ky.token,"<"),less_than_equal:new $v("less_than_equal",Ky.token,"<="),shift_left:new $v("shift_left",Ky.token,"<<"),modulo:new $v("modulo",Ky.token,"%"),minus:new $v("minus",Ky.token,"-"),minus_minus:new $v("minus_minus",Ky.token,"--"),period:new $v("period",Ky.token,"."),plus:new $v("plus",Ky.token,"+"),plus_plus:new $v("plus_plus",Ky.token,"++"),or:new $v("or",Ky.token,"|"),or_or:new $v("or_or",Ky.token,"||"),paren_left:new $v("paren_left",Ky.token,"("),paren_right:new $v("paren_right",Ky.token,")"),semicolon:new $v("semicolon",Ky.token,";"),star:new $v("star",Ky.token,"*"),tilde:new $v("tilde",Ky.token,"~"),underscore:new $v("underscore",Ky.token,"_"),xor:new $v("xor",Ky.token,"^"),plus_equal:new $v("plus_equal",Ky.token,"+="),minus_equal:new $v("minus_equal",Ky.token,"-="),times_equal:new $v("times_equal",Ky.token,"*="),division_equal:new $v("division_equal",Ky.token,"/="),modulo_equal:new $v("modulo_equal",Ky.token,"%="),and_equal:new $v("and_equal",Ky.token,"&="),or_equal:new $v("or_equal",Ky.token,"|="),xor_equal:new $v("xor_equal",Ky.token,"^="),shift_right_equal:new $v("shift_right_equal",Ky.token,">>="),shift_left_equal:new $v("shift_left_equal",Ky.token,"<<=")},Xv.simpleTokens={"@":qy.tokens.attr,"{":qy.tokens.brace_left,"}":qy.tokens.brace_right,":":qy.tokens.colon,",":qy.tokens.comma,"(":qy.tokens.paren_left,")":qy.tokens.paren_right,";":qy.tokens.semicolon},Xv.literalTokens={"&":qy.tokens.and,"&&":qy.tokens.and_and,"->":qy.tokens.arrow,"/":qy.tokens.forward_slash,"!":qy.tokens.bang,"[":qy.tokens.bracket_left,"]":qy.tokens.bracket_right,"=":qy.tokens.equal,"==":qy.tokens.equal_equal,"!=":qy.tokens.not_equal,">":qy.tokens.greater_than,">=":qy.tokens.greater_than_equal,">>":qy.tokens.shift_right,"<":qy.tokens.less_than,"<=":qy.tokens.less_than_equal,"<<":qy.tokens.shift_left,"%":qy.tokens.modulo,"-":qy.tokens.minus,"--":qy.tokens.minus_minus,".":qy.tokens.period,"+":qy.tokens.plus,"++":qy.tokens.plus_plus,"|":qy.tokens.or,"||":qy.tokens.or_or,"*":qy.tokens.star,"~":qy.tokens.tilde,_:qy.tokens.underscore,"^":qy.tokens.xor,"+=":qy.tokens.plus_equal,"-=":qy.tokens.minus_equal,"*=":qy.tokens.times_equal,"/=":qy.tokens.division_equal,"%=":qy.tokens.modulo_equal,"&=":qy.tokens.and_equal,"|=":qy.tokens.or_equal,"^=":qy.tokens.xor_equal,">>=":qy.tokens.shift_right_equal,"<<=":qy.tokens.shift_left_equal},Xv.regexTokens={decimal_float_literal:qy.tokens.decimal_float_literal,hex_float_literal:qy.tokens.hex_float_literal,int_literal:qy.tokens.int_literal,uint_literal:qy.tokens.uint_literal,ident:qy.tokens.ident},Xv.storage_class=[qy.keywords.function,qy.keywords.private,qy.keywords.workgroup,qy.keywords.uniform,qy.keywords.storage],Xv.access_mode=[qy.keywords.read,qy.keywords.write,qy.keywords.read_write],Xv.sampler_type=[qy.keywords.sampler,qy.keywords.sampler_comparison],Xv.sampled_texture_type=[qy.keywords.texture_1d,qy.keywords.texture_2d,qy.keywords.texture_2d_array,qy.keywords.texture_3d,qy.keywords.texture_cube,qy.keywords.texture_cube_array],Xv.multisampled_texture_type=[qy.keywords.texture_multisampled_2d],Xv.storage_texture_type=[qy.keywords.texture_storage_1d,qy.keywords.texture_storage_2d,qy.keywords.texture_storage_2d_array,qy.keywords.texture_storage_3d],Xv.depth_texture_type=[qy.keywords.texture_depth_2d,qy.keywords.texture_depth_2d_array,qy.keywords.texture_depth_cube,qy.keywords.texture_depth_cube_array,qy.keywords.texture_depth_multisampled_2d],Xv.texture_external_type=[qy.keywords.texture_external],Xv.any_texture_type=[...qy.sampled_texture_type,...qy.multisampled_texture_type,...qy.storage_texture_type,...qy.depth_texture_type,...qy.texture_external_type],Xv.texel_format=[qy.keywords.r8unorm,qy.keywords.r8snorm,qy.keywords.r8uint,qy.keywords.r8sint,qy.keywords.r16uint,qy.keywords.r16sint,qy.keywords.r16float,qy.keywords.rg8unorm,qy.keywords.rg8snorm,qy.keywords.rg8uint,qy.keywords.rg8sint,qy.keywords.r32uint,qy.keywords.r32sint,qy.keywords.r32float,qy.keywords.rg16uint,qy.keywords.rg16sint,qy.keywords.rg16float,qy.keywords.rgba8unorm,qy.keywords.rgba8unorm_srgb,qy.keywords.rgba8snorm,qy.keywords.rgba8uint,qy.keywords.rgba8sint,qy.keywords.bgra8unorm,qy.keywords.bgra8unorm_srgb,qy.keywords.rgb10a2unorm,qy.keywords.rg11b10float,qy.keywords.rg32uint,qy.keywords.rg32sint,qy.keywords.rg32float,qy.keywords.rgba16uint,qy.keywords.rgba16sint,qy.keywords.rgba16float,qy.keywords.rgba32uint,qy.keywords.rgba32sint,qy.keywords.rgba32float],Xv.const_literal=[qy.tokens.int_literal,qy.tokens.uint_literal,qy.tokens.decimal_float_literal,qy.tokens.hex_float_literal,qy.keywords.true,qy.keywords.false],Xv.literal_or_ident=[qy.tokens.ident,qy.tokens.int_literal,qy.tokens.uint_literal,qy.tokens.decimal_float_literal,qy.tokens.hex_float_literal,qy.tokens.name],Xv.element_count_expression=[qy.tokens.int_literal,qy.tokens.uint_literal,qy.tokens.ident],Xv.template_types=[qy.keywords.vec2,qy.keywords.vec3,qy.keywords.vec4,qy.keywords.mat2x2,qy.keywords.mat2x3,qy.keywords.mat2x4,qy.keywords.mat3x2,qy.keywords.mat3x3,qy.keywords.mat3x4,qy.keywords.mat4x2,qy.keywords.mat4x3,qy.keywords.mat4x4,qy.keywords.atomic,qy.keywords.bitcast,...qy.any_texture_type],Xv.attribute_name=[qy.tokens.ident,qy.keywords.block,qy.keywords.diagnostic],Xv.assignment_operators=[qy.tokens.equal,qy.tokens.plus_equal,qy.tokens.minus_equal,qy.tokens.times_equal,qy.tokens.division_equal,qy.tokens.modulo_equal,qy.tokens.and_equal,qy.tokens.or_equal,qy.tokens.xor_equal,qy.tokens.shift_right_equal,qy.tokens.shift_left_equal],Xv.increment_operators=[qy.tokens.plus_plus,qy.tokens.minus_minus];class qv{constructor(e,t,n,i,r){this.type=e,this.lexeme=t,this.line=n,this.start=i,this.end=r}toString(){return this.lexeme}isTemplateType(){return-1!=Xv.template_types.indexOf(this.type)}isArrayType(){return this.type==Xv.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Kv{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new qv(Xv.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=Xv.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Xv.none;const i=this._isAlpha(e),r="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(i){const t=Xv.keywords[e];if(t)return this._addToken(t),!0}if(i||r)return this._addToken(Xv.tokens.ident),!0;for(;;){let t=this._findType(e);const i=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==i)return this._current++,e+=i,this._addToken(Xv.tokens.minus_equal),!0;if("-"==i)return this._current++,e+=i,this._addToken(Xv.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=Xv.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==Xv.tokens.paren_right)&&">"!=i)return this._addToken(t),!0}if(">"==e&&(">"==i||"="==i)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===Xv.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===Xv.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===Xv.none){let i=e,r=0;const s=2;for(let e=0;e<s;++e)if(i+=this._peekAhead(e),t=this._findType(i),t!==Xv.none){r=e;break}if(t===Xv.none)return n!==Xv.none&&(this._current--,this._addToken(n),!0);e=i,this._current+=r+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==Xv.none&&(this._addToken(n),!0)}_findType(e){for(const t in Xv.regexTokens){const n=Xv.regexTokens[t];if(this._match(e,n.rule))return n}return Xv.literalTokens[e]||Xv.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new qv(e,t,this._line,this._start,this._current))}}function Yv(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const Jv=new Float32Array(1),Zv=new Uint32Array(Jv.buffer),Qv=new Uint32Array(Jv.buffer),e_=new Int32Array(1),t_=new Float32Array(e_.buffer),n_=new Uint32Array(e_.buffer),i_=new Uint32Array(1),r_=new Float32Array(i_.buffer),s_=new Int32Array(i_.buffer);function o_(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return Jv[0]=e,Zv[0];if("u32"===n)return Jv[0]=e,Qv[0]}else if("i32"===t||"x32"===t){if("f32"===n)return e_[0]=e,t_[0];if("u32"===n)return e_[0]=e,n_[0]}else if("u32"===t){if("f32"===n)return i_[0]=e,r_[0];if("i32"===n||"x32"===n)return i_[0]=e,s_[0]}return e}class a_{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class l_{constructor(e,t){this.align=e,this.size=t}}class c_{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new by,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof Dy&&this._functions.set(t.name,new a_(t));for(const t of e)if(t instanceof dv){const e=this.getTypeInfo(t,null);e instanceof ay&&this.structs.push(e)}for(const t of e)if(t instanceof ov)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Hy){const e=t,n=this._getAttributeNum(e.attributes,"id",0),i=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new yy(e.name,i,e.attributes,n));continue}if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),s=new fy(e.name,r,n,i,e.attributes,hy.Uniform,e.access);s.access||(s.access="read"),this.uniforms.push(s);continue}if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(r),o=new fy(e.name,r,n,i,e.attributes,s?hy.StorageTexture:hy.Storage,e.access);o.access||(o.access="read"),this.storage.push(o);continue}if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(r),o=new fy(e.name,r,n,i,e.attributes,s?hy.StorageTexture:hy.Texture,e.access);o.access||(o.access="read"),s?this.storage.push(o):this.textures.push(o);continue}if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),s=new fy(e.name,r,n,i,e.attributes,hy.Sampler,e.access);this.samplers.push(s);continue}}for(const t of e)if(t instanceof Dy){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),r=e||n||i,s=new _y(t.name,null==r?void 0:r.name,t.attributes);s.attributes=t.attributes,s.startLine=t.startLine,s.endLine=t.endLine,this.functions.push(s),this._functions.get(t.name).info=s,r&&(this._functions.get(t.name).inUse=!0,s.inUse=!0,s.resources=this._findResources(t,!!r),s.inputs=this._getInputs(t.args),s.outputs=this._getOutputs(t.returnType),this.entry[r.name].push(s)),s.arguments=t.args.map(e=>new vy(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),s.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(e=>{var n,i,r;if(e instanceof Ov){if(e.value)if(Yv(e.value))for(const s of e.value)for(const e of this.overrides)s===e.name&&(null===(n=t.info)||void 0===n||n.overrides.push(e));else for(const s of this.overrides)e.value===s.name&&(null===(i=t.info)||void 0===i||i.overrides.push(s))}else if(e instanceof Ev)for(const s of this.overrides)e.name===s.name&&(null===(r=t.info)||void 0===r||r.overrides.push(s))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const e=null===(n=this._functions.get(i.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const i of this.entry.compute)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.vertex)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.fragment)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,r=[];return e.search(s=>{if(s instanceof Ly)r.push({});else if(s instanceof By)r.pop();else if(s instanceof Vy){const e=s;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(s instanceof _v){const e=s;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(s instanceof jy){const e=s;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(s instanceof Ev){const e=s;if(r.length>0&&r[r.length-1][e.name])return;const t=i._findResource(e.name);t&&n.push(t)}else if(s instanceof bv){const r=s,o=i._functions.get(r.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=i._findResources(o.node,t)),n.push(...o.resources))}else if(s instanceof Zy){const r=s,o=i._functions.get(r.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=i._findResources(o.node,t)),n.push(...o.resources))}}),[...new Map(n.map(e=>[e.name,e])).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof dv)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof dv)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const i=this.getTypeInfo(n.type,n.type.attributes),r=this._parseInt(e.value),s=new my(n.name,i,e.name,r);t.push(s)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new my("",n,t.name,i)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(const n of e)if(n.type instanceof dv)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof dv)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),s=new gy(e.name,i,t.name,r);return null!==n&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new py(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof pv){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new cy(e.name,n,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof gv){const n=e,i=n.format?this.getTypeInfo(n.format,n.attributes):null,r=new ly(n.name,t);return r.format=i,r.count=n.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof dv){const n=e,i=new ay(n.name,t);i.startLine=n.startLine,i.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);i.members.push(new oy(e.name,t,e.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof mv){const n=e,i=n.format instanceof uv,r=n.format?i?this.getTypeInfo(n.format,null):new sy(n.format,null):null,s=new uy(n.name,r,t,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof fv){const n=e,i=n.format?this.getTypeInfo(n.format,null):null,r=new uy(n.name,i,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}const n=new sy(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const r=this._getTypeSize(e);if(e.size=null!==(t=null==r?void 0:r.size)&&void 0!==t?t:0,e instanceof ly&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(i=null==t?void 0:t.align)&&void 0!==i?i:0),this._updateTypeInfo(e.format)}e instanceof cy&&this._updateTypeInfo(e.format),e instanceof ay&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,r=0,s=0;for(let o=0,a=e.members.length;o<a;++o){const a=e.members[o],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+i),i=u,r=n,s=Math.max(s,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(s,r+i),e.align=s}_getTypeSize(e){var t,n;if(null==e)return null;const i=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof oy&&(e=e.type),e instanceof sy){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=c_._typeInfo[e.name];if(void 0!==n){const s="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new l_(Math.max(r,n.align/s),Math.max(i,n.size/s))}}{const t=c_._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new l_(Math.max(r,t.align/n),Math.max(i,t.size/n))}}if(e instanceof ly){let t=e,s=8,o=8;const a=this._getTypeSize(t.format);return null!==a&&(o=a.size,s=a.align),o=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(s,o)),i&&(o=i),new l_(Math.max(r,s),Math.max(i,o))}if(e instanceof ay){let t=0,n=0,s=0,o=0,a=0;for(const i of e.members){const e=this._getTypeSize(i.type);null!==e&&(t=Math.max(e.align,t),s=this._roundUp(e.align,s+o),o=e.size,a=s)}return n=this._roundUp(t,a+o),new l_(Math.max(r,t),Math.max(i,n))}return null}_isUniformVar(e){return e instanceof Vy&&"uniform"==e.storage}_isStorageVar(e){return e instanceof Vy&&"storage"==e.storage}_isTextureVar(e){return e instanceof Vy&&null!==e.type&&-1!=c_._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof Vy&&null!==e.type&&-1!=c_._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let r of i)if(r.name==t)return r;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}c_._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},c_._textureTypes=Xv.any_texture_type.map(e=>e.name),c_._samplerTypes=Xv.sampler_type.map(e=>e.name);let u_=0;class h_{constructor(e,t,n){this.id=u_++,this.name=e,this.value=t,this.node=n}clone(){return new h_(this.name,this.value,this.node)}}class d_{constructor(e){this.id=u_++,this.name=e.name,this.node=e}clone(){return new d_(this.node)}}class f_{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=u_++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new h_(e,t,null!=n?n:null))}setVariable(e,t,n){const i=this.getVariable(e);null!==i?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new f_(this)}}class p_{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class g_{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof Vv)return n.data.forEach(e=>{e||(i=!1)}),new zv(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv){const e=n.data.some(e=>e);return new zv(e?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof zv))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof jv&&0===i.typeInfo.size){const e=i.typeInfo,t=i.buffer.byteLength/e.stride;return new zv(t,this.getTypeInfo("u32"))}return new zv(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.abs(e)),n.typeInfo);const i=n;return new zv(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.acos(e)),n.typeInfo);const i=n;return new zv(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.acosh(e)),n.typeInfo);const i=n;return new zv(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.asin(e)),n.typeInfo);const i=n;return new zv(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.asinh(e)),n.typeInfo);const i=n;return new zv(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.atan(e)),n.typeInfo);const i=n;return new zv(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.atanh(e)),n.typeInfo);const i=n;return new zv(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Vv&&i instanceof Vv)return new Vv(n.data.map((e,t)=>Math.atan2(e,i.data[t])),n.typeInfo);const r=n,s=i;return new zv(Math.atan2(r.value,s.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.ceil(e)),n.typeInfo);const i=n;return new zv(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vv&&i instanceof Vv&&r instanceof Vv)return new Vv(n.data.map((e,t)=>this._clamp(e,i.data[t],r.data[t])),n.typeInfo);const s=n,o=i,a=r;return new zv(this._clamp(s.value,o.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.cos(e)),n.typeInfo);const i=n;return new zv(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.cosh(e)),n.typeInfo);const i=n;return new zv(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.clz32(e)),n.typeInfo);const i=n;return new zv(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>this._countOneBits(e)),n.typeInfo);const i=n;return new zv(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>this._countTrailingZeros(e)),n.typeInfo);const i=n;return new zv(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Vv&&i instanceof Vv){if(3!==n.data.length||3!==i.data.length)return null;const e=n.data,t=i.data;return new Vv([e[1]*t[2]-t[1]*e[2],e[2]*t[0]-t[2]*e[0],e[0]*t[1]-t[0]*e[1]],n.typeInfo)}return null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof Vv?new Vv(n.data.map(e=>e*i),n.typeInfo):new zv(n.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Hv){const e=n.data,t=n.typeInfo.getTypeName(),i=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new zv(e[0]*e[3]-e[1]*e[2],i);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new zv(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t);else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new zv(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i)}return null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Vv&&i instanceof Vv){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-i.data[t])*(n.data[t]-i.data[t]);return new zv(Math.sqrt(e),this.getTypeInfo("f32"))}const r=n,s=i;return new zv(Math.abs(r.value-s.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof Vv&&i instanceof Vv?new zv(this._dot(n.data,i.data),this.getTypeInfo("f32")):null}Dot4U8Packed(e,t){return null}Dot4I8Packed(e,t){return null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.exp(e)),n.typeInfo);const i=n;return new zv(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.pow(2,e)),n.typeInfo);const i=n;return new zv(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return null;if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return null;const s=i.value,o=r.value;if(n instanceof Vv)return new Vv(n.data.map(e=>e>>s&(1<<o)-1),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return null;const a=n.value;return new zv(a>>s&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vv&&i instanceof Vv&&r instanceof Vv){const e=this._dot(i.data,r.data);return new Vv(e<0?Array.from(n.data):n.data.map(e=>-e),n.typeInfo)}return null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>this._firstLeadingBit(e)),n.typeInfo);const i=n;return new zv(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>this._firstTrailingBit(e)),n.typeInfo);const i=n;return new zv(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.floor(e)),n.typeInfo);const i=n;return new zv(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vv&&i instanceof Vv&&r instanceof Vv)return n.data.length!==i.data.length||n.data.length!==r.data.length?null:new Vv(n.data.map((e,t)=>e*i.data[t]+r.data[t]),n.typeInfo);const s=n,o=i,a=r;return new zv(s.value*o.value+a.value,s.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>e-Math.floor(e)),n.typeInfo);const i=n;return new zv(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t),s=this.exec.evalExpression(e.args[3],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return null;const o=r.value,a=(1<<s.value)-1<<o,l=~a;if(n instanceof Vv&&i instanceof Vv)return new Vv(n.data.map((e,t)=>e&l|i.data[t]<<o&a),n.typeInfo);const c=n.value,u=i.value;return new zv(c&l|u<<o&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>1/Math.sqrt(e)),n.typeInfo);const i=n;return new zv(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv){let e=0;return n.data.forEach(t=>{e+=t*t}),new zv(Math.sqrt(e),this.getTypeInfo("f32"))}const i=n;return new zv(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.log(e)),n.typeInfo);const i=n;return new zv(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.log2(e)),n.typeInfo);const i=n;return new zv(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Vv&&i instanceof Vv)return new Vv(n.data.map((e,t)=>Math.max(e,i.data[t])),n.typeInfo);const r=n,s=i;return new zv(Math.max(r.value,s.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Vv&&i instanceof Vv)return new Vv(n.data.map((e,t)=>Math.min(e,i.data[t])),n.typeInfo);const r=n,s=i;return new zv(Math.min(r.value,s.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vv&&i instanceof Vv&&r instanceof Vv)return new Vv(n.data.map((e,t)=>n.data[t]*(1-r.data[t])+i.data[t]*r.data[t]),n.typeInfo);const s=i,o=r;return new zv(n.value*(1-o.value)+s.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Vv&&i instanceof Vv)return new Vv(n.data.map((e,t)=>e%i.data[t]),n.typeInfo);const r=i;return new zv(n.value%r.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv){const i=this.Length(e,t).value;return new Vv(n.data.map(e=>e/i),n.typeInfo)}return null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Vv&&i instanceof Vv)return new Vv(n.data.map((e,t)=>Math.pow(e,i.data[t])),n.typeInfo);const r=n,s=i;return new zv(Math.pow(r.value,s.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Vv?new Vv(n.data.map(e=>e),n.typeInfo):new zv(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Vv?new Vv(n.data.map(e=>e*Math.PI/180),n.typeInfo):new zv(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Vv&&i instanceof Vv){const e=this._dot(n.data,i.data);return new Vv(n.data.map((t,n)=>t-2*e*i.data[n]),n.typeInfo)}return null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Vv&&i instanceof Vv&&r instanceof zv){const e=this._dot(i.data,n.data);return new Vv(n.data.map((t,n)=>{const s=1-r.value*r.value*(1-e*e);if(s<0)return 0;const o=Math.sqrt(s);return r.value*t-(r.value*e+o)*i.data[n]}),n.typeInfo)}return null}ReverseBits(e,t){return null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.round(e)),n.typeInfo);const i=n;return new zv(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.min(Math.max(e,0),1)),n.typeInfo);const i=n;return new zv(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.sign(e)),n.typeInfo);const i=n;return new zv(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.sin(e)),n.typeInfo);const i=n;return new zv(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.sinh(e)),n.typeInfo);const i=n;return new zv(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(r instanceof Vv&&n instanceof Vv&&i instanceof Vv)return new Vv(r.data.map((e,t)=>this._smoothstep(n.data[t],i.data[t],e)),r.typeInfo);const s=n,o=i,a=r;return new zv(this._smoothstep(s.value,o.value,a.value),r.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.sqrt(e)),n.typeInfo);const i=n;return new zv(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof Vv&&n instanceof Vv)return new Vv(i.data.map((e,t)=>e<n.data[t]?0:1),i.typeInfo);const r=n;return new zv(i.value<r.value?0:1,r.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.tan(e)),n.typeInfo);const i=n;return new zv(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.tanh(e)),n.typeInfo);const i=n;return new zv(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):e}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof Hv))return null;const i=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[2],e[1],e[3]],i)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[3],e[6],e[1],e[4],e[7]],i)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],i)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[3],e[1],e[4],e[2],e[5]],i)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],i)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],i)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[4],e[1],e[5],e[2],e[6]],i)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],i)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new Hv([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],i)}return null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Vv)return new Vv(n.data.map(e=>Math.trunc(e)),n.typeInfo);const i=n;return new zv(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return null}DpdxCoarse(e,t){return null}DpdxFine(e,t){return null}Dpdy(e,t){return null}DpdyCoarse(e,t){return null}DpdyFine(e,t){return null}Fwidth(e,t){return null}FwidthCoarse(e,t){return null}FwidthFine(e,t){return null}TextureDimensions(e,t){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof Ev){const e=n.name,r=t.getVariableValue(e);if(r instanceof Wv){if(i<0||i>=r.mipLevelCount)return null;const e=r.getMipLevelSize(i),t=r.dimension;return"1d"===t?new zv(e[0],this.getTypeInfo("u32")):"3d"===t?new Vv(e,this.getTypeInfo("vec3u")):"2d"===t?new Vv(e.slice(0,2),this.getTypeInfo("vec2u")):null}return null}return null}TextureGather(e,t){return null}TextureGatherCompare(e,t){return null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof Vv)||2!==i.data.length)return null;if(n instanceof Ev){const e=n.name,s=t.getVariableValue(e);if(s instanceof Wv){const e=Math.floor(i.data[0]),t=Math.floor(i.data[1]);if(e<0||e>=s.width||t<0||t>=s.height)return null;const n=s.getPixel(e,t,0,r);return null===n?null:new Vv(n,this.getTypeInfo("vec4f"))}return null}return null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof Ev){const e=n.name,i=t.getVariableValue(e);return i instanceof Wv?new zv(i.depthOrArrayLayers,this.getTypeInfo("u32")):null}return null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof Ev){const e=n.name,i=t.getVariableValue(e);return i instanceof Wv?new zv(i.mipLevelCount,this.getTypeInfo("u32")):null}return null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof Ev){const e=n.name,i=t.getVariableValue(e);return i instanceof Wv?new zv(i.sampleCount,this.getTypeInfo("u32")):null}return null}TextureSample(e,t){return null}TextureSampleBias(e,t){return null}TextureSampleCompare(e,t){return null}TextureSampleCompareLevel(e,t){return null}TextureSampleGrad(e,t){return null}TextureSampleLevel(e,t){return null}TextureSampleBaseClampToEdge(e,t){return null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,s=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==s.length)return null;if(!(i instanceof Vv)||2!==i.data.length)return null;if(n instanceof Ev){const e=n.name,o=t.getVariableValue(e);if(o instanceof Wv){const e=o.getMipLevelSize(0),t=Math.floor(i.data[0]),n=Math.floor(i.data[1]);return t<0||t>=e[0]||n<0||n>=e[1]||o.setPixel(t,n,0,r,Array.from(s)),null}return null}return null}AtomicLoad(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t);return a instanceof zv&&o instanceof zv&&(a.value=o.value),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new zv(a.value,a.typeInfo);return a instanceof zv&&o instanceof zv&&(a.value+=o.value),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicSub(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new zv(a.value,a.typeInfo);return a instanceof zv&&o instanceof zv&&(a.value-=o.value),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMax(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new zv(a.value,a.typeInfo);return a instanceof zv&&o instanceof zv&&(a.value=Math.max(a.value,o.value)),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMin(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new zv(a.value,a.typeInfo);return a instanceof zv&&o instanceof zv&&(a.value=Math.min(a.value,o.value)),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicAnd(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new zv(a.value,a.typeInfo);return a instanceof zv&&o instanceof zv&&(a.value=a.value&o.value),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicOr(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new zv(a.value,a.typeInfo);return a instanceof zv&&o instanceof zv&&(a.value=a.value|o.value),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicXor(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new zv(a.value,a.typeInfo);return a instanceof zv&&o instanceof zv&&(a.value=a.value^o.value),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicExchange(e,t){let n=e.args[0];n instanceof Cv&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new zv(a.value,a.typeInfo);return a instanceof zv&&o instanceof zv&&(a.value=o.value),r.value instanceof jv&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicCompareExchangeWeak(e,t){return null}Pack4x8snorm(e,t){return null}Pack4x8unorm(e,t){return null}Pack4xI8(e,t){return null}Pack4xU8(e,t){return null}Pack4x8Clamp(e,t){return null}Pack4xU8Clamp(e,t){return null}Pack2x16snorm(e,t){return null}Pack2x16unorm(e,t){return null}Pack2x16float(e,t){return null}Unpack4x8snorm(e,t){return null}Unpack4x8unorm(e,t){return null}Unpack4xI8(e,t){return null}Unpack4xU8(e,t){return null}Unpack2x16snorm(e,t){return null}Unpack2x16unorm(e,t){return null}Unpack2x16float(e,t){return null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return null}SubgroupExclusiveAdd(e,t){return null}SubgroupInclusiveAdd(e,t){return null}SubgroupAll(e,t){return null}SubgroupAnd(e,t){return null}SubgroupAny(e,t){return null}SubgroupBallot(e,t){return null}SubgroupBroadcast(e,t){return null}SubgroupBroadcastFirst(e,t){return null}SubgroupElect(e,t){return null}SubgroupMax(e,t){return null}SubgroupMin(e,t){return null}SubgroupMul(e,t){return null}SubgroupExclusiveMul(e,t){return null}SubgroupInclusiveMul(e,t){return null}SubgroupOr(e,t){return null}SubgroupShuffle(e,t){return null}SubgroupShuffleDown(e,t){return null}SubgroupShuffleUp(e,t){return null}SubgroupShuffleXor(e,t){return null}SubgroupXor(e,t){return null}QuadBroadcast(e,t){return null}QuadSwapDiagonal(e,t){return null}QuadSwapX(e,t){return null}QuadSwapY(e,t){return null}}const m_={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},y_={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class v_ extends p_{constructor(e,t){var n;super(),this.ast=null!=e?e:[],this.reflection=new c_,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new f_,this.builtins=new g_(this),this.typeInfo={bool:this.getTypeInfo(uv.bool),i32:this.getTypeInfo(uv.i32),u32:this.getTypeInfo(uv.u32),f32:this.getTypeInfo(uv.f32),f16:this.getTypeInfo(uv.f16),vec2f:this.getTypeInfo(fv.vec2f),vec2u:this.getTypeInfo(fv.vec2u),vec2i:this.getTypeInfo(fv.vec2i),vec2h:this.getTypeInfo(fv.vec2h),vec3f:this.getTypeInfo(fv.vec3f),vec3u:this.getTypeInfo(fv.vec3u),vec3i:this.getTypeInfo(fv.vec3i),vec3h:this.getTypeInfo(fv.vec3h),vec4f:this.getTypeInfo(fv.vec4f),vec4u:this.getTypeInfo(fv.vec4u),vec4i:this.getTypeInfo(fv.vec4i),vec4h:this.getTypeInfo(fv.vec4h),mat2x2f:this.getTypeInfo(fv.mat2x2f),mat2x3f:this.getTypeInfo(fv.mat2x3f),mat2x4f:this.getTypeInfo(fv.mat2x4f),mat3x2f:this.getTypeInfo(fv.mat3x2f),mat3x3f:this.getTypeInfo(fv.mat3x3f),mat3x4f:this.getTypeInfo(fv.mat3x4f),mat4x2f:this.getTypeInfo(fv.mat4x2f),mat4x3f:this.getTypeInfo(fv.mat4x3f),mat4x4f:this.getTypeInfo(fv.mat4x4f)}}getVariableValue(e){var t,n;const i=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===i)return null;if(i instanceof zv)return i.value;if(i instanceof Vv)return Array.from(i.data);if(i instanceof Hv)return Array.from(i.data);if(i instanceof jv&&i.typeInfo instanceof ly){if("u32"===i.typeInfo.format.name)return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if("i32"===i.typeInfo.format.name)return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if("f32"===i.typeInfo.format.name)return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const r=this.context.clone();(i=null!=i?i:{}).constants&&this._setOverrides(i.constants,r),this._execStatements(this.ast,r);const s=r.getFunction(e);if(!s)return;if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return;1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],a=t[1],l=t[2],c=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new Vv(t,c));const u=this.reflection.getFunctionInfo(e);for(const h in n)for(const e in n[h]){const t=n[h][e];r.variables.forEach(n=>{var i;const r=n.node;if(null==r?void 0:r.attributes){let s=null,o=null;for(const e of r.attributes)"binding"===e.name?s=e.value:"group"===e.name&&(o=e.value);if(e==s&&h==o){let s=!1;for(const t of u.resources)if(t.name===n.name&&t.group===parseInt(h)&&t.binding===parseInt(e)){s=!0;break}if(s)if(void 0!==t.texture&&void 0!==t.descriptor){const e=new Wv(t.texture,this.getTypeInfo(r.type),t.descriptor,null!==(i=t.texture.view)&&void 0!==i?i:null);n.value=e}else void 0!==t.uniform?n.value=new jv(t.uniform,this.getTypeInfo(r.type)):n.value=new jv(t,this.getTypeInfo(r.type))}}})}for(let h=0;h<l;++h)for(let e=0;e<a;++e)for(let t=0;t<o;++t)r.setVariable("@workgroup_id",new Vv([t,e,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[t,e,h],r)}execStatement(e,t){if(e instanceof nv)return this.evalExpression(e.value,t);if(e instanceof lv){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof zv))throw new Error("Invalid break-if condition");if(!n.value)return null}return v_._breakObj}if(e instanceof cv)return v_._continueObj;if(e instanceof jy)this._let(e,t);else if(e instanceof Vy)this._var(e,t);else if(e instanceof Wy)this._const(e,t);else if(e instanceof Dy)this._function(e,t);else{if(e instanceof tv)return this._if(e,t);if(e instanceof ev)return this._switch(e,t);if(e instanceof Gy)return this._for(e,t);if(e instanceof Uy)return this._while(e,t);if(e instanceof Qy)return this._loop(e,t);if(e instanceof zy){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Jy)this._assign(e,t);else if(e instanceof Yy)this._increment(e,t);else{if(e instanceof dv)return null;if(e instanceof Hy){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new zv(0,this.getTypeInfo("u32")))}else if(e instanceof Zy)this._call(e,t);else{if(e instanceof sv)return null;if(e instanceof ov)return null}}}return null}evalExpression(e,t){return e instanceof Iv?this._evalBinaryOp(e,t):e instanceof xv?this._evalLiteral(e,t):e instanceof Ev?this._evalVariable(e,t):e instanceof bv?this._evalCall(e,t):e instanceof _v?this._evalCreate(e,t):e instanceof wv?this._evalConst(e,t):e instanceof Av?this._evalBitcast(e,t):e instanceof Cv?this._evalUnaryOp(e,t):null}getTypeInfo(e){var t;if(e instanceof uv){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const i=e[n],r=this.reflection.getOverrideInfo(n);null!==r&&(null===r.type&&(r.type=this.getTypeInfo("u32")),"u32"===r.type.name||"i32"===r.type.name||"f32"===r.type.name||"f16"===r.type.name?t.setVariable(n,new zv(i,r.type)):"bool"===r.type.name?t.setVariable(n,new zv(i?1:0,r.type)):("vec2"===r.type.name||"vec3"===r.type.name||"vec4"===r.type.name||"vec2f"===r.type.name||"vec3f"===r.type.name||"vec4f"===r.type.name||"vec2i"===r.type.name||"vec3i"===r.type.name||"vec4i"===r.type.name||"vec2u"===r.type.name||"vec3u"===r.type.name||"vec4u"===r.type.name||"vec2h"===r.type.name||"vec3h"===r.type.name||"vec4h"===r.type.name)&&t.setVariable(n,new Vv(i,r.type)))}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const c of e.node.attributes)if("workgroup_size"===c.name){if(c.value.length>0){const e=n.getVariableValue(c.value[0]);i[0]=e instanceof zv?e.value:parseInt(c.value[0])}if(c.value.length>1){const e=n.getVariableValue(c.value[1]);i[1]=e instanceof zv?e.value:parseInt(c.value[1])}if(c.value.length>2){const e=n.getVariableValue(c.value[2]);i[2]=e instanceof zv?e.value:parseInt(c.value[2])}}const r=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Vv(i,r));const o=i[0],a=i[1],l=i[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<a;++l)for(let a=0;a<o;++a,++u){const o=[a,l,c],h=[a+t[0]*i[0],l+t[1]*i[1],c+t[2]*i[2]];n.setVariable("@local_invocation_id",new Vv(o,r)),n.setVariable("@global_invocation_id",new Vv(h,r)),n.setVariable("@local_invocation_index",new zv(u,s)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const i=`@${e.value}`,r=t.getVariable(i);void 0!==r&&t.variables.set(n.name,r)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Cv;)e=e.right;return e instanceof Ev?e.name:null}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),i=this._execStatements(n,e);if(i)return i;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let t=0;t<i.node.args.length;++t){const r=i.node.args[t],s=this.evalExpression(e.args[t],n);n.setVariable(r.name,s,r)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i&&("++"===e.operator?i.value instanceof zv&&i.value.value++:"--"===e.operator&&i.value instanceof zv&&i.value.value--)}_getVariableData(e,t){if(e instanceof Ev){const n=this.getVariableName(e,t),i=t.getVariable(n);return null===i?null:i.value.getSubData(this,e.postfix,t)}if(e instanceof Cv){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof Uv?n.reference.getSubData(this,e.postfix,t):null}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new Uv(n)}}return null}_assign(e,t){let n=null,i="<var>",r=null;if(e.variable instanceof Cv){const n=this._getVariableData(e.variable,t),i=this.evalExpression(e.value,t),r=e.operator;if("="===r){if(n instanceof zv||n instanceof Vv||n instanceof Hv){if(i instanceof zv||i instanceof Vv||i instanceof Hv&&n.data.length===i.data.length)return void n.data.set(i.data)}else if(n instanceof jv&&i instanceof jv&&n.buffer.byteLength-n.offset>=i.buffer.byteLength-i.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(i.buffer,i.offset,i.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(i.buffer,i.offset,i.typeInfo.size)));return null}if("+="===r)return(n instanceof zv||n instanceof Vv||n instanceof Hv)&&(i instanceof zv||i instanceof Vv||i instanceof Hv)?void n.data.set(i.data.map((e,t)=>n.data[t]+e)):void 0;if("-="===r)return(n instanceof zv||n instanceof Vv||n instanceof Hv)&&(i instanceof zv||i instanceof Vv||i instanceof Hv)?void n.data.set(i.data.map((e,t)=>n.data[t]-e)):void 0}if(e.variable instanceof Cv){if("*"===e.variable.operator){i=this.getVariableName(e.variable.right,t);const r=t.getVariable(i);if(!(r&&r.value instanceof Uv))return;n=r.value.reference;let s=e.variable.postfix;if(!s){let t=e.variable.right;for(;t instanceof Cv;){if(t.postfix){s=t.postfix;break}t=t.right}}s&&(n=n.getSubData(this,s,t))}}else{r=e.variable.postfix,i=this.getVariableName(e.variable,t);const s=t.getVariable(i);if(null===s)return;n=s.value}if(n instanceof Uv&&(n=n.reference),null===n)return;const s=this.evalExpression(e.value,t),o=e.operator;if("="!==o){const e=n.getSubData(this,r,t);if(e instanceof Vv&&s instanceof zv){const t=e.data,n=s.value;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n}else if(e instanceof Vv&&s instanceof Vv){const t=e.data,n=s.data;if(t.length!==n.length)return;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n[e]}else{if(!(e instanceof zv&&s instanceof zv))return;"+="===o?e.value+=s.value:"-="===o?e.value-=s.value:"*="===o?e.value*=s.value:"/="===o?e.value/=s.value:"%="===o?e.value%=s.value:"&="===o?e.value&=s.value:"|="===o?e.value|=s.value:"^="===o?e.value^=s.value:"<<="===o?e.value<<=s.value:">>="===o&&(e.value>>=s.value)}return void(n instanceof jv&&n.setDataValue(this,e,r,t))}if(n instanceof jv)n.setDataValue(this,s,r,t);else if(r){if(!(n instanceof Vv||n instanceof Hv))return;if(r instanceof Sv){const e=this.evalExpression(r.index,t).value;if(n instanceof Vv){if(!(s instanceof zv))return;n.data[e]=s.value}else{if(!(n instanceof Hv))return;{const e=this.evalExpression(r.index,t).value;if(e<0)return;if(!(s instanceof Vv))return;{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(e<2&&2===s.data.length))return;n.data[2*e]=s.data[0],n.data[2*e+1]=s.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(e<2&&3===s.data.length))return;n.data[3*e]=s.data[0],n.data[3*e+1]=s.data[1],n.data[3*e+2]=s.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(e<2&&4===s.data.length))return;n.data[4*e]=s.data[0],n.data[4*e+1]=s.data[1],n.data[4*e+2]=s.data[2],n.data[4*e+3]=s.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(e<3&&2===s.data.length))return;n.data[2*e]=s.data[0],n.data[2*e+1]=s.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(e<3&&3===s.data.length))return;n.data[3*e]=s.data[0],n.data[3*e+1]=s.data[1],n.data[3*e+2]=s.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(e<3&&4===s.data.length))return;n.data[4*e]=s.data[0],n.data[4*e+1]=s.data[1],n.data[4*e+2]=s.data[2],n.data[4*e+3]=s.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(e<4&&2===s.data.length))return;n.data[2*e]=s.data[0],n.data[2*e+1]=s.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(e<4&&3===s.data.length))return;n.data[3*e]=s.data[0],n.data[3*e+1]=s.data[1],n.data[3*e+2]=s.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return;if(!(e<4&&4===s.data.length))return;n.data[4*e]=s.data[0],n.data[4*e+1]=s.data[1],n.data[4*e+2]=s.data[2],n.data[4*e+3]=s.data[3]}}}}}else if(r instanceof vv){const e=r.value;if(!(n instanceof Vv))return;if(s instanceof zv){if(e.length>1)return;if("x"===e)n.data[0]=s.value;else if("y"===e){if(n.data.length<2)return;n.data[1]=s.value}else if("z"===e){if(n.data.length<3)return;n.data[2]=s.value}else if("w"===e){if(n.data.length<4)return;n.data[3]=s.value}}else{if(!(s instanceof Vv))return;if(e.length!==s.data.length)return;for(let t=0;t<e.length;++t){const i=e[t];if("x"===i||"r"===i)n.data[0]=s.data[t];else if("y"===i||"g"===i){if(s.data.length<2)return;n.data[1]=s.data[t]}else if("z"===i||"b"===i){if(s.data.length<3)return;n.data[2]=s.data[t]}else{if("w"!==i&&"a"!==i)return;if(s.data.length<4)return;n.data[3]=s.data[t]}}}}}else n instanceof zv&&s instanceof zv?n.value=s.value:(n instanceof Vv&&s instanceof Vv||n instanceof Hv&&s instanceof Hv)&&n.data.set(s.data)}_function(e,t){const n=new d_(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return;e.value instanceof Cv||(n=n.clone())}else{const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||"array"===i){const i=new _v(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return;e.value instanceof Cv||(n=n.clone())}else{if(null===e.type)return;const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||e.type instanceof gv||e.type instanceof dv||e.type instanceof fv){const i=new _v(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof zv))return null;let i=null;for(const r of e.cases)if(r instanceof Pv)for(const e of r.selectors){if(e instanceof Rv){i=r;continue}const s=this.evalExpression(e,t);if(!(s instanceof zv))return null;if(s.value===n.value)return this._execStatements(r.body,t)}else r instanceof Mv&&(i=r);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof zv))return null;if(n.value)return this._execStatements(e.body,t);for(const i of e.elseif){const e=this.evalExpression(i.condition,t);if(!(e instanceof zv))return null;if(e.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof zv?e.value:0}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===v_._breakObj)break;if(null!==n&&n!==v_._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===v_._breakObj)break;if(n===v_._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===v_._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===v_._breakObj)break;if(n!==v_._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof zv){const e=o_(n.value,n.typeInfo.name,i.name);return new zv(e,this.getTypeInfo(i))}if(n instanceof Vv){const e=n.typeInfo.getTypeName();let t="";if(e.endsWith("f"))t="f32";else if(e.endsWith("i"))t="i32";else if(e.endsWith("u"))t="u32";else if(e.endsWith("b"))t="bool";else{if(!e.endsWith("h"))return null;t="f16"}const r=i.getTypeName();let s="";if(r.endsWith("f"))s="f32";else if(r.endsWith("i"))s="i32";else if(r.endsWith("u"))s="u32";else if(r.endsWith("b"))s="bool";else{if(!r.endsWith("h"))return null;s="f16"}const o=function(e,t,n){if(t===n)return e;const i=new Array(e.length);for(let r=0;r<e.length;r++)i[r]=o_(e[r],t,n);return i}(Array.from(n.data),t,s);return new Vv(o,this.getTypeInfo(i))}return null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof _v){if(null===e.type)return Fv.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}e instanceof _v?e.type.name:e.name;const i=e instanceof _v?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===i)return null;if(0===i.size)return null;const r=new jv(new ArrayBuffer(i.size),i,0);if(i instanceof ay){if(e.args)for(let s=0;s<e.args.length;++s){const n=i.members[s],o=e.args[s],a=this.evalExpression(o,t);r.setData(this,a,n.type,n.offset,t)}}else if(i instanceof ly){let s=0;if(e.args)for(let o=0;o<e.args.length;++o){const a=e.args[o],l=this.evalExpression(a,t);null===i.format&&("x32"===(null===(n=l.typeInfo)||void 0===n?void 0:n.name)?i.format=this.getTypeInfo("i32"):i.format=l.typeInfo),r.setData(this,l,i.format,s,t),s+=i.stride}}return e instanceof _v?r.getSubData(this,e.postfix,t):r}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return"x32"===i||"u32"===i||"f32"===i||"f16"===i||"i32"===i||"bool"===i?new zv(e.scalarValue,n):"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i?this._callConstructorVec(e,t):"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=v_._priority.get(t.name);v_._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new Uv(n);if("*"===e.operator)return n instanceof Uv?n.reference.getSubData(this,e.postfix,t):null;const i=n instanceof zv?n.value:n instanceof Vv?Array.from(n.data):null;switch(e.operator){case"+":{if(Yv(i)){const e=i.map((e,t)=>+e);return new Vv(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new zv(+e,t)}case"-":{if(Yv(i)){const e=i.map((e,t)=>-e);return new Vv(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new zv(-e,t)}case"!":{if(Yv(i)){const e=i.map((e,t)=>e?0:1);return new Vv(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new zv(e?0:1,t)}case"~":{if(Yv(i)){const e=i.map((e,t)=>~e);return new Vv(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new zv(~e,t)}}return null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),r=n instanceof zv?n.value:n instanceof Vv||n instanceof Hv?Array.from(n.data):null,s=i instanceof zv?i.value:i instanceof Vv||i instanceof Hv?Array.from(i.data):null;switch(e.operator){case"+":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e+t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t+e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e+t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e+t,o)}case"-":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e-t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t-e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e-t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e-t,o)}case"*":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(n instanceof Hv&&i instanceof Hv){const r=function(e,t,n,i){if(void 0===y_[t.name]||void 0===y_[i.name])return null;const r=y_[t.name][0],s=y_[t.name][1],o=y_[i.name][0];if(r!==y_[i.name][1])return null;const a=new Array(o*s);for(let l=0;l<s;l++)for(let t=0;t<o;t++){let i=0;for(let o=0;o<r;o++)i+=e[o*s+l]*n[t*r+o];a[l*o+t]=i}return a}(e,n.typeInfo,t,i.typeInfo);if(null===r)return null;const s=y_[i.typeInfo.name][0],o=y_[n.typeInfo.name][1],a=this.getTypeInfo(`mat${s}x${o}f`);return new Hv(r,a)}if(n instanceof Hv&&i instanceof Vv){const r=function(e,t,n,i){if(void 0===y_[t.name]||void 0===m_[i.name])return null;const r=y_[t.name][0],s=y_[t.name][1];if(r!==n.length)return null;const o=new Array(s);for(let a=0;a<s;a++){let t=0;for(let i=0;i<r;i++)t+=e[i*s+a]*n[i];o[a]=t}return o}(e,n.typeInfo,t,i.typeInfo);return null===r?null:new Vv(r,i.typeInfo)}if(n instanceof Vv&&i instanceof Hv){const r=function(e,t,n,i){if(void 0===m_[t.name]||void 0===y_[i.name])return null;const r=y_[i.name][0],s=y_[i.name][1];if(s!==e.length)return null;const o=[];for(let a=0;a<r;a++){let t=0;for(let i=0;i<s;i++)t+=e[i]*n[i*r+a];o[a]=t}return o}(e,n.typeInfo,t,i.typeInfo);return null===r?null:new Vv(r,n.typeInfo)}{if(e.length!==t.length)return null;const i=e.map((e,n)=>e*t[n]);return new Vv(i,n.typeInfo)}}if(Yv(r)){const e=s,t=r.map((t,n)=>t*e);return n instanceof Hv?new Hv(t,n.typeInfo):new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e*t);return i instanceof Hv?new Hv(t,i.typeInfo):new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e*t,o)}case"%":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e%t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t%e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e%t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e%t,o)}case"/":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e/t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t/e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e/t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e/t,o)}case"&":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e&t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t&e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e&t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e&t,o)}case"|":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e|t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t|e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e|t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e|t,o)}case"^":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e^t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t^e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e^t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e^t,o)}case"<<":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e<<t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t<<e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e<<t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e<<t,o)}case">>":{if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e>>t[n]);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t>>e);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e>>t);return new Vv(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new zv(e>>t,o)}case">":if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e>t[n]?1:0);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t>e?1:0);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e>t?1:0);return new Vv(t,i.typeInfo)}return new zv(r>s?1:0,this.getTypeInfo("bool"));case"<":if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e<t[n]?1:0);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t<e?1:0);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e<t?1:0);return new Vv(t,i.typeInfo)}return new zv(r<s?1:0,this.getTypeInfo("bool"));case"==":if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e===t[n]?1:0);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t==e?1:0);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e==t?1:0);return new Vv(t,i.typeInfo)}return new zv(r===s?1:0,this.getTypeInfo("bool"));case"!=":if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e!==t[n]?1:0);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t!==e?1:0);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e!==t?1:0);return new Vv(t,i.typeInfo)}return new zv(r!==s?1:0,this.getTypeInfo("bool"));case">=":if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e>=t[n]?1:0);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t>=e?1:0);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e>=t?1:0);return new Vv(t,i.typeInfo)}return new zv(r>=s?1:0,this.getTypeInfo("bool"));case"<=":if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e<=t[n]?1:0);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t<=e?1:0);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e<=t?1:0);return new Vv(t,i.typeInfo)}return new zv(r<=s?1:0,this.getTypeInfo("bool"));case"&&":if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e&&t[n]?1:0);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t&&e?1:0);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e&&t?1:0);return new Vv(t,i.typeInfo)}return new zv(r&&s?1:0,this.getTypeInfo("bool"));case"||":if(Yv(r)&&Yv(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e||t[n]?1:0);return new Vv(i,n.typeInfo)}if(Yv(r)){const e=s,t=r.map((t,n)=>t||e?1:0);return new Vv(t,n.typeInfo)}if(Yv(s)){const e=r,t=s.map((t,n)=>e||t?1:0);return new Vv(t,i.typeInfo)}return new zv(r||s?1:0,this.getTypeInfo("bool"))}return null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):null;for(let r=0;r<i.node.args.length;++r){const t=i.node.args[r],s=this.evalExpression(e.args[r],n);n.createVariable(t.name,s,t)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let t=0;t<n.node.args.length;++t){const r=n.node.args[t],s=this.evalExpression(e.args[t],i);i.setVariable(r.name,s,r)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new zv(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=m_[i];if(void 0===r)return null;const s=[];if(e instanceof xv)if(e.isVector){const t=e.vectorValue;for(const e of t)s.push(e)}else s.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);if(e instanceof Vv){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];s.push(n)}}else if(e instanceof zv){let t=e.value;s.push(t)}}if(e.type instanceof fv&&null===e.type.format&&(e.type.format=fv.f32),0===s.length){const i=new Array(r).fill(0);return new Vv(i,n).getSubData(this,e.postfix,t)}if(1===s.length)for(;s.length<r;)s.push(s[0]);return s.length<r?null:new Vv(s.length>r?s.slice(0,r):s,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=y_[i];if(void 0===r)return null;const s=[];if(e instanceof xv)if(e.isVector){const t=e.vectorValue;for(const e of t)s.push(e)}else s.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);e instanceof Vv?s.push(...e.data):e instanceof zv?s.push(e.value):e instanceof Hv&&s.push(...e.data)}if(n instanceof uy&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===s.length){const i=new Array(r[2]).fill(0);return new Hv(i,n).getSubData(this,e.postfix,t)}return s.length!==r[2]?null:new Hv(s,n).getSubData(this,e.postfix,t)}}v_._breakObj=new Dv(new sy("BREAK",null),null),v_._continueObj=new Dv(new sy("CONTINUE",null),null),v_._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class __{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class b_{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new __,this._exec=new v_,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const e of this._deferArrayCountEval){const t=e.arrayType,i=e.countNode;if(i instanceof Ev){const e=i.name,r=this._context.constants.get(e);if(r)try{const e=r.constEvaluate(this._exec);t.count=e}catch(n){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(e=>{e instanceof Nv||e instanceof pv?e.type=this._forwardType(e.type):e instanceof gv?e.format=this._forwardType(e.format):e instanceof Vy||e instanceof jy||e instanceof Wy?e.type=this._forwardType(e.type):e instanceof Dy?e.returnType=this._forwardType(e.returnType):e instanceof Lv&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof hv){const t=this._getType(e.name);if(t)return t}else e instanceof pv?e.type=this._forwardType(e.type):e instanceof gv&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new Kv(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Xv.eof}_match(e){if(e instanceof $v)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const t of e){if(n===t)return!0;t===Xv.tokens.name&&(i=!0)}if(i){const e=Xv.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Xv.tokens.name){const e=Xv.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Xv.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Xv.keywords.alias)){const e=this._type_alias();return this._consume(Xv.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Xv.keywords.diagnostic)){const e=this._diagnostic();return this._consume(Xv.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Xv.keywords.requires)){const e=this._requires_directive();return this._consume(Xv.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Xv.keywords.enable)){const e=this._enable_directive();return this._consume(Xv.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(Xv.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(Xv.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Xv.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(Xv.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Xv.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(Xv.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Xv.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(Xv.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Xv.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Xv.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Xv.keywords.fn))return null;const e=this._currentLine,t=this._consume(Xv.tokens.ident,"Expected function name.").toString();this._consume(Xv.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Xv.tokens.paren_right))do{if(this._check(Xv.tokens.paren_right))break;const e=this._attribute(),t=this._consume(Xv.tokens.name,"Expected argument name.").toString();this._consume(Xv.tokens.colon,"Expected ':' for argument type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i,n.push(this._updateNode(new Lv(t,r,e))))}while(this._match(Xv.tokens.comma));this._consume(Xv.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Xv.tokens.arrow)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}const r=this._compound_statement(),s=this._currentLine;return this._updateNode(new Dy(t,n,i,r,e,s),e)}_compound_statement(){const e=[];for(this._consume(Xv.tokens.brace_left,"Expected '{' for block.");!this._check(Xv.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(Xv.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Xv.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Xv.tokens.attr)&&this._attribute(),this._check(Xv.keywords.if))return this._if_statement();if(this._check(Xv.keywords.switch))return this._switch_statement();if(this._check(Xv.keywords.loop))return this._loop_statement();if(this._check(Xv.keywords.for))return this._for_statement();if(this._check(Xv.keywords.while))return this._while_statement();if(this._check(Xv.keywords.continuing))return this._continuing_statement();if(this._check(Xv.keywords.static_assert))return this._static_assert_statement();if(this._check(Xv.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Xv.keywords.return))e=this._return_statement();else if(this._check([Xv.keywords.var,Xv.keywords.let,Xv.keywords.const]))e=this._variable_statement();else if(this._match(Xv.keywords.discard))e=this._updateNode(new av);else if(this._match(Xv.keywords.break)){const t=this._updateNode(new lv);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(Xv.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Xv.keywords.continue)){const t=this._updateNode(new cv);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(Xv.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Xv.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Fy(t),e)}_while_statement(){if(!this._match(Xv.keywords.while))return null;const e=this._updateNode(new Uy(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Xv.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Xv.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new zy(n,e),t)}_for_statement(){if(!this._match(Xv.keywords.for))return null;this._consume(Xv.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Gy(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Xv.tokens.semicolon)?null:this._for_init(),this._consume(Xv.tokens.semicolon,"Expected ';'."),e.condition=this._check(Xv.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Xv.tokens.semicolon,"Expected ';'."),e.increment=this._check(Xv.tokens.paren_right)?null:this._for_increment(),this._consume(Xv.tokens.paren_right,"Expected ')'."),this._check(Xv.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Xv.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Xv.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Vy(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Xv.keywords.let)){const e=this._currentLine,t=this._consume(Xv.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Xv.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Xv.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new jy(t,n,null,null,i),e)}if(this._match(Xv.keywords.const)){const e=this._currentLine,t=this._consume(Xv.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Xv.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Xv.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return null===n&&i instanceof xv&&(n=i.type),this._updateNode(new Wy(t,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(Xv.increment_operators))return this._current=e,null;const n=this._consume(Xv.increment_operators,"Expected increment operator");return this._updateNode(new Yy(n.type===Xv.tokens.plus_plus?$y.increment:$y.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Xv.tokens.brace_right))return null;let n=this._match(Xv.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const i=this._consume(Xv.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new Jy(Xy.parse(i.lexeme),e,r),t)}_func_call_statement(){if(!this._check(Xv.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(Xv.tokens.ident,"Expected function name."),i=this._argument_expression_list();return null===i?(this._current=t,null):this._updateNode(new Zy(n.lexeme,i),e)}_loop_statement(){if(!this._match(Xv.keywords.loop))return null;this._check(Xv.tokens.attr)&&this._attribute(),this._consume(Xv.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Qy([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof zy){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Xv.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Xv.keywords.switch))return null;const e=this._updateNode(new ev(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Xv.tokens.attr)&&this._attribute(),this._consume(Xv.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Xv.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Xv.keywords.default,Xv.keywords.case]);){if(this._match(Xv.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof Rv){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Xv.tokens.colon),this._check(Xv.tokens.attr)&&this._attribute(),this._consume(Xv.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(Xv.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Pv(n,i)))}if(this._match(Xv.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Xv.tokens.colon),this._check(Xv.tokens.attr)&&this._attribute(),this._consume(Xv.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Xv.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Mv(n)))}}return e}_case_selectors(){const e=[];for(this._match(Xv.keywords.default)?e.push(this._updateNode(new Rv)):e.push(this._shift_expression());this._match(Xv.tokens.comma);)this._match(Xv.keywords.default)?e.push(this._updateNode(new Rv)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Xv.keywords.fallthrough))return this._consume(Xv.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(Xv.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Xv.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(Xv.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let r=null;return this._match(Xv.keywords.else)&&(this._check(Xv.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new tv(t,n,i,r),e)}_match_elseif(){return this._tokens[this._current].type===Xv.keywords.else&&this._tokens[this._current+1].type===Xv.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new Bv(t,n))),this._match_elseif()&&(this._check(Xv.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Xv.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new nv(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Xv.tokens.or_or);)e=this._updateNode(new Iv(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Xv.tokens.and_and);)e=this._updateNode(new Iv(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Xv.tokens.or);)e=this._updateNode(new Iv(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Xv.tokens.xor);)e=this._updateNode(new Iv(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Xv.tokens.and);)e=this._updateNode(new Iv(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Xv.tokens.equal_equal,Xv.tokens.not_equal])?this._updateNode(new Iv(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Xv.tokens.less_than,Xv.tokens.greater_than,Xv.tokens.less_than_equal,Xv.tokens.greater_than_equal]);)e=this._updateNode(new Iv(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Xv.tokens.shift_left,Xv.tokens.shift_right]);)e=this._updateNode(new Iv(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Xv.tokens.plus,Xv.tokens.minus]);)e=this._updateNode(new Iv(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Xv.tokens.star,Xv.tokens.forward_slash,Xv.tokens.modulo]);)e=this._updateNode(new Iv(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Xv.tokens.minus,Xv.tokens.bang,Xv.tokens.tilde,Xv.tokens.star,Xv.tokens.and])?this._updateNode(new Cv(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Xv.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Xv.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Sv(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Xv.tokens.period)){const e=this._consume(Xv.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new vv(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return uv.void;case"bool":return uv.bool;case"i32":return uv.i32;case"u32":return uv.u32;case"f32":return uv.f32;case"f16":return uv.f16;case"vec2f":return fv.vec2f;case"vec3f":return fv.vec3f;case"vec4f":return fv.vec4f;case"vec2i":return fv.vec2i;case"vec3i":return fv.vec3i;case"vec4i":return fv.vec4i;case"vec2u":return fv.vec2u;case"vec3u":return fv.vec3u;case"vec4u":return fv.vec4u;case"vec2h":return fv.vec2h;case"vec3h":return fv.vec3h;case"vec4h":return fv.vec4h;case"mat2x2f":return fv.mat2x2f;case"mat2x3f":return fv.mat2x3f;case"mat2x4f":return fv.mat2x4f;case"mat3x2f":return fv.mat3x2f;case"mat3x3f":return fv.mat3x3f;case"mat3x4f":return fv.mat3x4f;case"mat4x2f":return fv.mat4x2f;case"mat4x3f":return fv.mat4x3f;case"mat4x4f":return fv.mat4x4f;case"mat2x2h":return fv.mat2x2h;case"mat2x3h":return fv.mat2x3h;case"mat2x4h":return fv.mat2x4h;case"mat3x2h":return fv.mat3x2h;case"mat3x3h":return fv.mat3x3h;case"mat3x4h":return fv.mat3x4h;case"mat4x2h":return fv.mat4x2h;case"mat4x3h":return fv.mat4x3h;case"mat4x4h":return fv.mat4x4h;case"mat2x2i":return fv.mat2x2i;case"mat2x3i":return fv.mat2x3i;case"mat2x4i":return fv.mat2x4i;case"mat3x2i":return fv.mat3x2i;case"mat3x3i":return fv.mat3x3i;case"mat3x4i":return fv.mat3x4i;case"mat4x2i":return fv.mat4x2i;case"mat4x3i":return fv.mat4x3i;case"mat4x4i":return fv.mat4x4i;case"mat2x2u":return fv.mat2x2u;case"mat2x3u":return fv.mat2x3u;case"mat2x4u":return fv.mat2x4u;case"mat3x2u":return fv.mat3x2u;case"mat3x3u":return fv.mat3x3u;case"mat3x4u":return fv.mat3x4u;case"mat4x2u":return fv.mat4x2u;case"mat4x3u":return fv.mat4x3u;case"mat4x4u":return fv.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Xv.tokens.ident)){const e=this._previous().toString();if(this._check(Xv.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new _v(n,t)):this._updateNode(new bv(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new wv(e,t.value))}return this._updateNode(new Ev(e))}if(this._match(Xv.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?uv.i32:e.endsWith("u")||e.endsWith("U")?uv.u32:uv.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new xv(new zv(n,this._exec.getTypeInfo(t)),t))}if(this._match(Xv.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,uv.u32),this._updateNode(new xv(new zv(e,this._exec.getTypeInfo(uv.u32)),uv.u32))}if(this._match([Xv.tokens.decimal_float_literal,Xv.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?uv.f16:uv.f32);const i=t?uv.f16:uv.f32;return this._updateNode(new xv(new zv(n,this._exec.getTypeInfo(i)),i))}if(this._match([Xv.keywords.true,Xv.keywords.false])){let e=this._previous().toString()===Xv.keywords.true.rule;return this._updateNode(new xv(new zv(e?1:0,this._exec.getTypeInfo(uv.bool)),uv.bool))}if(this._check(Xv.tokens.paren_left))return this._paren_expression();if(this._match(Xv.keywords.bitcast)){this._consume(Xv.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(Xv.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new Av(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new _v(e,t))}_argument_expression_list(){if(!this._match(Xv.tokens.paren_left))return null;const e=[];do{if(this._check(Xv.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Xv.tokens.comma));return this._consume(Xv.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Xv.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Xv.tokens.paren_right),e}_paren_expression(){this._consume(Xv.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Xv.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Xv.keywords.struct))return null;const e=this._currentLine,t=this._consume(Xv.tokens.ident,"Expected name for struct.").toString();this._consume(Xv.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Xv.tokens.brace_right);){const e=this._attribute(),t=this._consume(Xv.tokens.name,"Expected variable name.").toString();this._consume(Xv.tokens.colon,"Expected ':' for struct member type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i),this._check(Xv.tokens.brace_right)?this._match(Xv.tokens.comma):this._consume(Xv.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new Nv(t,r,e)))}this._consume(Xv.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,r=this._updateNode(new dv(t,n,e,i),e);return this._context.structs.set(t,r),r}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Xv.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof xv){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof xv&&(e.type="x32"===e.value.type.name?uv.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Xv.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Xv.keywords.const))return null;const t=this._consume(Xv.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(Xv.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}let r=null;this._consume(Xv.tokens.equal,"const declarations require an assignment");const s=this._short_circuit_or_expression();try{let e=[uv.f32],n=s.constEvaluate(this._exec,e);n instanceof zv&&this._validateTypeRange(n.value,e[0]),e[0]instanceof fv&&null===e[0].format&&n.typeInfo instanceof uy&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=uv.f16:"f32"===n.typeInfo.format.name?e[0].format=uv.f32:"i32"===n.typeInfo.format.name?e[0].format=uv.i32:"u32"===n.typeInfo.format.name?e[0].format=uv.u32:"bool"===n.typeInfo.format.name&&(e[0].format=uv.bool)),r=this._updateNode(new xv(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch(a){r=s}if(null!==i&&r instanceof xv){if("x32"!==r.type.name&&i.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${i.name}. Line:${this._currentLine}`);r.type=i,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else null===i&&r instanceof xv&&(i=null!==(e=null==r?void 0:r.type)&&void 0!==e?e:uv.f32,i===uv.x32&&(i=uv.i32));const o=this._updateNode(new Wy(t.toString(),i,"","",r),n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(Xv.keywords.let))return null;const e=this._currentLine,t=this._consume(Xv.tokens.name,"Expected variable name");let n=null;if(this._match(Xv.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let i=null;if(this._match(Xv.tokens.equal)&&(i=this._const_expression()),null!==n&&i instanceof xv){if("x32"!==i.type.name&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else null===n&&i instanceof xv&&(n="x32"===i.type.name?uv.i32:i.type);return i instanceof xv&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new jy(t.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Xv.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(Xv.tokens.less_than)&&(t=this._consume(Xv.storage_class,"Expected storage_class.").toString(),this._match(Xv.tokens.comma)&&(n=this._consume(Xv.access_mode,"Expected access_mode.").toString()),this._consume(Xv.tokens.greater_than,"Expected '>'."));const i=this._consume(Xv.tokens.name,"Expected variable name");let r=null;if(this._match(Xv.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}return this._updateNode(new Vy(i.toString(),r,t,n,null),e)}_override_decl(){if(!this._match(Xv.keywords.override))return null;const e=this._consume(Xv.tokens.name,"Expected variable name");let t=null;if(this._match(Xv.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new Hy(e.toString(),t,null))}_diagnostic(){this._consume(Xv.tokens.paren_left,"Expected '('");const e=this._consume(Xv.tokens.ident,"Expected severity control name.");this._consume(Xv.tokens.comma,"Expected ','");let t=this._consume(Xv.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Xv.tokens.period)&&(t+=`.${this._consume(Xv.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Xv.tokens.paren_right,"Expected ')'"),this._updateNode(new sv(e.toString(),t))}_enable_directive(){const e=this._consume(Xv.tokens.ident,"identity expected.");return this._updateNode(new iv(e.toString()))}_requires_directive(){const e=[this._consume(Xv.tokens.ident,"identity expected.").toString()];for(;this._match(Xv.tokens.comma);){const t=this._consume(Xv.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new rv(e))}_type_alias(){const e=this._consume(Xv.tokens.ident,"identity expected.");this._consume(Xv.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new ov(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Xv.tokens.ident,...Xv.texel_format,Xv.keywords.bool,Xv.keywords.f32,Xv.keywords.i32,Xv.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new hv(e));return this._forwardTypeCount++,t}return this._updateNode(new uv(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Xv.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(Xv.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(Xv.tokens.comma)&&(n=this._consume(Xv.access_mode,"Expected access_mode for pointer").toString()),this._consume(Xv.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new fv(e,t,n))}if(this._match(Xv.keywords.ptr)){let e=this._previous().toString();this._consume(Xv.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(Xv.storage_class,"Expected storage_class for pointer");this._consume(Xv.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let i=null;return this._match(Xv.tokens.comma)&&(i=this._consume(Xv.access_mode,"Expected access_mode for pointer").toString()),this._consume(Xv.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new pv(e,t.toString(),n,i))}const t=this._attribute();if(this._match(Xv.keywords.array)){let e=null,i=-1;const r=this._previous();let s=null;if(this._match(Xv.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(Xv.tokens.comma)){s=this._shift_expression();try{t=s.constEvaluate(this._exec).toString(),s=null}catch(n){t="1"}}this._consume(Xv.tokens.greater_than,"Expected '>' for array."),i=t?parseInt(t):0}const o=this._updateNode(new gv(r.toString(),t,e,i));return s&&this._deferArrayCountEval.push({arrayType:o,countNode:s}),o}return null}_texture_sampler_types(){if(this._match(Xv.sampler_type))return this._updateNode(new mv(this._previous().toString(),null,null));if(this._match(Xv.depth_texture_type))return this._updateNode(new mv(this._previous().toString(),null,null));if(this._match(Xv.sampled_texture_type)||this._match(Xv.multisampled_texture_type)){const e=this._previous();this._consume(Xv.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Xv.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new mv(e.toString(),t,null))}if(this._match(Xv.storage_texture_type)){const e=this._previous();this._consume(Xv.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Xv.texel_format,"Invalid texel format.").toString();this._consume(Xv.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Xv.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Xv.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new mv(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(Xv.tokens.attr);){const t=this._consume(Xv.attribute_name,"Expected attribute name"),n=this._updateNode(new Ov(t.toString(),null));if(this._match(Xv.tokens.paren_left)){if(n.value=this._consume(Xv.literal_or_ident,"Expected attribute value").toString(),this._check(Xv.tokens.comma)){this._advance();do{const e=this._consume(Xv.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(Xv.tokens.comma))}this._consume(Xv.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class E_ extends c_{constructor(e){super(),e&&this.update(e)}update(e){const t=(new b_).parse(e);this.updateAST(t)}}function w_(e){var t;const n={attributes:[],bindings:[]};let i;try{i=function(e){try{return new E_(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&(null==t?void 0:t.message)&&(e+=`: ${t.message} `),"object"==typeof t&&(null==t?void 0:t.token)&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e)}catch(o){return Sg.error(o.message)(),n}for(const a of i.uniforms){const e=[];for(const n of(null==(t=a.type)?void 0:t.members)||[])e.push({name:n.name,type:x_(n.type)});n.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:e})}for(const a of i.textures)n.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of i.samplers)n.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const r=i.entry.vertex[0],s=(null==r?void 0:r.inputs.length)||0;for(let a=0;a<s;a++){const e=r.inputs[a];if("location"===e.locationType){const t=x_(e.type);n.attributes.push({name:e.name,location:Number(e.location),type:t})}}return n}function x_(e){return(null==e?void 0:e.format)?`${e.name}<${e.format.name}>`:e.name}const A_=1/Math.PI*180,S_=1/180*Math.PI;globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const T_=globalThis.mathgl.config;function C_(e,{precision:t=T_.precision}={}){return e=function(e){return Math.round(e/T_.EPSILON)*T_.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function I_(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function k_(e){return function(e,t){return N_(e,e=>e*S_,t)}(e)}function R_(e){return P_(e)}function P_(e,t){return N_(e,e=>e*A_,t)}function M_(e,t,n){return N_(e,e=>Math.max(t,Math.min(n,e)))}function L_(e,t,n){return I_(e)?e.map((e,i)=>L_(e,t[i],n)):n*t+(1-n)*e}function B_(e,t,n){const i=T_.EPSILON;n&&(T_.EPSILON=n);try{if(e===t)return!0;if(I_(e)&&I_(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!B_(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=T_.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{T_.EPSILON=i}}function N_(e,t,n){if(I_(e)){const i=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(i);for(let r=0;r<n.length&&r<i.length;++r){const i="number"==typeof e?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}class O_ extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:I_(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(T_)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+C_(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!B_(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const r=e[i],s="number"==typeof t?t:t[i];this[i]=r+n*(s-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(T_.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function D_(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function F_(e,t,n=""){if(T_.debug&&!function(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}function U_(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class z_ extends O_{get x(){return this[0]}set x(e){this[0]=D_(e)}get y(){return this[1]}set y(e){this[1]=D_(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return D_(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return D_(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return U_(e>=0&&e<this.ELEMENTS,"index is out of range"),D_(this[e])}setComponent(e,t){return U_(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const G_=1e-6;let V_="undefined"!=typeof Float32Array?Float32Array:Array;function H_(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function j_(e,t,n,i){const r=t[0],s=t[1];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e}function W_(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e}function $_(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}function X_(e,t,n){const i=t[0],r=t[1],s=n[3]*i+n[7]*r||1;return e[0]=(n[0]*i+n[4]*r)/s,e[1]=(n[1]*i+n[5]*r)/s,e}function q_(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[3]*i+n[7]*r+n[11]*s||1;return e[0]=(n[0]*i+n[4]*r+n[8]*s)/o,e[1]=(n[1]*i+n[5]*r+n[9]*s)/o,e[2]=(n[2]*i+n[6]*r+n[10]*s)/o,e}function K_(e,t,n){const i=t[0],r=t[1],s=t[2];return e[0]=n[0]*i+n[3]*r+n[6]*s,e[1]=n[1]*i+n[4]*r+n[7]*s,e[2]=n[2]*i+n[5]*r+n[8]*s,e[3]=t[3],e}!function(){const e=function(){const e=new V_(2);return V_!=Float32Array&&(e[0]=0,e[1]=0),e}()}();class Y_ extends z_{constructor(e=0,t=0){super(2),I_(e)&&1===arguments.length?this.copy(e):(T_.debug&&(D_(e),D_(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return T_.debug&&(D_(e.x),D_(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return $_(this,this,e),this.check()}transformAsVector(e){return X_(this,this,e),this.check()}transformByMatrix3(e){return W_(this,this,e),this.check()}transformByMatrix2x3(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5]}(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r}(this,this,e),this.check()}}function J_(){const e=new V_(3);return V_!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Z_(e){const t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function Q_(e,t,n){const i=new V_(3);return i[0]=e,i[1]=t,i[2]=n,i}function eb(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function tb(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2];return e[0]=r*l-s*a,e[1]=s*o-i*l,e[2]=i*a-r*o,e}function nb(e,t,n){const i=t[0],r=t[1],s=t[2];let o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,e[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,e[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,e}function ib(e,t,n){const i=t[0],r=t[1],s=t[2];return e[0]=i*n[0]+r*n[3]+s*n[6],e[1]=i*n[1]+r*n[4]+s*n[7],e[2]=i*n[2]+r*n[5]+s*n[8],e}function rb(e,t,n){const i=n[0],r=n[1],s=n[2],o=n[3],a=t[0],l=t[1],c=t[2];let u=r*c-s*l,h=s*a-i*c,d=i*l-r*a,f=r*d-s*h,p=s*u-i*d,g=i*h-r*u;const m=2*o;return u*=m,h*=m,d*=m,f*=2,p*=2,g*=2,e[0]=a+u+f,e[1]=l+h+p,e[2]=c+d+g,e}const sb=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},ob=Z_,ab=function(e){const t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i};!function(){const e=J_()}();const lb=[0,0,0];let cb,ub;class hb extends z_{static get ZERO(){return cb||(cb=new hb(0,0,0),Object.freeze(cb)),cb}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&I_(e)?this.copy(e):(T_.debug&&(D_(e),D_(t),D_(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return T_.debug&&(D_(e.x),D_(e.y),D_(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=D_(e)}angle(e){return function(e,t){const n=e[0],i=e[1],r=e[2],s=t[0],o=t[1],a=t[2],l=Math.sqrt((n*n+i*i+r*r)*(s*s+o*o+a*a)),c=l&&eb(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}cross(e){return tb(this,this,e),this.check()}rotateX({radians:e,origin:t=lb}){return function(e,t,n,i){const r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=lb}){return function(e,t,n,i){const r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=lb}){return function(e,t,n,i){const r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return nb(this,this,e),this.check()}transformAsVector(e){return q_(this,this,e),this.check()}transformByMatrix3(e){return ib(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return rb(this,this,e),this.check()}}class db extends z_{static get ZERO(){return ub||(ub=new db(0,0,0,0),Object.freeze(ub)),ub}constructor(e=0,t=0,n=0,i=0){super(-0,-0,-0,-0),I_(e)&&1===arguments.length?this.copy(e):(T_.debug&&(D_(e),D_(t),D_(n),D_(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return T_.debug&&(D_(e.x),D_(e.y),D_(e.z),D_(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=D_(e)}get w(){return this[3]}set w(e){this[3]=D_(e)}transform(e){return nb(this,this,e),this.check()}transformByMatrix3(e){return K_(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2],e[3]=t[3]}(this,this,e),this.check()}transformByQuaternion(e){return rb(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class fb extends O_{toString(){let e="[";if(T_.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=D_(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function pb(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],f=n[1],p=n[2],g=n[3],m=n[4],y=n[5],v=n[6],_=n[7],b=n[8];return e[0]=d*i+f*o+p*c,e[1]=d*r+f*a+p*u,e[2]=d*s+f*l+p*h,e[3]=g*i+m*o+y*c,e[4]=g*r+m*a+y*u,e[5]=g*s+m*l+y*h,e[6]=v*i+_*o+b*c,e[7]=v*r+_*a+b*u,e[8]=v*s+_*l+b*h,e}function gb(e,t,n){const i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}var mb,yb;(yb=mb||(mb={}))[yb.COL0ROW0=0]="COL0ROW0",yb[yb.COL0ROW1=1]="COL0ROW1",yb[yb.COL0ROW2=2]="COL0ROW2",yb[yb.COL1ROW0=3]="COL1ROW0",yb[yb.COL1ROW1=4]="COL1ROW1",yb[yb.COL1ROW2=5]="COL1ROW2",yb[yb.COL2ROW0=6]="COL2ROW0",yb[yb.COL2ROW1=7]="COL2ROW1",yb[yb.COL2ROW2=8]="COL2ROW2";const vb=Object.freeze([1,0,0,0,1,0,0,0,1]);class _b extends fb{static get IDENTITY(){return function(){Eb||(Eb=new _b,Object.freeze(Eb));return Eb}()}static get ZERO(){return function(){bb||(bb=new _b([0,0,0,0,0,0,0,0,0]),Object.freeze(bb));return bb}()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return mb}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(vb)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,d=r*o,f=r*a,p=r*l,g=s*o,m=s*a,y=s*l;e[0]=1-h-p,e[3]=u-y,e[6]=d+m,e[1]=u+y,e[4]=1-c-p,e[7]=f-g,e[2]=d-m,e[5]=f+g,e[8]=1-c-h}(this,e),this.check()}set(e,t,n,i,r,s,o,a,l){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this.check()}setRowMajor(e,t,n,i,r,s,o,a,l){return this[0]=e,this[1]=i,this[2]=o,this[3]=t,this[4]=r,this[5]=a,this[6]=n,this[7]=s,this[8]=l,this.check()}determinant(){return function(e){const t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}(this)}transpose(){return function(e,t){if(e===t){const n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){return function(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*o-a*c,d=-u*s+a*l,f=c*s-o*l;let p=n*h+i*d+r*f;p&&(p=1/p,e[0]=h*p,e[1]=(-u*i+r*c)*p,e[2]=(a*i-r*o)*p,e[3]=d*p,e[4]=(u*n-r*l)*p,e[5]=(-a*n+r*s)*p,e[6]=f*p,e[7]=(-c*n+i*l)*p,e[8]=(o*n-i*s)*p)}(this,this),this.check()}multiplyLeft(e){return pb(this,e,this),this.check()}multiplyRight(e){return pb(this,this,e),this.check()}rotate(e){return function(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),f=Math.cos(n);e[0]=f*i+d*o,e[1]=f*r+d*a,e[2]=f*s+d*l,e[3]=f*o-d*i,e[4]=f*a-d*r,e[5]=f*l-d*s,e[6]=c,e[7]=u,e[8]=h}(this,this,e),this.check()}scale(e){return Array.isArray(e)?gb(this,this,e):gb(this,this,[e,e]),this.check()}translate(e){return function(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],f=n[1];e[0]=i,e[1]=r,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=d*i+f*o+c,e[7]=d*r+f*a+u,e[8]=d*s+f*l+h}(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=W_(t||[-0,-0],e,this);break;case 3:n=ib(t||[-0,-0,-0],e,this);break;case 4:n=K_(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return F_(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let bb,Eb=null;function wb(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],y=t[15],v=n*a-i*o,_=n*l-r*o,b=n*c-s*o,E=i*l-r*a,w=i*c-s*a,x=r*c-s*l,A=u*g-h*p,S=u*m-d*p,T=u*y-f*p,C=h*m-d*g,I=h*y-f*g,k=d*y-f*m;let R=v*k-_*I+b*C+E*T-w*S+x*A;return R?(R=1/R,e[0]=(a*k-l*I+c*C)*R,e[1]=(r*I-i*k-s*C)*R,e[2]=(g*x-m*w+y*E)*R,e[3]=(d*w-h*x-f*E)*R,e[4]=(l*T-o*k-c*S)*R,e[5]=(n*k-r*T+s*S)*R,e[6]=(m*b-p*x-y*_)*R,e[7]=(u*x-d*b+f*_)*R,e[8]=(o*I-a*T+c*A)*R,e[9]=(i*T-n*I-s*A)*R,e[10]=(p*w-g*b+y*v)*R,e[11]=(h*b-u*w-f*v)*R,e[12]=(a*S-o*C-l*A)*R,e[13]=(n*C-i*S+r*A)*R,e[14]=(g*_-p*E-m*v)*R,e[15]=(u*E-h*_+d*v)*R,e):null}function xb(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],y=t[14],v=t[15];let _=n[0],b=n[1],E=n[2],w=n[3];return e[0]=_*i+b*a+E*h+w*g,e[1]=_*r+b*l+E*d+w*m,e[2]=_*s+b*c+E*f+w*y,e[3]=_*o+b*u+E*p+w*v,_=n[4],b=n[5],E=n[6],w=n[7],e[4]=_*i+b*a+E*h+w*g,e[5]=_*r+b*l+E*d+w*m,e[6]=_*s+b*c+E*f+w*y,e[7]=_*o+b*u+E*p+w*v,_=n[8],b=n[9],E=n[10],w=n[11],e[8]=_*i+b*a+E*h+w*g,e[9]=_*r+b*l+E*d+w*m,e[10]=_*s+b*c+E*f+w*y,e[11]=_*o+b*u+E*p+w*v,_=n[12],b=n[13],E=n[14],w=n[15],e[12]=_*i+b*a+E*h+w*g,e[13]=_*r+b*l+E*d+w*m,e[14]=_*s+b*c+E*f+w*y,e[15]=_*o+b*u+E*p+w*v,e}function Ab(e,t,n){const i=n[0],r=n[1],s=n[2];let o,a,l,c,u,h,d,f,p,g,m,y;return t===e?(e[12]=t[0]*i+t[4]*r+t[8]*s+t[12],e[13]=t[1]*i+t[5]*r+t[9]*s+t[13],e[14]=t[2]*i+t[6]*r+t[10]*s+t[14],e[15]=t[3]*i+t[7]*r+t[11]*s+t[15]):(o=t[0],a=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],f=t[7],p=t[8],g=t[9],m=t[10],y=t[11],e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=f,e[8]=p,e[9]=g,e[10]=m,e[11]=y,e[12]=o*i+u*r+p*s+t[12],e[13]=a*i+h*r+g*s+t[13],e[14]=l*i+d*r+m*s+t[14],e[15]=c*i+f*r+y*s+t[15]),e}function Sb(e,t,n){const i=n[0],r=n[1],s=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Tb(e,t,n){const i=Math.sin(n),r=Math.cos(n),s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+c*i,e[5]=o*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-s*i,e[9]=u*r-o*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e}function Cb(e,t,n){const i=Math.sin(n),r=Math.cos(n),s=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+c*i,e[1]=o*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-s*i,e[5]=u*r-o*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e}const Ib=function(e,t,n,i,r){const s=1/Math.tan(t/2);if(e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){const t=1/(i-r);e[10]=(r+i)*t,e[14]=2*r*i*t}else e[10]=-1,e[14]=-2*i;return e};const kb=function(e,t,n,i,r,s,o){const a=1/(t-n),l=1/(i-r),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(o+s)*c,e[15]=1,e};function Rb(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Pb(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,e[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,e[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,e[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,e}var Mb;!function(){const e=function(){const e=new V_(4);return V_!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}(),function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(Mb||(Mb={}));const Lb=45*Math.PI/180,Bb=1,Nb=.1,Ob=500,Db=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Fb extends fb{static get IDENTITY(){return function(){zb||(zb=new Fb,Object.freeze(zb));return zb}()}static get ZERO(){return function(){Ub||(Ub=new Fb([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ub));return Ub}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Mb}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,r,s,o,a,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=g,this.check()}setRowMajor(e,t,n,i,r,s,o,a,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=t,this[5]=s,this[6]=c,this[7]=f,this[8]=n,this[9]=o,this[10]=u,this[11]=p,this[12]=i,this[13]=a,this[14]=h,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Db)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,d=r*o,f=r*a,p=r*l,g=s*o,m=s*a,y=s*l;e[0]=1-h-p,e[1]=u+y,e[2]=d-m,e[3]=0,e[4]=u-y,e[5]=1-c-p,e[6]=f+g,e[7]=0,e[8]=d+m,e[9]=f-g,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:r,near:s=Nb,far:o=Ob}=e;return o===1/0?function(e,t,n,i,r,s){const o=2*s/(n-t),a=2*s/(r-i),l=(n+t)/(n-t),c=(r+i)/(r-i),u=-1,h=-1,d=-2*s;e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=u,e[11]=h,e[12]=0,e[13]=0,e[14]=d,e[15]=0}(this,t,n,i,r,s):function(e,t,n,i,r,s,o){const a=1/(n-t),l=1/(r-i),c=1/(s-o);e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(o+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*c,e[15]=0}(this,t,n,i,r,s,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return function(e,t,n,i){let r,s,o,a,l,c,u,h,d,f;const p=t[0],g=t[1],m=t[2],y=i[0],v=i[1],_=i[2],b=n[0],E=n[1],w=n[2];Math.abs(p-b)<G_&&Math.abs(g-E)<G_&&Math.abs(m-w)<G_?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(h=p-b,d=g-E,f=m-w,r=1/Math.sqrt(h*h+d*d+f*f),h*=r,d*=r,f*=r,s=v*f-_*d,o=_*h-y*f,a=y*d-v*h,r=Math.sqrt(s*s+o*o+a*a),r?(r=1/r,s*=r,o*=r,a*=r):(s=0,o=0,a=0),l=d*a-f*o,c=f*s-h*a,u=h*o-d*s,r=Math.sqrt(l*l+c*c+u*u),r?(r=1/r,l*=r,c*=r,u*=r):(l=0,c=0,u=0),e[0]=s,e[1]=l,e[2]=h,e[3]=0,e[4]=o,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=u,e[10]=f,e[11]=0,e[12]=-(s*p+o*g+a*m),e[13]=-(l*p+c*g+u*m),e[14]=-(h*p+d*g+f*m),e[15]=1)}(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:r,near:s=Nb,far:o=Ob}=e;return kb(this,t,n,i,r,s,o),this.check()}orthographic(e){const{fovy:t=Lb,aspect:n=Bb,focalDistance:i=1,near:r=Nb,far:s=Ob}=e;Gb(t);const o=t/2,a=i*Math.tan(o),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:r,far:s})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}=e;return Gb(t),Ib(this,t,n,i,r),this.check()}determinant(){return function(e){const t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],g=e[14],m=t*o-n*s,y=t*a-i*s,v=n*a-i*o,_=c*p-u*f,b=c*g-h*f,E=u*g-h*p;return l*(t*E-n*b+i*_)-r*(s*E-o*b+a*_)+e[15]*(c*v-u*y+h*m)-d*(f*v-p*y+g*m)}(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*r,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*r,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*r,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*r,e[8]=this[10]*s,e}transpose(){return function(e,t){if(e===t){const n=t[1],i=t[2],r=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return wb(this,this),this.check()}multiplyLeft(e){return xb(this,e,this),this.check()}multiplyRight(e){return xb(this,this,e),this.check()}rotateX(e){return Tb(this,this,e),this.check()}rotateY(e){return function(e,t,n){const i=Math.sin(n),r=Math.cos(n),s=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-c*i,e[1]=o*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=s*i+c*r,e[9]=o*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r}(this,this,e),this.check()}rotateZ(e){return Cb(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,i){let r,s,o,a,l,c,u,h,d,f,p,g,m,y,v,_,b,E,w,x,A,S,T,C,I=i[0],k=i[1],R=i[2],P=Math.sqrt(I*I+k*k+R*R);P<G_||(P=1/P,I*=P,k*=P,R*=P,s=Math.sin(n),r=Math.cos(n),o=1-r,a=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],g=t[8],m=t[9],y=t[10],v=t[11],_=I*I*o+r,b=k*I*o+R*s,E=R*I*o-k*s,w=I*k*o-R*s,x=k*k*o+r,A=R*k*o+I*s,S=I*R*o+k*s,T=k*R*o-I*s,C=R*R*o+r,e[0]=a*_+h*b+g*E,e[1]=l*_+d*b+m*E,e[2]=c*_+f*b+y*E,e[3]=u*_+p*b+v*E,e[4]=a*w+h*x+g*A,e[5]=l*w+d*x+m*A,e[6]=c*w+f*x+y*A,e[7]=u*w+p*x+v*A,e[8]=a*S+h*T+g*C,e[9]=l*S+d*T+m*C,e[10]=c*S+f*T+y*C,e[11]=u*S+p*T+v*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return Sb(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Ab(this,this,e),this.check()}transform(e,t){return 4===e.length?(F_(t=Pb(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=$_(t||[-0,-0],e,this);break;case 3:i=nb(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return F_(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=X_(t||[-0,-0],e,this);break;case 3:n=q_(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return F_(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let Ub,zb;function Gb(e){if(e>2*Math.PI)throw Error("expected radians")}function Vb(){const e=new V_(4);return V_!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Hb(e,t,n){n*=.5;const i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function jb(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+o*a+r*c-s*l,e[1]=r*u+o*l+s*a-i*c,e[2]=s*u+o*c+i*l-r*a,e[3]=o*u-i*a-r*l-s*c,e}function Wb(e,t,n,i){const r=t[0],s=t[1],o=t[2],a=t[3];let l,c,u,h,d,f=n[0],p=n[1],g=n[2],m=n[3];return l=r*f+s*p+o*g+a*m,l<0&&(l=-l,f=-f,p=-p,g=-g,m=-m),1-l>G_?(c=Math.acos(l),d=Math.sin(c),u=Math.sin((1-i)*c)/d,h=Math.sin(i*c)/d):(u=1-i,h=i),e[0]=u*r+h*f,e[1]=u*s+h*p,e[2]=u*o+h*g,e[3]=u*a+h*m,e}function $b(e,t){const n=t[0]+t[4]+t[8];let i;if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const r=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*s+s]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*r+s]-t[3*s+r])*i,e[r]=(t[3*r+n]+t[3*n+r])*i,e[s]=(t[3*s+n]+t[3*n+s])*i}return e}const Xb=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},qb=Rb,Kb=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Yb=function(e,t,n,i){const r=t[0],s=t[1],o=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=o+i*(n[2]-o),e[3]=a+i*(n[3]-a),e},Jb=function(e){const t=e[0],n=e[1],i=e[2],r=e[3];return Math.sqrt(t*t+n*n+i*i+r*r)},Zb=function(e){const t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r},Qb=function(e,t){const n=t[0],i=t[1],r=t[2],s=t[3];let o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=s*o,e},eE=function(){const e=J_(),t=Q_(1,0,0),n=Q_(0,1,0);return function(i,r,s){const o=eb(r,s);return o<-.999999?(tb(e,t,r),ob(e)<1e-6&&tb(e,n,r),function(e,t){const n=t[0],i=t[1],r=t[2];let s=n*n+i*i+r*r;s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s}(e,e),Hb(i,e,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(tb(e,r,s),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+o,Qb(i,i))}}();!function(){const e=Vb(),t=Vb()}(),function(){const e=function(){const e=new V_(9);return V_!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}()}();const tE=[0,0,0,1];class nE extends O_{constructor(e=0,t=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&1===arguments.length?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return $b(this,e),this.check()}fromAxisRotation(e,t){return Hb(this,e,t),this.check()}identity(){var e;return(e=this)[0]=0,e[1]=0,e[2]=0,e[3]=1,this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=D_(e)}get y(){return this[1]}set y(e){this[1]=D_(e)}get z(){return this[2]}set z(e){this[2]=D_(e)}get w(){return this[3]}set w(e){this[3]=D_(e)}len(){return Jb(this)}lengthSquared(){return Zb(this)}dot(e){return Kb(this,e)}rotationTo(e,t){return eE(this,e,t),this.check()}add(e){return Xb(this,this,e),this.check()}calculateW(){return function(e,t){const n=t[0],i=t[1],r=t[2];e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r))}(this,this),this.check()}conjugate(){var e,t;return t=this,(e=this)[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],this.check()}invert(){return function(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=s*a}(this,this),this.check()}lerp(e,t,n){return void 0===n?this.lerp(this,e,t):(Yb(this,e,t,n),this.check())}multiplyRight(e){return jb(this,this,e),this.check()}multiplyLeft(e){return jb(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){return function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=s*l-r*a,e[3]=o*l-i*a}(this,this,e),this.check()}rotateY(e){return function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l-s*a,e[1]=r*l+o*a,e[2]=s*l+i*a,e[3]=o*l-r*a}(this,this,e),this.check()}rotateZ(e){return function(e,t,n){n*=.5;const i=t[0],r=t[1],s=t[2],o=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=s*l+o*a,e[3]=o*l-s*a}(this,this,e),this.check()}scale(e){return qb(this,this,e),this.check()}slerp(e,t,n){let i,r,s;switch(arguments.length){case 1:({start:i=tE,target:r,ratio:s}=e);break;case 2:i=this,r=e,s=t;break;default:i=e,r=t,s=n}return Wb(this,i,r,s),this.check()}transformVector4(e,t=new db){return function(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,h=c*r+l*i-o*s,d=c*s+o*r-a*i,f=-o*i-a*r-l*s;e[0]=u*c+f*-o+h*-l-d*-a,e[1]=h*c+f*-a+d*-o-u*-l,e[2]=d*c+f*-l+u*-a-h*-o,e[3]=t[3]}(t,e,this),F_(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}function iE(e,t=[],n=0){const i=Math.fround(e),r=e-i;return t[n]=i,t[n+1]=r,t}const rE={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n"},sE={name:"fp64arithmetic",vs:"\nuniform fp64arithmeticUniforms {\n  uniform float ONE;\n} fp64;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' form.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * fp64.ONE - (t - a);\n  float a_lo = a * fp64.ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * fp64.ONE;\n  float err = b - (sum - a) * fp64.ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *\n    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:iE,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=4*n+i;iE(e[4*i+n],t,2*r)}return t}},oE={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!bool(picking.isAttribute)) {\n      // Stores the picking color so that the fragment shader can render it during picking\n      picking_vRGBcolor_Avalid.rgb = pickingColor;\n    }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n",getUniforms:function(e={},t){const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,e=>e/255);Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute));void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors));return n}};const aE="precision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int lightType;\n\n  int directionalLightCount;\n  int pointLightCount;\n\n  vec3 ambientColor;\n\n  vec3 lightColor0;\n  vec3 lightPosition0;\n  vec3 lightDirection0;\n  vec3 lightAttenuation0;\n\n  vec3 lightColor1;\n  vec3 lightPosition1;\n  vec3 lightDirection1;\n  vec3 lightAttenuation1;\n\n  vec3 lightColor2;\n  vec3 lightPosition2;\n  vec3 lightDirection2;\n  vec3 lightAttenuation2;\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  switch (index) {\n    case 0:\n      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);\n    case 1:\n      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);\n    case 2:\n    default:  \n      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);\n  }\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  switch (index) {\n    case 0:\n      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);\n    case 1:\n      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);\n    case 2:\n    default:   \n      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);\n  }\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n";var lE,cE;(cE=lE||(lE={}))[cE.POINT=0]="POINT",cE[cE.DIRECTIONAL=1]="DIRECTIONAL";const uE={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:lE.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:"// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  color: vec3<f32>,\n};\n\nstruct PointLight {\n  color: vec3<f32>,\n  position: vec3<f32>,\n  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  color: vec3<f32>,\n  direction: vec3<f32>,\n};\n\nstruct lightingUniforms {\n  enabled: i32,\n  pointLightCount: i32,\n  directionalLightCount: i32,\n\n  ambientColor: vec3<f32>,\n\n  // TODO - support multiple lights by uncommenting arrays below\n  lightType: i32,\n  lightColor: vec3<f32>,\n  lightDirection: vec3<f32>,\n  lightPosition: vec3<f32>,\n  lightAttenuation: vec3<f32>,\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n};\n\n// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)\n@binding(1) @group(0) var<uniform> lighting : lightingUniforms;\n\nfn lighting_getPointLight(index: i32) -> PointLight {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nfn lighting_getDirectionalLight(index: i32) -> DirectionalLight {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n",vs:aE,fs:aE,getUniforms:function(e,t={}){if(!(e=e?{...e}:e))return{...uE.defaultUniforms};e.lights&&(e={...e,...dE(e.lights),lights:void 0});const{ambientLight:n,pointLights:i,directionalLights:r}=e||{};if(!(n||i&&i.length>0||r&&r.length>0))return{...uE.defaultUniforms,enabled:0};const s={...uE.defaultUniforms,...t,...hE({ambientLight:n,pointLights:i,directionalLights:r})};void 0!==e.enabled&&(s.enabled=e.enabled?1:0);return s}};function hE({ambientLight:e,pointLights:t=[],directionalLights:n=[]}){const i={};i.ambientColor=fE(e);let r=0;for(const s of t){i.lightType=lE.POINT;const e=r;i[`lightColor${e}`]=fE(s),i[`lightPosition${e}`]=s.position,i[`lightAttenuation${e}`]=s.attenuation||[1,0,0],r++}for(const s of n){i.lightType=lE.DIRECTIONAL;const e=r;i[`lightColor${e}`]=fE(s),i[`lightDirection${e}`]=s.direction,r++}return r>5&&Sg.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=n.length,i.pointLightCount=t.length,i}function dE(e){var t,n;const i={pointLights:[],directionalLights:[]};for(const r of e||[])switch(r.type){case"ambient":i.ambientLight=r;break;case"directional":null==(t=i.directionalLights)||t.push(r);break;case"point":null==(n=i.pointLights)||n.push(r)}return i}function fE(e={}){const{color:t=[0,0,0],intensity:n=1}=e;return t.map(e=>e*n/255)}const pE="uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n",gE="#define MAX_LIGHTS 3\n\nuniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  for (int i = 0; i < lighting.pointLightCount; i++) {\n    PointLight pointLight = lighting_getPointLight(i);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);\n  }\n\n  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);\n  for (int i = lighting.pointLightCount; i < totalLights; i++) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(i);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n}\n",mE="struct phongMaterialUniforms {\n  ambient: f32,\n  diffuse: f32,\n  shininess: f32,\n  specularColor: vec3<f32>,\n};\n\n@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;\n\nfn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {\n  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);\n  var lambertian: f32 = dot(light_direction, normal_worldspace);\n  var specular: f32 = 0.0;\n  if (lambertian > 0.0) {\n    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, phongMaterial.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;\n}\n\nfn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {\n  var lightColor: vec3<f32> = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);\n  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    let pointLight: PointLight  = lighting_getPointLight(0);\n    let light_position_worldspace: vec3<f32> = pointLight.position;\n    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n}\n\nfn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{\n  var lightColor = vec3<f32>(0, 0, 0);\n  let surfaceColor = vec3<f32>(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    let view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0, default: {\n        let pointLight: PointLight = lighting_getPointLight(0);\n        let light_position_worldspace: vec3<f32> = pointLight.position;\n        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n      }\n      case 1: {\n        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n      }\n    }\n  }\n  return lightColor;\n}\n",yE={props:{},name:"gouraudMaterial",vs:gE.replace("phongMaterial","gouraudMaterial"),fs:pE.replace("phongMaterial","gouraudMaterial"),source:mE.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[uE],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...yE.defaultUniforms,...t}}},vE={name:"phongMaterial",dependencies:[uE],source:mE,vs:pE,fs:gE,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...vE.defaultUniforms,...t}}},_E="uniform pbrProjectionUniforms {\n  mat4 modelViewProjectionMatrix;\n  mat4 modelMatrix;\n  mat4 normalMatrix;\n  vec3 camera;\n} pbrProjection;\n",bE={props:{},uniforms:{},name:"pbrMaterial",dependencies:[uE,{name:"pbrProjection",vs:_E,fs:_E,getUniforms:e=>e,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}}],source:"struct PBRFragmentInputs {\n  pbr_vPosition: vec3f,\n  pbr_vUV: vec2f,\n  pbr_vTBN: mat3f,\n  pbr_vNormal: vec3f\n};\n\nvar fragmentInputs: PBRFragmentInputs;\n\nfn pbr_setPositionNormalTangentUV(position: vec4f, normal: vec4f, tangent: vec4f, uv: vec2f)\n{\n  var pos: vec4f = pbrProjection.modelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  let normalW: vec3f = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));\n  let tangentW: vec3f = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));\n  let bitangentW: vec3f = cross(normalW, tangentW) * tangent.w;\n  fragmentInputs,pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else // HAS_TANGENTS != 1\n  fragmentInputs.pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n\nstruct pbrMaterialUniforms {\n  // Material is unlit\n  unlit: uint32,\n\n  // Base color map\n  baseColorMapEnabled: uint32,\n  baseColorFactor: vec4f,\n\n  normalMapEnabled : uint32,\n  normalScale: f32,  // #ifdef HAS_NORMALMAP\n\n  emissiveMapEnabled: uint32,\n  emissiveFactor: vec3f, // #ifdef HAS_EMISSIVEMAP\n\n  metallicRoughnessValues: vec2f,\n  metallicRoughnessMapEnabled: uint32,\n\n  occlusionMapEnabled: i32,\n  occlusionStrength: f32, // #ifdef HAS_OCCLUSIONMAP\n  \n  alphaCutoffEnabled: i32,\n  alphaCutoff: f32, // #ifdef ALPHA_CUTOFF\n  \n  // IBL\n  IBLenabled: i32,\n  scaleIBLAmbient: vec2f, // #ifdef USE_IBL\n  \n  // debugging flags used for shader output of intermediate PBR variables\n  // #ifdef PBR_DEBUG\n  scaleDiffBaseMR: vec4f,\n  scaleFGDSpec: vec4f\n  // #endif\n} \n  \n@binding(2) @group(0) var<uniform> material : pbrMaterialUniforms;\n\n// Samplers\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D pbr_baseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D pbr_normalSampler;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D pbr_emissiveSampler;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D pbr_metallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D pbr_occlusionSampler;\n#endif\n#ifdef USE_IBL\nuniform samplerCube pbr_diffuseEnvSampler;\nuniform samplerCube pbr_specularEnvSampler;\nuniform sampler2D pbr_brdfLUT;\n#endif\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo {\n  NdotL: f32,                  // cos angle between normal and light direction\n  NdotV: f32,                  // cos angle between normal and view direction\n  NdotH: f32,                  // cos angle between normal and half vector\n  LdotH: f32,                  // cos angle between light direction and half vector\n  VdotH: f32,                  // cos angle between view direction and half vector\n  perceptualRoughness: f32,    // roughness value, as authored by the model creator (input to shader)\n  metalness: f32,              // metallic value at the surface\n  reflectance0: vec3f,            // full reflectance color (normal incidence angle)\n  reflectance90: vec3f,           // reflectance color at grazing angle\n  alphaRoughness: f32,         // roughness mapped to a more linear change in the roughness (proposed by [2])\n  diffuseColor: vec3f,            // color contribution from diffuse lighting\n  specularColor: vec3f,           // color contribution from specular lighting\n  n: vec3f,                       // normal at surface point\n  v: vec3f,                       // vector from surface point to camera\n};\n\nconst M_PI = 3.141592653589793;\nconst c_MinRoughness = 0.04;\n\nfn SRGBtoLINEAR(srgbIn: vec4f ) -> vec4f\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\n  var linOut: vec3f = pow(srgbIn.xyz,vec3(2.2));\n#else // SRGB_FAST_APPROXIMATION\n  var bLess: vec3f = step(vec3(0.04045),srgbIn.xyz);\n  var linOut: vec3f = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif //SRGB_FAST_APPROXIMATION\n  return vec4f(linOut,srgbIn.w);;\n#else //MANUAL_SRGB\n  return srgbIn;\n#endif //MANUAL_SRGB\n}\n\n// Find the normal for this fragment, pulling either from a predefined normal map\n// or from the interpolated mesh normal and tangent attributes.\nfn getNormal() -> vec3f\n{\n  // Retrieve the tangent space matrix\n#ifndef HAS_TANGENTS\n  var pos_dx: vec3f = dFdx(pbr_vPosition);\n  var pos_dy: vec3f = dFdy(pbr_vPosition);\n  var tex_dx: vec3f = dFdx(vec3(pbr_vUV, 0.0));\n  var tex_dy: vec3f = dFdy(vec3(pbr_vUV, 0.0));\n  var t: vec3f = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  var ng: vec3f = normalize(pbr_vNormal);\n#else\n  var ng: vec3f = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  var b: vec3f = normalize(cross(ng, t));\n  var tbn: mat3f = mat3f(t, b, ng);\n#else // HAS_TANGENTS\n  var tbn: mat3f = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));\n#else\n  // The tbn matrix is linearly interpolated, so we need to re-normalize\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\n#ifdef USE_IBL\nfn getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection) -> vec3f\n{\n  float mipCount = 9.0; // resolution of 512x512\n  float lod = (pbrInfo.perceptualRoughness * mipCount);\n  // retrieve a scale and bias to F0. See [1], Figure 3\n  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,\n    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;\n  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);\n\n  // For presentation, this allows us to disable IBL terms\n  diffuse *= pbrMaterial.scaleIBLAmbient.x;\n  specular *= pbrMaterial.scaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nfn diffuse(pbrInfo: PBRInfo) -> vec3<f32> {\n  return pbrInfo.diffuseColor / PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nfn specularReflection(pbrInfo: PBRInfo) -> vec3<f32> {\n  return pbrInfo.reflectance0 +\n    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *\n    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfn geometricOcclusion(pbrInfo: PBRInfo) -> f32 {\n  let NdotL: f32 = pbrInfo.NdotL;\n  let NdotV: f32 = pbrInfo.NdotV;\n  let r: f32 = pbrInfo.alphaRoughness;\n\n  let attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  let attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across\n// the area being drawn (aka D())\n// Implementation from \"Average Irregularity Representation of a Roughened Surface\n// for Ray Reflection\" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes\n// from EPIC Games [1], Equation 3.\nfn microfacetDistribution(pbrInfo: PBRInfo) -> f32 {\n  let roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;\n  let f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;\n  return roughnessSq / (PI * f * f);\n}\n\nfn PBRInfo_setAmbientLight(pbrInfo: ptr<function, PBRInfo>) {\n  (*pbrInfo).NdotL = 1.0;\n  (*pbrInfo).NdotH = 0.0;\n  (*pbrInfo).LdotH = 0.0;\n  (*pbrInfo).VdotH = 1.0;\n}\n\nfn PBRInfo_setDirectionalLight(pbrInfo: ptr<function, PBRInfo>, lightDirection: vec3<f32>) {\n  let n = (*pbrInfo).n;\n  let v = (*pbrInfo).v;\n  let l = normalize(lightDirection);             // Vector from surface point to light\n  let h = normalize(l + v);                      // Half vector between both l and v\n\n  (*pbrInfo).NdotL = clamp(dot(n, l), 0.001, 1.0);\n  (*pbrInfo).NdotH = clamp(dot(n, h), 0.0, 1.0);\n  (*pbrInfo).LdotH = clamp(dot(l, h), 0.0, 1.0);\n  (*pbrInfo).VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\n\nfn PBRInfo_setPointLight(pbrInfo: ptr<function, PBRInfo>, pointLight: PointLight) {\n  let light_direction = normalize(pointLight.position - pbr_vPosition);\n  PBRInfo_setDirectionalLight(pbrInfo, light_direction);\n}\n\nfn calculateFinalColor(pbrInfo: PBRInfo, lightColor: vec3<f32>) -> vec3<f32> {\n  // Calculate the shading terms for the microfacet specular shading model\n  let F = specularReflection(pbrInfo);\n  let G = geometricOcclusion(pbrInfo);\n  let D = microfacetDistribution(pbrInfo);\n\n  // Calculation of analytical lighting contribution\n  let diffuseContrib = (1.0 - F) * diffuse(pbrInfo);\n  let specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);\n  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\n  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);\n}\n\nfn pbr_filterColor(colorUnused: vec4<f32>) -> vec4<f32> {\n  // The albedo may be defined from a base texture or a flat color\n  var baseColor: vec4<f32>;\n  #ifdef HAS_BASECOLORMAP\n  baseColor = SRGBtoLINEAR(textureSample(pbr_baseColorSampler, pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;\n  #else\n  baseColor = pbrMaterial.baseColorFactor;\n  #endif\n\n  #ifdef ALPHA_CUTOFF\n  if (baseColor.a < pbrMaterial.alphaCutoff) {\n    discard;\n  }\n  #endif\n\n  var color = vec3<f32>(0.0, 0.0, 0.0);\n\n  if (pbrMaterial.unlit) {\n    color = baseColor.rgb;\n  } else {\n    // Metallic and Roughness material properties are packed together\n    // In glTF, these factors can be specified by fixed scalar values\n    // or from a metallic-roughness map\n    var perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;\n    var metallic = pbrMaterial.metallicRoughnessValues.x;\n    #ifdef HAS_METALROUGHNESSMAP\n    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.\n    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data\n    let mrSample = textureSample(pbr_metallicRoughnessSampler, pbr_metallicRoughnessSampler, pbr_vUV);\n    perceptualRoughness = mrSample.g * perceptualRoughness;\n    metallic = mrSample.b * metallic;\n    #endif\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n    // Roughness is authored as perceptual roughness; as is convention,\n    // convert to material roughness by squaring the perceptual roughness [2].\n    let alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    let f0 = vec3<f32>(0.04);\n    var diffuseColor = baseColor.rgb * (vec3<f32>(1.0) - f0);\n    diffuseColor *= 1.0 - metallic;\n    let specularColor = mix(f0, baseColor.rgb, metallic);\n\n    // Compute reflectance.\n    let reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n    // For typical incident reflectance range (between 4% to 100%) set the grazing\n    // reflectance to 100% for typical fresnel effect.\n    // For very low reflectance range on highly diffuse objects (below 4%),\n    // incrementally reduce grazing reflectance to 0%.\n    let reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    let specularEnvironmentR0 = specularColor;\n    let specularEnvironmentR90 = vec3<f32>(1.0, 1.0, 1.0) * reflectance90;\n\n    let n = getNormal();                          // normal at surface point\n    let v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera\n\n    let NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n    let reflection = -normalize(reflect(v, n));\n\n    var pbrInfo = PBRInfo(\n      0.0, // NdotL\n      NdotV,\n      0.0, // NdotH\n      0.0, // LdotH\n      0.0, // VdotH\n      perceptualRoughness,\n      metallic,\n      specularEnvironmentR0,\n      specularEnvironmentR90,\n      alphaRoughness,\n      diffuseColor,\n      specularColor,\n      n,\n      v\n    );\n\n    #ifdef USE_LIGHTS\n    // Apply ambient light\n    PBRInfo_setAmbientLight(&pbrInfo);\n    color += calculateFinalColor(pbrInfo, lighting.ambientColor);\n\n    // Apply directional light\n    for (var i = 0; i < lighting.directionalLightCount; i++) {\n      if (i < lighting.directionalLightCount) {\n        PBRInfo_setDirectionalLight(&pbrInfo, lighting_getDirectionalLight(i).direction);\n        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);\n      }\n    }\n\n    // Apply point light\n    for (var i = 0; i < lighting.pointLightCount; i++) {\n      if (i < lighting.pointLightCount) {\n        PBRInfo_setPointLight(&pbrInfo, lighting_getPointLight(i));\n        let attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));\n        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);\n      }\n    }\n    #endif\n\n    // Calculate lighting contribution from image based lighting source (IBL)\n    #ifdef USE_IBL\n    if (pbrMaterial.IBLenabled) {\n      color += getIBLContribution(pbrInfo, n, reflection);\n    }\n    #endif\n\n    // Apply optional PBR terms for additional (optional) shading\n    #ifdef HAS_OCCLUSIONMAP\n    if (pbrMaterial.occlusionMapEnabled) {\n      let ao = textureSample(pbr_occlusionSampler, pbr_occlusionSampler, pbr_vUV).r;\n      color = mix(color, color * ao, pbrMaterial.occlusionStrength);\n    }\n    #endif\n\n    #ifdef HAS_EMISSIVEMAP\n    if (pbrMaterial.emissiveMapEnabled) {\n      let emissive = SRGBtoLINEAR(textureSample(pbr_emissiveSampler, pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;\n      color += emissive;\n    }\n    #endif\n\n    // This section uses mix to override final color for reference app visualization\n    // of various parameters in the lighting equation.\n    #ifdef PBR_DEBUG\n    // TODO: Figure out how to debug multiple lights\n\n    // color = mix(color, F, pbr_scaleFGDSpec.x);\n    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);\n    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);\n    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);\n\n    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);\n    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);\n    color = mix(color, vec3<f32>(metallic), pbrMaterial.scaleDiffBaseMR.z);\n    color = mix(color, vec3<f32>(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);\n    #endif\n  }\n\n  return vec4<f32>(pow(color, vec3<f32>(1.0 / 2.2)), baseColor.a);\n}\n",vs:"out vec3 pbr_vPosition;\nout vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nout mat3 pbr_vTBN;\n# else\nout vec3 pbr_vNormal;\n# endif\n#endif\n\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\n  vec4 pos = pbrProjection.modelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n  pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else // HAS_TANGENTS != 1\n  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n",fs:"precision highp float;\n\nuniform pbrMaterialUniforms {\n  // Material is unlit\n  bool unlit;\n\n  // Base color map\n  bool baseColorMapEnabled;\n  vec4 baseColorFactor;\n\n  bool normalMapEnabled;  \n  float normalScale; // #ifdef HAS_NORMALMAP\n\n  bool emissiveMapEnabled;\n  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP\n\n  vec2 metallicRoughnessValues;\n  bool metallicRoughnessMapEnabled;\n\n  bool occlusionMapEnabled;\n  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP\n  \n  bool alphaCutoffEnabled;\n  float alphaCutoff; // #ifdef ALPHA_CUTOFF\n  \n  // IBL\n  bool IBLenabled;\n  vec2 scaleIBLAmbient; // #ifdef USE_IBL\n  \n  // debugging flags used for shader output of intermediate PBR variables\n  // #ifdef PBR_DEBUG\n  vec4 scaleDiffBaseMR;\n  vec4 scaleFGDSpec;\n  // #endif\n} pbrMaterial;\n\n// Samplers\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D pbr_baseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D pbr_normalSampler;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D pbr_emissiveSampler;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D pbr_metallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D pbr_occlusionSampler;\n#endif\n#ifdef USE_IBL\nuniform samplerCube pbr_diffuseEnvSampler;\nuniform samplerCube pbr_specularEnvSampler;\nuniform sampler2D pbr_brdfLUT;\n#endif\n\n// Inputs from vertex shader\n\nin vec3 pbr_vPosition;\nin vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nin mat3 pbr_vTBN;\n#else\nin vec3 pbr_vNormal;\n#endif\n#endif\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo {\n  float NdotL;                  // cos angle between normal and light direction\n  float NdotV;                  // cos angle between normal and view direction\n  float NdotH;                  // cos angle between normal and half vector\n  float LdotH;                  // cos angle between light direction and half vector\n  float VdotH;                  // cos angle between view direction and half vector\n  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n  float metalness;              // metallic value at the surface\n  vec3 reflectance0;            // full reflectance color (normal incidence angle)\n  vec3 reflectance90;           // reflectance color at grazing angle\n  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n  vec3 diffuseColor;            // color contribution from diffuse lighting\n  vec3 specularColor;           // color contribution from specular lighting\n  vec3 n;                       // normal at surface point\n  vec3 v;                       // vector from surface point to camera\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\n  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n#else // SRGB_FAST_APPROXIMATION\n  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif //SRGB_FAST_APPROXIMATION\n  return vec4(linOut,srgbIn.w);;\n#else //MANUAL_SRGB\n  return srgbIn;\n#endif //MANUAL_SRGB\n}\n\n// Find the normal for this fragment, pulling either from a predefined normal map\n// or from the interpolated mesh normal and tangent attributes.\nvec3 getNormal()\n{\n  // Retrieve the tangent space matrix\n#ifndef HAS_TANGENTS\n  vec3 pos_dx = dFdx(pbr_vPosition);\n  vec3 pos_dy = dFdy(pbr_vPosition);\n  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\n  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  vec3 ng = normalize(pbr_vNormal);\n#else\n  vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n#else // HAS_TANGENTS\n  mat3 tbn = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));\n#else\n  // The tbn matrix is linearly interpolated, so we need to re-normalize\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)\n{\n  float mipCount = 9.0; // resolution of 512x512\n  float lod = (pbrInfo.perceptualRoughness * mipCount);\n  // retrieve a scale and bias to F0. See [1], Figure 3\n  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,\n    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;\n  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);\n\n  // For presentation, this allows us to disable IBL terms\n  diffuse *= pbrMaterial.scaleIBLAmbient.x;\n  specular *= pbrMaterial.scaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3 diffuse(PBRInfo pbrInfo)\n{\n  return pbrInfo.diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3 specularReflection(PBRInfo pbrInfo)\n{\n  return pbrInfo.reflectance0 +\n    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *\n    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat geometricOcclusion(PBRInfo pbrInfo)\n{\n  float NdotL = pbrInfo.NdotL;\n  float NdotV = pbrInfo.NdotV;\n  float r = pbrInfo.alphaRoughness;\n\n  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across\n// the area being drawn (aka D())\n// Implementation from \"Average Irregularity Representation of a Roughened Surface\n// for Ray Reflection\" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes\n// from EPIC Games [1], Equation 3.\nfloat microfacetDistribution(PBRInfo pbrInfo)\n{\n  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;\n  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;\n  return roughnessSq / (M_PI * f * f);\n}\n\nvoid PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {\n  pbrInfo.NdotL = 1.0;\n  pbrInfo.NdotH = 0.0;\n  pbrInfo.LdotH = 0.0;\n  pbrInfo.VdotH = 1.0;\n}\n\nvoid PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {\n  vec3 n = pbrInfo.n;\n  vec3 v = pbrInfo.v;\n  vec3 l = normalize(lightDirection);             // Vector from surface point to light\n  vec3 h = normalize(l+v);                        // Half vector between both l and v\n\n  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);\n  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\n  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\n  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\n\nvoid PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {\n  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);\n  PBRInfo_setDirectionalLight(pbrInfo, light_direction);\n}\n\nvec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {\n  // Calculate the shading terms for the microfacet specular shading model\n  vec3 F = specularReflection(pbrInfo);\n  float G = geometricOcclusion(pbrInfo);\n  float D = microfacetDistribution(pbrInfo);\n\n  // Calculation of analytical lighting contribution\n  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);\n  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);\n  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\n  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);\n}\n\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n  // The albedo may be defined from a base texture or a flat color\n#ifdef HAS_BASECOLORMAP\n  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;\n#else\n  vec4 baseColor = pbrMaterial.baseColorFactor;\n#endif\n\n#ifdef ALPHA_CUTOFF\n  if (baseColor.a < pbrMaterial.alphaCutoff) {\n    discard;\n  }\n#endif\n\n  vec3 color = vec3(0, 0, 0);\n\n  if(pbrMaterial.unlit){\n    color.rgb = baseColor.rgb;\n  }\n  else{\n    // Metallic and Roughness material properties are packed together\n    // In glTF, these factors can be specified by fixed scalar values\n    // or from a metallic-roughness map\n    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;\n    float metallic = pbrMaterial.metallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\n    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.\n    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data\n    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);\n    perceptualRoughness = mrSample.g * perceptualRoughness;\n    metallic = mrSample.b * metallic;\n#endif\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n    // Roughness is authored as perceptual roughness; as is convention,\n    // convert to material roughness by squaring the perceptual roughness [2].\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    vec3 f0 = vec3(0.04);\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n    diffuseColor *= 1.0 - metallic;\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n    // Compute reflectance.\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n    // For typical incident reflectance range (between 4% to 100%) set the grazing\n    // reflectance to 100% for typical fresnel effect.\n    // For very low reflectance range on highly diffuse objects (below 4%),\n    // incrementally reduce grazing reflecance to 0%.\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n    vec3 n = getNormal();                          // normal at surface point\n    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera\n\n    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n    vec3 reflection = -normalize(reflect(v, n));\n\n    PBRInfo pbrInfo = PBRInfo(\n      0.0, // NdotL\n      NdotV,\n      0.0, // NdotH\n      0.0, // LdotH\n      0.0, // VdotH\n      perceptualRoughness,\n      metallic,\n      specularEnvironmentR0,\n      specularEnvironmentR90,\n      alphaRoughness,\n      diffuseColor,\n      specularColor,\n      n,\n      v\n    );\n\n\n#ifdef USE_LIGHTS\n    // Apply ambient light\n    PBRInfo_setAmbientLight(pbrInfo);\n    color += calculateFinalColor(pbrInfo, lighting.ambientColor);\n\n    // Apply directional light\n    for(int i = 0; i < lighting.directionalLightCount; i++) {\n      if (i < lighting.directionalLightCount) {\n        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);\n        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);\n      }\n    }\n\n    // Apply point light\n    for(int i = 0; i < lighting.pointLightCount; i++) {\n      if (i < lighting.pointLightCount) {\n        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));\n        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));\n        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);\n      }\n    }\n#endif\n\n    // Calculate lighting contribution from image based lighting source (IBL)\n#ifdef USE_IBL\n    if (pbrMaterial.IBLenabled) {\n      color += getIBLContribution(pbrInfo, n, reflection);\n    }\n#endif\n\n // Apply optional PBR terms for additional (optional) shading\n#ifdef HAS_OCCLUSIONMAP\n    if (pbrMaterial.occlusionMapEnabled) {\n      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;\n      color = mix(color, color * ao, pbrMaterial.occlusionStrength);\n    }\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n    if (pbrMaterial.emissiveMapEnabled) {\n      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;\n      color += emissive;\n    }\n#endif\n\n    // This section uses mix to override final color for reference app visualization\n    // of various parameters in the lighting equation.\n#ifdef PBR_DEBUG\n    // TODO: Figure out how to debug multiple lights\n\n    // color = mix(color, F, pbr_scaleFGDSpec.x);\n    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);\n    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);\n    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);\n\n    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);\n    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);\n    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);\n    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);\n#endif\n\n  }\n\n  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n",defines:{LIGHTING_FRAGMENT:!0,HAS_NORMALMAP:!1,HAS_EMISSIVEMAP:!1,HAS_OCCLUSIONMAP:!1,HAS_BASECOLORMAP:!1,HAS_METALROUGHNESSMAP:!1,ALPHA_CUTOFF:!1,USE_IBL:!1,PBR_DEBUG:!1},getUniforms:e=>e,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},EE="uniform layerUniforms {\n  uniform float opacity;\n} layer;\n",wE={name:"layer",vs:EE,fs:EE,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},xE={name:"color",dependencies:[],source:"\n\nstruct ColorUniforms {\n  opacity: f32,\n};\n\nvar<private> color: ColorUniforms = ColorUniforms(1.0);\n// TODO (kaapp) avoiding binding index collisions to handle layer opacity \n// requires some thought.\n// @group(0) @binding(0) var<uniform> color: ColorUniforms;\n\n@must_use\nfn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {\n    return vec4(fragColor.rgb * fragColor.a, fragColor.a); \n};\n",getUniforms:e=>({}),uniformTypes:{opacity:"f32"}},AE="#define SMOOTH_EDGE_RADIUS 0.5",SE={name:"geometry",source:"const SMOOTH_EDGE_RADIUS: f32 = 0.5;\n\nstruct VertexGeometry {\n  position: vec4<f32>,\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\nvar<private> geometry_: VertexGeometry = VertexGeometry(\n  vec4<f32>(0.0, 0.0, 1.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec2<f32>(0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0)\n);\n\nstruct FragmentGeometry {\n  uv: vec2<f32>,\n};\n\nvar<private> fragmentGeometry: FragmentGeometry;\n\nfn smoothedge(edge: f32, x: f32) -> f32 {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n",vs:`${AE}\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n`,fs:`${AE}\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`};var TE,CE,IE,kE,RE,PE;(CE=TE||(TE={}))[CE.Start=1]="Start",CE[CE.Move=2]="Move",CE[CE.End=4]="End",CE[CE.Cancel=8]="Cancel",(kE=IE||(IE={}))[kE.None=0]="None",kE[kE.Left=1]="Left",kE[kE.Right=2]="Right",kE[kE.Up=4]="Up",kE[kE.Down=8]="Down",kE[kE.Horizontal=3]="Horizontal",kE[kE.Vertical=12]="Vertical",kE[kE.All=15]="All",(PE=RE||(RE={}))[PE.Possible=1]="Possible",PE[PE.Began=2]="Began",PE[PE.Changed=4]="Changed",PE[PE.Ended=8]="Ended",PE[PE.Recognized=8]="Recognized",PE[PE.Cancelled=16]="Cancelled",PE[PE.Failed=32]="Failed";const ME="manipulation",LE="none",BE="pan-x",NE="pan-y";class OE{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(LE))return LE;const t=e.includes(BE),n=e.includes(NE);return t&&n?LE:t||n?t?BE:NE:e.includes(ME)?ME:"auto"}(e.join(" "))}}function DE(e){return e.trim().split(/\s+/g)}function FE(e,t,n){if(e)for(const i of DE(t))e.addEventListener(i,n,!1)}function UE(e,t,n){if(e)for(const i of DE(t))e.removeEventListener(i,n,!1)}function zE(e){return(e.ownerDocument||e).defaultView}function GE(e){const t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let n=0,i=0,r=0;for(;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:Math.round(n/t),y:Math.round(i/t)}}function VE(e){const t=[];let n=0;for(;n<e.pointers.length;)t[n]={clientX:Math.round(e.pointers[n].clientX),clientY:Math.round(e.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:t,center:GE(t),deltaX:e.deltaX,deltaY:e.deltaY}}function HE(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}function jE(e,t){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)}function WE(e,t){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return 180*Math.atan2(i,n)/Math.PI}function $E(e,t){return e===t?IE.None:Math.abs(e)>=Math.abs(t)?e<0?IE.Left:IE.Right:t<0?IE.Up:IE.Down}function XE(e,t,n){return{x:t/e||0,y:n/e||0}}function qE(e,t){const{session:n}=e,{pointers:i}=t,{length:r}=i;n.firstInput||(n.firstInput=VE(t)),r>1&&!n.firstMultiple?n.firstMultiple=VE(t):1===r&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,a=o?o.center:s.center,l=t.center=GE(i);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-s.timeStamp,t.angle=function(e,t){const n=t.x-e.x,i=t.y-e.y;return 180*Math.atan2(i,n)/Math.PI}(a,l),t.distance=HE(a,l);const{deltaX:c,deltaY:u}=function(e,t){const n=t.center;let i=e.offsetDelta,r=e.prevDelta;const s=e.prevInput;return t.eventType!==TE.Start&&(null==s?void 0:s.eventType)!==TE.End||(r=e.prevDelta={x:(null==s?void 0:s.deltaX)||0,y:(null==s?void 0:s.deltaY)||0},i=e.offsetDelta={x:n.x,y:n.y}),{deltaX:r.x+(n.x-i.x),deltaY:r.y+(n.y-i.y)}}(n,t);t.deltaX=c,t.deltaY=u,t.offsetDirection=$E(t.deltaX,t.deltaY);const h=XE(t.deltaTime,t.deltaX,t.deltaY);var d,f;t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,t.scale=o?(d=o.pointers,jE((f=i)[0],f[1])/jE(d[0],d[1])):1,t.rotation=o?function(e,t){return WE(t[1],t[0])-WE(e[1],e[0])}(o.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let p=e.element;return function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parentNode}return!1}(t.srcEvent.target,p)&&(p=t.srcEvent.target),t.target=p,function(e,t){const n=e.lastInterval||t,i=t.timeStamp-n.timeStamp;let r,s,o,a;if(t.eventType!==TE.Cancel&&(i>25||void 0===n.velocity)){const l=t.deltaX-n.deltaX,c=t.deltaY-n.deltaY,u=XE(i,l,c);s=u.x,o=u.y,r=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=$E(l,c),e.lastInterval=t}else r=n.velocity,s=n.velocityX,o=n.velocityY,a=n.direction;t.velocity=r,t.velocityX=s,t.velocityY=o,t.direction=a}(n,t),t}let KE=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,n){const i=n.pointers.length,r=n.changedPointers.length,s=t&TE.Start&&i-r===0,o=t&(TE.End|TE.Cancel)&&i-r===0;n.isFirst=Boolean(s),n.isFinal=Boolean(o),s&&(e.session={}),n.eventType=t;const a=qE(e,n);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}(this.manager,e,t)}init(){FE(this.element,this.evEl,this.domHandler),FE(this.target,this.evTarget,this.domHandler),FE(zE(this.element),this.evWin,this.domHandler)}destroy(){UE(this.element,this.evEl,this.domHandler),UE(this.target,this.evTarget,this.domHandler),UE(zE(this.element),this.evWin,this.domHandler)}};const YE={pointerdown:TE.Start,pointermove:TE.Move,pointerup:TE.End,pointercancel:TE.Cancel,pointerout:TE.Cancel};class JE extends KE{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const i=YE[e.type],r=e.pointerType,s="touch"===r;let o=t.findIndex(t=>t.pointerId===e.pointerId);i&TE.Start&&(e.buttons||s)?o<0&&(t.push(e),o=t.length-1):i&(TE.End|TE.Cancel)&&(n=!0),o<0||(t[o]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:r,srcEvent:e}),n&&t.splice(o,1))}}const ZE=["","webkit","Moz","MS","ms","o"];function QE(e,t){const n=t[0].toUpperCase()+t.slice(1);for(const i of ZE){const r=i?i+n:t;if(r in e)return r}}const ew={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class tw{constructor(e,t){this.options={...ew,...t,cssProps:{...ew.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new JE(this),this.touchAction=new OE(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){const{session:t}=this;if(t.stopped)return;let n;this.session.prevented&&e.srcEvent.preventDefault();const{recognizers:i}=this;let{curRecognizer:r}=t;(!r||r&&r.state&RE.Recognized)&&(r=t.curRecognizer=null);let s=0;for(;s<i.length;)n=i[s],2===t.stopped||r&&n!==r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(RE.Began|RE.Changed|RE.Ended)&&(r=t.curRecognizer=n),s++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const t of e)this.add(t);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const t of e)this.remove(t);return this}const t="string"==typeof e?this.get(e):e;if(t){const{recognizers:e}=this,n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const i of DE(e))n[i]=n[i]||[],n[i].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const i of DE(e))t?n[i]&&n[i].splice(n[i].indexOf(t),1):delete n[i]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<n.length;)n[r](i),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,i]of Object.entries(this.options.cssProps)){const r=QE(t.style,n);e?(this.oldCssProps[r]=t.style[r],t.style[r]=i):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}}let nw=1;function iw(e){return e&RE.Cancelled?"cancel":e&RE.Ended?"end":e&RE.Changed?"move":e&RE.Began?"start":""}class rw{constructor(e){this.options=e,this.id=nw++,this.state=RE.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const t of e)this.recognizeWith(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const t of e)this.dropRecognizeWith(t);return this}let t;return t="string"==typeof e?this.manager.get(e):e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const t of e)this.requireFailure(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return-1===n.indexOf(t)&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const t of e)this.dropRequireFailure(t);return this}let t;if(t="string"==typeof e?this.manager.get(e):e,t){const e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find(e=>e.options.enable))}canRecognizeWith(e){return Boolean(this.simultaneous[e.id])}emit(e){if(!e)return;const{state:t}=this;t<RE.Ended&&this.manager.emit(this.options.event+iw(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=RE.Ended&&this.manager.emit(this.options.event+iw(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=RE.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(RE.Failed|RE.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable)return this.reset(),void(this.state=RE.Failed);this.state&(RE.Recognized|RE.Cancelled|RE.Failed)&&(this.state=RE.Possible),this.state=this.process(t),this.state&(RE.Began|RE.Changed|RE.Ended|RE.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class sw extends rw{attrTest(e){const t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,i=t&(RE.Began|RE.Changed),r=this.attrTest(e);return i&&(n&TE.Cancel||!r)?t|RE.Cancelled:i||r?n&TE.End?t|RE.Ended:t&RE.Began?t|RE.Changed:RE.Began:RE.Failed}}class ow extends rw{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[ME]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&TE.Start&&0===this.count)return this.failTimeout();if(i&&r&&n){if(e.eventType!==TE.End)return this.failTimeout();const n=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||HE(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,i&&n?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=RE.Recognized,this.tryEmit(this._input)},t.interval),RE.Began):RE.Recognized}return RE.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=RE.Failed},this.options.interval),RE.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===RE.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const aw=["","start","move","end","cancel","up","down","left","right"];class lw extends sw{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:IE.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&IE.Horizontal&&t.push(NE),e&IE.Vertical&&t.push(BE),t}getEventNames(){return aw.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:i}=e,{direction:r}=e;const s=e.deltaX,o=e.deltaY;return r&t.direction||(t.direction&IE.Horizontal?(r=0===s?IE.None:s<0?IE.Left:IE.Right,n=s!==this.pX,i=Math.abs(e.deltaX)):(r=0===o?IE.None:o<0?IE.Up:IE.Down,n=o!==this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&Boolean(r&t.direction)}attrTest(e){return super.attrTest(e)&&(Boolean(this.state&RE.Began)||!(this.state&RE.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=IE[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const cw=["","start","move","end","cancel","in","out"];class uw{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const hw=-1!==("undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("firefox"),dw=4.000244140625;class fw extends uw{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(hw&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%dw===0&&(t=Math.floor(t/dw)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const pw=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class gw extends uw{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,pw.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){pw.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const mw=["keydown","keyup"];class yw extends uw{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",mw.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){mw.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class vw extends uw{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}const _w={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function bw(e){const t=_w[e.srcEvent.type];if(!t)return null;const{buttons:n,button:i}=e.srcEvent;let r=!1,s=!1,o=!1;return 2===t?(r=Boolean(1&n),s=Boolean(4&n),o=Boolean(2&n)):(r=0===i,s=1===i,o=2===i),{leftButton:r,middleButton:s,rightButton:o}}function Ew(e,t){const n=e.center;if(!n)return null;const i=t.getBoundingClientRect(),r=i.width/t.offsetWidth||1,s=i.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-i.left-t.clientLeft)/r,y:(n.y-i.top-t.clientTop)/s}}}const ww={srcElement:"root",priority:0};class xw{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,r=!1){const{handlers:s,handlersByElement:o}=this,a={...ww,...n};let l=o.get(a.srcElement);l||(l=[],o.set(a.srcElement,l));const c={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};i&&(c.once=!0),r&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const s=n[r];if(s.type===e&&s.handler===t){n.splice(r,1);const e=i.get(s.srcElement);e.splice(e.indexOf(s),1),0===e.length&&i.delete(s.srcElement)}}this._active=n.some(e=>!e.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const i=()=>{e.handled=!0},r=()=>{e.handled=!0,t=!0},s=[];for(let o=0;o<n.length;o++){const{type:a,handler:l,once:c}=n[o];if(l({...e,type:a,stopPropagation:i,stopImmediatePropagation:r}),c&&s.push(n[o]),t)break}for(let e=0;e<s.length;e++){const{type:t,handler:n}=s[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...bw(e),...Ew(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function Aw(e){if("recognizer"in e)return e;let t;const n=Array.isArray(e)?[...e]:[e];if("function"==typeof n[0]){t=new(n.shift())(n.shift()||{})}else t=n.shift();return{recognizer:t,recognizeWith:"string"==typeof n[0]?[n[0]]:n[0],requireFailure:"string"==typeof n[1]?[n[1]]:n[1]}}class Sw{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,e){this.manager=new tw(e,this.options);for(const e of this.options.recognizers){const{recognizer:t,recognizeWith:n,requireFailure:i}=Aw(e);this.manager.add(t),n&&t.recognizeWith(n),i&&t.requireFailure(i)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new fw(e,this._onOtherEvent,{enable:!1}),this.moveInput=new gw(e,this._onOtherEvent,{enable:!1}),this.keyInput=new yw(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new vw(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var n,i,r,s;const{manager:o}=this;if(!o)return;const a=o.get(e);a&&(a.set({enable:t}),o.touchAction.update()),null==(n=this.wheelInput)||n.enableEventType(e,t),null==(i=this.moveInput)||i.enableEventType(e,t),null==(r=this.keyInput)||r.enableEventType(e,t),null==(s=this.contextmenuInput)||s.enableEventType(e,t)}_addEventHandler(e,t,n,i,r){if("string"!=typeof e){n=t;for(const[t,s]of Object.entries(e))this._addEventHandler(t,s,n,i,r);return}const{manager:s,events:o}=this;if(!s)return;let a=o.get(e);if(!a){const t=this._getRecognizerName(e)||e;a=new xw(this,t),o.set(e,a),s&&s.on(e,a.handleEvent)}a.add(e,t,n,i,r),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const[t,n]of Object.entries(e))this._removeEventHandler(t,n);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:e}=i;let t=!1;for(const i of n.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){var t;return null==(t=this.manager.recognizers.find(t=>t.getEventNames().includes(e)))?void 0:t.options.event}}const Tw={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Tw,"IDENTITY",{get:()=>(Op.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Cw={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Iw={common:0,meters:1,pixels:2},kw={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Rw={multipan:[lw,{threshold:10,direction:IE.Vertical,pointers:2}],pinch:[class extends sw{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[LE]}getEventNames(){return cw.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||Boolean(this.state&RE.Began))}emit(e){if(1!==e.scale){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[lw,{threshold:1},["pinch"],["multipan"]],dblclick:[ow,{event:"dblclick",taps:2}],click:[ow,{event:"click"},null,["dblclick"]]};function Pw(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}function Mw(e){let t,n={};return i=>{for(const r in i)if(!Pw(i[r],n[r])){t=e(i),n=i;break}return t}}const Lw=[0,0,0,0],Bw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Nw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ow=[0,0,0],Dw=[0,0,0],Fw=Mw(function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,n){const{viewMatrixUncentered:i,projectionMatrix:r}=e;let{viewMatrix:s,viewProjectionMatrix:o}=e,a=Lw,l=Lw,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=Uw(e,t,n);d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Pb([],l,o),s=i||s,o=xb([],r,s),o=xb([],o,Bw));return{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,n,i),u=e.getDistanceScales(),h=[e.width*t,e.height*t],d=Pb([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,f={coordinateSystem:n,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:o.slice(0,3),center:r,pseudoMeters:Boolean(e._pseudoMeters),viewportSize:h,devicePixelRatio:t,focalDistance:d,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:Ow,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:Nw,cameraPosition:a};if(c){const t=e.getDistanceScales(c);switch(n){case Tw.METER_OFFSETS:f.commonUnitsPerWorldUnit=t.unitsPerMeter,f.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case Tw.LNGLAT:case Tw.LNGLAT_OFFSETS:e._pseudoMeters||(f.commonUnitsPerMeter=t.unitsPerMeter),f.commonUnitsPerWorldUnit=t.unitsPerDegree,f.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case Tw.CARTESIAN:f.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],f.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return f});function Uw(e,t,n=Dw){n.length<3&&(n=[n[0],n[1],0]);let i,r=n,s=!0;switch(i=t===Tw.LNGLAT_OFFSETS||t===Tw.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Cw.WEB_MERCATOR:t!==Tw.LNGLAT&&t!==Tw.CARTESIAN||(i=[0,0,0],s=!1);break;case Cw.WEB_MERCATOR_AUTO_OFFSET:t===Tw.LNGLAT?r=i:t===Tw.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Cw.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case Cw.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}const zw=`${`${Object.keys(Tw).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${Tw[e]};`).join("")}\n${Object.keys(Cw).map(e=>`const PROJECTION_MODE_${e}: i32 = ${Cw[e]};`).join("")}\n${Object.keys(Iw).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${Iw[e]};`).join("")}\n\nconst TILE_SIZE: f32 = 512.0;\nconst PI: f32 = 3.1415926536;\nconst WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);\nconst ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);\nconst EARTH_RADIUS: f32 = 6370972.0; // meters\nconst GLOBE_RADIUS: f32 = 256.0;\n\n// -----------------------------------------------------------------------------\n// Uniform block (converted from GLSL uniform block)\n// -----------------------------------------------------------------------------\nstruct ProjectUniforms {\n  wrapLongitude: i32,\n  coordinateSystem: i32,\n  commonUnitsPerMeter: vec3<f32>,\n  projectionMode: i32,\n  scale: f32,\n  commonUnitsPerWorldUnit: vec3<f32>,\n  commonUnitsPerWorldUnit2: vec3<f32>,\n  center: vec4<f32>,\n  modelMatrix: mat4x4<f32>,\n  viewProjectionMatrix: mat4x4<f32>,\n  viewportSize: vec2<f32>,\n  devicePixelRatio: f32,\n  focalDistance: f32,\n  cameraPosition: vec3<f32>,\n  coordinateOrigin: vec3<f32>,\n  commonOrigin: vec3<f32>,\n  pseudoMeters: i32,\n};\n\n@group(0) @binding(0)\nvar<uniform> project: ProjectUniforms;\n\n// -----------------------------------------------------------------------------\n// Geometry data\n// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,\n// you might supply this via vertex attributes or a uniform. Here we define a\n// uniform struct for demonstration.)\n// -----------------------------------------------------------------------------\n\n// Structure to carry additional geometry data used by deck.gl filters.\nstruct Geometry {\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  position: vec4<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\n// @group(0) @binding(1)\nvar<private> geometry: Geometry;\n`}\n\n// -----------------------------------------------------------------------------\n// Functions\n// -----------------------------------------------------------------------------\n\n// Returns an adjustment factor for commonUnitsPerMeter\nfn _project_size_at_latitude(lat: f32) -> f32 {\n  let y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\n// Overloaded version: scales a value in meters at a given latitude.\nfn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);\n}\n\n// Computes a non-linear scale factor based on geometry.\n// (Note: This function relies on "geometry" being provided.)\nfn project_size() -> f32 {\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n      project.pseudoMeters == 0) {\n    if (geometry.position.w == 0.0) {\n      return _project_size_at_latitude(geometry.worldPosition.y);\n    }\n    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    let y2 = y * y;\n    let y4 = y2 * y2;\n    let y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\n// Overloads to scale offsets (meters to world units)\nfn project_size_float(meters: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * project_size();\n}\n\nfn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {\n  return meters * project.commonUnitsPerMeter.xy * project_size();\n}\n\nfn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {\n  return meters * project.commonUnitsPerMeter * project_size();\n}\n\nfn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {\n  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\n\n// Returns a rotation matrix aligning the zaxis with the given up vector.\nfn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {\n  let uz = normalize(up);\n  let ux = select(\n    vec3<f32>(1.0, 0.0, 0.0),\n    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),\n    abs(uz.z) == 1.0\n  );\n  let uy = cross(uz, ux);\n  return mat3x3<f32>(ux, uy, uz);\n}\n\n// Since WGSL does not support "out" parameters, we return a struct.\nstruct RotationResult {\n  needsRotation: bool,\n  transform: mat3x3<f32>,\n};\n\nfn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    return RotationResult(true, project_get_orientation_matrix(commonPosition));\n  } else {\n    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed\n  };\n}\n\n// Projects a normal vector from the current coordinate system to world space.\nfn project_normal(vector: vec3<f32>) -> vec3<f32> {\n  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);\n  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\n  let rotResult = project_needs_rotation(geometry.position.xyz);\n  if (rotResult.needsRotation) {\n    n = rotResult.transform * n;\n  }\n  return n;\n}\n\n// Applies a scale offset based on y-offset (dy)\nfn project_offset_(offset: vec4<f32>) -> vec4<f32> {\n  let dy: f32 = offset.y;\n  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\n  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n// Projects lng/lat coordinates to a unit tile [0,1]\nfn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {\n  var x = lnglat.x;\n  if (project.wrapLongitude != 0) {\n    x = ((x + 180.0) % 360.0) - 180.0;\n  }\n  let y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2<f32>(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// Projects lng/lat/z coordinates for a globe projection.\nfn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {\n  let lambda = radians(lnglatz.x);\n  let phi = radians(lnglatz.y);\n  let cosPhi = cos(phi);\n  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n  return vec3<f32>(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n// Projects positions (with an optional 64-bit low part) from the input\n// coordinate system to the common space.\nfn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {\n  var position_world = project.modelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug:\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_mercator_(position_world.xy),\n        _project_size_at_latitude_m(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\n        return vec4<f32>(\n          project_mercator_(position_world.xy) - project.commonOrigin.xy,\n          project_size_float(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);\n  }\n\n  return project_offset_(position_world) +\n         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));\n}\n\n// Overloaded versions for different input types.\nfn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {\n  return project_position_vec4_f64(position, ZERO_64_LOW);\n}\n\nfn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nfn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nfn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\n// Transforms a common space position to clip space.\nfn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {\n  return viewProjectionMatrix * position + center;\n}\n\n// Uses the project viewProjectionMatrix and center.\nfn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {\n  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);\n}\n\n// Returns a clip space offset corresponding to a given number of screen pixels.\nfn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {\n  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\n  return offset * project.focalDistance;\n}\n\nfn project_meter_size_to_pixel(meters: f32) -> f32 {\n  return project_size_float(meters) * project.scale;\n}\n\nfn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {\n  if (unit == UNIT_METERS) {\n    return project_meter_size_to_pixel(size);\n  } else if (unit == UNIT_COMMON) {\n    return size * project.scale;\n  }\n  // UNIT_PIXELS: no scaling applied.\n  return size;\n}\n\nfn project_pixel_size_float(pixels: f32) -> f32 {\n  return pixels / project.scale;\n}\n\nfn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {\n  return pixels / project.scale;\n}\n`,Gw=Object.keys(Tw).map(e=>`const int COORDINATE_SYSTEM_${e} = ${Tw[e]};`).join(""),Vw=Object.keys(Cw).map(e=>`const int PROJECTION_MODE_${e} = ${Cw[e]};`).join(""),Hw=Object.keys(Iw).map(e=>`const int UNIT_${e.toUpperCase()} = ${Iw[e]};`).join(""),jw={};const Ww={name:"project",dependencies:[rE,SE],source:zw,vs:`${Gw}\n${Vw}\n${Hw}\nuniform projectUniforms {\nbool wrapLongitude;\nint coordinateSystem;\nvec3 commonUnitsPerMeter;\nint projectionMode;\nfloat scale;\nvec3 commonUnitsPerWorldUnit;\nvec3 commonUnitsPerWorldUnit2;\nvec4 center;\nmat4 modelMatrix;\nmat4 viewProjectionMatrix;\nvec2 viewportSize;\nfloat devicePixelRatio;\nfloat focalDistance;\nvec3 cameraPosition;\nvec3 coordinateOrigin;\nvec3 commonOrigin;\nbool pseudoMeters;\n} project;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject.pseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project.commonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project.commonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project.commonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project.wrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project.modelMatrix * position;\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project.coordinateOrigin;\n}\n}\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project.commonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project.coordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\nreturn offset * project.focalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project.scale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project.scale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project.scale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project.scale;\n}\n`,getUniforms:function(e=jw){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=Tw.DEFAULT,coordinateOrigin:r=Dw,autoWrapLongitude:s=!1}){i===Tw.DEFAULT&&(i=e.isGeospatial?Tw.LNGLAT:Tw.CARTESIAN);const o=Fw({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r});return o.wrapLongitude=s,o.modelMatrix=n||Nw,o}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},$w={name:"project32",dependencies:[Ww],source:"// Define a structure to hold both the clip-space position and the common position.\nstruct ProjectResult {\n  clipPosition: vec4<f32>,\n  commonPosition: vec4<f32>,\n};\n\n// This function mimics the GLSL version with the 'out' parameter by returning both values.\nfn project_position_to_clipspace_and_commonspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> ProjectResult {\n  // Compute the projected position.\n  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);\n\n  // Start with the provided offset.\n  var finalOffset: vec3<f32> = offset;\n\n  // Get whether a rotation is needed and the rotation matrix.\n  let rotationResult = project_needs_rotation(projectedPosition);\n\n  // If rotation is needed, update the offset.\n  if (rotationResult.needsRotation) {\n    finalOffset = rotationResult.transform * offset;\n  }\n\n  // Compute the common position.\n  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);\n\n  // Convert to clip-space.\n  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);\n\n  return ProjectResult(clipPosition, commonPosition);\n}\n\n// A convenience overload that returns only the clip-space position.\nfn project_position_to_clipspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> vec4<f32> {\n  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;\n}\n",vs:"vec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"};function Xw(e,t){const n=Pb([],t,e);return Rb(n,n,1/n[3]),n}function qw(e,t){const n=e%t;return n<0?t+n:n}function Kw(e,t,n){return e<t?t:e>n?n:e}const Yw=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function Jw(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Zw=Math.PI,Qw=Zw/4,ex=Zw/180,tx=180/Zw,nx=512,ix=4003e4,rx=85.051129,sx=1.5;function ox(e){const[t,n]=e;Jw(Number.isFinite(t)),Jw(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*ex;return[nx*(t*ex+Zw)/(2*Zw),nx*(Zw+Math.log(Math.tan(Qw+.5*i)))/(2*Zw)]}function ax(e){const[t,n]=e,i=t/nx*(2*Zw)-Zw,r=2*(Math.atan(Math.exp(n/nx*(2*Zw)-Zw))-Qw);return[i*tx,r*tx]}function lx(e){const{latitude:t}=e;Jw(Number.isFinite(t));const n=Math.cos(t*ex);return Yw(ix*n)-9}function cx(e){return 12790407194604047e-21/Math.cos(e*ex)}function ux(e){const{latitude:t,longitude:n,highPrecision:i=!1}=e;Jw(Number.isFinite(t)&&Number.isFinite(n));const r=nx,s=Math.cos(t*ex),o=r/360,a=o/s,l=12790407194604047e-21/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[.703125,1/a,1/l]};if(i){const e=ex*Math.tan(t*ex)/s,n=o*e/2,i=12790407194604047e-21*e,r=i/a*l;c.unitsPerDegree2=[0,n,i],c.unitsPerMeter2=[r,0,r]}return c}function hx(e,t){const[n,i,r]=e,[s,o,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=ux({longitude:n,latitude:i,highPrecision:!0}),u=ox(e);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=ax(u),d=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],d]:h}function dx(e){return 2*Math.atan(.5/e)*tx}function fx(e){return.5/Math.tan(.5*e*ex)}function px(e,t){const[n,i,r=0]=e;return Jw(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Xw(t,[n,i,r,1])}function gx(e,t,n=0){const[i,r,s]=e;if(Jw(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s)){return Xw(t,[i,r,s,1])}const o=Xw(t,[i,r,0,1]),a=Xw(t,[i,r,1,1]),l=o[2],c=a[2];return j_([],o,a,l===c?0:((n||0)-l)/(c-l))}function mx(e){const{width:t,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=e,[[a,l],[c,u]]=i,h=function(e=0){if("number"==typeof e)return{top:e,bottom:e,left:e,right:e};return Jw(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e}(e.padding),d=ox([a,Kw(u,-85.051129,rx)]),f=ox([c,Kw(l,-85.051129,rx)]),p=[Math.max(Math.abs(f[0]-d[0]),r),Math.max(Math.abs(f[1]-d[1]),r)],g=[t-h.left-h.right-2*Math.abs(o[0]),n-h.top-h.bottom-2*Math.abs(o[1])];Jw(g[0]>0&&g[1]>0);const m=g[0]/p[0],y=g[1]/p[1],v=(h.right-h.left)/2/m,_=(h.top-h.bottom)/2/y,b=ax([(f[0]+d[0])/2+v,(f[1]+d[1])/2+_]),E=Math.min(s,Yw(Math.abs(Math.min(m,y))));return Jw(Number.isFinite(E)),{longitude:b[0],latitude:b[1],zoom:E}}const yx=Math.PI/180;function vx(e,t,n){const{pixelUnprojectionMatrix:i}=e,r=Xw(i,[t,0,1,1]),s=Xw(i,[t,e.height,1,1]),o=ax(j_([],r,s,(n*e.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2])));return o.push(n),o}const _x="\nuniform shadowUniforms {\n  bool drawShadowMap;\n  bool useShadowMap;\n  vec4 color;\n  highp int lightId;\n  float lightCount;\n  mat4 viewProjectionMatrix0;\n  mat4 viewProjectionMatrix1;\n  vec4 projectCenter0;\n  vec4 projectCenter1;\n} shadow;\n",bx=`\n${_x}\n\nconst int max_lights = 2;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  mat4 viewProjectionMatrices[max_lights];\n  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;\n  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;\n  vec4 projectCenters[max_lights];\n  projectCenters[0] = shadow.projectCenter0;\n  projectCenters[1] = shadow.projectCenter1;\n\n  if (shadow.drawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);\n  }\n  if (shadow.useShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow.lightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n\n`,Ex=`\n${_x}\n\nconst int max_lights = 2;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow.drawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow.useShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow.lightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow.color.a / shadow.lightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n\n`,wx=Mw(function({viewport:e,center:t}){return new Fb(e.viewProjectionMatrix).invert().transform(t)}),xx=Mw(function({viewport:e,shadowMatrices:t}){const n=[],i=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,s=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>function(e,t){const[n,i,r]=e,s=gx([n,i,r],t);if(Number.isFinite(r))return s;return[s[0],s[1],0]}(e,i));for(const o of t){const t=o.clone().translate(new hb(e.center).negate()),i=s.map(e=>t.transform(e)),r=(new Fb).ortho({left:Math.min(...i.map(e=>e[0])),right:Math.max(...i.map(e=>e[0])),bottom:Math.min(...i.map(e=>e[1])),top:Math.max(...i.map(e=>e[1])),near:Math.min(...i.map(e=>-e[2])),far:Math.max(...i.map(e=>-e[2]))});n.push(r.multiplyRight(o))}return n}),Ax=[0,0,0,1],Sx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];const Tx={name:"shadow",dependencies:[Ww],vs:bx,fs:Ex,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(e){const{shadowEnabled:t=!0,project:n}=e;if(!(t&&n&&e.shadowMatrices&&e.shadowMatrices.length))return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const i=Ww.getUniforms(n),r=wx({viewport:n.viewport,center:i.center}),s=[],o=xx({shadowMatrices:e.shadowMatrices,viewport:n.viewport}).slice();for(let l=0;l<e.shadowMatrices.length;l++){const e=o[l],t=e.clone().translate(new hb(n.viewport.center).negate());i.coordinateSystem===Tw.LNGLAT&&i.projectionMode===Cw.WEB_MERCATOR?(o[l]=t,s[l]=r):(o[l]=e.clone().multiplyRight(Sx),s[l]=t.transform(r))}const a={drawShadowMap:Boolean(e.drawToShadowMap),useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||Ax,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let l=0;l<o.length;l++)a[`viewProjectionMatrix${l}`]=o[l],a[`projectCenter${l}`]=s[l];for(let l=0;l<2;l++)a[`shadow_uShadowMap${l}`]=e.shadowMaps&&e.shadowMaps[l]||e.dummyShadowMap;return a},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Cx={...oE,defaultUniforms:{...oE.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}},Ix=[SE],kx=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Rx=[];function Px(e){const t=wg.getDefaultShaderAssembler();for(const i of Ix)t.addDefaultModule(i);t._hookFunctions.length=0;const n="glsl"===e?kx:Rx;for(const i of n)t.addShaderHook(i);return t}const Mx=[255,255,255],Lx=1;let Bx=0;class Nx{constructor(e={}){this.type="ambient";const{color:t=Mx}=e,{intensity:n=Lx}=e;this.id=e.id||"ambient-"+Bx++,this.color=t,this.intensity=n}}const Ox=[255,255,255],Dx=1,Fx=[0,0,-1];let Ux=0;class zx{constructor(e={}){this.type="directional";const{color:t=Ox}=e,{intensity:n=Dx}=e,{direction:i=Fx}=e,{_shadow:r=!1}=e;this.id=e.id||"directional-"+Ux++,this.color=t,this.intensity=n,this.type="directional",this.direction=new hb(i).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class Gx{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Vx extends Gx{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,r=e.clearColor??(!!i&&[0,0,0,0]),s=!!i&&1,o=!!i&&0,a=e.colorMask??15,l={viewport:[0,0,t,n]};e.colorMask&&(l.colorMask=a),e.scissorRect&&(l.scissorRect=e.scissorRect);const c=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:r,clearDepth:s,clearStencil:o});try{return this._drawLayers(c,e)}finally{c.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const l=[];for(const c of r){const r=s&&s[c.id];null==o||o(c);const a=this._getDrawLayerParams(c,t),u=c.subViewports||[c];for(const s of u){const o=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:s,view:r,pass:t.pass,layers:t.layers},a);l.push(o)}}return l}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:i=!1,layerFilter:r,cullRect:s,effects:o,shaderModuleProps:a},l=!1){var c;const u=[],h=Hx(this._lastRenderIndex+1),d={layer:t[0],viewport:e,isPicking:i,renderPass:n,cullRect:s},f={};for(let p=0;p<t.length;p++){const i=t[p],s=this._shouldDrawLayer(i,d,r,f),g={shouldDrawLayer:s};s&&!l&&(g.shouldDrawLayer=!0,g.layerRenderIndex=h(i,s),g.shaderModuleProps=this._getShaderModuleProps(i,o,n,a),g.layerParameters={...null==(c=i.context.deck)?void 0:c.props.parameters,...this.getLayerParameters(i,p,e)}),u[p]=g}return u}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:i,target:r,viewport:s,view:o},a){const l=function(e,{shaderModuleProps:t,target:n,viewport:i}){var r;const s=(null==(r=null==t?void 0:t.project)?void 0:r.devicePixelRatio)??e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),a=n?n.height:o,l=i;return[l.x*s,a-(l.y+l.height)*s,l.width*s,l.height*s]}(this.device,{shaderModuleProps:n,target:r,viewport:s});if(o){const{clear:e,clearColor:t,clearDepth:n,clearStencil:i}=o.props;if(e){let e=[0,0,0,0],s=1,o=0;Array.isArray(t)?e=[...t.slice(0,3),t[3]||255].map(e=>e/255):!1===t&&(e=!1),void 0!==n&&(s=n),void 0!==i&&(o=i);this.device.beginRenderPass({framebuffer:r,parameters:{viewport:l,scissorRect:l},clearColor:e,clearDepth:s,clearStencil:o}).end()}}const c={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let h=0;h<t.length;h++){const n=t[h],r=a[h],{shouldDrawLayer:o}=r;if(o&&n.props.pickable&&c.pickableCount++,n.isComposite&&c.compositeCount++,n.isDrawable&&r.shouldDrawLayer){const{layerRenderIndex:t,shaderModuleProps:o,layerParameters:a}=r;c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),o.project&&(o.project.viewport=s),n.context.renderPass=e;try{n._drawLayer({renderPass:e,shaderModuleProps:o,uniforms:{layerIndex:t},parameters:a})}catch(u){n.raiseError(u,`drawing ${n} to ${i}`)}}}return c}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let r=e.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(t))return!1;t.layer=r,r=r.parent}if(n){const e=t.layer.id;if(e in i||(i[e]=n(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,i){var r,s;const o=this.device.canvasContext.cssToDeviceRatio(),a=(null==(r=e.internalState)?void 0:r.propsInTransition)||e.props,l={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const c of t)jx(l,null==(s=c.getShaderModuleProps)?void 0:s.call(c,e,l));return jx(l,this.getShaderModuleProps(e,t,l),i)}}function Hx(e=0,t={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in t)&&i(r.parent,!1),l in n){const e=n[l]=n[l]||Hx(t[l],t);c=e(r,s),n[a]=e}else Number.isFinite(o)?(c=o+(t[l]||0),n[a]=null):c=e;return s&&c>=e&&(e=c+1),t[a]=c,c};return i}function jx(e,...t){for(const n of t)if(n)for(const t in n)e[t]?Object.assign(e[t],n[t]):e[t]=n[t];return e}class Wx extends Vx{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],r=i.width*n,s=i.height*n;r===t.width&&s===t.height||t.resize({width:r,height:s}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const $x={color:[255,255,255],intensity:1},Xx=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],qx=[0,0,0,200/255];class Kx{constructor(e={}){this.id="lighting-effect",this.shadowColor=qx,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(Tx),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++){this.shadowPasses[s].render({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:r,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},r=e.props.material;return{shadow:n,lighting:i,phongMaterial:r,gouraudMaterial:r}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Tx))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=(new Fb).lookAt({eye:new hb(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new Wx(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new Nx($x),this.directionalLights.push(new zx(Xx[0]),new zx(Xx[1])))}}const Yx=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:i,padding:r=0,copy:s=!1,initialize:o=!1,maxCount:a}){const l=i||e&&e.constructor||Float32Array,c=t*n+r;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u=1/0;a&&(u=a*n+r);const h=this._allocate(l,c,o,u);return e&&s?h.set(e):o||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,n,i){let r=Math.max(Math.ceil(t*this.opts.overAlloc),1);r>i&&(r=i);const s=this._pool,o=e.BYTES_PER_ELEMENT*r,a=s.findIndex(e=>e.byteLength>=o);if(a>=0){const t=new e(s.splice(a,1)[0],0,r);return n&&t.fill(0),t}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,r=t.findIndex(e=>e.byteLength>=i);r<0?t.push(n):(r>0||t.length<this.opts.poolSize)&&t.splice(r,0,n),t.length>this.opts.poolSize&&t.shift()}};const Jx=new hb;function Zx(e,t,n,i){Jx.set(e,t,n);const r=Jx.len();return{distance:i/r,normal:new hb(-e/r,-t/r,-n/r)}}function Qx(e){return e-Math.fround(e)}let eA;function tA(e,t){const{size:n=1,startIndex:i=0}=t,r=void 0!==t.endIndex?t.endIndex:e.length,s=(r-i)/n;eA=Yx.allocate(eA,s,{type:Float32Array,size:2*n});let o=i,a=0;for(;o<r;){for(let t=0;t<n;t++){const i=e[o++];eA[a+t]=i,eA[a+t+n]=Qx(i)}a+=2*n}return eA.subarray(0,s*n*2)}function nA(e){let t=null,n=!1;for(const i of e)i&&(t?(n||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],n=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}const iA=Math.PI/180,rA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],sA=[0,0,0],oA={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class aA{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||oA,this.focalDistance=e.focalDistance||1,this.position=e.position||sA,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Cw.WEB_MERCATOR:Cw.WEB_MERCATOR_AUTO_OFFSET:Cw.IDENTITY}equals(e){return e instanceof aA&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&B_(e.projectionMatrix,this.projectionMatrix)&&B_(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=px(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,s=t?r:this.height-r;return 2===e.length?[i,s]:[i,s,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,s]=e,o=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=gx([i,o,s],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(s)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=ox(e);return t[1]=M_(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ax(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],r[0],s[0]),Math.min(n[1],i[1],r[1],s[1]),Math.max(n[0],i[0],r[0],s[0]),Math.max(n[1],i[1],r[1],s[1])]}getDistanceScales(e){return e&&this.isGeospatial?ux({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:Zx((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Zx(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Zx(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Zx(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Zx(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Zx(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=lx({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||ux({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:s}=e;let o=sA;if(r&&(o=s?new Fb(s).transformAsVector(r,[]):r),this.isGeospatial){const e=this.projectPosition([t,n,0]);this.center=new hb(o).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=rA,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:r,fovy:s=75,near:o=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new Fb).multiplyRight(t).translate(new hb(this.center).negate()),this.projectionMatrix=n||function({width:e,height:t,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=e/t,c=n?(new Fb).orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):(new Fb).perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:n=0,right:i=0,top:r=0,bottom:o=0}=s,a=M_((n+e-i)/2,0,e)-e/2,l=M_((r+t-o)/2,0,t)-t/2;c[8]-=2*a/e,c[9]+=2*l/t}return c}({width:this.width,height:this.height,orthographic:i,fovyRadians:r||s*iA,focalDistance:c,padding:l,near:o,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;xb(u,u,this.projectionMatrix),xb(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=wb([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Sb(d,d,[this.width/2,-this.height/2,1]),Ab(d,d,[1,-1,0]),xb(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=wb([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Op.warn("Pixel project matrix not invertible")()}}aA.displayName="Viewport";class lA extends aA{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:r=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:a=1.01,nearZ:l,farZ:c,orthographic:u=!1,projectionMatrix:h,repeat:d=!1,worldOffset:f=0,position:p,padding:g,legacyMeterSizes:m=!1}=e;let{width:y,height:v,altitude:_=1.5}=e;const b=Math.pow(2,i);let E;y=y||1,v=v||1;let w=null;if(h)_=h[5]/2,E=dx(_);else{let n;if(e.fovy?(E=e.fovy,_=fx(E)):E=dx(_),g){const{top:e=0,bottom:t=0}=g;n=[0,M_((e+v-t)/2,0,v)-v/2]}w=function(e){const{width:t,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e;let{fovy:u=dx(sx)}=e;void 0!==i&&(u=dx(i));const h=u*ex,d=r*ex,f=fx(u);let p=f;o&&(p+=o[2]*a/Math.cos(d)/n);const g=h*(.5+(s?s[1]:0)/n),m=Math.sin(g)*p/Math.sin(Kw(Math.PI/2-d-g,.01,Math.PI-.01)),y=Math.sin(d)*m+p,v=10*p;return{fov:h,aspect:t/n,focalDistance:f,near:l,far:Math.min(y*c,v)}}({width:y,height:v,scale:b,center:p&&[0,0,p[2]*cx(t)],offset:n,pitch:r,fovy:E,nearZMultiplier:o,farZMultiplier:a}),Number.isFinite(l)&&(w.near=l),Number.isFinite(c)&&(w.far=c)}let x=function(e){const{height:t,pitch:n,bearing:i,altitude:r,scale:s,center:o}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Ab(a,a,[0,0,-r]),Tb(a,a,-n*ex),Cb(a,a,i*ex);const l=s/t;var c,u;return Sb(a,a,[l,l,l]),o&&Ab(a,a,((c=[])[0]=-(u=o)[0],c[1]=-u[1],c[2]=-u[2],c)),a}({height:v,pitch:r,bearing:s,scale:b,altitude:_});if(f){x=(new Fb).translate([512*f,0,0]).multiplyLeft(x)}super({...e,width:y,height:v,viewMatrix:x,longitude:n,latitude:t,zoom:i,...w,fovy:E,focalDistance:_}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=s,this.altitude=_,this.fovy=E,this.orthographic=u,this._subViewports=d?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const e=i?new lA({...this,worldOffset:i}):this;this._subViewports.push(e)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*cx(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/cx(n)]}addMetersToLngLat(e,t){return hx(e,t)}panByPosition(e,t){const n=gx(t,this.pixelUnprojectionMatrix),i=H_([],this.projectFlat(e),((r=[])[0]=-(s=n)[0],r[1]=-s[1],r));var r,s;const o=H_([],this.center,i),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const t=function(e,t=0){const{width:n,height:i,unproject:r}=e,s={targetZ:t},o=r([0,i],s),a=r([n,i],s);let l,c;return(e.fovy?.5*e.fovy*yx:Math.atan(.5/e.altitude))>(90-e.pitch)*yx-.01?(l=vx(e,0,t),c=vx(e,n,t)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:r,latitude:s,zoom:o}=mx({width:n,height:i,bounds:e,...t});return new lA({width:n,height:i,longitude:r,latitude:s,zoom:o})}}lA.displayName="WebMercatorViewport";const cA=[0,0,0];function uA(e,t,n=!1){const i=t.projectPosition(e);if(n&&t instanceof lA){const[n,r,s=0]=e,o=t.getDistanceScales([n,r]);i[2]=s*o.unitsPerMeter[2]}return i}function hA(e,{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=e;switch(n&&([o,a,l]=Pb([],[o,a,l,1],n)),i){case Tw.LNGLAT:return uA([o,a,l],t,s);case Tw.LNGLAT_OFFSETS:return uA([o+r[0],a+r[1],l+(r[2]||0)],t,s);case Tw.METER_OFFSETS:return uA(hx(r,[o,a,l]),t,s);case Tw.CARTESIAN:default:return t.isGeospatial?[o+r[0],a+r[1],l+r[2]]:t.projectPosition([o,a,l])}}function dA(e,t){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(e){const{viewport:t,modelMatrix:n,coordinateOrigin:i}=e;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=e;return r===Tw.DEFAULT&&(r=t.isGeospatial?Tw.LNGLAT:Tw.CARTESIAN),void 0===s&&(s=r),void 0===o&&(o=i),{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=cA,shaderCoordinateOrigin:u=cA,offsetMode:h=!1}=l?Uw(n,i,r):{},d=hA(e,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const e=n.projectPosition(c||u);sb(d,d,e)}return d}let fA=1,pA=1;class gA{constructor(){i(this,"time",0),i(this,"channels",new Map),i(this,"animations",new Map),i(this,"playing",!1),i(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,s=fA++,o={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:e,channel:t}=i;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=pA++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let mA=0;const yA=class e{constructor(t){if(i(this,"device",null),i(this,"canvas",null),i(this,"props"),i(this,"animationProps",null),i(this,"timeline",null),i(this,"stats"),i(this,"cpuTime"),i(this,"gpuTime"),i(this,"frameRate"),i(this,"display"),i(this,"needsRedraw","initialized"),i(this,"_initialized",!1),i(this,"_running",!1),i(this,"_animationFrameId",null),i(this,"_nextFramePromise",null),i(this,"_resolveNextFrame",null),i(this,"_cpuStartTime",0),i(this,"_error",null),this.props={...e.defaultAnimationLoopProps,...t},!(t=this.props).device)throw new Error("No device provided");this.stats=t.stats||new rf({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(null==(e=this.device)?void 0:e.isLost)||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),null==(t=this.device)||t.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){var e;const t=null==(e=this.device)?void 0:e.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");const n=null==t?void 0:t.canvas,i=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:n,useDevicePixels:i,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var e,t;if(!this.device)return{width:1,height:1,aspect:1};const[n,i]=(null==(e=this.device)?void 0:e.getDefaultCanvasContext().getDevicePixelSize())||[1,1];let r=1;const s=null==(t=this.device)?void 0:t.getDefaultCanvasContext().canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:n>0&&i>0&&(r=n/i),{width:n,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};i(yA,"defaultAnimationLoopProps",{device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>{},stats:lm.stats.get("animation-loop-"+mA++),autoResizeViewport:!1});let vA=yA;const _A={};function bA(e="id"){_A[e]=_A[e]||1;return`${e}-${_A[e]++}`}class EA{constructor(e){if(i(this,"id"),i(this,"userData",{}),i(this,"topology"),i(this,"bufferLayout",[]),i(this,"vertexCount"),i(this,"indices"),i(this,"attributes"),this.id=e.id||bA("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Rg.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;null==(e=this.indices)||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function wA(e,t){if(t instanceof EA)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:Rg.INDEX,data:n})}(e,t),{attributes:i,bufferLayout:r}=function(e,t){const n=[],i={};for(const[s,o]of Object.entries(t.attributes)){let t=s;switch(s){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(o){i[t]=e.createBuffer({data:o.value,id:`${s}-buffer`});const{value:r,size:a,normalized:l}=o;n.push({name:t,format:Dg(r,a,l)})}}const r=t._calculateVertexCount(t.attributes,t.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}(e,t);return new EA({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:n,attributes:i})}const xA=class e{constructor(e){i(this,"device"),i(this,"cachingEnabled"),i(this,"destroyPolicy"),i(this,"debug"),i(this,"_hashCounter",0),i(this,"_hashes",{}),i(this,"_renderPipelineCache",{}),i(this,"_computePipelineCache",{}),this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e(t),t._lumaData.defaultPipelineFactory}get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}createRenderPipeline(e){var t;if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const n={...Mm.defaultProps,...e},i=this._renderPipelineCache,r=this._hashRenderPipeline(n);let s=null==(t=i[r])?void 0:t.pipeline;return s?(i[r].useCount++,this.debug&&Sg.warn(`${this}: ${i[r].pipeline} reused, count=${i[r].useCount}, (id=${e.id})`)()):(s=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:bA("unnamed-cached")}),s.hash=r,i[r]={pipeline:s,useCount:1},this.debug&&Sg.warn(`${this}: ${s} created, count=${i[r].useCount}`)()),s}createComputePipeline(e){var t;if(!this.cachingEnabled)return this.device.createComputePipeline(e);const n={...Om.defaultProps,...e},i=this._computePipelineCache,r=this._hashComputePipeline(n);let s=null==(t=i[r])?void 0:t.pipeline;return s?(i[r].useCount++,this.debug&&Sg.warn(`${this}: ${i[r].pipeline} reused, count=${i[r].useCount}, (id=${e.id})`)()):(s=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0}),s.hash=r,i[r]={pipeline:s,useCount:1},this.debug&&Sg.warn(`${this}: ${s} created, count=${i[r].useCount}`)()),s}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._getCache(e),n=e.hash;t[n].useCount--,0===t[n].useCount?(this._destroyPipeline(e),this.debug&&Sg.warn(`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(Sg.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&Sg.warn(`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Om&&(t=this._computePipelineCache),e instanceof Mm&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device;return`${t}/C/${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout)),{type:r}=this.device;if("webgl"===r)return`${r}/R/${t}/${n}V-BL${i}`;{const s=this._getHash(JSON.stringify(e.parameters));return`${r}/R/${t}/${n}V-T${e.topology}P${s}BL${i}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};i(xA,"defaultProps",{...Mm.defaultProps});let AA=xA;const SA=class e{constructor(e){i(this,"device"),i(this,"cachingEnabled"),i(this,"destroyPolicy"),i(this,"debug"),i(this,"_cache",{}),this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}static getDefaultShaderFactory(t){var n;return(n=t._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new e(t)),t._lumaData.defaultShaderFactory}get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&Sg.warn(`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:1},this.debug&&Sg.warn(`${this}: Created new shader ${i.id}`)()}return n.shader}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,0===n.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy(),this.debug&&Sg.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&Sg.warn(`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}};i(SA,"defaultProps",{...Cm.defaultProps});let TA=SA;let CA=null,IA=null;function kA(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!kA(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i){if(!t.hasOwnProperty(s))return!1;if(!kA(e[s],t[s],n-1))return!1}return!0}return!1}class RA{constructor(e){i(this,"bufferLayouts"),this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?null==(t=e.attributes)?void 0:t.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const i of t){const e=n.findIndex(e=>e.name===i.name);e<0?n.push(i):n[e]=i}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(t=>t.name===e);return-1===t&&Sg.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function PA(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}(e)}function MA(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const i=e[n];var r;PA(r=i)||"number"==typeof r||"boolean"==typeof r?t.uniforms[n]=i:t.bindings[n]=i}),t}class LA{constructor(e,t){i(this,"options",{disableWarnings:!1}),i(this,"modules"),i(this,"moduleUniforms"),i(this,"moduleBindings"),Object.assign(this.options,t);const n=ig(Object.values(e).filter(e=>e.dependencies));for(const i of n)e[i.name]=i;Sg.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,r]of Object.entries(e))this._addModule(r),r.name&&i!==r.name&&!this.options.disableWarnings&&Sg.warn(`Module name: ${i} vs ${r.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const i=n,r=e[i]||{},s=this.modules[i];if(!s){this.options.disableWarnings||Sg.warn(`Module ${n} not found`)();continue}const o=this.moduleUniforms[i],a=this.moduleBindings[i],l=(null==(t=s.getUniforms)?void 0:t.call(s,r,o))||r,{uniforms:c,bindings:u}=MA(l);this.moduleUniforms[i]={...o,...c},this.moduleBindings[i]={...a,...u}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var e;const t={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[r,s]of Object.entries(i))t[`${n}.${r}`]={type:null==(e=this.modules[n].uniformTypes)?void 0:e[r],value:String(s)};return t}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}const BA=["+X","-X","+Y","-Y","+Z","-Z"],NA=["+X","-X","+Y","-Y","+Z","-Z"],OA=class e{constructor(t,n){i(this,"device"),i(this,"id"),i(this,"props"),i(this,"texture"),i(this,"sampler"),i(this,"view"),i(this,"ready"),i(this,"isReady",!1),i(this,"destroyed",!1),i(this,"resolveReady",()=>{}),i(this,"rejectReady",()=>{}),this.device=t;const r=bA("async-texture");this.props={...e.defaultProps,id:r,...n},this.id=this.props.id,"string"==typeof(null==(n={...n})?void 0:n.data)&&"2d"===n.dimension&&(n.data=async function(e,t){const n=new Image;return n.crossOrigin="anonymous",n.src=e.startsWith("http")?e:""+e,await n.decode(),t?await createImageBitmap(n,t):await createImageBitmap(n)}(n.data)),n.mipmaps&&(n.mipLevels="auto"),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data,n=await FA(t).then(void 0,this.rejectReady);if(this.destroyed)return;const i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!i)throw new Error("Texture size could not be determined");const r={...i,...e,data:void 0,mipLevels:1},s=this.device.getMipLevelCount(r.width,r.height);if(r.mipLevels="auto"===this.props.mipLevels?s:Math.min(s,this.props.mipLevels),this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n)}this.props.mipmaps&&this.generateMipmaps(),Sg.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof vm?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=null==e?void 0:e.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e)return null;if(ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&!1!==this.props.mipmaps&&Sg.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){const e=n[i];this.device.isExternalImage(e)?this.texture.copyExternalImage({image:e,depth:t,mipLevel:i,flipY:!0}):this.texture.copyImageData({data:e.data,mipLevel:i})}}_setTexture3DData(e,t){var n;if("3d"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeData(e,t){var n;if("cube"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(const[i,r]of Object.entries(t)){const e=NA.indexOf(i);this._setTexture2DData(r,e)}}_setTextureArrayData(e,t){var n;if("2d-array"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,i=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&Sg.warn(`${this.id} has mipmap and multiple LODs.`)();const r=BA.indexOf(n);this._setTexture2DData(t,r)}_normalizeTextureData(e){const t=this.texture;let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}};i(OA,"defaultProps",{...Em.defaultProps,data:null,mipmaps:!1});let DA=OA;async function FA(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(FA));if(e&&"object"==typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),i=Object.keys(t),r={};for(let e=0;e<i.length;e++)r[i[e]]=n[e];return r}return e}const UA=class e{constructor(t,n){var r,s,o,a;i(this,"device"),i(this,"id"),i(this,"source"),i(this,"vs"),i(this,"fs"),i(this,"pipelineFactory"),i(this,"shaderFactory"),i(this,"userData",{}),i(this,"parameters"),i(this,"topology"),i(this,"bufferLayout"),i(this,"isInstanced"),i(this,"instanceCount",0),i(this,"vertexCount"),i(this,"indexBuffer",null),i(this,"bufferAttributes",{}),i(this,"constantAttributes",{}),i(this,"bindings",{}),i(this,"vertexArray"),i(this,"transformFeedback",null),i(this,"pipeline"),i(this,"shaderInputs"),i(this,"_uniformStore"),i(this,"_attributeInfos",{}),i(this,"_gpuGeometry",null),i(this,"props"),i(this,"_pipelineNeedsUpdate","newly created"),i(this,"_needsRedraw","initializing"),i(this,"_destroyed",!1),i(this,"_lastDrawTimestamp",-1),i(this,"_lastLogTime",0),i(this,"_logOpen",!1),i(this,"_drawCount",0),this.props={...e.defaultProps,...n},n=this.props,this.id=n.id||bA("model"),this.device=t,Object.assign(this.userData,n.userData);const l=Object.fromEntries((null==(r=this.props.modules)?void 0:r.map(e=>[e.name,e]))||[]),c=n.shaderInputs||new LA(l,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(c);const u=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(t),h=((null==(s=this.props.modules)?void 0:s.length)>0?this.props.modules:null==(o=this.shaderInputs)?void 0:o.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:u,...this.props,modules:h});this.source=e,this._getModuleUniforms=t,(a=this.props).shaderLayout||(a.shaderLayout=w_(this.source))}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:u,...this.props,modules:h});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||AA.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||TA.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),null==(e=this._gpuGeometry)||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Sg.info(2,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings});const{indexBuffer:i}=this.vertexArray,r=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var t;null==(t=this._gpuGeometry)||t.destroy();const n=e&&wA(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const e=new RA(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new RA(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){kA(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new ry(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(GA(n)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=e}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(null==t?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&Sg.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map(e=>[e.name,e.location])),i=t.slice();return i.sort((e,t)=>{const i=e.attributes?e.attributes.map(e=>e.attribute):[e.name],r=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...i.map(e=>n[e]))-Math.min(...r.map(e=>n[e]))}),i}(this.pipeline.shaderLayout,this.bufferLayout);const i=new RA(this.bufferLayout);for(const[r,s]of Object.entries(e)){const e=i.getBufferLayout(r);if(!e){n||Sg.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const t=i.getAttributeNamesForBuffer(e);let o=!1;for(const n of t){const e=this._attributeInfos[n];if(e){const t="webgpu"===this.device.type?i.getBufferIndex(e.bufferName):e.location;this.vertexArray.setBuffer(t,s),o=!0}}o||n||Sg.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,i):((null==t?void 0:t.disableWarnings)??this.props.disableWarnings)||Sg.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof DA&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof DA?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof xm?e=Math.max(e,t.texture.updateTimestamp):t instanceof Rg||t instanceof Em?e=Math.max(e,t.updateTimestamp):t instanceof DA?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof vm||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(e=>e.name===n)||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Sg.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=Wm(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Sg.level>3?0:1e4;Sg.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Sg.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:Sg.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){var t;const n={},i="Values";if(0===e.attributes.length&&!(null==(t=e.varyings)?void 0:t.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const r of e.attributes)r&&(n[`in ${r.location} ${r.name}: ${r.type}`]={[i]:r.stepMode||"vertex"});for(const r of e.varyings||[])n[`out ${r.location} ${r.name}`]={[i]:JSON.stringify(r)};return n}(this.pipeline.shaderLayout,this.id);Sg.table(2,e)();const t=this.shaderInputs.getDebugTable();Sg.table(2,t)();const n=this._getAttributeDebugTable();Sg.table(2,this._attributeInfos)(),Sg.table(2,n)(),Sg.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,{id:t,minimap:n,opaque:i,top:r="0",left:s="0",rgbaScale:o=1}){CA||(CA=document.createElement("canvas"),CA.id=t,CA.title=t,CA.style.zIndex="100",CA.style.position="absolute",CA.style.top=r,CA.style.left=s,CA.style.border="blue 5px solid",CA.style.transform="scaleY(-1)",document.body.appendChild(CA),IA=CA.getContext("2d")),CA.width===e.width&&CA.height===e.height||(CA.width=e.width/2,CA.height=e.height/2,CA.style.width="400px",CA.style.height="400px");const a=e.device.readPixelsToArrayWebGL(e),l=null==IA?void 0:IA.createImageData(e.width,e.height);if(l){const e=0;for(let t=0;t<a.length;t+=4)l.data[e+t+0]=a[t+0]*o,l.data[e+t+1]=a[t+1]*o,l.data[e+t+2]=a[t+2]*o,l.data[e+t+3]=i?255:a[t+3]*o;null==IA||IA.putImageData(l,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=Bg(t);return(e instanceof Rg?new n(e.debugData):e).toString()}};i(UA,"defaultProps",{...Mm.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:wg.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let zA=UA;function GA(e){return Boolean(e.uniformTypes&&!function(e){for(const t in e)return!1;return!0}(e.uniformTypes))}const VA=class e{constructor(t,n=e.defaultProps){if(i(this,"device"),i(this,"model"),i(this,"transformFeedback"),!e.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new zA(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||xg(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return"webgl"===(null==(t=null==e?void 0:e.info)?void 0:t.type)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){(null==e?void 0:e.inputBuffers)&&this.model.setAttributes(e.inputBuffers),(null==e?void 0:e.outputBuffers)&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Rg)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:r=n.byteLength}=t;return n.readAsync(i,r)}};i(VA,"defaultProps",{...zA.defaultProps,outputs:void 0,feedbackBuffers:void 0});let HA=VA;class jA{constructor(e){i(this,"id"),i(this,"topology"),i(this,"vertexCount"),i(this,"indices"),i(this,"attributes"),i(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:r=null}=e;this.id=e.id||bA("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[i,s]of Object.entries(t)){const e=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(e.value))throw new Error(`${this._print(i)}: must be typed array or object with value as typed array`);if("POSITION"!==i&&"positions"!==i||e.size||(e.size=3),"indices"===i){if(this.indices)throw new Error("Multiple indices detected");this.indices=e}else this.attributes[i]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:e,size:t,constant:r}=i;!r&&e&&void 0!==t&&t>=1&&(n=Math.min(n,e.length/t))}return n}}class WA{constructor(e={}){i(this,"id"),i(this,"matrix",new Fb),i(this,"display",!0),i(this,"position",new hb),i(this,"rotation",new hb),i(this,"scale",new hb(1,1,1)),i(this,"userData",{}),i(this,"props",{});const{id:t}=e;this.id=t||bA(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:n,scale:i,update:r=!0}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),r&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update(e={}){const{position:t,rotation:n,scale:i}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const n=new Fb(e).multiplyRight(t),i=n.invert(),r=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:r}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class $A extends WA{constructor(e={}){e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;Sg.assert(t.every(e=>e instanceof WA),"every child must an instance of ScenegraphNode"),super(e),i(this,"children"),this.children=t}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,{worldMatrix:n})=>{const i=t.getBounds();if(!i)return;const[r,s]=i,o=new hb(r).add(s).divide([2,2,2]);n.transformAsPoint(o,o);const a=new hb(s).subtract(r).divide([2,2,2]);n.transformAsVector(a,a);for(let l=0;l<8;l++){const t=new hb(1&l?-1:1,2&l?-1:1,4&l?-1:1).multiply(a).add(o);for(let n=0;n<3;n++)e[0][n]=Math.min(e[0][n],t[n]),e[1][n]=Math.max(e[1][n],t[n])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(const t of e)Array.isArray(t)?this.add(...t):this.children.push(t);return this}remove(e){const t=this.children,n=t.indexOf(e);return n>-1&&t.splice(n,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:t=new Fb}={}){const n=new Fb(t).multiplyRight(this.matrix);for(const i of this.children)i instanceof $A?i.traverse(e,{worldMatrix:n}):e(i,{worldMatrix:n})}}class XA extends WA{constructor(e){super(e),i(this,"model"),i(this,"bounds",null),i(this,"managedResources"),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}}const qA={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class KA extends Vx{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,pickingFBO:s,deviceRect:{x:o,y:a,width:l,height:c},cullRect:u,effects:h,pass:d="picking",pickZ:f,shaderModuleProps:p}){this.pickZ=f;const g=this._resetColorEncoder(f),m=[o,a,l,c],y=super.render({target:s,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,cullRect:u,effects:null==h?void 0:h.filter(e=>e.useInPicking),pass:d,isPicking:!0,shaderModuleProps:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});this._colorEncoderState=null;return{decodePickingColor:g&&YA.bind(null,g),stats:y}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const i={...e.props.parameters},{pickable:r,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:r&&s.includes("draw")&&(Object.assign(i,qA),i.blend=!0,i.blendColor=function(e,t,n){const{byLayer:i,byAlpha:r}=e;let s,o=i.get(t);o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:t,viewports:[n]},i.set(t,o),r[s]=o):(Op.warn("Too many pickable layers, only picking the first 255")(),s=0));return[0,0,0,s/255]}(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function YA(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}const JA="Awaiting state",ZA="Matched. State transferred from previous layer",QA="Initialized",eS="Discarded. Awaiting garbage collection",tS="No longer matched. Awaiting garbage collection",nS="Finalized! Awaiting garbage collection",iS=Symbol.for("component"),rS=Symbol.for("propTypes"),sS=Symbol.for("deprecatedProps"),oS=Symbol.for("asyncPropDefaults"),aS=Symbol.for("asyncPropOriginal"),lS=Symbol.for("asyncPropResolved");function cS(e,t=()=>!0){return Array.isArray(e)?uS(e,t,[]):t(e)?[e]:[]}function uS(e,t,n){let i=-1;for(;++i<e.length;){const r=e[i];Array.isArray(r)?uS(r,t,n):t(r)&&n.push(r)}return n}function hS({target:e,source:t,start:n=0,count:i=1}){const r=t.length,s=i*r;let o=0;for(let a=n;o<r;o++)e[a++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+s-o),o=s);return e}class dS{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;"string"==typeof e&&(i=dp(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const r of this._subscribers)r.onChange(this.getData())}}class fS{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:null==(t=e.device)?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let r=this._resources[e];r?r.setData(t,n):(r=new dS(e,t,this._context),this._resources[e]=r),r.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const e in t){const n=t[e],i=this._resources[n.resourceId];i&&i.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:r,protocol:s}=this;e.startsWith(s)&&(r[e=e.replace(s,"")]||this.add({resourceId:e,data:null,persistent:!1}));const o=r[e];if(this._track(n,i,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const r=this._consumers,s=r[e]=r[e]||{};let o=s[t];const a=o&&o.resourceId&&this._resources[o.resourceId];a&&(a.unsubscribe(o),this.prune()),n&&(o?(o.onChange=i,o.resourceId=n.id):o={onChange:i,resourceId:n.id},s[t]=o,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}class pS{constructor(e,t){var n;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{Up("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:i,stats:r,viewport:s,timeline:o}=t||{};this.layers=[],this.resourceManager=new fS({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:null==e?void 0:e.gl,deck:i,shaderAssembler:Px((null==(n=null==e?void 0:e.info)?void 0:n.shadingLanguage)||"glsl"),defaultShaderModules:[wE],renderPass:void 0,stats:r||new rf({id:"deck.gl"}),viewport:s||new aA({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new gA,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Up("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const n=cS(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(t=>t.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const s of e)n[s.id]?Op.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let r=!1;for(const s of i)if(s.hasUniformTransition()){r=`Uniform transition in ${s}`;break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(e,t,n){for(const r of e){r.context=this.context;const e=t[r.id];null===e&&Op.warn(`Multiple new layers with same id ${r.id}`)(),t[r.id]=null;let s=null;try{this._debug&&e!==r&&r.validateProps(),e?(this._transferLayerState(e,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),s=r.isComposite?r.getSubLayers():null}catch(i){this._handleError("matching",i,r)}s&&this._updateSublayersRecursively(s,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=QA}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=ZA,t!==e&&(e.lifecycle=eS)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=tS;try{e._finalize(),e.lifecycle=nS}catch(t){this._handleError("finalization",t,e)}}}function gS(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!gS(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i){if(!t.hasOwnProperty(s))return!1;if(!gS(e[s],t[s],n-1))return!1}return!0}return!1}class mS{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t="string"==typeof e?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const s=n[r];if(s.containsPixel(i)){const n=e.slice();return n[0]-=s.x,n[1]-=s.y,s.unproject(n,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=cS(e,Boolean);this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){if(e){!gS(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else Op.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>{var n;return null==(n=this.getView(e.id))?void 0:n.makeViewport({viewState:t,width:this.width,height:this.height})}});return n}_updateController(e,t,n,i){const r=e.controller;if(r&&n){const s={...t,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return i&&i.constructor===r.type||(i=this._createController(e,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const r=e[i],s=this.getViewState(r),o=r.makeViewport({viewState:s,width:this.width,height:this.height});let a=t[r.id];const l=Boolean(r.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[r.id]=this._updateController(r,s,o,a),o&&this._viewports.unshift(o)}for(const i in t){const e=t[i];e&&!this.controllers[i]&&e.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((n,i)=>!e[i].equals(t[i]))}}const yS=/([0-9]+\.?[0-9]*)(%|px)/;function vS(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=yS.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function _S(e,t){return e.relative?Math.round(e.position*t):e.position}class bS{constructor(e){const{id:t,x:n=0,y:i=0,width:r="100%",height:s="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=vS(n),this._y=vS(i),this._width=vS(r),this._height=vS(s),this._padding=o&&{left:vS(o.left||0),right:vS(o.right||0),top:vS(o.top||0),bottom:vS(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&gS(this.props,e.props,2)}clone(e){return new(0,this.constructor)({...this.props,...e})}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;return new(this.getViewportType(n))({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return"string"==typeof e?e:(null==e?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){const n={x:_S(this._x,e),y:_S(this._y,t),width:_S(this._width,e),height:_S(this._height,t)};return this._padding&&(n.padding={left:_S(this._padding.left,e),top:_S(this._padding.top,t),right:_S(this._padding.right,e),bottom:_S(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}class ES{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,null==(n=(t=this.settings).onStart)||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null==(t=(e=this.settings).onEnd)||t.call(e,this))}cancel(){var e,t;this._inProgress&&(null==(t=(e=this.settings).onInterrupt)||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null==(t=(e=this.settings).onUpdate)||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const wS=()=>{},xS=2,AS=3,SS=e=>e,TS=1;class CS{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:n,startProps:i,endProps:r,duration:s,easing:o}}=e,a=o(t/s),l=n.interpolateProps(i,r,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new ES(e.timeline),this.onViewStateChange=e.onViewStateChange||wS,this.onStateChange=e.onStateChange||wS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;i={...n,...e===xS?t:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){if(this.transition.inProgress){return this.transition.settings.interruption===AS||this._isUpdateDueToCurrentTransition(t)}return!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),r=t.transitionInterpolator,s=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(0===s)return;const o=r.initializeProps(e,i);this.propsInTransition={};const a={duration:s,easing:t.transitionEasing||SS,interpolator:r,interruption:t.transitionInterruption||TS,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null==e||e(t)}}}function IS(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class kS{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!B_(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const r of this._propsToExtract)(r in e||r in t)&&(n[r]=e[r],i[r]=t[r]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];IS(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const RS=["longitude","latitude","zoom","bearing","pitch"],PS=["longitude","latitude","zoom"];class MS extends kS{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:RS,required:PS},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:r}=this.opts;if(i&&r){const s=i(e),o=i(t),a=s.unproject(r);n.start.around=r,Object.assign(n.end,{around:o.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const r of this._propsToExtract)i[r]=L_(e[r]||0,t[r]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...i});Object.assign(i,r.panByPosition(t.aroundPosition,L_(e.around,t.around,n)))}return i}}const LS={transitionDuration:0},BS=e=>1-(1-e)*(1-e),NS=["wheel"],OS=["panstart","panmove","panend"],DS=["pinchstart","pinchmove","pinchend"],FS=["multipanstart","multipanmove","multipanend"],US=["dblclick"],zS=["keydown"],GS={};class VS{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new CS({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&(null==(e=this.eventManager)||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:s=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(NS,c&&n),this.toggleEvents(OS,c),this.toggleEvents(DS,c&&(o||a)),this.toggleEvents(FS,c&&a),this.toggleEvents(US,c&&s),this.toggleEvents(zS,c&&l),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=s,this.touchZoom=o,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t=null,n={}){const i={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),r){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,LS,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,LS,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:BS},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,LS,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:BS},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:r}=e;let s=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==s&&(s=1/s);const o=i?{...this._getTransitionProps({around:t}),transitionDuration:250}:LS,a=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(a,o,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,LS,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,LS,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:BS},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return GS._startPinchRotation=e.rotation,GS._lastPinchEvent=e,this.updateViewport(n,LS,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:GS._startPinchRotation-n})}return this.updateViewport(t,LS,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),GS._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=GS;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let r=this.controllerState.rotateEnd();const s=Math.log2(e.scale),o=(s-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,s+o*t/2);r=r.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:BS},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return GS._startPinchRotation=null,GS._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:s}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?o.zoomOut(n).zoomOut(n):o.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?o.zoomIn(n).zoomIn(n):o.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=o.rotateLeft(r),l.isRotating=!0):(a=o.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":t?(a=o.rotateRight(r),l.isRotating=!0):(a=o.moveRight(i),l.isPanning=!0);break;case"ArrowUp":t?(a=o.rotateUp(s),l.isRotating=!0):(a=o.moveUp(i),l.isPanning=!0);break;case"ArrowDown":t?(a=o.rotateDown(s),l.isRotating=!0):(a=o.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new MS({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:LS}}class HS{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class jS extends HS{constructor(e){const{width:t,height:n,latitude:i,longitude:r,zoom:s,bearing:o=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:y,startPitch:v,startZoom:_,normalize:b=!0}=e;IS(Number.isFinite(r)),IS(Number.isFinite(i)),IS(Number.isFinite(s)),super({width:t,height:n,latitude:i,longitude:r,zoom:s,bearing:o,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:f,normalize:b,position:c},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:y,startPitch:v,startZoom:_}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:s}=this.getState();if(!i||void 0===r||void 0===s)return this;let o;return o=e?this._getNewRotation(e,i,s,r):{bearing:r+t,pitch:s+n},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:r}=this.getState();if(r||(i=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:s,minZoom:o}=this.getViewportProps();let a=i+Math.log2(n);a=M_(a,o,s);const l=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...l.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:r}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=M_(i,n,t);const{maxPitch:r,minPitch:s,pitch:o}=e;e.pitch=M_(o,s,r);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:i=0}=e;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=e;(r<-180||r>180)&&(r=qw(r+180,360)-180),(a<-180||a>180)&&(a=qw(a+180,360)-180);const l=Yw(n/512);if(o<=l)o=l,s=0;else{const e=n/2/Math.pow(2,o),t=ax([0,e])[1];if(s<t)s=t;else{const t=ax([0,512-e])[1];s>t&&(s=t)}}return{width:t,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const r=e[0]-t[0],s=e[1]-t[1],o=e[1],a=t[1],{width:l,height:c}=this.getViewportProps(),u=r/l;let h=0;s>0?Math.abs(c-a)>5&&(h=s/(a-c)*1.2):s<0&&a>5&&(h=1-o/a),h=M_(h,-1,1);const{minPitch:d,maxPitch:f}=this.getViewportProps();let p=n;return h>0?p=n+h*(f-n):h<0&&(p=n-h*(d-n)),{pitch:p,bearing:i+180*u}}}class WS extends VS{constructor(){super(...arguments),this.ControllerState=jS,this.transition={transitionDuration:300,transitionInterpolator:new MS({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e);(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class $S extends bS{constructor(e={}){super(e)}getViewportType(){return lA}get ControllerType(){return WS}}$S.displayName="MapView";const XS=new Kx;class qS{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){const n=t.findIndex(t=>{return n=e,(t.order??1/0)-(n.order??1/0)>0;var n});n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(gS(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const e=t[i.id];let r=i;e&&e!==i?e.setProps?(e.setProps(i.props),r=e):e.cleanup(this._context):e||i.setup(this._context),n.push(r),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(e=>e instanceof Kx)||this._resolvedEffects.push(XS),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class KS extends Vx{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}class YS{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new KS(e),this.pickLayersPass=new KA(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=t.render({...n,target:i});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=void 0===e.clearCanvas||e.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,Up("deckRenderer.renderLayers",this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[n,i]=t;0===e.length&&[0,1].map(t=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:i});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[r]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const r of e)if(r.postRender){i.target=r.id===this.lastPostProcessEffect?t.target:void 0;const e=r.postRender(i);i.inputBuffer=e,i.swapBuffer=e===n[0]?n[1]:n[0]}}}const JS={pickedColor:null,pickedObjectIndex:-1};function ZS({pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=r*r,h=-1,d=0;for(let f=0;f<c;f++){const t=f+a-i,r=t*t;if(r>u)d+=4*l;else for(let i=0;i<l;i++){if(e[d+3]-1>=0){const e=i+o-n,t=e*e+r;t<=u&&(u=t,h=d)}d+=4}}if(h>=0){const n=e.slice(h,h+4),i=t(n);if(i){const e=Math.floor(h/4/l),t=h/4-e*l;return{...i,pickedColor:n,pickedX:o+t,pickedY:a+e}}Op.error("Picked non-existent layer. Is picking buffer corrupt?")()}return JS}function QS({pickedColors:e,decodePickingColor:t}){const n=new Map;if(e)for(let i=0;i<e.length;i+=4){if(e[i+3]-1>=0){const r=e.slice(i,i+4),s=r.join(",");if(!n.has(s)){const e=t(r);e?n.set(s,{...e,color:r}):Op.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function eT({pickInfo:e,viewports:t,pixelRatio:n,x:i,y:r,z:s}){let o,a=t[0];if(t.length>1&&(a=function(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.containsPixel(t))return i}return e[0]}((null==e?void 0:e.pickedViewports)||t,{x:i,y:r})),a){const e=[i-a.x,r-a.y];void 0!==s&&(e[2]=s),o=a.unproject(e)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:o,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function tT(e){const{pickInfo:t,lastPickedInfo:n,mode:i,layers:r}=e,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=t,l=o?[o]:[];if("hover"===i){const e=n.index,t=n.layerId,i=o?o.props.id:null;if(i!==t||a!==e){if(i!==t){const e=r.find(e=>e.props.id===t);e&&l.unshift(e)}n.layerId=i,n.index=a,n.info=null}}const c=eT(e),u=new Map;return u.set(null,c),l.forEach(e=>{let t={...c};e===o&&(t.color=s,t.index=a,t.picked=!0),t=nT({layer:e,info:t,mode:i});const r=t.layer;e===o&&"hover"===i&&(n.info=t),u.set(r.id,t),"hover"===i&&r.updateAutoHighlight(t)}),u}function nT({layer:e,info:t,mode:n}){for(;e&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}class iT{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new KA(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},r=this.lastPickedInfo.info){const s=r&&r.layer&&r.layer.id,o=r&&r.viewport&&r.viewport.id,a=s?n.find(e=>e.id===s):null,l=o&&i.find(e=>e.id===o)||i[0],c=l&&l.unproject([e-l.x,t-l.y]),u={x:e,y:t,viewport:l,coordinate:c,layer:a};return{...r,...u}}_resizeBuffer(){var e,t;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:n}=this.device.getDefaultCanvasContext();null==(e=this.pickingFBO)||e.resize({width:n.width,height:n.height}),null==(t=this.depthFBO)||t.resize({width:n.width,height:n.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:n,x:i,y:r,radius:s=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===n.length)return{result:[],emptyInfo:eT({viewports:n,x:i,y:r,pixelRatio:h})};this._resizeBuffer();const f=this.device.canvasContext.cssToDevicePixels([i,r],!0),p=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],g=Math.round(s*h),{width:m,height:y}=this.pickingFBO,v=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceWidth:m,deviceHeight:y}),_={x:i-s,y:r-s,width:2*s+1,height:2*s+1};let b;const E=[],w=new Set;for(let x=0;x<o;x++){let e,s;if(v){e=ZS({...this._drawAndSample({layers:d,views:t,viewports:n,onViewportActive:c,deviceRect:v,cullRect:_,effects:u,pass:`picking:${a}`}),deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceRect:v})}else e={pickedColor:null,pickedObjectIndex:-1};if(e.pickedLayer&&l&&this.depthFBO){const{pickedColors:i}=this._drawAndSample({layers:[e.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:_,effects:u,pass:`picking:${a}:z`},!0);i[3]&&(s=i[0])}e.pickedLayer&&x+1<o&&(w.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),b=tT({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:n,x:i,y:r,z:s,pixelRatio:h});for(const t of b.values())t.layer&&E.push(t);if(!e.pickedColor)break}for(const x of w)x.restorePickingColors();return{result:E,emptyInfo:b.get(null)}}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:r,radius:s=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===n.length)return{result:[],emptyInfo:eT({viewports:n,x:i,y:r,pixelRatio:h})};this._resizeBuffer();const f=this.device.canvasContext.cssToDevicePixels([i,r],!0),p=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],g=Math.round(s*h),{width:m,height:y}=this.pickingFBO,v=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceWidth:m,deviceHeight:y}),_={x:i-s,y:r-s,width:2*s+1,height:2*s+1};let b;const E=[],w=new Set;for(let x=0;x<o;x++){let e,s;if(v){e=ZS({...this._drawAndSample({layers:d,views:t,viewports:n,onViewportActive:c,deviceRect:v,cullRect:_,effects:u,pass:`picking:${a}`}),deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceRect:v})}else e={pickedColor:null,pickedObjectIndex:-1};if(e.pickedLayer&&l&&this.depthFBO){const{pickedColors:i}=this._drawAndSample({layers:[e.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:_,effects:u,pass:`picking:${a}:z`},!0);i[3]&&(s=i[0])}e.pickedLayer&&x+1<o&&(w.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),b=tT({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:n,x:i,y:r,z:s,pixelRatio:h});for(const t of b.values())t.layer&&E.push(t);if(!e.pickedColor)break}for(const x of w)x.restorePickingColors();return{result:E,emptyInfo:b.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:n,x:i,y:r,width:s=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(e);if(!h||0===n.length)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([i,r],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([i+s,r+o],!0),y=m.x+m.width,v=m.y,_={x:p,y:v,width:y-p,height:g-v},b=QS(this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:c,deviceRect:_,cullRect:{x:i,y:r,width:s,height:o},effects:u,pass:`picking:${a}`})),E=new Map,w=[],x=Number.isFinite(l);for(let A=0;A<b.length&&!(x&&w.length>=l);A++){const e=b[A];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:d};t=nT({layer:e.pickedLayer,info:t,mode:a});const n=t.layer.id;E.has(n)||E.set(n,new Set);const s=E.get(n),o=t.object??t.index;s.has(o)||(s.add(o),w.push(t))}return w}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:r,width:s=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(e);if(!h||0===n.length)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([i,r],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([i+s,r+o],!0),y=m.x+m.width,v=m.y,_={x:p,y:v,width:y-p,height:g-v},b=QS(this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:c,deviceRect:_,cullRect:{x:i,y:r,width:s,height:o},effects:u,pass:`picking:${a}`})),E=new Map,w=[],x=Number.isFinite(l);for(let A=0;A<b.length&&!(x&&w.length>=l);A++){const e=b[A];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:d};t=nT({layer:e.pickedLayer,info:t,mode:a});const n=t.layer.id;E.has(n)||E.set(n,new Set);const s=E.get(n),o=t.object??t.index;s.has(o)||(s.add(o),w.push(t))}return w}async _drawAndSampleAsync({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:r,cullRect:s,effects:o,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:c,deviceRect:r,cullRect:s,effects:o,pass:a,pickZ:l,preRenderStats:{},isPicking:!0};for(const y of o)y.useInPicking&&(u.preRenderStats[y.id]=y.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=r,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:r,cullRect:s,effects:o,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:c,deviceRect:r,cullRect:s,effects:o,pass:a,pickZ:l,preRenderStats:{},isPicking:!0};for(const y of o)y.useInPicking&&(u.preRenderStats[y.id]=y.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=r,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:r}){const s=Math.max(0,e-n),o=Math.max(0,t-n),a=Math.min(i,e+n+1)-s,l=Math.min(r,t+n+1)-o;return a<=0||l<=0?null:{x:s,y:o,width:a,height:l}}}const rT={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},sT="top-left",oT="__root";class aT{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,null==t||t.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!gS(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){var n,i;const r=e.reduce((e,t)=>(e[t.id]=t,e),{});for(const s of this.getWidgets()){const{viewId:o}=s;if(o){const e=r[o];e&&(s.onViewportChange&&s.onViewportChange(e),null==(n=s.onRedraw)||n.call(s,{viewports:[e],layers:t}))}else{if(s.onViewportChange)for(const t of e)s.onViewportChange(t);null==(i=s.onRedraw)||i.call(s,{viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){var n,i;for(const r of this.getWidgets()){const{viewId:s}=r;s&&s!==(null==(n=e.viewport)?void 0:n.id)||null==(i=r.onHover)||i.call(r,e,t)}}onEvent(e,t){var n,i;const r=kw[t.type];if(r)for(const s of this.getWidgets()){const{viewId:o}=s;o&&o!==(null==(n=e.viewport)?void 0:n.id)||null==(i=s[r])||i.call(s,e,t)}}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const e=t[n.id];e?e.viewId!==n.viewId||e.placement!==n.placement?(this._removeWidget(e),this._addWidget(n)):n!==e&&(e.setProps(n.props),n=e):this._addWidget(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const e=t[n];e&&this._removeWidget(e)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:n=sT}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,n).append(e.rootElement),e.updateHTML()}_removeWidget(e){var t;null==(t=e.onRemove)||t.call(e),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){var n;const i=e||oT;let r=this.containers[i];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",null==(n=this.parentElement)||n.append(r),this.containers[i]=r);let s=r.querySelector(`.${t}`);return s||(s=globalThis.document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,rT[t]),r.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,r=n===oT||i,s=this.containers[n];r?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:e}px`,s.style.height=`${i?i.height:t}px`):s.style.display="none"}}}function lT(e,t){t&&Object.entries(t).map(([t,n])=>{t.startsWith("--")?e.style.setProperty(t,n):e.style[t]=n})}class cT{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,n=this.rootElement;var i,r;n&&t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),n&&!gS(t.style,e.style,1)&&(i=n,(r=t.style)&&Object.keys(r).map(e=>{e.startsWith("--")?i.style.removeProperty(e):i.style[e]=""}),lT(n,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(e=>"string"==typeof e&&e.length>0).forEach(e=>t.classList.add(e)),lT(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}cT.defaultProps={id:"widget",style:{},className:""};const uT={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class hT extends cT{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,uT),e}onRenderHTML(e){}onViewportChange(e){var t;this.isVisible&&e.id===(null==(t=this.lastViewport)?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.rootElement;if(i){if("string"==typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className)}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(i.style,e.style)}}}var dT,fT;hT.defaultProps={...cT.defaultProps},(fT=dT||(dT={}))[fT.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",fT[fT.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",fT[fT.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",fT[fT.POINTS=0]="POINTS",fT[fT.LINES=1]="LINES",fT[fT.LINE_LOOP=2]="LINE_LOOP",fT[fT.LINE_STRIP=3]="LINE_STRIP",fT[fT.TRIANGLES=4]="TRIANGLES",fT[fT.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",fT[fT.TRIANGLE_FAN=6]="TRIANGLE_FAN",fT[fT.ZERO=0]="ZERO",fT[fT.ONE=1]="ONE",fT[fT.SRC_COLOR=768]="SRC_COLOR",fT[fT.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",fT[fT.SRC_ALPHA=770]="SRC_ALPHA",fT[fT.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",fT[fT.DST_ALPHA=772]="DST_ALPHA",fT[fT.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",fT[fT.DST_COLOR=774]="DST_COLOR",fT[fT.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",fT[fT.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",fT[fT.CONSTANT_COLOR=32769]="CONSTANT_COLOR",fT[fT.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",fT[fT.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",fT[fT.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",fT[fT.FUNC_ADD=32774]="FUNC_ADD",fT[fT.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",fT[fT.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",fT[fT.BLEND_EQUATION=32777]="BLEND_EQUATION",fT[fT.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",fT[fT.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",fT[fT.BLEND_DST_RGB=32968]="BLEND_DST_RGB",fT[fT.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",fT[fT.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",fT[fT.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",fT[fT.BLEND_COLOR=32773]="BLEND_COLOR",fT[fT.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",fT[fT.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",fT[fT.LINE_WIDTH=2849]="LINE_WIDTH",fT[fT.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",fT[fT.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",fT[fT.CULL_FACE_MODE=2885]="CULL_FACE_MODE",fT[fT.FRONT_FACE=2886]="FRONT_FACE",fT[fT.DEPTH_RANGE=2928]="DEPTH_RANGE",fT[fT.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",fT[fT.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",fT[fT.DEPTH_FUNC=2932]="DEPTH_FUNC",fT[fT.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",fT[fT.STENCIL_FUNC=2962]="STENCIL_FUNC",fT[fT.STENCIL_FAIL=2964]="STENCIL_FAIL",fT[fT.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",fT[fT.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",fT[fT.STENCIL_REF=2967]="STENCIL_REF",fT[fT.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",fT[fT.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",fT[fT.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",fT[fT.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",fT[fT.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",fT[fT.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",fT[fT.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",fT[fT.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",fT[fT.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",fT[fT.VIEWPORT=2978]="VIEWPORT",fT[fT.SCISSOR_BOX=3088]="SCISSOR_BOX",fT[fT.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",fT[fT.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",fT[fT.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",fT[fT.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",fT[fT.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",fT[fT.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",fT[fT.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",fT[fT.RED_BITS=3410]="RED_BITS",fT[fT.GREEN_BITS=3411]="GREEN_BITS",fT[fT.BLUE_BITS=3412]="BLUE_BITS",fT[fT.ALPHA_BITS=3413]="ALPHA_BITS",fT[fT.DEPTH_BITS=3414]="DEPTH_BITS",fT[fT.STENCIL_BITS=3415]="STENCIL_BITS",fT[fT.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",fT[fT.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",fT[fT.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",fT[fT.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",fT[fT.SAMPLES=32937]="SAMPLES",fT[fT.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",fT[fT.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",fT[fT.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",fT[fT.VENDOR=7936]="VENDOR",fT[fT.RENDERER=7937]="RENDERER",fT[fT.VERSION=7938]="VERSION",fT[fT.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",fT[fT.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",fT[fT.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",fT[fT.STATIC_DRAW=35044]="STATIC_DRAW",fT[fT.STREAM_DRAW=35040]="STREAM_DRAW",fT[fT.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",fT[fT.ARRAY_BUFFER=34962]="ARRAY_BUFFER",fT[fT.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",fT[fT.BUFFER_SIZE=34660]="BUFFER_SIZE",fT[fT.BUFFER_USAGE=34661]="BUFFER_USAGE",fT[fT.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",fT[fT.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",fT[fT.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",fT[fT.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",fT[fT.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",fT[fT.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",fT[fT.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",fT[fT.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",fT[fT.CULL_FACE=2884]="CULL_FACE",fT[fT.FRONT=1028]="FRONT",fT[fT.BACK=1029]="BACK",fT[fT.FRONT_AND_BACK=1032]="FRONT_AND_BACK",fT[fT.BLEND=3042]="BLEND",fT[fT.DEPTH_TEST=2929]="DEPTH_TEST",fT[fT.DITHER=3024]="DITHER",fT[fT.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",fT[fT.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",fT[fT.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",fT[fT.SCISSOR_TEST=3089]="SCISSOR_TEST",fT[fT.STENCIL_TEST=2960]="STENCIL_TEST",fT[fT.NO_ERROR=0]="NO_ERROR",fT[fT.INVALID_ENUM=1280]="INVALID_ENUM",fT[fT.INVALID_VALUE=1281]="INVALID_VALUE",fT[fT.INVALID_OPERATION=1282]="INVALID_OPERATION",fT[fT.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",fT[fT.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",fT[fT.CW=2304]="CW",fT[fT.CCW=2305]="CCW",fT[fT.DONT_CARE=4352]="DONT_CARE",fT[fT.FASTEST=4353]="FASTEST",fT[fT.NICEST=4354]="NICEST",fT[fT.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",fT[fT.BYTE=5120]="BYTE",fT[fT.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",fT[fT.SHORT=5122]="SHORT",fT[fT.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",fT[fT.INT=5124]="INT",fT[fT.UNSIGNED_INT=5125]="UNSIGNED_INT",fT[fT.FLOAT=5126]="FLOAT",fT[fT.DOUBLE=5130]="DOUBLE",fT[fT.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",fT[fT.ALPHA=6406]="ALPHA",fT[fT.RGB=6407]="RGB",fT[fT.RGBA=6408]="RGBA",fT[fT.LUMINANCE=6409]="LUMINANCE",fT[fT.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",fT[fT.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",fT[fT.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",fT[fT.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",fT[fT.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",fT[fT.VERTEX_SHADER=35633]="VERTEX_SHADER",fT[fT.COMPILE_STATUS=35713]="COMPILE_STATUS",fT[fT.DELETE_STATUS=35712]="DELETE_STATUS",fT[fT.LINK_STATUS=35714]="LINK_STATUS",fT[fT.VALIDATE_STATUS=35715]="VALIDATE_STATUS",fT[fT.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",fT[fT.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",fT[fT.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",fT[fT.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",fT[fT.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",fT[fT.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",fT[fT.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",fT[fT.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",fT[fT.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",fT[fT.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",fT[fT.SHADER_TYPE=35663]="SHADER_TYPE",fT[fT.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",fT[fT.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",fT[fT.NEVER=512]="NEVER",fT[fT.LESS=513]="LESS",fT[fT.EQUAL=514]="EQUAL",fT[fT.LEQUAL=515]="LEQUAL",fT[fT.GREATER=516]="GREATER",fT[fT.NOTEQUAL=517]="NOTEQUAL",fT[fT.GEQUAL=518]="GEQUAL",fT[fT.ALWAYS=519]="ALWAYS",fT[fT.KEEP=7680]="KEEP",fT[fT.REPLACE=7681]="REPLACE",fT[fT.INCR=7682]="INCR",fT[fT.DECR=7683]="DECR",fT[fT.INVERT=5386]="INVERT",fT[fT.INCR_WRAP=34055]="INCR_WRAP",fT[fT.DECR_WRAP=34056]="DECR_WRAP",fT[fT.NEAREST=9728]="NEAREST",fT[fT.LINEAR=9729]="LINEAR",fT[fT.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",fT[fT.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",fT[fT.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",fT[fT.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",fT[fT.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",fT[fT.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",fT[fT.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",fT[fT.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",fT[fT.TEXTURE_2D=3553]="TEXTURE_2D",fT[fT.TEXTURE=5890]="TEXTURE",fT[fT.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",fT[fT.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",fT[fT.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",fT[fT.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",fT[fT.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",fT[fT.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",fT[fT.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",fT[fT.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",fT[fT.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",fT[fT.TEXTURE0=33984]="TEXTURE0",fT[fT.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",fT[fT.REPEAT=10497]="REPEAT",fT[fT.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",fT[fT.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",fT[fT.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",fT[fT.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",fT[fT.FLOAT_VEC2=35664]="FLOAT_VEC2",fT[fT.FLOAT_VEC3=35665]="FLOAT_VEC3",fT[fT.FLOAT_VEC4=35666]="FLOAT_VEC4",fT[fT.INT_VEC2=35667]="INT_VEC2",fT[fT.INT_VEC3=35668]="INT_VEC3",fT[fT.INT_VEC4=35669]="INT_VEC4",fT[fT.BOOL=35670]="BOOL",fT[fT.BOOL_VEC2=35671]="BOOL_VEC2",fT[fT.BOOL_VEC3=35672]="BOOL_VEC3",fT[fT.BOOL_VEC4=35673]="BOOL_VEC4",fT[fT.FLOAT_MAT2=35674]="FLOAT_MAT2",fT[fT.FLOAT_MAT3=35675]="FLOAT_MAT3",fT[fT.FLOAT_MAT4=35676]="FLOAT_MAT4",fT[fT.SAMPLER_2D=35678]="SAMPLER_2D",fT[fT.SAMPLER_CUBE=35680]="SAMPLER_CUBE",fT[fT.LOW_FLOAT=36336]="LOW_FLOAT",fT[fT.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",fT[fT.HIGH_FLOAT=36338]="HIGH_FLOAT",fT[fT.LOW_INT=36339]="LOW_INT",fT[fT.MEDIUM_INT=36340]="MEDIUM_INT",fT[fT.HIGH_INT=36341]="HIGH_INT",fT[fT.FRAMEBUFFER=36160]="FRAMEBUFFER",fT[fT.RENDERBUFFER=36161]="RENDERBUFFER",fT[fT.RGBA4=32854]="RGBA4",fT[fT.RGB5_A1=32855]="RGB5_A1",fT[fT.RGB565=36194]="RGB565",fT[fT.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",fT[fT.STENCIL_INDEX=6401]="STENCIL_INDEX",fT[fT.STENCIL_INDEX8=36168]="STENCIL_INDEX8",fT[fT.DEPTH_STENCIL=34041]="DEPTH_STENCIL",fT[fT.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",fT[fT.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",fT[fT.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",fT[fT.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",fT[fT.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",fT[fT.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",fT[fT.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",fT[fT.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",fT[fT.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",fT[fT.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",fT[fT.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",fT[fT.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",fT[fT.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",fT[fT.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",fT[fT.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",fT[fT.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",fT[fT.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",fT[fT.NONE=0]="NONE",fT[fT.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",fT[fT.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",fT[fT.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",fT[fT.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",fT[fT.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",fT[fT.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",fT[fT.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",fT[fT.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",fT[fT.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",fT[fT.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",fT[fT.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",fT[fT.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",fT[fT.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",fT[fT.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",fT[fT.READ_BUFFER=3074]="READ_BUFFER",fT[fT.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",fT[fT.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",fT[fT.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",fT[fT.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",fT[fT.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",fT[fT.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",fT[fT.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",fT[fT.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",fT[fT.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",fT[fT.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",fT[fT.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",fT[fT.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",fT[fT.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",fT[fT.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",fT[fT.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",fT[fT.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",fT[fT.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",fT[fT.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",fT[fT.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",fT[fT.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",fT[fT.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",fT[fT.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",fT[fT.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",fT[fT.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",fT[fT.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",fT[fT.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",fT[fT.RED=6403]="RED",fT[fT.RGB8=32849]="RGB8",fT[fT.RGBA8=32856]="RGBA8",fT[fT.RGB10_A2=32857]="RGB10_A2",fT[fT.TEXTURE_3D=32879]="TEXTURE_3D",fT[fT.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",fT[fT.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",fT[fT.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",fT[fT.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",fT[fT.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",fT[fT.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",fT[fT.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",fT[fT.SRGB=35904]="SRGB",fT[fT.SRGB8=35905]="SRGB8",fT[fT.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",fT[fT.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",fT[fT.RGBA32F=34836]="RGBA32F",fT[fT.RGB32F=34837]="RGB32F",fT[fT.RGBA16F=34842]="RGBA16F",fT[fT.RGB16F=34843]="RGB16F",fT[fT.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",fT[fT.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",fT[fT.R11F_G11F_B10F=35898]="R11F_G11F_B10F",fT[fT.RGB9_E5=35901]="RGB9_E5",fT[fT.RGBA32UI=36208]="RGBA32UI",fT[fT.RGB32UI=36209]="RGB32UI",fT[fT.RGBA16UI=36214]="RGBA16UI",fT[fT.RGB16UI=36215]="RGB16UI",fT[fT.RGBA8UI=36220]="RGBA8UI",fT[fT.RGB8UI=36221]="RGB8UI",fT[fT.RGBA32I=36226]="RGBA32I",fT[fT.RGB32I=36227]="RGB32I",fT[fT.RGBA16I=36232]="RGBA16I",fT[fT.RGB16I=36233]="RGB16I",fT[fT.RGBA8I=36238]="RGBA8I",fT[fT.RGB8I=36239]="RGB8I",fT[fT.RED_INTEGER=36244]="RED_INTEGER",fT[fT.RGB_INTEGER=36248]="RGB_INTEGER",fT[fT.RGBA_INTEGER=36249]="RGBA_INTEGER",fT[fT.R8=33321]="R8",fT[fT.RG8=33323]="RG8",fT[fT.R16F=33325]="R16F",fT[fT.R32F=33326]="R32F",fT[fT.RG16F=33327]="RG16F",fT[fT.RG32F=33328]="RG32F",fT[fT.R8I=33329]="R8I",fT[fT.R8UI=33330]="R8UI",fT[fT.R16I=33331]="R16I",fT[fT.R16UI=33332]="R16UI",fT[fT.R32I=33333]="R32I",fT[fT.R32UI=33334]="R32UI",fT[fT.RG8I=33335]="RG8I",fT[fT.RG8UI=33336]="RG8UI",fT[fT.RG16I=33337]="RG16I",fT[fT.RG16UI=33338]="RG16UI",fT[fT.RG32I=33339]="RG32I",fT[fT.RG32UI=33340]="RG32UI",fT[fT.R8_SNORM=36756]="R8_SNORM",fT[fT.RG8_SNORM=36757]="RG8_SNORM",fT[fT.RGB8_SNORM=36758]="RGB8_SNORM",fT[fT.RGBA8_SNORM=36759]="RGBA8_SNORM",fT[fT.RGB10_A2UI=36975]="RGB10_A2UI",fT[fT.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",fT[fT.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",fT[fT.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",fT[fT.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",fT[fT.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",fT[fT.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",fT[fT.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",fT[fT.HALF_FLOAT=5131]="HALF_FLOAT",fT[fT.RG=33319]="RG",fT[fT.RG_INTEGER=33320]="RG_INTEGER",fT[fT.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",fT[fT.CURRENT_QUERY=34917]="CURRENT_QUERY",fT[fT.QUERY_RESULT=34918]="QUERY_RESULT",fT[fT.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",fT[fT.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",fT[fT.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",fT[fT.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",fT[fT.DRAW_BUFFER0=34853]="DRAW_BUFFER0",fT[fT.DRAW_BUFFER1=34854]="DRAW_BUFFER1",fT[fT.DRAW_BUFFER2=34855]="DRAW_BUFFER2",fT[fT.DRAW_BUFFER3=34856]="DRAW_BUFFER3",fT[fT.DRAW_BUFFER4=34857]="DRAW_BUFFER4",fT[fT.DRAW_BUFFER5=34858]="DRAW_BUFFER5",fT[fT.DRAW_BUFFER6=34859]="DRAW_BUFFER6",fT[fT.DRAW_BUFFER7=34860]="DRAW_BUFFER7",fT[fT.DRAW_BUFFER8=34861]="DRAW_BUFFER8",fT[fT.DRAW_BUFFER9=34862]="DRAW_BUFFER9",fT[fT.DRAW_BUFFER10=34863]="DRAW_BUFFER10",fT[fT.DRAW_BUFFER11=34864]="DRAW_BUFFER11",fT[fT.DRAW_BUFFER12=34865]="DRAW_BUFFER12",fT[fT.DRAW_BUFFER13=34866]="DRAW_BUFFER13",fT[fT.DRAW_BUFFER14=34867]="DRAW_BUFFER14",fT[fT.DRAW_BUFFER15=34868]="DRAW_BUFFER15",fT[fT.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",fT[fT.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",fT[fT.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",fT[fT.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",fT[fT.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",fT[fT.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",fT[fT.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",fT[fT.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",fT[fT.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",fT[fT.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",fT[fT.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",fT[fT.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",fT[fT.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",fT[fT.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",fT[fT.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",fT[fT.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",fT[fT.SAMPLER_3D=35679]="SAMPLER_3D",fT[fT.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",fT[fT.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",fT[fT.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",fT[fT.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",fT[fT.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",fT[fT.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",fT[fT.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",fT[fT.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",fT[fT.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",fT[fT.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",fT[fT.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",fT[fT.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",fT[fT.MAX_SAMPLES=36183]="MAX_SAMPLES",fT[fT.SAMPLER_BINDING=35097]="SAMPLER_BINDING",fT[fT.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",fT[fT.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",fT[fT.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",fT[fT.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",fT[fT.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",fT[fT.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",fT[fT.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",fT[fT.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",fT[fT.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",fT[fT.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",fT[fT.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",fT[fT.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",fT[fT.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",fT[fT.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",fT[fT.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",fT[fT.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",fT[fT.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",fT[fT.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",fT[fT.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",fT[fT.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",fT[fT.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",fT[fT.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",fT[fT.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",fT[fT.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",fT[fT.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",fT[fT.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",fT[fT.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",fT[fT.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",fT[fT.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",fT[fT.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",fT[fT.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",fT[fT.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",fT[fT.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",fT[fT.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",fT[fT.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",fT[fT.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",fT[fT.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",fT[fT.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",fT[fT.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",fT[fT.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",fT[fT.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",fT[fT.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",fT[fT.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",fT[fT.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",fT[fT.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",fT[fT.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",fT[fT.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",fT[fT.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",fT[fT.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",fT[fT.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",fT[fT.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",fT[fT.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",fT[fT.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",fT[fT.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",fT[fT.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",fT[fT.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",fT[fT.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",fT[fT.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",fT[fT.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",fT[fT.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",fT[fT.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",fT[fT.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",fT[fT.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",fT[fT.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",fT[fT.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",fT[fT.UNIFORM_TYPE=35383]="UNIFORM_TYPE",fT[fT.UNIFORM_SIZE=35384]="UNIFORM_SIZE",fT[fT.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",fT[fT.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",fT[fT.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",fT[fT.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",fT[fT.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",fT[fT.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",fT[fT.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",fT[fT.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",fT[fT.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",fT[fT.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",fT[fT.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",fT[fT.OBJECT_TYPE=37138]="OBJECT_TYPE",fT[fT.SYNC_CONDITION=37139]="SYNC_CONDITION",fT[fT.SYNC_STATUS=37140]="SYNC_STATUS",fT[fT.SYNC_FLAGS=37141]="SYNC_FLAGS",fT[fT.SYNC_FENCE=37142]="SYNC_FENCE",fT[fT.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",fT[fT.UNSIGNALED=37144]="UNSIGNALED",fT[fT.SIGNALED=37145]="SIGNALED",fT[fT.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",fT[fT.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",fT[fT.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",fT[fT.WAIT_FAILED=37149]="WAIT_FAILED",fT[fT.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",fT[fT.COLOR=6144]="COLOR",fT[fT.DEPTH=6145]="DEPTH",fT[fT.STENCIL=6146]="STENCIL",fT[fT.MIN=32775]="MIN",fT[fT.MAX=32776]="MAX",fT[fT.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",fT[fT.STREAM_READ=35041]="STREAM_READ",fT[fT.STREAM_COPY=35042]="STREAM_COPY",fT[fT.STATIC_READ=35045]="STATIC_READ",fT[fT.STATIC_COPY=35046]="STATIC_COPY",fT[fT.DYNAMIC_READ=35049]="DYNAMIC_READ",fT[fT.DYNAMIC_COPY=35050]="DYNAMIC_COPY",fT[fT.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",fT[fT.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",fT[fT.INVALID_INDEX=4294967295]="INVALID_INDEX",fT[fT.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",fT[fT.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",fT[fT.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",fT[fT.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",fT[fT.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",fT[fT.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",fT[fT.R16_EXT=33322]="R16_EXT",fT[fT.RG16_EXT=33324]="RG16_EXT",fT[fT.RGB16_EXT=32852]="RGB16_EXT",fT[fT.RGBA16_EXT=32859]="RGBA16_EXT",fT[fT.R16_SNORM_EXT=36760]="R16_SNORM_EXT",fT[fT.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",fT[fT.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",fT[fT.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",fT[fT.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",fT[fT.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",fT[fT.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",fT[fT.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",fT[fT.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",fT[fT.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",fT[fT.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",fT[fT.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",fT[fT.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",fT[fT.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",fT[fT.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",fT[fT.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",fT[fT.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",fT[fT.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",fT[fT.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",fT[fT.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",fT[fT.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",fT[fT.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",fT[fT.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",fT[fT.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",fT[fT.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",fT[fT.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",fT[fT.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",fT[fT.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",fT[fT.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",fT[fT.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",fT[fT.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",fT[fT.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",fT[fT.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",fT[fT.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",fT[fT.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",fT[fT.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",fT[fT.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",fT[fT.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",fT[fT.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",fT[fT.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",fT[fT.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",fT[fT.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",fT[fT.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",fT[fT.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",fT[fT.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",fT[fT.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",fT[fT.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",fT[fT.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",fT[fT.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",fT[fT.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",fT[fT.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",fT[fT.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",fT[fT.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",fT[fT.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",fT[fT.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",fT[fT.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",fT[fT.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",fT[fT.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",fT[fT.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",fT[fT.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",fT[fT.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",fT[fT.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",fT[fT.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",fT[fT.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",fT[fT.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",fT[fT.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",fT[fT.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",fT[fT.LINE_WEBGL=6913]="LINE_WEBGL",fT[fT.FILL_WEBGL=6914]="FILL_WEBGL",fT[fT.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",fT[fT.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",fT[fT.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",fT[fT.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",fT[fT.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",fT[fT.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",fT[fT.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",fT[fT.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",fT[fT.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",fT[fT.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",fT[fT.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",fT[fT.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",fT[fT.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",fT[fT.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",fT[fT.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",fT[fT.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",fT[fT.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",fT[fT.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",fT[fT.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",fT[fT.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",fT[fT.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",fT[fT.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",fT[fT.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",fT[fT.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT";const pT={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},gT=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),mT=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),yT=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)});function vT(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){const e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");const t={...pT,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:gT(e),OES_vertex_array_object:mT(e),ANGLE_instanced_arrays:yT(e)},n=e.getExtension;e.getExtension=function(i){const r=n.call(e,i);return r||(i in t?t[i]:null)};const i=e.getSupportedExtensions;e.getSupportedExtensions=function(){const n=i.apply(e)||[];return null==n?void 0:n.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}async function _T(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),new Promise((t,r)=>{i.onload=t,i.onerror=t=>r(new Error(`Unable to load script '${e}': ${t}`)),n.appendChild(i)})}let bT=null,ET=!1;const wT={debugSpectorJS:Sg.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};function xT(e){return e.luma=e.luma||{},e.luma}function AT(e,t={}){return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return Sg.warn("webgl-debug not loaded")(),e;const n=xT(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...dT,...e});const i=globalThis.WebGLDebugUtils.makeDebugContext(e,TT.bind(null,t),CT.bind(null,t));for(const o in dT)o in i||"number"!=typeof dT[o]||(i[o]=dT[o]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,i);const s=Object.create(r);return n.realContext=e,n.debugContext=s,s.debug=!0,s}(e,t):function(e){const t=xT(e);return t.realContext?t.realContext:e}(e)}function ST(e,t){t=Array.from(t).map(e=>void 0===e?"undefined":e);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${e}(${n})`}function TT(e,t,n,i){i=Array.from(i).map(e=>void 0===e?"undefined":e);const r=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${n}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i)})`;Sg.error(r)()}function CT(e,t,n){let i="";Sg.level>=1&&(i=ST(t,n),e.traceWebGL&&Sg.log(1,i)());for(const r of n)void 0===r&&(i=i||ST(t,n))}const IT=new class extends cm{constructor(){super(),i(this,"type","webgl"),sm.defaultProps={...sm.defaultProps,...wT}}enforceWebGL2(e){vT(e)}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}isDeviceHandle(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext&&Sg.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:n}=await s(async()=>{const{WebGLDevice:e}=await Promise.resolve().then(()=>cI);return{WebGLDevice:e}},void 0);if(e instanceof n)return e;if((null==e?void 0:e.device)instanceof n)return e.device;if(!function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return!0;return Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");const i=!0===t.createCanvasContext?{}:t.createCanvasContext;return new n({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...i}})}async create(e={}){const{WebGLDevice:t}=await s(async()=>{const{WebGLDevice:e}=await Promise.resolve().then(()=>cI);return{WebGLDevice:e}},void 0);Sg.groupCollapsed(1,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(async function(){nd()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await _T("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.debugSpectorJS&&n.push(async function(e){if(!globalThis.SPECTOR)try{await _T(e.debugSpectorJSUrl||wT.debugSpectorJSUrl)}catch(t){Sg.warn(String(t))}}(e));const i=await Promise.allSettled(n);for(const e of i)"rejected"===e.status&&Sg.error(`Failed to initialize debug libraries ${e.reason}`)();const r=new t(e),s=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.props.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return Sg.probe(1,s)(),Sg.table(1,r.info)(),r}finally{Sg.groupEnd(1)()}}},kT={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},RT=(e,t,n)=>t?e.enable(n):e.disable(n),PT=(e,t,n)=>e.hint(n,t),MT=(e,t,n)=>e.pixelStorei(n,t),LT=(e,t,n)=>{const i=36006===n?36009:36008;return e.bindFramebuffer(i,t)},BT=(e,t,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];e.bindBuffer(i,t)};function NT(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const OT={3042:RT,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:RT,2885:(e,t)=>e.cullFace(t),2929:RT,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:RT,35723:PT,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>{var n;return null==(n=e.bindTransformFeedback)?void 0:n.call(e,36386,t)},34229:(e,t)=>e.bindVertexArray(t),36006:LT,36010:LT,34964:BT,36662:BT,36663:BT,35053:BT,35055:BT,2886:(e,t)=>e.frontFace(t),33170:PT,2849:(e,t)=>e.lineWidth(t),32823:RT,32824:"polygonOffset",10752:"polygonOffset",35977:RT,32926:RT,32928:RT,32938:"sampleCoverage",32939:"sampleCoverage",3089:RT,3088:(e,t)=>e.scissor(...t),2960:RT,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:RT,10754:RT,12288:RT,12289:RT,12290:RT,12291:RT,12292:RT,12293:RT,12294:RT,12295:RT,3333:MT,3317:MT,37440:MT,37441:MT,37443:MT,3330:MT,3332:MT,3331:MT,3314:MT,32878:MT,3316:MT,3315:MT,32877:MT,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===(null==t?void 0:t.length)?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=NT(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=NT(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilFuncSeparate(1028,n,i,r),e.stencilFuncSeparate(1029,s,o,a)},stencilOp:(e,t)=>{t=NT(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilOpSeparate(1028,n,i,r),e.stencilOpSeparate(1029,s,o,a)},viewport:(e,t)=>e.viewport(...t)};function DT(e,t,n){return void 0!==t[e]?t[e]:n[e]}const FT={blendEquation:(e,t,n)=>e.blendEquationSeparate(DT(32777,t,n),DT(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(DT(32969,t,n),DT(32968,t,n),DT(32971,t,n),DT(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(DT(32824,t,n),DT(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(DT(32938,t,n),DT(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,DT(2962,t,n),DT(2967,t,n),DT(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,DT(34816,t,n),DT(36003,t,n),DT(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,DT(2964,t,n),DT(2965,t,n),DT(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,DT(34817,t,n),DT(34818,t,n),DT(34819,t,n))},UT={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,n)=>e({36007:n}),bindTransformFeedback:(e,t,n)=>e({36389:n}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},bindBuffer:(e,t,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?e({[i]:n}):{valueChanged:!0}},blendColor:(e,t,n,i,r)=>e({32773:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,i,r)=>e({32969:t,32968:n,32971:i,32970:r}),clearColor:(e,t,n,i,r)=>e({3106:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,i,r)=>e({3107:[t,n,i,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,i,r)=>e({3088:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,i)=>e({2962:t,2967:n,2963:i,34816:t,36003:n,36004:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:i,[1028===t?2963:36004]:r}),stencilOp:(e,t,n,i)=>e({2964:t,2965:n,2966:i,34817:t,34818:n,34819:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:i,[1028===t?2966:34819]:r}),viewport:(e,t,n,i,r)=>e({2978:[t,n,i,r]})},zT=(e,t)=>e.isEnabled(t),GT={3042:zT,2884:zT,2929:zT,3024:zT,32823:zT,32926:zT,32928:zT,3089:zT,2960:zT,35977:zT},VT=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function HT(e,t){if(function(e){for(const t in e)return!1;return!0}(t))return;const n={};for(const r in t){const i=Number(r),s=OT[r];s&&("string"==typeof s?n[s]=!0:s(e,t[r],i))}const i=e.state&&e.state.cache;if(i)for(const r in n){(0,FT[r])(e,t,i)}}function jT(e,t=kT){if("number"==typeof t){const n=t,i=GT[n];return i?i(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),i={};for(const r of n){const t=GT[r];i[r]=t?t(e,Number(r)):e.getParameter(Number(r))}return i}function WT(e,t){if(e===t)return!0;if($T(e)&&$T(t)&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}function $T(e){return Array.isArray(e)||ArrayBuffer.isView(e)}class XT{constructor(e,t){i(this,"gl"),i(this,"program",null),i(this,"stateStack",[]),i(this,"enable",!0),i(this,"cache",null),i(this,"log"),i(this,"initialized",!1),this.gl=e,this.log=(null==t?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];HT(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=(null==t?void 0:t.copyState)?jT(e):Object.assign({},kT),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const i=XT.get(e);i.program!==n&&(t(n),i.program=n)}}(e);for(const n in UT){KT(e,n,UT[n])}qT(e,"getParameter"),qT(e,"isEnabled")}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){const s=e[r],o=this.cache[r];WT(s,o)||(n=!0,t=o,i&&!(r in i)&&(i[r]=o),this.cache[r]=s)}return{valueChanged:n,oldValue:t}}}function qT(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||VT.has(t))return n(t);const i=XT.get(e);return t in i.cache||(i.cache[t]=n(t)),i.enable?i.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function KT(e,t,n){if(!e[t])return;const i=e[t].bind(e);e[t]=function(...t){const r=XT.get(e),{valueChanged:s,oldValue:o}=n(r._updateCache,...t);return s&&i(...t),o},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function YT(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function JT(e,t){const n=e.getParameter(7936),i=e.getParameter(7937);YT(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,s=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936)||n,o=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937)||i,a=e.getParameter(7938),l=ZT(s,o),c=function(e,t){if(/Metal/i.exec(e)||/Metal/i.exec(t))return"metal";if(/ANGLE/i.exec(e)||/ANGLE/i.exec(t))return"opengl";return"unknown"}(s,o),u=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(ZT(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(s,o);return{type:"webgl",gpu:l,gpuType:u,gpuBackend:c,vendor:s,renderer:o,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ZT(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function QT(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const eC="WEBGL_compressed_texture_s3tc",tC="WEBGL_compressed_texture_s3tc_srgb",nC="EXT_texture_compression_rgtc",iC="EXT_texture_compression_bptc",rC="EXT_texture_norm16",sC="EXT_render_snorm",oC={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[sC],"norm16-renderable-webgl":[rC],"snorm16-renderable-webgl":[rC,sC],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[eC,tC,nC,iC],"texture-compression-bc5-webgl":[nC],"texture-compression-bc7-webgl":[iC],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]};const aC={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:eC},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:tC},"bc1-rgba-unorm":{gl:33777,x:eC},"bc1-rgba-unorm-srgb":{gl:35916,x:tC},"bc2-rgba-unorm":{gl:33778,x:eC},"bc2-rgba-unorm-srgb":{gl:35918,x:tC},"bc3-rgba-unorm":{gl:33779,x:eC},"bc3-rgba-unorm-srgb":{gl:35919,x:tC},"bc4-r-unorm":{gl:36283,x:nC},"bc4-r-snorm":{gl:36284,x:nC},"bc5-rg-unorm":{gl:36285,x:nC},"bc5-rg-snorm":{gl:36286,x:nC},"bc6h-rgb-ufloat":{gl:36495,x:iC},"bc6h-rgb-float":{gl:36494,x:iC},"bc7-rgba-unorm":{gl:36492,x:iC},"bc7-rgba-unorm-srgb":{gl:36493,x:iC},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function lC(e){var t;const n=aC[e],i=function(e){const t=aC[e],n=null==t?void 0:t.gl;if(void 0===n)throw new Error(`Unsupported texture format ${e}`);return n}(e),r=em.getInfo(e);return r.compressed&&(n.dataFormat=i),{internalFormat:i,format:(null==n?void 0:n.dataFormat)||cC(r.channels,r.integer,r.normalized,i),type:r.dataType?QT(r.dataType):(null==(t=null==n?void 0:n.types)?void 0:t[0])||5121,compressed:r.compressed||!1}}function cC(e,t,n,i){if(6408===i||6407===i)return i;switch(e){case"r":return t&&!n?36244:6403;case"rg":return t&&!n?33320:33319;case"rgb":return t&&!n?36248:6407;case"rgba":return t&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}const uC={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class hC extends im{constructor(e,t,n){super([],n),i(this,"gl"),i(this,"extensions"),i(this,"testedFeatures",new Set),this.gl=e,this.extensions=t,YT(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){var t;return!(null==(t=this.disabledFeatures)?void 0:t[e])&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in oC}(e)&&function(e,t,n){return(oC[t]||[]).every(t=>YT(e,t,n))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(e=>"polygon-mode-webgl"!==e);for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(uC),...Object.keys(oC)]}getWebGLFeature(e){const t=uC[e];return"string"==typeof t?Boolean(YT(this.gl,t,this.extensions)):Boolean(t)}}class dC extends nm{constructor(e){super(),i(this,"gl"),i(this,"limits",{}),this.gl=e}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class fC extends Rm{constructor(e,t){super(e,t),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"colorAttachments",[]),i(this,"depthStencilAttachment",null);const n=null===t.handle;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const e=this.colorAttachments[t];if(e){const n=36064+t;this._attachTextureView(n,e)}}if(this.depthStencilAttachment){const e=function(e){switch(em.getInfo(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:i}=t,r=t.props.baseMipLevel,s=t.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,r,s);break;case 34067:const t=function(e){return e<34069?e+34069:e}(s);n.framebufferTexture2D(36160,e,t,i.handle,r);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,r);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}class pC extends pm{constructor(e,t){super(t),i(this,"device"),i(this,"handle",null),i(this,"_framebuffer",null),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new fC(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const gC={};function mC(e="id"){gC[e]=gC[e]||1;return`${e}-${gC[e]++}`}class yC extends Rg{constructor(e,t={}){super(e,t),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"glTarget"),i(this,"glUsage"),i(this,"glIndexType",5123),i(this,"byteLength",0),i(this,"bytesUsed",0),this.device=e,this.gl=this.device.gl;const n="object"==typeof t?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=function(e){if(e&Rg.INDEX)return 34963;if(e&Rg.VERTEX)return 34962;if(e&Rg.UNIFORM)return 35345;return 34962}(this.props.usage),this.glUsage=function(e){if(e&Rg.INDEX)return 35044;if(e&Rg.VERTEX)return 35044;if(e&Rg.UNIFORM)return 35048;return 35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,n=e.byteLength+t){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const n=ArrayBuffer.isView(e)?e:new Uint8Array(e),i=36663;this.gl.bindBuffer(i,this.handle),this.gl.bufferSubData(i,t,n),this.gl.bindBuffer(i,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,n=this.byteLength-t){const i=new ArrayBuffer(n);await e(i,"copied"),this.write(i,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,n){const i=await this.readAsync(t,n);return await e(i.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const n=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function vC(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class _C extends Cm{constructor(e,t){switch(super(e,t),i(this,"device"),i(this,"handle"),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){const t=e.split(/\r?\n/),n=[];for(const i of t){if(i.length<=1)continue;const e=i.split(":");if(2===e.length){const[t,i]=e;n.push({message:i.trim(),type:vC(t),lineNum:0,linePos:0});continue}const[t,r,s,...o]=e;let a=parseInt(s,10);isNaN(a)&&(a=0);let l=parseInt(r,10);isNaN(l)&&(l=0),n.push({message:o.join(":").trim(),type:vC(t),lineNum:a,linePos:l})}return n}(e):[]}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(null==e?void 0:e.getTranslatedShaderSource(this.handle))||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es\n${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),this.device.props.debug){if(this.device.features.has("compilation-status-async-webgl"))Sg.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Sg.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`)}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void(await e(10));const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function bC(e,t,n,i){if(function(e){let t=!0;for(const n in e){t=!1;break}return t}(t))return i(e);const r=e;r.pushState();try{return function(e,t){const n=e,{gl:i}=n;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029)}t.frontFace&&i.frontFace(SC("frontFace",t.frontFace,{ccw:2305,cw:2304}));t.unclippedDepth&&e.features.has("depth-clip-control")&&i.enable(34383);void 0!==t.depthBias&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0));if(t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,i=SC("provokingVertex",t.provokingVertex,{first:36429,last:36430});null==e||e.provokingVertexWEBGL(i)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,i=SC("polygonMode",t.polygonMode,{fill:6914,line:6913});null==e||e.polygonModeWEBGL(1028,i),null==e||e.polygonModeWEBGL(1029,i)}t.polygonOffsetLine&&i.enable(10754)}e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295));void 0!==t.depthWriteEnabled&&i.depthMask(t.depthWriteEnabled);t.depthCompare&&("always"!==t.depthCompare?i.enable(2929):i.disable(2929),i.depthFunc(EC("depthCompare",t.depthCompare)));if(t.stencilWriteMask){const e=t.stencilWriteMask;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,e)}t.stencilReadMask&&Sg.warn("stencilReadMask not supported under WebGL");if(t.stencilCompare){const e=t.stencilReadMask||4294967295,n=EC("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,n,0,e),i.stencilFuncSeparate(1029,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=wC("stencilPassOperation",t.stencilPassOperation),n=wC("stencilFailOperation",t.stencilFailOperation),r=wC("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,n,r,e),i.stencilOpSeparate(1029,n,r,e)}switch(t.blend){case!0:i.enable(3042);break;case!1:i.disable(3042)}if(t.blendColorOperation||t.blendAlphaOperation){const e=xC("blendColorOperation",t.blendColorOperation||"add"),n=xC("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(e,n);const r=AC("blendColorSrcFactor",t.blendColorSrcFactor||"one"),s=AC("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=AC("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=AC("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(r,s,o,a)}}(e,t),HT(r.gl,n),i(e)}finally{r.popState()}}function EC(e,t){return SC(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function wC(e,t){return SC(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function xC(e,t){return SC(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function AC(e,t,n="color"){return SC(e,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:"color"===n?32769:32771,"one-minus-constant":"color"===n?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function SC(e,t,n){if(!(t in n))throw new Error(function(e,t){return`Illegal parameter ${t} for ${e}`}(e,t));return n[t]}function TC(e){const t={};return e.addressModeU&&(t[10242]=CC(e.addressModeU)),e.addressModeV&&(t[10243]=CC(e.addressModeV)),e.addressModeW&&(t[32882]=CC(e.addressModeW)),e.magFilter&&(t[10240]=IC(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e,t="none"){if(!t)return IC(e);switch(t){case"none":return IC(e);case"nearest":switch(e){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(e){case"nearest":return 9986;case"linear":return 9987}}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=EC("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function CC(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function IC(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}class kC extends vm{constructor(e,t){super(e,t),i(this,"device"),i(this,"handle"),i(this,"parameters"),this.device=e,this.parameters=TC(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}function RC(e,t,n){if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:i=!0}=t,r=XT.get(e);let s;if(r.push(),HT(e,t),i)s=n(e),r.pop();else try{s=n(e)}finally{r.pop()}return s}class PC extends xm{constructor(e,t){super(e,{...Em.defaultProps,...t}),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"texture"),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class MC extends Em{constructor(e,t){super(e,t),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"sampler"),i(this,"view"),i(this,"glTarget"),i(this,"glFormat"),i(this,"glType"),i(this,"glInternalFormat"),i(this,"compressed"),i(this,"_textureUnit",0),this.device=e,this.gl=this.device.gl;const n=lC(this.props.format);this.glTarget=function(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:r,width:s,height:o,depth:a,mipLevels:l,glTarget:c,glInternalFormat:u}=this;switch(r){case"2d":case"cube":this.gl.texStorage2D(c,l,u,s,o);break;case"2d-array":case"3d":this.gl.texStorage3D(c,l,u,s,o,a);break;default:throw new Error(r)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new PC(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new PC(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=TC(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),n=t.data,{width:i,height:r,depth:s}=this,{mipLevel:o=0,byteOffset:a=0,x:l=0,y:c=0,z:u=0}=t,{glFormat:h,glType:d,compressed:f}=this,p=LC(this.glTarget,this.dimension,s),g=this.compressed?{}:{3314:t.bytesPerRow,32878:t.rowsPerImage};this.gl.bindTexture(p,this.handle),RC(this.gl,g,()=>{switch(this.dimension){case"2d":case"cube":f?this.gl.compressedTexSubImage2D(p,o,l,c,i,r,h,n,a):this.gl.texSubImage2D(p,o,l,c,i,r,h,d,n,a);break;case"2d-array":case"3d":f?this.gl.compressedTexSubImage3D(p,o,l,c,u,i,r,s,h,n,a):this.gl.texSubImage3D(p,o,l,c,u,i,r,s,h,d,n,a)}}),this.gl.bindTexture(p,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:i}=this,{image:r,depth:s,mipLevel:o,x:a,y:l,z:c,width:u,height:h}=t,d=LC(this.glTarget,this.dimension,s),f=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),RC(this.gl,f,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(d,o,a,l,u,h,n,i,r);break;case"2d-array":case"3d":this.gl.texSubImage3D(d,o,a,l,c,u,h,s,n,i,r)}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||(Sg.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),null==e?void 0:e.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(t){Sg.warn(`Error generating mipmap for ${this}: ${t.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){Sg.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),i=n;switch(e){case 33082:case 33083:this.gl.texParameterf(this.glTarget,e,i);break;case 10240:case 10241:case 10242:case 10243:case 32882:case 34892:case 34893:this.gl.texParameteri(this.glTarget,e,i);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,e,i)}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return void 0!==e&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return void 0!==e&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function LC(e,t,n){return"cube"===t?34069+n:e}function BC(e){return DC[e]}function NC(e){return Boolean(FC[e])}function OC(e){return FC[e]}const DC={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},FC={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},UC={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function zC(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r);if(!i)throw new Error("activeInfo");const{name:s,type:o}=i,a=e.getAttribLocation(t,s);if(a>=0){const e=BC(o),t=/instance/i.test(s)?"instance":"vertex";n.push({name:s,location:a,stepMode:t,type:e})}}return n.sort((e,t)=>e.location-t.location),n}(e,t);const i=function(e,t){const n=(n,i)=>e.getActiveUniformBlockParameter(t,n,i),i=[],r=e.getProgramParameter(t,35382);for(let s=0;s<r;s++){const r={name:e.getActiveUniformBlockName(t,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},o=n(s,35395)||[],a=e.getActiveUniforms(t,o,35383),l=e.getActiveUniforms(t,o,35384),c=e.getActiveUniforms(t,o,35387),u=e.getActiveUniforms(t,o,35388);for(let n=0;n<r.uniformCount;++n){const i=e.getActiveUniform(t,o[n]);if(!i)throw new Error("activeInfo");const s=BC(a[n]);r.uniforms.push({name:i.name,format:s,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}i.push(r)}return i.sort((e,t)=>e.location-t.location),i}(e,t);for(const a of i){const e=a.uniforms.map(e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:e})}const r=function(e,t){const n=[],i=e.getProgramParameter(t,35718);for(let r=0;r<i;r++){const i=e.getActiveUniform(t,r);if(!i)throw new Error("activeInfo");const{name:s,size:o,type:a}=i,{name:l,isArray:c}=GC(s);let u=e.getUniformLocation(t,l);const h={location:u,name:l,size:o,type:a,isArray:c};if(n.push(h),h.size>1)for(let r=0;r<h.size;r++){const i=`${l}[${r}]`;u=e.getUniformLocation(t,i);const s={...h,name:i,location:u};n.push(s)}}return n}(e,t);let s=0;for(const a of r)if(NC(a.type)){const{viewDimension:e,sampleType:t}=OC(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:s,viewDimension:e,sampleType:t}),a.textureUnit=s,s+=1}r.length&&(n.uniforms=r);const o=function(e,t){const n=[],i=e.getProgramParameter(t,35971);for(let r=0;r<i;r++){const i=e.getTransformFeedbackVarying(t,r);if(!i)throw new Error("activeInfo");const{name:s,type:o,size:a}=i,l=BC(o),{type:c,components:u}=Gm(l);n.push({location:r,name:s,type:c,size:a*u})}return n.sort((e,t)=>e.location-t.location),n}(e,t);return(null==o?void 0:o.length)&&(n.varyings=o),n}function GC(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function VC(e,t,n,i){const r=e;let s=i;!0===s&&(s=1),!1===s&&(s=0);const o="number"==typeof s?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!=typeof i)throw new Error("samplers must be set to integers");return e.uniform1i(t,i);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:case 35670:return e.uniform1iv(t,o);case 35667:case 35671:return e.uniform2iv(t,o);case 35668:case 35672:return e.uniform3iv(t,o);case 35669:case 35673:return e.uniform4iv(t,o);case 5125:return r.uniform1uiv(t,o,1);case 36294:return r.uniform2uiv(t,o,2);case 36295:return r.uniform3uiv(t,o,3);case 36296:return r.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return r.uniformMatrix2x3fv(t,!1,o);case 35686:return r.uniformMatrix2x4fv(t,!1,o);case 35687:return r.uniformMatrix3x2fv(t,!1,o);case 35688:return r.uniformMatrix3x4fv(t,!1,o);case 35689:return r.uniformMatrix4x2fv(t,!1,o);case 35690:return r.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}class HC extends Mm{constructor(e,t){super(e,t),i(this,"device"),i(this,"handle"),i(this,"vs"),i(this,"fs"),i(this,"introspectedLayout"),i(this,"uniforms",{}),i(this,"bindings",{}),i(this,"varyings",null),i(this,"_uniformCount",0),i(this,"_uniformSetters",{}),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:r=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,r)),this._linkShaders(),Sg.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=zC(this.device.gl,this.handle),Sg.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?function(e,t){const n={...e,attributes:e.attributes.map(e=>({...e}))};for(const i of(null==t?void 0:t.attributes)||[]){const e=n.attributes.find(e=>e.name===i.name);e?(e.type=i.type||e.type,e.stepMode=i.stepMode||e.stepMode):Sg.warn(`shader layout attribute ${i.name} not present in shader`)}return n}(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[n,i]of Object.entries(e)){const e=this.shaderLayout.bindings.find(e=>e.name===n)||this.shaderLayout.bindings.find(e=>e.name===`${n}Uniforms`);if(!e){const e=this.shaderLayout.bindings.map(e=>`"${e.name}"`).join(", ");(null==t?void 0:t.disableWarnings)||Sg.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${e}`,i)();continue}switch(i||Sg.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(i instanceof yC||i.buffer instanceof yC))throw new Error("buffer value");break;case"texture":if(!(i instanceof PC||i instanceof MC||i instanceof fC))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Sg.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(e.type)}this.bindings[n]=i}}draw(e){var t;const{renderPass:n,parameters:i=this.props.parameters,topology:r=this.props.topology,vertexArray:s,vertexCount:o,instanceCount:a,isInstanced:l=!1,firstVertex:c=0,transformFeedback:u}=e,h=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}(r),d=Boolean(s.indexBuffer),f=null==(t=s.indexBuffer)?void 0:t.glIndexType;if("success"!==this.linkStatus)return Sg.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Sg.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(n),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const p=n;return bC(this.device,i,p.glParameters,()=>{d&&l?this.device.gl.drawElementsInstanced(h,o||0,f,c,a||0):d?this.device.gl.drawElements(h,o||0,f,c):l?this.device.gl.drawArraysInstanced(h,c,o||0,a||0):this.device.gl.drawArrays(h,c,o||0),u&&u.end()}),s.unbindAfterRender(n),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Sg.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Sg.timeEnd(4,`linkProgram for ${this.id}`)(),Sg.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}Sg.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Sg.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){var t;if("success"!==e){const n="link-error"===e?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${n} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader()}switch(null==(t=this.fs)?void 0:t.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${n} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader()}const i=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${n} during ${e}: ${i}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;if(!e.getProgramParameter(this.handle,35714))return this.linkStatus="error","link-error";e.validateProgram(this.handle);return e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")}async _waitForLinkComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void(await e(10));const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)this.bindings[t.name]||this.bindings[t.name.replace(/Uniforms$/,"")]||(Sg.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const i of this.shaderLayout.bindings){const r=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!r)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:s}=i,o=e.getUniformBlockIndex(this.handle,s);if(4294967295===o)throw new Error(`Invalid uniform block name ${s}`);e.uniformBlockBinding(this.handle,n,o),r instanceof yC?e.bindBufferBase(35345,n,r.handle):e.bindBufferRange(35345,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof PC||r instanceof MC||r instanceof fC))throw new Error("texture");let a;if(r instanceof PC)a=r.texture;else if(r instanceof MC)a=r;else{if(!(r instanceof fC&&r.colorAttachments[0]instanceof PC))throw new Error("No texture");Sg.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=r.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.glTarget,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:i,textureUnit:r}=e,s=this.uniforms[t]??r;void 0!==s&&VC(this.device.gl,n,i,s)}}}class jC extends zm{constructor(e){super(e,{}),i(this,"device"),i(this,"handle",null),i(this,"commands",[]),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":WC(this.device,t.options);break;case"copy-buffer-to-texture":$C(this.device,t.options);break;case"copy-texture-to-buffer":XC(this.device,t.options);break;case"copy-texture-to-texture":qC(this.device,t.options);break;default:throw new Error(t.name)}}}function WC(e,t){const n=t.sourceBuffer,i=t.destinationBuffer;e.gl.bindBuffer(36662,n.handle),e.gl.bindBuffer(36663,i.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function $C(e,t){throw new Error("Not implemented")}function XC(e,t){const{sourceTexture:n,mipLevel:i=0,aspect:r="all",width:s=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:d}=t;if("all"!==r)throw new Error("aspect not supported in WebGL");if(0!==i||0!==a||h||d)throw new Error("not implemented");const{framebuffer:f,destroyFramebuffer:p}=KC(n);let g;try{const t=c,n=s||f.width,i=o||f.height,r=lC(f.colorAttachments[0].texture.props.format),a=r.format,h=r.type;e.gl.bindBuffer(35051,t.handle),g=e.gl.bindFramebuffer(36160,f.handle),e.gl.readPixels(l[0],l[1],n,i,a,h,u)}finally{e.gl.bindBuffer(35051,null),void 0!==g&&e.gl.bindFramebuffer(36160,g),p&&f.destroy()}}function qC(e,t){const{sourceTexture:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=t;let{width:a=t.destinationTexture.width,height:l=t.destinationTexture.height}=t;const{framebuffer:c,destroyFramebuffer:u}=KC(n),[h,d]=r,[f,p,g]=s,m=e.gl.bindFramebuffer(36160,c.handle);let y,v;if(!(o instanceof MC))throw new Error("invalid destination");switch(y=o,a=Number.isFinite(a)?a:y.width,l=Number.isFinite(l)?l:y.height,y._bind(0),v=y.glTarget,v){case 3553:case 34067:e.gl.copyTexSubImage2D(v,i,f,p,h,d,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(v,i,f,p,g,h,d,a,l)}y&&y._unbind(),e.gl.bindFramebuffer(36160,m),u&&c.destroy()}function KC(e){if(e instanceof Em){const{width:t,height:n,id:i}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${i}`,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}const YC=[1,2,4,8];class JC extends Bm{constructor(e,t){var n;let r;if(super(e,t),i(this,"device"),i(this,"handle",null),i(this,"glParameters",{}),this.device=e,!(null==(n=null==t?void 0:t.parameters)?void 0:n.viewport))if(null==t?void 0:t.framebuffer){const{width:e,height:n}=t.framebuffer;r=[0,0,e,n]}else{const[t,n]=e.getDefaultCanvasContext().getDrawingBufferSize();r=[0,0,t,n]}this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&(null==s?void 0:s.handle)){const e=this.props.framebuffer.colorAttachments.map((e,t)=>36064+t);this.device.gl.drawBuffers(e)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=YC.map(t=>Boolean(t&e.colorMask))),this.glParameters=t,HT(this.device.gl,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;null==t||t.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;null==e||e.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((e,t)=>{e&&this.clearColorBuffer(t,e)}),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&RC(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){RC(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class ZC extends Fm{constructor(e,t){super(e,t),i(this,"device"),i(this,"handle",null),i(this,"commandBuffer"),this.device=e,this.commandBuffer=new jC(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new JC(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}class QC extends qm{constructor(e,t){super(e,t),i(this,"device"),i(this,"handle"),i(this,"buffer",null),i(this,"bufferValue",null),this.device=e,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return"Chrome"==(nd()?td()?"Electron":(ed.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node")}destroy(){var e;super.destroy(),this.buffer&&(null==(e=this.buffer)||e.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(34963===n.glTarget)throw new Error("Use .setIndexBuffer()");const{size:i,type:r,stride:s,offset:o,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),l?this.device.gl.vertexAttribIPointer(e,i,r,s,o):this.device.gl.vertexAttribPointer(e,i,r,a,s,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=QT(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t=!0){const n=QC.isConstantAttributeZeroSupported(this.device);(t||(n||0!==e))&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=function(e){if(Array.isArray(e))return new Float32Array(e);return e}(t),i=n.byteLength*e,r=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s||(s=!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue)),s){const e=function(e,t){return new e(ey(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,r);!function(e){const{target:t,source:n,start:i=0,count:r=1}=e,s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)t[l++]=n[a];for(;a<o;)a<o-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+o-a),a=o);e.target}({target:e,source:n,start:0,count:r}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class eI extends Ym{constructor(e,t){super(e,t),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"layout"),i(this,"buffers",{}),i(this,"unusedBuffers",{}),i(this,"bindOnUse",!0),i(this,"_bound",!1),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":return 1;case"triangle-list":case"triangle-strip":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteLength:r,byteOffset:s}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=i,void Sg.warn(`${this.id} unusedBuffers varying buffer ${e}`)();this.buffers[n]={buffer:i,byteLength:r,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,r)}getBuffer(e){if(tI(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if("function"!=typeof e)return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof yC)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(tI(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,n=0,i){const r=t&&t.handle;r&&void 0!==i?this.gl.bindBufferRange(35982,e,r,n,i):this.gl.bindBufferBase(35982,e,r)}}function tI(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}class nI extends Qm{constructor(e,t){if(super(e,t),i(this,"device"),i(this,"handle"),i(this,"target",null),i(this,"_queryPending",!1),i(this,"_pollingPromise",null),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin((null==e?void 0:e.conservative)?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)}),this._pollingPromise}}function iI(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}const rI={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function sI(e,t){var n;const{sourceX:i=0,sourceY:r=0,sourceAttachment:s=0}=t||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceDepth:c,sourceFormat:u,sourceType:h}=t||{};const{framebuffer:d,deleteFramebuffer:f}=oI(e),{gl:p,handle:g}=d;a||(a=d.width),l||(l=d.height);const m=null==(n=d.colorAttachments[s])?void 0:n.texture;if(!m)throw new Error(`Invalid framebuffer attachment ${s}`);c=(null==m?void 0:m.depth)||1,u||(u=(null==m?void 0:m.glFormat)||6408),h||(h=(null==m?void 0:m.glType)||5121),o=function(e,t,n,i,r){if(e)return e;t||(t=5121);const s=Bg((a=t,rI[a])),o=iI(n);var a;return new s(i*r*o)}(o,h,u,a,l);const y=Lg(o);h=h||UC[y];const v=p.bindFramebuffer(36160,g);return p.readBuffer(36064+s),p.readPixels(i,r,a,l,u,h,o),p.readBuffer(36064),p.bindFramebuffer(36160,v||null),f&&d.destroy(),o}function oI(e){return e instanceof Rm?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:aI(e),deleteFramebuffer:!0}}function aI(e,t){const{device:n,width:i,height:r,id:s}=e;return n.createFramebuffer({...t,id:`framebuffer-for-${s}`,width:i,height:r,colorAttachments:[e]})}class lI extends sm{constructor(e){var t,n;super({...e,id:e.id||mC("webgl-device")}),i(this,"type","webgl"),i(this,"handle"),i(this,"features"),i(this,"limits"),i(this,"info"),i(this,"canvasContext"),i(this,"preferredColorFormat","rgba8unorm"),i(this,"preferredDepthFormat","depth24plus"),i(this,"commandEncoder"),i(this,"lost"),i(this,"_resolveContextLost"),i(this,"gl"),i(this,"_constants"),i(this,"_extensions",{}),i(this,"_polyfilled",!1),i(this,"spectorJS");const r=sm._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=null==(n=null==(t=r.canvas)?void 0:t.gl)?void 0:n.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new pC(this,r),this.lost=new Promise(e=>{this._resolveContextLost=e});const o={...e.webgl};"premultiplied"===r.alphaMode&&(o.premultipliedAlpha=!0),void 0!==e.powerPreference&&(o.powerPreference=e.powerPreference);const a=this.props._handle||function(e,t,n){let i="";const r={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=e.getContext("webgl2",r)),r.failIfMajorPerformanceCaveat&&(i||(i="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),s||n.failIfMajorPerformanceCaveat||(r.failIfMajorPerformanceCaveat=!1,s=e.getContext("webgl2",r),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=e.getContext("webgl",{}),s&&(s=null,i||(i="Your browser only supports WebGL1"))),!s)throw i||(i="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:o,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",e=>o(e),!1),e.addEventListener("webglcontextrestored",e=>a(e),!1),s.luma||(s.luma={}),s}(this.canvasContext.canvas,{onContextLost:e=>{var t;return null==(t=this._resolveContextLost)?void 0:t.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:e=>{}},o);if(!a)throw new Error("WebGL context creation failed");if(s=a.device,s){if(e._reuseDevices)return Sg.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=a,this.gl=a,this.spectorJS=function(e){var t;if(!(e={...wT,...e}).debugSpectorJS)return null;if(!bT&&globalThis.SPECTOR&&!(null==(t=globalThis.luma)?void 0:t.spector)){Sg.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;bT=new e,globalThis.luma&&(globalThis.luma.spector=bT)}if(!bT)return null;if(ET||(ET=!0,bT.spyCanvases(),null==bT||bT.onCaptureStarted.add(e=>Sg.info("Spector capture started:",e)()),null==bT||bT.onCapture.add(e=>{Sg.info("Spector capture complete:",e)(),null==bT||bT.getResultUI(),null==bT||bT.resultView.display(),null==bT||bT.resultView.addCapture(e)})),e.gl){const t=e.gl,n=t.device;null==bT||bT.startCapture(e.gl,500),t.device=n,new Promise(e=>setTimeout(e,2e3)).then(e=>{Sg.info("Spector capture stopped after 2 seconds")(),null==bT||bT.stopCapture()})}return bT}({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=JT(this.gl,this._extensions),this.limits=new dC(this.gl),this.features=new hC(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures();new XT(this.gl,{log:(...e)=>Sg.log(1,...e)()}).trackState(this.gl,{copyState:!1});const l=e.debugWebGL||e.debug,c=e.debugWebGL;l&&(this.gl=AT(this.gl,{debugWebGL:l,traceWebGL:c}),Sg.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Sg.level=Math.max(Sg.level,1))),this.commandEncoder=new ZC(this,{id:`${this}-command-encoder`})}get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){return"unorm8x4-bgra"!==e}destroy(){this.props._reuseDevices||this._reused||delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new yC(this,t)}createTexture(e){return new MC(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new kC(this,e)}createShader(e){return new _C(this,e)}createFramebuffer(e){return new fC(this,e)}createVertexArray(e){return new QC(this,e)}createTransformFeedback(e){return new eI(this,e)}createQuerySet(e){return new nI(this,e)}createRenderPipeline(e){return new HC(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new ZC(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return sI(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:s=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=oI(e);a=a||u.width,l=l||u.height;const d=u;c=c||5121;let f=n;if(!f){const e=o+a*l*iI(s)*function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}(c);f=d.device.createBuffer({byteLength:e})}const p=e.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[i,r],destinationBuffer:f,byteOffset:o}),p.destroy(),h&&u.destroy(),f}(e,t)}setParametersWebGL(e){HT(this.gl,e)}getParametersWebGL(e){return jT(this.gl,e)}withParametersWebGL(e,t){return RC(this.gl,e,t)}resetWebGL(){Sg.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),HT(this.gl,kT)}_getDeviceSpecificTextureFormatCapabilities(e){return function(e,t,n){let i=t.create;const r=aC[t.format];return void 0===(null==r?void 0:r.gl)&&(i=!1),(null==r?void 0:r.x)&&(i=i&&Boolean(YT(e,r.x,n))),{format:t.format,create:i&&t.create,render:i&&t.render,filter:i&&t.filter,blend:i&&t.blend,store:i&&t.store}}(this.gl,e,this._extensions)}loseDevice(){var e;let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),null==(e=this._resolveContextLost)||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){XT.get(this.gl).push()}popState(){XT.get(this.gl).pop()}getGLKey(e,t){const n=Number(e);for(const i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return(null==t?void 0:t.emptyIfUnknown)?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((e,[n,i])=>(e[`${n}:${this.getGLKey(n,t)}`]=`${i}:${this.getGLKey(i,t)}`,e),{})}setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(i,t)&&Sg.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return YT(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,n){e.luma=t;const i={props:n.spector,id:n.spector.id};e.__SPECTOR_Metadata=i}}const cI=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:lI},Symbol.toStringTag,{value:"Module"}));function uI(){}const hI={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:uI,onWebGLInitialized:uI,onResize:uI,onViewStateChange:uI,onInteractionStateChange:uI,onBeforeRender:uI,onAfterRender:uI,onLoad:uI,onError:e=>Op.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class dI{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new rf({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=kw[e.type],n=e.offsetCenter;if(!t||!n||!this.layerManager)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=r,o=s&&(s[t]||s.props[t]),a=this.props[t];let l=!1;o&&(l=o.call(s,r,e)),l||(null==a||a(r,e),this.widgetManager.onEvent(r,e))},this._onPointerDown=e=>{var t;if("webgpu"===(null==(t=this.device)?void 0:t.type))return;const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...hI,...e},(e=this.props).viewState&&e.initialViewState&&Op.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Op.error("WebGL1 context not supported.")(),t=IT.attach(e.gl,this.props.deviceProps)),t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Yx.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,i,r,s,o,a,l,c;null==(e=this.animationLoop)||e.stop(),null==(t=this.animationLoop)||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,null==(n=this.layerManager)||n.finalize(),this.layerManager=null,null==(i=this.viewManager)||i.finalize(),this.viewManager=null,null==(r=this.effectManager)||r.finalize(),this.effectManager=null,null==(s=this.deckRenderer)||s.finalize(),this.deckRenderer=null,null==(o=this.deckPicker)||o.finalize(),this.deckPicker=null,null==(a=this.eventManager)||a.destroy(),this.eventManager=null,null==(l=this.widgetManager)||l.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(null==(c=this.canvas.parentElement)||c.removeChild(this.canvas),this.canvas=null)}setProps(e){var t,n,i,r,s,o,a,l;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Op.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Op.removed("onLayerClick","onClick")(),e.initialViewState&&!gS(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const c=Object.create(this.props);if(Object.assign(c,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==(null==(t=this.device)?void 0:t.id)&&(null==(n=this.animationLoop)||n.stop(),this.canvas!==(null==(i=e.device.canvasContext)?void 0:i.canvas)&&(null==(r=this.canvas)||r.remove(),null==(s=this.eventManager)||s.destroy(),this.canvas=null),Op.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),null==(o=this.animationLoop)||o.setProps(c),void 0!==e.useDevicePixels&&(null==(l=null==(a=this.device)?void 0:a.canvasContext)?void 0:l.canvas)instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;const t=this.device.canvasContext.canvas,n={target:t,contentBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}],devicePixelContentBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}],borderBoxSize:[{inlineSize:t.clientWidth,blockSize:t.clientHeight}]};this.device.canvasContext._handleResize([n])}this.layerManager&&(this.viewManager.setProps(c),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(c),this.effectManager.setProps(c),this.deckRenderer.setProps(c),this.deckPicker.setProps(c),this.widgetManager.setProps(c)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t=t||n||i||r||s,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return IS(this.viewManager),this.viewManager.views}getViewports(e){return IS(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;null==(t=this.layerManager)||t.removeDefaultShaderModule(e)}_pick(e,t,n){IS(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;if("string"==typeof t&&(t=document.getElementById(t),IS(t)),!t){t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&"number"==typeof e.width&&(t.width=e.width),e.height&&"number"==typeof e.height&&(t.height=e.height);(e.parent||document.body).appendChild(t)}return Object.assign(t.style,e.style),t}_setCanvasSize(e){var t;if(!this.canvas)return;const{width:n,height:i}=e;if(n||0===n){const e=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=e}if(i||0===i){const n=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=(null==(t=e.style)?void 0:t.position)||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){var e,t;const{canvas:n}=this;if(!n)return;const i=n.clientWidth??n.width,r=n.clientHeight??n.height;i===this.width&&r===this.height||(this.width=i,this.height=r,null==(e=this.viewManager)||e.setProps({width:i,height:r}),null==(t=this.layerManager)||t.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(e,t){const{gl:n,onError:i}=t;return new vA({device:e,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(e){var t,n;const i=null==(t=this.props.deviceProps)?void 0:t.createCanvasContext,r="object"==typeof i?i:void 0,s={adapters:[],...e.deviceProps};s.adapters.includes(IT)||s.adapters.push(IT);const o={alphaMode:"webgpu"===(null==(n=this.props.deviceProps)?void 0:n.type)?"premultiplied":void 0};return lm.createDevice({_reuseDevices:!0,type:"webgl",...s,createCanvasContext:{...o,...r,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new $S({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var e,t,n,i;if("webgpu"===(null==(e=this.device)?void 0:e.type))return;const{_pickRequest:r}=this;if(r.event){const{result:e,emptyInfo:s}=this._pick("pickObject","pickObject Time",r);this.cursorState.isHovering=e.length>0;let o=s,a=!1;for(const n of e)o=n,a=(null==(t=n.layer)?void 0:t.onHover(n,r.event))||a;a||(null==(i=(n=this.props).onHover)||i.call(n,o,r.event),this.widgetManager.onHover(o,r.event)),r.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var t,n;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=null==(t=this.device.canvasContext)?void 0:t.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);const i=new gA;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new Sw(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Rw).map(e=>{var t;const[n,i,r,s]=Rw[e];return{recognizer:new n({...i,...null==(t=this.props.eventRecognizerOptions)?void 0:t[e],event:e}),recognizeWith:r,requestFailure:s}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in kw)this.eventManager.on(s,this._onEvent);this.viewManager=new mS({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new pS(this.device,{deck:this,stats:this.stats,viewport:r,timeline:i}),this.effectManager=new qS({deck:this,device:this.device}),this.deckRenderer=new YS(this.device),this.deckPicker=new iT(this.device),this.widgetManager=new aT({deck:this,parentElement:null==(n=this.canvas)?void 0:n.parentElement}),this.widgetManager.addDefault(new hT),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var n;const{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};null==(n=this.deckRenderer)||n.renderLayers(s),"screen"===s.pass&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),Op.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),"webgpu"!==(null==(e=this.device)?void 0:e.type)&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=lm.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}dI.defaultProps=hI,dI.VERSION=Gp;const fI=Lg;function pI(e,t,n){const i="webgpu"===n&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${i}x${t.size}`:t.type,byteOffset:t.offset||0}}function gI(e){return e.stride||e.size*e.bytesPerElement}function mI(e,t){t.offset&&Op.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=gI(e),i=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:n}}class yI{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,r="float64"===i;let s,{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0),s=r?"float32":!i&&t.isIndexed?"uint32":i||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Bg(e)}}(i||s);this.doublePrecision=r,r&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:o,logicalType:i,type:s,normalized:s.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*gI(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Yx.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const i=this.value;if(t){const r=mI(this.getAccessor(),t),s=r.offset/i.BYTES_PER_ELEMENT,o=r.size||this.size;n[e]=i.subarray(s,s+o)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),i=[],r={name:this.id,byteStride:gI(n),attributes:i};if(this.doublePrecision){const r=function(e,t){const n=mI(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(n,t||{});i.push(pI(e,{...n,...r.high},this.device.type),pI(`${e}64Low`,{...n,...r.low},this.device.type))}else if(t){const r=mI(n,t);i.push(pI(e,{...n,...r},this.device.type))}else i.push(pI(e,n,this.device.type));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,r=n*i;if(t&&r&&t.length>=r){const n=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let e=0;e<r;)for(let r=0;r<i;r++){const i=t[e++];i<n[r]&&(n[r]=i),i>s[r]&&(s[r]=i)}e=[n,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;n=ArrayBuffer.isView(e)?{value:e}:e instanceof Rg?{buffer:e}:e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type){if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const e=fI(n.value);i.type=i.normalized?e.replace("int","norm"):e}}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=gI(i)}if(t.bounds=null,n.constant){let e=n.value;e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e));if(!(!t.constant||!this._areValuesEqual(e,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(n.buffer){const e=n.buffer;t.externalBuffer=e,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let e=n.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:r}=this;const s=gI(i),o=(i.vertexOffset||0)*s;if(this.doublePrecision&&e instanceof Float64Array&&(e=tA(e,i)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const a=e.byteLength+o+2*s;(!r||r.byteLength<a)&&(r=this._createBuffer(a)),r.write(e,o)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?tA(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,i=n.allocatedValue,r=Yx.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=r;const{byteOffset:s}=this;let{buffer:o}=this;return(!o||o.byteLength<r.byteLength+s)&&(o=this._createBuffer(r.byteLength+s),t&&i&&o.write(i instanceof Float64Array?tA(i,this):i,s)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof n||!this.settings.normalized||"normalized"in e||Op.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let e=r;for(;--e>=0;)t[n+e]=i[e];return t}switch(r){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=r;for(;--s>=0;)t[n+s]=Number.isFinite(e[s])?e[s]:i[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var t;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:i}=this.settings;return this._buffer=this.device.createBuffer({...null==(t=this._buffer)?void 0:t.props,id:this.id,usage:(n?Rg.INDEX:Rg.VERTEX)|Rg.COPY_DST,indexType:n?i:void 0,byteLength:e}),this._buffer}}const vI=[],_I=[];function bI(e,t=0,n=1/0){let i=vI;const r={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(_I.length=e.length,i=_I):i=vI,(t>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,n),r.index=t-1),{iterable:i,objectInfo:r}}function EI(e){return e&&e[Symbol.asyncIterator]}function wI(e,t){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=t,a=e.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((e.length-c)/l);return(t,{index:i,target:r})=>{if(!s){const t=i*l+c;for(let i=0;i<n;i++)r[i]=e[t+i];return r}const a=s[i],h=s[i+1]||u;let d;if(o){d=new Array(h-a);for(let t=a;t<h;t++){const i=t*l+c;r=new Array(n);for(let t=0;t<n;t++)r[t]=e[i+t];d[t-a]=r}}else if(l===n)d=e.subarray(a*n+c,h*n+c);else{d=new e.constructor((h-a)*n);let t=0;for(let i=a;i<h;i++){const r=i*l+c;for(let i=0;i<n;i++)d[t++]=e[r+i]}}return d}}const xI=[],AI=[[0,1/0]];const SI={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function TI(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return{...SI[n],...t,...e,type:n}}class CI extends yI{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:AI}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,n,i;(t=this.state).layoutChanged||(t.layoutChanged=(n=e,i=this.getAccessor(),!(n.type===i.type&&n.size===i.size&&gI(n)===gI(i)&&(n.offset||0)===(i.offset||0)))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition;return TI(Array.isArray(t)?e[t.find(t=>e[t])]:e[t],n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===AI)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],i=e.length;let r=0;for(let s=0;s<i;s++){const i=e[s];i[1]<t[0]?(n.push(i),r=s+1):i[0]>t[1]?n.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return n.splice(r,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=AI}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=xI}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate(e,t.updateRanges!==AI),!0))}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:s,noAlloc:o}}=this;let a=!0;if(s){for(const[o,a]of r)s.call(i,this,{data:t,startRow:o,endRow:a,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of r){const i=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e,t){const n="webgpu"===this.device.type;if(n||void 0===t||"function"==typeof t){if(n&&"function"!=typeof t){const e=this._normalizeValue(t,[],0);this._areValuesEqual(e,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const i=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;n.binaryValue=e,this.setNeedsRedraw();if(i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const r=e;IS(ArrayBuffer.isView(r.value),`invalid ${i.accessor}`);const s=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=wI(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(n.stepMode="dynamic"===i?e?e.isInstanced?"instance":"vertex":"instance":i??"vertex",!t)return n;for(const r in t){const e=super._getBufferLayout(r,t[r]);n.attributes.push(...e.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:r,numInstances:s}){if(e.constant&&"webgpu"!==this.context.device.type)return;const{settings:o,state:a,value:l,size:c,startIndices:u}=e,{accessor:h,transform:d}=o;let f=a.binaryAccessor||("function"==typeof h?h:r[h]);"function"!=typeof f&&"string"==typeof h&&(f=()=>r[h]),IS("function"==typeof f,`accessor "${h}" is not a function`);let p=e.getVertexOffset(n);const{iterable:g,objectInfo:m}=bI(t,n,i);for(const y of g){m.index++;let t=f(y,m);if(d&&(t=d.call(this,t)),u){const n=(m.index<u.length-1?u[m.index+1]:s)-u[m.index];if(t&&Array.isArray(t[0])){let n=p;for(const i of t)e._normalizeValue(i,l,n),n+=c}else t&&t.length>c?l.set(t,p):(e._normalizeValue(t,m.target,0),hS({target:l,source:m.target,start:p,count:n}));p+=n*c}else e._normalizeValue(t,l,p),p+=c}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function II(e){const{source:t,target:n,start:i=0,size:r,getData:s}=e,o=e.end||n.length,a=t.length,l=o-i;if(a>l)return void n.set(t.subarray(0,l),i);if(n.set(t,i),!s)return;let c=a;for(;c<l;){const e=s(c,t);for(let t=0;t<r;t++)n[i+c]=e[t]||0,c++}}function kI(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function RI(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function PI(e){e.push(e.shift())}function MI({device:e,source:t,target:n}){return(!n||n.byteLength<t.byteLength)&&(null==n||n.destroy(),n=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),n}function LI({device:e,buffer:t,attribute:n,fromLength:i,toLength:r,fromStartIndices:s,getData:o=e=>e}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,h=n.startIndices,d=s&&h,f=n.isConstant;if(!d&&t&&i>=r)return t;const p=n.value instanceof Float64Array?Float32Array:n.value.constructor,g=f?n.value:new p(n.getBuffer().readSyncWebGL(c,r*p.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!f){const e=o;o=(t,i)=>n.normalizeConstant(e(t,i))}const m=f?(e,t)=>o(g,t):(e,t)=>o(g.subarray(e+c,e+c+l),t),y=t?new Float32Array(t.readSyncWebGL(u,4*i).buffer):new Float32Array(0),v=new Float32Array(r);return function({source:e,target:t,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!r||!s)return II({source:e,target:t,size:n,getData:i}),t;let o=0,a=0;const l=i&&((e,t)=>i(e+a,t)),c=Math.min(r.length,s.length);for(let u=1;u<c;u++){const i=r[u]*n,c=s[u]*n;II({source:e.subarray(o,i),target:t,start:a,end:c,size:n,getData:l}),o=i,a=c}a<t.length&&II({source:[],target:t,start:a,size:n,getData:l})}({source:y,target:v,sourceStartIndices:s,targetStartIndices:h,size:l,getData:m}),(!t||t.byteLength<v.byteLength+u)&&(null==t||t.destroy(),t=e.createBuffer({byteLength:v.byteLength+u,usage:35050})),t.write(v,u),t}class BI{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new ES(n),this.attribute=t,this.attributeInTransition=function(e){const{device:t,settings:n,value:i}=e,r=new CI(t,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:n,settings:i,value:r,size:s}=e,o=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=e.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(i.noAlloc?r.length:(t+a)*s)*o}(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}const NI={name:"interpolation",vs:"uniform interpolationUniforms {\n  float time;\n} interpolation;\n",uniformTypes:{time:"f32"}},OI="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, interpolation.time);\n  gl_Position = vec4(0.0);\n}\n",DI="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n";function FI(e){return e.doublePrecision&&e.value instanceof Float64Array}const UI={name:"spring",vs:"uniform springUniforms {\n  float damping;\n  float stiffness;\n} spring;\n",uniformTypes:{damping:"f32",stiffness:"f32"}},zI="#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE force = delta * spring.stiffness;\n  ATTRIBUTE_TYPE resistance = velocity * spring.damping;\n  return force - resistance + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",GI="#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}";const VI={interpolation:class extends BI{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=function(e,t){const n=t.size,i=kI(n),r=RI(n),s=t.getBufferLayout();if(FI(t))return new HA(e,{vs:DI,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[sE,NI],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0});return new HA(e,{vs:OI,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:s.attributes[0].format}],modules:[NI],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:r,attribute:s}=this;PI(r),r[0]=LI({device:this.device,buffer:r[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),r[1]=MI({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:o}=this,a=o.model;let l=Math.floor(this.currentLength/s.size);FI(s)&&(l/=2),a.setVertexCount(l),s.isConstant?(a.setAttributes({aFrom:r[0]}),a.setConstantAttributes({aTo:s.value})):a.setAttributes({aFrom:r[0],aTo:s.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:r}=this.transform,s={time:i};r.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends BI{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}(e),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(e,this.texture),this.transform=function(e,t){const n=kI(t.size),i=RI(t.size);return new HA(e,{vs:zI,fs:GI,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[UI],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:r,attribute:s}=this;for(let a=0;a<2;a++)r[a]=LI({device:this.device,buffer:r[a],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});r[2]=MI({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?o.setConstantAttributes({aTo:s.value}):o.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,r=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const s={stiffness:r.stiffness,damping:r.damping};t.model.shaderInputs.setProps({spring:s}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),PI(e),this.setBuffer(e[1]);this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class HI{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const i in e){const n=e[i],r=n.getTransitionSetting(t);r&&this._updateAttribute(i,n,r)}for(const i in this.transitions){const n=e[i];n&&n.getTransitionSetting(t)||this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const t in this.transitions){this.transitions[t].update()&&(this.needsRedraw=!0)}const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let r=!i||i.type!==n.type;if(r){i&&this._removeTransition(e);const s=VI[n.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):(Op.error(`unsupported transition type '${n.type}'`)(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const jI="attributeManager.invalidate";class WI{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=Mw(nA),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new HI(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);Up(jI,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Up(jI,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:r={},buffers:s={},context:o={}}){let a=!1;Up("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const i=this.attributes[l],c=i.settings.accessor;i.startIndices=n,i.numInstances=t,r[l]&&Op.removed(`props.${l}`,`data.attributes.${l}`)(),i.setExternalBuffer(s[l])||i.setBinaryValue("string"==typeof c?s[c]:void 0,e.startIndices)||"string"==typeof c&&!s[c]&&i.setConstantValue(o,r[c])||i.needsUpdate()&&(a=!0,this._updateAttribute({attribute:i,numInstances:t,data:e,props:r,context:o})),this.needsRedraw=this.needsRedraw||i.needsRedraw()}a&&Up("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(e=>{var t;return null==(t=this.attributes[e])?void 0:t.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in t){const s=t[r];s.needsRedraw(e)&&!n.hasAttribute(r)&&(i[r]=s)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],r={...i,id:n,size:(i.isIndexed?1:i.size)||1,...t};this.attributes[n]=new CI(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes){this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)})}this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,r=i[e];return r&&r.forEach(e=>{const i=n[e];i&&i.setNeedsUpdate(i.id,t)}),r}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(Up("attribute.updateStart",t),t.constant)return void t.setConstantValue(e.context,t.value);t.allocate(n)&&Up("attribute.allocate",t,n);t.updateBuffer(e)&&(this.needsRedraw=!0,Up("attribute.updateEnd",t,n))}}const $I=1e-5;function XI(e,t,n,i,r){const s=t-e;return(n-t)*r+-s*i+s+t}function qI(e,t){if(Array.isArray(e)){let n=0;for(let i=0;i<e.length;i++){const r=e[i]-t[i];n+=r*r}return Math.sqrt(n)}return Math.abs(e-t)}const KI={interpolation:class extends ES{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:r}}=this,s=r(e/i);this._value=L_(t,n,s)}},spring:class extends ES{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:r=e,_currValue:s=e}=this;let o=function(e,t,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=XI(e[o],t[o],n[o],i,r);return s}return XI(e,t,n,i,r)}(r,s,t,n,i);const a=qI(o,t),l=qI(o,s);a<$I&&l<$I&&(o=t,this.end()),this._prevValue=s,this._currValue=o}}};class YI{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:r}=this;if(r.has(e)){const n=r.get(e),{value:i=n.settings.fromValue}=n;t=i,this.remove(e)}if(!(i=TI(i)))return;const s=KI[i.type];if(!s)return void Op.error(`unsupported transition type '${i.type}'`)();const o=new s(this.timeline);o.start({...i,fromValue:t,toValue:n}),r.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function JI(e,t){const n=QI({newProps:e,oldProps:t,propTypes:e[rS],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=e;i?i(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied");n&&r&&(n=r(e.data,t.data)||n);return n}(e,t);let r=!1;return i||(r=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers){if(nk(e,t,"all"))return{all:!0}}const n={};let i=!1;for(const r in e.updateTriggers)if("all"!==r){nk(e,t,r)&&(n[r]=!0,i=!0)}return!!i&&n}(e,t)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:tk(e,t),transitionsChanged:ZI(e,t)}}function ZI(e,t){if(!e.transitions)return!1;const n={},i=e[rS];let r=!1;for(const s in e.transitions){const o=i[s],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&ek(e[s],t[s],o)&&(n[s]=!0,r=!0)}return!!r&&n}function QI({newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(t===e)return!1;if("object"!=typeof e||null===e)return`${r} changed shallowly`;if("object"!=typeof t||null===t)return`${r} changed shallowly`;for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${r}.${s} added`;const n=ek(e[s],t[s],i[s]);if(n)return`${r}.${s} ${n}`}for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${r}.${s} dropped`;if(!Object.hasOwnProperty.call(e,s)){const n=ek(e[s],t[s],i[s]);if(n)return`${r}.${s} ${n}`}}return!1}function ek(e,t,n){let i=n&&n.equal;return i&&!i(e,t,n)?"changed deeply":i||(i=e&&t&&e.equals,!i||i.call(e,t))?i||t===e?null:"changed shallowly":"changed deeply"}function tk(e,t){if(null===t)return!0;const n=t.extensions,{extensions:i}=e;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function nk(e,t,n){let i=e.updateTriggers[n];i=null==i?{}:i;let r=t.updateTriggers[n];r=null==r?{}:r;return QI({oldProps:r,newProps:i,triggerName:n})}function ik(e){if(null===(t=e)||"object"!=typeof t)throw new Error("count(): argument not an object");var t;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}function rk(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){const e=n.modules.findIndex(e=>"project32"===e.name);e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const i={...e.inject};for(const e in t.inject)i[e]=(i[e]||"")+t.inject[e];n.inject=i}else n.inject=t.inject;return n}const sk={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},ok={};const ak={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||uk(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>gS(e,t,1)},accessor:{validate(e,t){const n=hk(e);return"function"===n||n===hk(t.value)},equal:(e,t,n)=>"function"==typeof t||gS(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||uk(e),equal(e,t,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?gS(e,t,r):e===t}},object:{equal(e,t,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?gS(e,t,r):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare&&!1!==n.ignore||e===t},data:{transform:(e,t,n)=>{if(!e)return e;const{dataTransform:i}=n.props;return i?i(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,n)=>{const i=n.context;return i&&i.device?function(e,t,n,i){if(n instanceof Em)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const{width:s,height:o}=n.data,a=t.createTexture({...n,sampler:{...sk,...r,...i},mipLevels:t.getMipLevelCount(s,o)});return a.generateMipmapsWebGL(),ok[a.id]=e,a}(n.id,i.device,e,{...t.parameters,...n.props.textureParameters}):null},release:(e,t,n)=>{var i,r;i=n.id,(r=e)&&r instanceof Em&&ok[r.id]===i&&(r.delete(),delete ok[r.id])}}};function lk(e,t){switch(hk(t)){case"object":return ck(e,t);case"array":return ck(e,{type:"array",value:t,compare:!1});case"boolean":return ck(e,{type:"boolean",value:t});case"number":return ck(e,{type:"number",value:t});case"function":return ck(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function ck(e,t){return"type"in t?{name:e,...ak[t.type],...t}:"value"in t?{name:e,type:hk(t.value),...t}:{name:e,type:"object",value:t}}function uk(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function hk(e){return uk(e)?"array":null===e?"null":typeof e}const dk="_mergedDefaultProps";function fk(e,t){if(!(e instanceof vk.constructor))return{};let n=dk;if(t)for(const r of t){const e=r.constructor;e&&(n+=`:${e.extensionName||e.name}`)}const i=mk(e,n);return i||(e[n]=function(e,t){const n=e.prototype;if(!n)return null;const i=Object.getPrototypeOf(e),r=fk(i),s=mk(e,"defaultProps")||{},o=function(e){const t={},n={},i={};for(const[r,s]of Object.entries(e)){const e=null==s?void 0:s.deprecatedFor;if(e)i[r]=Array.isArray(e)?e:[e];else{const e=lk(r,s);t[r]=e,n[r]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:i}}(s),a=Object.assign(Object.create(null),r,o.defaultProps),l=Object.assign(Object.create(null),null==r?void 0:r[rS],o.propTypes),c=Object.assign(Object.create(null),null==r?void 0:r[sS],o.deprecatedProps);for(const u of t){const e=fk(u.constructor);e&&(Object.assign(a,e),Object.assign(l,e[rS]),Object.assign(c,e[sS]))}(function(e,t){const n=function(e){const t=e.componentName;t||Op.warn(`${e.name}.componentName not specified`)();return t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:n}})})(a,e),function(e,t){const n={},i={};for(const r in t){const e=t[r],{name:s,value:o}=e;e.async&&(n[s]=o,i[s]=pk(s))}e[oS]=n,e[aS]={},Object.defineProperties(e,i)}(a,l),function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const i=`${this.id}: ${n}`;for(const r of t[n])gk(this,r)||(this[r]=e);Op.deprecated(i,t[n].join("/"))()}})}(a,c),a[rS]=l,a[sS]=c,0!==t.length||gk(e,"_propTypes")||(e._propTypes=l);return a}(e,t||[]))}function pk(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||EI(t)?this[aS][e]=t:this[lS][e]=t},get(){if(this[lS]){if(e in this[lS]){return this[lS][e]||this[oS][e]}if(e in this[aS]){const t=this[iS]&&this[iS].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[oS][e]}}return this[oS][e]}}}function gk(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function mk(e,t){return gk(e,t)&&e[t]}let yk=0;class vk{constructor(...e){this.props=function(e,t){let n;for(let s=t.length-1;s>=0;s--){const e=t[s];"extensions"in e&&(n=e.extensions)}const i=fk(e.constructor,n),r=Object.create(i);r[iS]=e,r[aS]={},r[lS]={};for(let s=0;s<t.length;++s){const e=t[s];for(const t in e)r[t]=e[t]}return Object.freeze(r),r}(this,e),this.id=this.props.id,this.count=yk++}clone(e){const{props:t}=this,n={};for(const i in t[oS])i in t[lS]?n[i]=t[lS][i]:i in t[aS]&&(n[i]=t[aS][i]);return new this.constructor({...t,...n,...e})}}vk.componentName="Component",vk.defaultProps={};const _k=Object.freeze({});class bk{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||_k}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[iS]||this.component;const t=e[lS]||{},n=e[aS]||e,i=e[oS]||{};for(const r in t){const e=t[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,e),t[r]=this.getAsyncProp(r)}for(const r in n){const e=n[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,e)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):EI(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],s=0;for await(const o of t){if(!this.component)return;const{dataTransform:t}=this.component.props;r=t?t(o,r):r.concat(o),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:s,endRow:r.length}]}),s=r.length,this._setAsyncPropValue(e,r,i)}this._onResolve(e,r)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[rS];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Ek extends bk{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=null==n?void 0:n.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const wk=2**24-1,xk=Object.freeze([]),Ak=Mw(({oldViewport:e,viewport:t})=>e.equals(t));let Sk=new Uint8ClampedArray(0);const Tk={data:{type:"data",value:xk,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;r=r||n.getLoadOptions(),i=i||n.props.loaders,s&&(r={...r,fetch:{...null==r?void 0:r.fetch,signal:s}});let a=o.contains(e);return a||r||(o.add({resourceId:e,data:dp(e,i),persistent:!1}),a=!0),a?o.subscribe({resourceId:e,onChange:e=>{var i;return null==(i=n.internalState)?void 0:i.reloadAsyncProp(t,e)},consumerId:n.id,requestId:t}):dp(e,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Tw.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ck extends vk{constructor(){super(...arguments),this.internalState=null,this.lifecycle=JA,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){IS(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=hA(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,s]=px(n,t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,s]}unproject(e){IS(this.internalState);return(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){IS(this.internalState);return dA(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Tw.DEFAULT||e===Tw.LNGLAT||e===Tw.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){IS(e instanceof Uint8Array);const[t,n,i]=e;return t+256*n+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:ik(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=rk(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=rk(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:n}=e,i=this.internalState.hasPickingBuffer,r=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(i!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:e,instancePickingColors:n}=t.attributes,i=e||n;i&&(r&&i.constant&&(i.constant=!1,t.invalidate(i.id)),i.value||r||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var n,i,r,s;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(null==(i=(n=this.props).onError)?void 0:i.call(n,e))||null==(s=null==(r=this.context)?void 0:r.onError)||s.call(r,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var e;return(null==(e=this.internalState)?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&Ak({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(Sk.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>wk&&Op.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Sk=Yx.allocate(Sk,t,{size:4,copy:!0,maxCount:Math.max(t,wk)});const e=Math.floor(Sk.length/4),i=[0,0,0];for(let t=n;t<e;t++)this.encodePickingColor(t,i),Sk[4*t+0]=i[0],Sk[4*t+1]=i[1],Sk[4*t+2]=i[2],Sk[4*t+3]=0}e.value=Sk.subarray(0,4*t)}_setModelAttributes(e,t,n=!1){var i;if(!Object.keys(t).length)return;if(n){const n=this.getAttributeManager();e.setBufferLayout(n.getBufferLayouts(e)),t=n.getAttributes()}const r=(null==(i=e.userData)?void 0:i.excludeAttributes)||{},s={},o={};for(const a in t){if(r[a])continue;const n=t[a].getValue();for(const i in n){const r=n[i];r instanceof Rg?t[a].settings.isIndexed?e.setIndexBuffer(r):s[i]=r:r&&(o[i]=r)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i,s=r&&t.attributes&&t.attributes[r.id];if(s&&s.value){const n=s.value,i=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=r.getVertexOffset(e);n[t]===i[0]&&n[t+1]===i[1]&&n[t+2]===i[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const r=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(s-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Sk.buffer&&(n.value=Sk.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){IS(!this.internalState),IS(Number.isFinite(this.props.coordinateSystem)),Up("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Ek({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Op.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new YI(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Up("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Up("layer.update",this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,r=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||r,this.props=s;try{const e=this._getUpdateParams(),t=this.getModels();if(n.device)this.updateState(e);else try{this.updateState(e)}catch(o){}for(const n of this.props.extensions)n.updateState.call(this,e,n);this.setNeedsRedraw(),this._updateAttributes();const i=this.getModels()[0]!==t[0];this._postUpdate(e,i)}finally{n.viewport=r,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Up("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:r}=this.props,o=r&&r(n)||[0,0];s.device instanceof lI&&s.device.setParametersWebGL({polygonOffset:o});for(const e of this.getModels())"webgpu"===e.device.type?e.setParameters({...e.parameters,...i}):e.setParameters(i);if(s.device instanceof lI)s.device.withParametersWebGL(i,()=>{const r={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:s};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)});else{const r={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:s};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)}}finally{this.props=r}}getChangeFlags(){var e;return null==(e=this.internalState)?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let n=!1;if("dataChanged"===i){const r=e[i],s=t[i];r&&Array.isArray(s)&&(t.dataChanged=Array.isArray(r)?s.concat(r):r,n=!0)}t[i]||(t[i]=e[i],n=!0),n&&Up("layer.changeFlag",this,i,e)}const n=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var n;const i=JI(e,t);if(i.updateTriggersChanged)for(const r in i.updateTriggersChanged)i.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(i.transitionsChanged)for(const r in i.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],null==(n=e.transitions)?void 0:n[r]);return this.setChangeFlags(i)}validateProps(){!function(e){const t=e[rS];for(const n in t){const i=t[n],{validate:r}=i;if(r&&!r(e[n],i))throw new Error(`Invalid prop ${n}: ${e[n]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"==typeof n&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new WI(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e,r=this.state.model;(null==r?void 0:r.isInstanced)&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:o,highlightColor:a}=n;if(t||i.autoHighlight!==s||i.highlightedObjectIndex!==o||i.highlightColor!==a){const e={};Array.isArray(a)&&(e.highlightColor=a),(t||i.autoHighlight!==s||o!==i.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=!!n&&n.getNeedsRedraw(e);if(t=t||i,t)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ck.defaultProps=Tk,Ck.layerName="Layer";class Ik extends Ck{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if("function"==typeof e){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){var t;const{opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:d,positionFormat:f,modelMatrix:p,extensions:g,fetch:m,operation:y,_subLayerProps:v}=this.props,_={id:"",updateTriggers:{},opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:d,positionFormat:f,modelMatrix:p,extensions:g,fetch:m,operation:y},b=v&&e.id&&v[e.id],E=b&&b.updateTriggers,w=e.id||"sublayer";if(b){const t=this.props[rS],n=e.type?e.type._propTypes:{};for(const e in b){const i=n[e]||t[e];i&&"accessor"===i.type&&(b[e]=this.getSubLayerAccessor(b[e]))}}Object.assign(_,e,b),_.id=`${this.props.id}-${w}`,_.updateTriggers={all:null==(t=this.props.updateTriggers)?void 0:t.all,...e.updateTriggers,...E};for(const x of g){const e=x.getSubLayerProps.call(this,x);e&&Object.assign(_,e,{updateTriggers:Object.assign(_.updateTriggers,e.updateTriggers)})}return _}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){n=cS(this.renderLayers(),Boolean),this.internalState.subLayers=n}Up("compositeLayer.renderLayers",this,i,n);for(const r of n)r.parent=this}}Ik.layerName="CompositeLayer";const kk=Math.PI/180,Rk=180/Math.PI,Pk=6370972,Mk=256;function Lk(){const e=4018225162502676e-20,t=Math.PI/180*Mk;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}class Bk extends aA{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:r=1,resolution:s=10}=e;let{latitude:o=0,height:a,altitude:l=1.5,fovy:c}=e;o=Math.max(Math.min(o,rx),-85.051129),a=a||1,c?l=fx(c):c=dx(l);const u=1/Math.PI/Math.cos(o*Math.PI/180),h=Math.pow(2,n)*u,d=e.nearZ??i,f=e.farZ??(l+512*h/a)*r,p=(new Fb).lookAt({eye:[0,-l,0],up:[0,0,1]});p.rotateX(o*kk),p.rotateZ(-t*kk),p.scale(h/a),super({...e,height:a,viewMatrix:p,longitude:t,latitude:o,zoom:n,distanceScales:Lk(),fovy:c,focalDistance:l,near:d,far:f}),this.scale=h,this.latitude=o,this.longitude=t,this.resolution=s}get projectionMode(){return Cw.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),r=this.unproject([this.width,this.height/2],t),s=this.unproject([this.width/2,this.height],t);return r[0]<this.longitude&&(r[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],r[0],i[0],s[0]),Math.min(n[1],r[1],i[1],s[1]),Math.max(n[0],r[0],i[0],s[0]),Math.max(n[1],r[1],i[1],s[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,s]=e,o=t?r:this.height-r,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(s))l=Nk(a,[i,o,s,1]);else{const e=Nk(a,[i,o,-1,1]),t=Nk(a,[i,o,1,1]),r=((n||0)/Pk+1)*Mk,s=ab(sb([],e,t)),c=ab(e),u=ab(t),h=4*((4*c*u-(s-c-u)**2)/16)/s;l=function(e,t,n,i){const r=t[0],s=t[1],o=t[2];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e[2]=o+i*(n[2]-o),e}([],e,t,(Math.sqrt(c-h)-Math.sqrt(Math.max(0,r*r-h)))/Math.sqrt(s))}const[c,u,h]=this.unprojectPosition(l);return Number.isFinite(s)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n,i=0]=e,r=t*kk,s=n*kk,o=Math.cos(s),a=(i/Pk+1)*Mk;return[Math.sin(r)*o*a,-Math.cos(r)*o*a,Math.sin(s)*a]}unprojectPosition(e){const[t,n,i]=e,r=ob(e),s=Math.asin(i/r);return[Math.atan2(t,-n)*Rk,s*Rk,(r/Mk-1)*Pk]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function Nk(e,t){const n=Pb([],t,e);return Rb(n,n,1/n[3]),n}class Ok{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Yx,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:s,dataChanged:o,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===s?2:3),this.buffers=n,this.normalize=a,r&&(IS(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.vertexPositions=r)),this.geometryBuffer=n.vertexPositions,Array.isArray(o))for(const l of o)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?wI(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:s}=this;for(const o in r)if(o in i)s.release(n[o]),n[o]=null;else{const i=r[o];i.copy=t,n[o]=s.allocate(n[o],e,i)}}_forEachGeometry(e,t,n){const{data:i,getGeometry:r}=this,{iterable:s,objectInfo:o}=bI(i,t,n);for(const a of s){o.index++;e(r?r(a,o):null,o.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:s}=this,{startRow:o=0,endRow:a=1/0}=e||{},l={};if(e||(t=[0],n=[0]),this.normalize||!s)this._forEachGeometry((e,t)=>{const i=e&&this.normalizeGeometry(e);l[t]=i,n[t+1]=n[t]+(i?this.getGeometrySize(i):0)},o,a),i=n[n.length-1];else if(n=r.startIndices,i=n[r.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof Rg){const e=4*this.positionSize;i=i||s.byteLength/e}else if(s.buffer){const e=s.stride||4*this.positionSize;i=i||s.buffer.byteLength/e}else if(s.value){const e=s.value,t=s.stride/e.BYTES_PER_ELEMENT||this.positionSize;i=i||e.length/t}this._allocate(i,Boolean(e)),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=i;const c={};this._forEachGeometry((e,r)=>{const s=l[r]||e;c.vertexStart=n[r],c.indexStart=t[r];const o=r<n.length-1?n[r+1]:i;c.geometrySize=o-n[r],c.geometryIndex=r,this.updateGeometryAttributes(s,c)},o,a),this.vertexCount=t[t.length-1]}}const Dk="undefined"!=typeof window?ve.useLayoutEffect:ve.useEffect;function Fk(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}const Uk={position:"absolute",zIndex:-1};function zk(e,t){if("function"==typeof e)return e(t);if(Array.isArray(e))return e.map(e=>zk(e,t));if(Gk(e)){if(function(e){var t;return null==(t=e.props)?void 0:t.mapStyle}(e))return t.style=Uk,ve.cloneElement(e,t);if(function(e){const t=e.type;return t&&t.deckGLViewProps}(e))return ve.cloneElement(e,t)}return e}function Gk(e){return e&&"object"==typeof e&&"type"in e||!1}function Vk(e){if("function"==typeof e)return ve.createElement(bS,{},e);if(Array.isArray(e))return e.map(Vk);if(Gk(e)){if(e.type===ve.Fragment)return Vk(e.props.children);if(Fk(e.type,bS))return e}return e}const Hk=ve.createContext();const jk={mixBlendMode:null};function Wk(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}const $k=ve.forwardRef(function(e,t){const[n,i]=ve.useState(0),r=ve.useRef({control:null,version:n,forceUpdate:()=>i(e=>e+1)}).current,s=ve.useRef(null),o=ve.useRef(null),a=ve.useMemo(()=>function({children:e,layers:t=[],views:n=null}){const i=[],r=[],s={};return ve.Children.forEach(Vk(e),e=>{if(Gk(e)){const t=e.type;if(Fk(t,Ck)){const n=function(e,t){const n={},i=e.defaultProps||{};for(const r in t)i[r]!==t[r]&&(n[r]=t[r]);return new e(n)}(t,e.props);r.push(n)}else i.push(e);if(Fk(t,bS)&&t!==bS&&e.props.id){const n=new t(e.props);s[n.id]=n}}else e&&i.push(e)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(e=>{s[e.id]=e}):n&&(s[n.id]=n),n=Object.values(s)),{layers:t=r.length>0?[...r,...t]:t,children:i,views:n}}(e),[e.layers,e.views,e.children]);let l=!0;const c=t=>{var n;return l&&e.viewState?(r.viewStateUpdateRequested=t,null):(r.viewStateUpdateRequested=null,null==(n=e.onViewStateChange)?void 0:n.call(e,t))},u=t=>{var n;l?r.interactionStateUpdateRequested=t:(r.interactionStateUpdateRequested=null,null==(n=e.onInteractionStateChange)||n.call(e,t))},h=ve.useMemo(()=>{const t={widgets:[],...e,style:null,width:"100%",height:"100%",parent:s.current,canvas:o.current,layers:a.layers,views:a.views,onViewStateChange:c,onInteractionStateChange:u};return delete t._customRender,r.deck&&r.deck.setProps(t),t},[e]);ve.useEffect(()=>{const t=e.Deck||dI;return r.deck=function(e,t,n){var i,r,s;const o=new t({...n,_customRender:"webgpu"===(null==(s=null==(r=null==(i=n.deviceProps)?void 0:i.adapters)?void 0:r[0])?void 0:s.type)?void 0:t=>{e.redrawReason=t;const n=o.getViewports();e.lastRenderedViewports!==n?e.forceUpdate():Wk(e)}});return o}(r,t,{...h,parent:s.current,canvas:o.current}),()=>{var e;return null==(e=r.deck)?void 0:e.finalize()}},[]),Dk(()=>{var e;Wk(r);const{viewStateUpdateRequested:t,interactionStateUpdateRequested:n}=r;t&&c(t),n&&u(n),(null==(e=r.deck)?void 0:e.isInitialized)&&r.deck.redraw("Initial render")}),ve.useImperativeHandle(t,()=>function(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}(r),[]);const d=r.deck&&r.deck.isInitialized?r.deck.getViewports():void 0,{ContextProvider:f,width:p="100%",height:g="100%",id:m,style:y}=e,{containerStyle:v,canvasStyle:_}=ve.useMemo(()=>function({width:e,height:t,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},r={left:0,top:0};if(n)for(const s in n)s in jk?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}({width:p,height:g,style:y}),[p,g,y]);if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===d||r.version!==n){r.lastRenderedViewports=d,r.version=n;const e=function({children:e,deck:t,ContextProvider:n=Hk.Provider}){const{viewManager:i}=t||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const o of e){let e=s,t=o;Gk(o)&&Fk(o.type,bS)&&(e=o.props.id||s,t=o.props.children);const n=i.getViewport(e),a=i.getViewState(e);if(n){a.padding=n.padding;const{x:i,y:s,width:o,height:l}=n;t=zk(t,{x:i,y:s,width:o,height:l,viewport:n,viewState:a}),r[e]||(r[e]={viewport:n,children:[]}),r[e].children.push(t)}}return Object.keys(r).map(e=>{const{viewport:i,children:s}=r[e],{x:o,y:a,width:l,height:c}=i,u={position:"absolute",left:o,top:a,width:l,height:c},h=`view-${e}`,d=ve.createElement("div",{key:h,id:h,style:u},...s),f={deck:t,viewport:i,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:n=>{n.viewId=e,t._onViewStateChange(n)},widgets:[]},p=`view-${e}-context`;return ve.createElement(n,{key:p,value:f},d)})}({children:a.children,deck:r.deck,ContextProvider:f}),t=ve.createElement("canvas",{key:"canvas",id:m||"deckgl-overlay",ref:o,style:_});r.control=ve.createElement("div",{id:`${m||"deckgl"}-wrapper`,ref:s,style:v},[t,e])}return l=!1,r.control}),Xk=new Uint32Array([0,2,1,0,3,2]),qk=new Float32Array([0,1,0,0,1,0,1,1]);function Kk(e,t){if(!t)return function(e){const t=new Float64Array(12);for(let n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return{vertexCount:6,positions:t,indices:Xk,texCoords:qk}}(e);const n=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),i=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),r=Math.ceil(n/t)+1,s=Math.ceil(i/t)+1,o=(r-1)*(s-1)*6,a=new Uint32Array(o),l=new Float32Array(r*s*2),c=new Float64Array(r*s*3);let u=0,h=0;for(let d=0;d<r;d++){const t=d/(r-1);for(let n=0;n<s;n++){const i=n/(s-1),r=Yk(e,t,i);c[3*u+0]=r[0],c[3*u+1]=r[1],c[3*u+2]=r[2]||0,l[2*u+0]=t,l[2*u+1]=1-i,d>0&&n>0&&(a[h++]=u-s,a[h++]=u-s-1,a[h++]=u-1,a[h++]=u-s,a[h++]=u-1,a[h++]=u),u++}}return{vertexCount:o,positions:c,indices:a,texCoords:l}}function Yk(e,t,n){return L_(L_(e[0],e[1],n),L_(e[3],e[2],n),t)}const Jk="uniform bitmapUniforms {\n  vec4 bounds;\n  float coordinateConversion;\n  float desaturate;\n  vec3 tintColor;\n  vec4 transparentColor;\n} bitmap;\n",Zk={name:"bitmap",vs:Jk,fs:Jk,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},Qk={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Tw.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class eR extends Ck{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nin vec2 texCoords;\nin vec3 positions;\nin vec3 positions64Low;\n\nout vec2 vTexCoord;\nout vec2 vTexPos;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (bitmap.coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project.commonOrigin.xy;\n  } else if (bitmap.coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nin vec2 vTexCoord;\nin vec2 vTexPos;\n\nout vec4 fragColor;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), bitmap.desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * bitmap.tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (bitmap.transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),\n    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])\n  );\n}\n\n\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (bitmap.coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (bitmap.coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture(bitmapTexture, uv);\n\n  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  if (bool(picking.isActive) && !bool(picking.isAttribute)) {\n    // Since instance information is not used, we can use picking color for pixel index\n    fragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n",modules:[$w,Cx,Zk]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:n}){var i;const r=this.getAttributeManager();if(n.extensionsChanged&&(null==(i=this.state.model)||i.destroy(),this.state.model=this._getModel(),r.invalidateAll()),e.bounds!==t.bounds){const e=this.state.mesh,t=this._createMesh();this.state.model.setVertexCount(t.vertexCount);for(const n in t)e&&e[n]!==t[n]&&r.invalidate(n);this.setState({mesh:t,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,n=e.info;if(!n.color||!t)return n.bitmap=null,n;const{width:i,height:r}=t;n.index=0;const s=function(e){const[t,n,i]=e;return[(t+(15&i)/16)/256,(n+(240&i)/256)/256]}(n.color);return n.bitmap={size:{width:i,height:r},uv:s,pixel:[Math.floor(s[0]*i),Math.floor(s[1]*r)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return tR(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),Kk(t,this.context.viewport.resolution)}_getModel(){return new zA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:t}=e,{model:n,coordinateConversion:i,bounds:r,disablePicking:s}=this.state,{image:o,desaturate:a,transparentColor:l,tintColor:c}=this.props;if((!t.picking.isActive||!s)&&o&&n){const e={bitmapTexture:o,bounds:r,coordinateConversion:i,desaturate:a,tintColor:c.slice(0,3).map(e=>e/255),transparentColor:l.map(e=>e/255)};n.shaderInputs.setProps({bitmap:e}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:n}=Tw;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:n}=this.props;if(!tR(n))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const r=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&r===t)return{coordinateConversion:-1,bounds:n};if(i===t&&r===e){const e=ox([n[0],n[1]]),t=ox([n[2],n[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}function tR(e){return Number.isFinite(e[0])}eR.layerName="BitmapLayer",eR.defaultProps=Qk;const nR="uniform iconUniforms {\n  float sizeScale;\n  vec2 iconsTextureDim;\n  float sizeBasis;\n  float sizeMinPixels;\n  float sizeMaxPixels;\n  bool billboard;\n  highp int sizeUnits;\n  float alphaCutoff;\n} icon;\n",iR={name:"icon",vs:nR,fs:nR,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},rR=()=>{},sR={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},oR={x:0,y:0,width:0,height:0};function aR(e,t,n,i){const r=Math.min(n/t.width,i/t.height),s=Math.floor(t.width*r),o=Math.floor(t.height*r);return 1===r?{image:t,width:s,height:o}:(e.canvas.height=o,e.canvas.width=s,e.clearRect(0,0,s,o),e.drawImage(t,0,0,t.width,t.height,0,0,s,o),{image:e.canvas,width:s,height:o})}function lR(e){return e&&(e.id||e.url)}function cR(e,t,n){for(let i=0;i<t.length;i++){const{icon:r,xOffset:s}=t[i];e[lR(r)]={...r,x:s,y:n}}}class uR{constructor(e,{onUpdate:t=rR,onError:n=rR}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=n}finalize(){var e;null==(e=this._texture)||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?lR(e):e;return this._mapping[t]||oR}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,textureParameters:r}){var s;e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),i&&(this._mapping=i),n&&(null==(s=this._texture)||s.delete(),this._texture=null,this._externalTexture=n),r&&(this._samplerParameters=r)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){var n;if(!this._autoPacking||"undefined"==typeof document)return;const i=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=bI(e);for(const o of r){s.index++;const e=t(o,s),r=lR(e);if(!e)throw new Error("Icon is missing.");if(!e.url)throw new Error("Icon url is missing.");i[r]||n[r]&&e.url===n[r].url||(i[r]={...e,source:o,sourceIndex:s.index})}return i}(e,t,this._mapping)||{});if(i.length>0){const{mapping:e,xOffset:t,yOffset:r,rowHeight:s,canvasHeight:o}=function({icons:e,buffer:t,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let c=0;c<e.length;c++){const l=e[c];if(!n[lR(l)]){const{height:e,width:c}=l;i+c+t>o&&(cR(n,a,r),i=0,r=s+r+t,s=0,a=[]),a.push({icon:l,xOffset:i}),i=i+c+t,s=Math.max(s,e)}}return a.length>0&&cR(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:(l=s+r+t,Math.pow(2,Math.ceil(Math.log2(l))))};var l}({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=s,this._mapping=e,this._xOffset=t,this._yOffset=r,this._canvasHeight=o,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||sR,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,n,i){const{width:r,height:s,device:o}=e,a=o.createTexture({format:"rgba8unorm",width:t,height:n,sampler:i,mipLevels:o.getMipLevelCount(t,n)}),l=o.createCommandEncoder();return l.copyTextureToTexture({sourceTexture:e,destinationTexture:a,width:r,height:s}),l.finish(),a.generateMipmapsWebGL(),e.destroy(),a}(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||sR)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i),null==(n=this._texture)||n.generateMipmapsWebGL()}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,dp(n.url,this._loadOptions).then(e=>{var i,r;const s=lR(n),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{image:h,width:d,height:f}=aR(t,e,c,u);null==(i=this._texture)||i.copyExternalImage({image:h,x:a+(c-d)/2,y:l+(u-f)/2,width:d,height:f}),o.width=d,o.height=f,null==(r=this._texture)||r.generateMipmapsWebGL(),this.onUpdate()}).catch(e=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:e})}).finally(()=>{this._pendingCount--})}}const hR=[0,0,0,255],dR={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:hR},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class fR extends Ck{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME icon-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceSizes;\nin float instanceAngles;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec4 instanceIconFrames;\nin float instanceColorModes;\nin vec2 instanceOffsets;\nin vec2 instancePixelOffset;\nout float vColorMode;\nout vec4 vColor;\nout vec2 vTextureCoords;\nout vec2 uv;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = angle * PI / 180.0;\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvec2 iconSize = instanceIconFrames.zw;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),\nicon.sizeMinPixels, icon.sizeMaxPixels\n);\nfloat iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;\nfloat instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;\nvec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\npixelOffset += instancePixelOffset;\npixelOffset.y *= -1.0;\nif (icon.billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvTextureCoords = mix(\ninstanceIconFrames.xy,\ninstanceIconFrames.xy + iconSize,\n(positions.xy + 1.0) / 2.0\n) / icon.iconsTextureDim;\nvColor = instanceColors;\nDECKGL_FILTER_COLOR(vColor, geometry);\nvColorMode = instanceColorModes;\n}\n",fs:"#version 300 es\n#define SHADER_NAME icon-layer-fragment-shader\nprecision highp float;\nuniform sampler2D iconsTexture;\nin float vColorMode;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec4 texColor = texture(iconsTexture, vTextureCoords);\nvec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\nfloat a = texColor.a * layer.opacity * vColor.a;\nif (a < icon.alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color, a);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[$w,Cx,iR]})}initializeState(){this.state={iconManager:new uR(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:hR},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var t;super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:h}=this.state;if("string"==typeof o)return;const d=o||this.internalState.isAsyncPropLoading("iconAtlas");h.setProps({loadOptions:n.loadOptions,autoPacking:!d,iconAtlas:o,iconMapping:d?a:null,textureParameters:u}),d?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&h.packIcons(l,c),r.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeBasis:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();if(c){const e=this.state.model,l={iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:Iw[s],sizeScale:t,sizeBasis:"height"===n?1:0,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a};e.shaderInputs.setProps({icon:l}),e.draw(this.context.renderPass)}}_getModel(){return new zA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jA({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([-1,-1,1,-1,-1,1,1,1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var t;const n=null==(t=this.getCurrentLayer())?void 0:t.props.onIconError;n?n(e):Op.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:i=t/2,anchorY:r=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,n/2-r]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:i,height:r}=this.state.iconManager.getIconMapping(e);return[t,n,i,r]}}fR.defaultProps=dR,fR.layerName="IconLayer";const pR="uniform pointCloudUniforms {\n  float radiusPixels;\n  highp int sizeUnits;\n} pointCloud;\n",gR={name:"pointCloud",source:"struct PointCloudUniforms {\n  radiusPixels: f32,\n  sizeUnits: i32,\n};\n\n@group(0) @binding(3)\nvar<uniform> pointCloud: PointCloudUniforms;\n",vs:pR,fs:pR,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},mR=[0,0,0,255],yR=[0,0,1],vR={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:yR},getColor:{type:"accessor",value:mR},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};class _R extends Ck{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME point-cloud-layer-vertex-shader\nin vec3 positions;\nin vec3 instanceNormals;\nin vec4 instanceColors;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec3 instancePickingColors;\nout vec4 vColor;\nout vec2 unitPosition;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.normal = project_normal(instanceNormals);\nunitPosition = positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\nvec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\nvec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, instanceColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME point-cloud-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 unitPosition;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition.xy;\nfloat distToCenter = length(unitPosition);\nif (distToCenter > 1.0) {\ndiscard;\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",source:"struct ConstantAttributes {\n  instanceNormals: vec3<f32>,\n  instanceColors: vec4<f32>,\n  instancePositions: vec3<f32>,\n  instancePositions64Low: vec3<f32>,\n  instancePickingColors: vec3<f32>\n};\n\nconst constants = ConstantAttributes(\n  vec3<f32>(1.0, 0.0, 0.0),\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec3<f32>(0.0),\n  vec3<f32>(0.0),\n  vec3<f32>(0.0)\n);\n\nstruct Attributes {\n  @builtin(instance_index) instanceIndex : u32,\n  @builtin(vertex_index) vertexIndex : u32,\n  @location(0) positions: vec3<f32>,\n  @location(1) instancePositions: vec3<f32>,\n  @location(2) instancePositions64Low: vec3<f32>,\n  @location(3) instanceNormals: vec3<f32>,\n  @location(4) instanceColors: vec4<f32>,\n  @location(5) instancePickingColors: vec3<f32>\n};\n\nstruct Varyings {\n  @builtin(position) position: vec4<f32>,\n  @location(0) vColor: vec4<f32>,\n  @location(1) unitPosition: vec2<f32>,\n};\n\n@vertex\nfn vertexMain(attributes: Attributes) -> Varyings {\n  var varyings: Varyings;\n  \n  // var geometry: Geometry;\n  // geometry.worldPosition = instancePositions;\n  // geometry.normal = project_normal(instanceNormals);\n\n  // position on the containing square in [-1, 1] space\n  varyings.unitPosition = attributes.positions.xy;\n  geometry.uv = varyings.unitPosition;\n  geometry.pickingColor = attributes.instancePickingColors;\n\n  // Find the center of the point and add the current vertex\n  let offset = vec3<f32>(attributes.positions.xy * project_unit_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);\n  // DECKGL_FILTER_SIZE(offset, geometry);\n\n  varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);\n  // DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  let clipPixels = project_pixel_size_to_clipspace(offset.xy);\n  varyings.position.x += clipPixels.x;\n  varyings.position.y += clipPixels.y;\n\n  // Apply lighting\n  let lightColor = lighting_getLightColor2(attributes.instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\n\n  // Apply opacity to instance color, or return instance picking color\n  varyings.vColor = vec4(lightColor, attributes.instanceColors.a * color.opacity);\n  // DECKGL_FILTER_COLOR(vColor, geometry);\n\n  return varyings;\n}\n\n@fragment\nfn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {\n  // var geometry: Geometry;\n  // geometry.uv = unitPosition.xy;\n\n  let distToCenter = length(varyings.unitPosition);\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  var fragColor: vec4<f32>;\n\n  fragColor = varyings.vColor;\n  // DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  // Apply premultiplied alpha as required by transparent canvas\n  fragColor = deckgl_premultiplied_alpha(fragColor);\n\n  return fragColor;\n}\n",modules:[$w,xE,yE,Cx,gR]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:yR},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:mR}})}updateState(e){var t;const{changeFlags:n,props:i}=e;super.updateState(e),n.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),n.dataChanged&&function(e){const{header:t,attributes:n}=e;if(t&&n&&(e.length=t.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0)){const{size:e,value:t}=n.COLOR_0;n.instanceColors={size:e,type:"unorm8",value:t}}}(i.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:n}=this.props,i=this.state.model,r={sizeUnits:Iw[n],radiusPixels:t};i.shaderInputs.setProps({pointCloud:r}),"webgpu"===this.context.device.type&&(i.instanceCount=this.props.data.length),i.draw(this.context.renderPass)}_getModel(){const e="webgpu"===this.context.device.type?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[];for(let n=0;n<3;n++){const e=n/3*Math.PI*2;t.push(2*Math.cos(e),2*Math.sin(e),0)}return new zA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jA({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),parameters:e,isInstanced:!0})}}_R.layerName="PointCloudLayer",_R.defaultProps=vR;const bR="uniform scatterplotUniforms {\n  float radiusScale;\n  float radiusMinPixels;\n  float radiusMaxPixels;\n  float lineWidthScale;\n  float lineWidthMinPixels;\n  float lineWidthMaxPixels;\n  float stroked;\n  float filled;\n  bool antialiasing;\n  bool billboard;\n  highp int radiusUnits;\n  highp int lineWidthUnits;\n} scatterplot;\n",ER={name:"scatterplot",vs:bR,fs:bR,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},wR=[0,0,0,255],xR={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:wR},getLineColor:{type:"accessor",value:wR},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class AR extends Ck{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),\nscatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),\nscatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n);\nouterRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\nfloat edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;\nif (scatterplot.billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = scatterplot.antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (scatterplot.stroked > 0.5) {\nfloat isLine = scatterplot.antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (scatterplot.filled > 0.5) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (scatterplot.filled < 0.5) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",source:"// Main shaders\n\nstruct ScatterplotUniforms {\n  radiusScale: f32,\n  radiusMinPixels: f32,\n  radiusMaxPixels: f32,\n  lineWidthScale: f32,\n  lineWidthMinPixels: f32,\n  lineWidthMaxPixels: f32,\n  stroked: f32,\n  filled: i32,\n  antialiasing: i32,\n  billboard: i32,\n  radiusUnits: i32,\n  lineWidthUnits: i32,\n};\n\nstruct ConstantAttributeUniforms {\n instancePositions: vec3<f32>,\n instancePositions64Low: vec3<f32>,\n instanceRadius: f32,\n instanceLineWidths: f32,\n instanceFillColors: vec4<f32>,\n instanceLineColors: vec4<f32>,\n instancePickingColors: vec3<f32>,\n\n instancePositionsConstant: i32,\n instancePositions64LowConstant: i32,\n instanceRadiusConstant: i32,\n instanceLineWidthsConstant: i32,\n instanceFillColorsConstant: i32,\n instanceLineColorsConstant: i32,\n instancePickingColorsConstant: i32\n};\n\n@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;\n\nstruct ConstantAttributes {\n  instancePositions: vec3<f32>,\n  instancePositions64Low: vec3<f32>,\n  instanceRadius: f32,\n  instanceLineWidths: f32,\n  instanceFillColors: vec4<f32>,\n  instanceLineColors: vec4<f32>,\n  instancePickingColors: vec3<f32>\n};\n\nconst constants = ConstantAttributes(\n  vec3<f32>(0.0),\n  vec3<f32>(0.0),\n  0.0,\n  0.0,\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec3<f32>(0.0)\n);\n\nstruct Attributes {\n  @builtin(instance_index) instanceIndex : u32,\n  @builtin(vertex_index) vertexIndex : u32,\n  @location(0) positions: vec3<f32>,\n  @location(1) instancePositions: vec3<f32>,\n  @location(2) instancePositions64Low: vec3<f32>,\n  @location(3) instanceRadius: f32,\n  @location(4) instanceLineWidths: f32,\n  @location(5) instanceFillColors: vec4<f32>,\n  @location(6) instanceLineColors: vec4<f32>,\n  @location(7) instancePickingColors: vec3<f32>\n};\n\nstruct Varyings {\n  @builtin(position) position: vec4<f32>,\n  @location(0) vFillColor: vec4<f32>,\n  @location(1) vLineColor: vec4<f32>,\n  @location(2) unitPosition: vec2<f32>,\n  @location(3) innerUnitRadius: f32,\n  @location(4) outerRadiusPixels: f32,\n};\n\n@vertex\nfn vertexMain(attributes: Attributes) -> Varyings {\n  var varyings: Varyings;\n\n  // Draw an inline geometry constant array clip space triangle to verify that rendering works.\n  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));\n  // if (attributes.instanceIndex == 0) {\n  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);\n  //   return varyings;\n  // }\n\n  // var geometry: Geometry;\n  // geometry.worldPosition = instancePositions;\n\n  // Multiply out radius and clamp to limits\n  varyings.outerRadiusPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),\n    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n  );\n\n  // Multiply out line width and clamp to limits\n  let lineWidthPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),\n    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\n  // Expand geometry to accommodate edge smoothing\n  let edgePadding = select(\n    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,\n    1.0,\n    scatterplot.antialiasing != 0\n  );\n\n  // position on the containing square in [-1, 1] space\n  varyings.unitPosition = edgePadding * attributes.positions.xy;\n  geometry.uv = varyings.unitPosition;\n  geometry.pickingColor = attributes.instancePickingColors;\n\n  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;\n\n  if (scatterplot.billboard != 0) {\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    let clipPixels = project_pixel_size_to_clipspace(offset.xy);\n    varyings.position.x = clipPixels.x;\n    varyings.position.y = clipPixels.y;\n  } else {\n    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n  }\n\n  // Apply opacity to instance color, or return instance picking color\n  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);\n  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);\n\n  return varyings;\n}\n\n@fragment\nfn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {\n  // var geometry: Geometry;\n  // geometry.uv = unitPosition;\n\n  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;\n  let inCircle = select(\n    smoothedge(distToCenter, varyings.outerRadiusPixels),\n    step(distToCenter, varyings.outerRadiusPixels),\n    scatterplot.antialiasing != 0\n  );\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  var fragColor: vec4<f32>;\n\n  if (scatterplot.stroked != 0) {\n    let isLine = select(\n      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      scatterplot.antialiasing != 0\n    );\n\n    if (scatterplot.filled != 0) {\n      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);\n    }\n  } else if (scatterplot.filled == 0) {\n    discard;\n  } else {\n    fragColor = varyings.vFillColor;\n  }\n\n  fragColor.a *= inCircle;\n  // DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  // Apply premultiplied alpha as required by transparent canvas\n  fragColor = deckgl_premultiplied_alpha(fragColor);\n\n  return fragColor;\n  // return vec4<f32>(0, 0, 1, 1);\n}\n",modules:[$w,xE,Cx,ER]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,stroked:s,filled:o,billboard:a,antialiasing:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,f={stroked:s,filled:o,billboard:a,antialiasing:l,radiusUnits:Iw[t],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,lineWidthUnits:Iw[c],lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d},p=this.state.model;p.shaderInputs.setProps({scatterplot:f}),"webgpu"===this.context.device.type&&(p.instanceCount=this.props.data.length),p.draw(this.context.renderPass)}_getModel(){const e="webgpu"===this.context.device.type?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0;return new zA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jA({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0,parameters:e})}}AR.defaultProps=xR,AR.layerName="ScatterplotLayer";const SR=1,TR=-1;function CR(e,t,n={}){const i=function(e,t={}){return Math.sign(function(e,t={}){const{start:n=0,end:i=e.length,plane:r="xy"}=t,s=t.size||2;let o=0;const a=IR[r[0]],l=IR[r[1]];for(let c=n,u=i-s;c<i;c+=s)o+=(e[c+a]-e[u+a])*(e[c+l]+e[u+l]),u=c;return o/2}(e,t))}(e,n);return i!==t&&(function(e,t){const{start:n=0,end:i=e.length,size:r=2}=t,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const t=n+a*r,i=n+(s-1-a)*r;for(let n=0;n<r;++n){const r=e[t+n];e[t+n]=e[i+n],e[i+n]=r}}}(e,n),!0)}const IR={x:0,y:1,z:2};function kR(e,t){const n=t.length,i=e.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(e[i-n+s]!==t[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)e[i+r]=t[r];return!0}function RR(e,t){const n=t.length;for(let i=0;i<n;i++)e[i]=t[i]}function PR(e,t,n,i,r=[]){const s=i+t*n;for(let o=0;o<n;o++)r[o]=e[s+o];return r}function MR(e,t,n,i,r=[]){let s,o;if(8&n)s=(i[3]-e[1])/(t[1]-e[1]),o=3;else if(4&n)s=(i[1]-e[1])/(t[1]-e[1]),o=1;else if(2&n)s=(i[2]-e[0])/(t[0]-e[0]),o=2;else{if(!(1&n))return null;s=(i[0]-e[0])/(t[0]-e[0]),o=0}for(let a=0;a<e.length;a++)r[a]=(1&o)===a?i[o]:s*(t[a]-e[a])+e[a];return r}function LR(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function BR(e,t){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=e.length}=t||{},l=(a-o)/n;let c=[];const u=[c],h=PR(e,0,n,o);let d,f;const p=DR(h,r,s,[]),g=[];kR(c,h);for(let m=1;m<l;m++){for(d=PR(e,m,n,o,d),f=LR(d,p);f;){MR(h,d,f,p,g);const e=LR(g,p);e&&(MR(h,g,e,p,g),f=e),kR(c,g),RR(h,g),FR(p,r,f),i&&c.length>n&&(c=[],u.push(c),kR(c,h)),f=LR(d,p)}kR(c,d),RR(h,d)}return i?u:u[0]}function NR(e,t=null,n){if(!e.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:e,types:o?new Array(e.length/i).fill(1):null,holes:t||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:e,types:t,holes:n}=l.shift();UR(e,i,n[0]||e.length,c),u=DR(c[0],r,s,u);const h=LR(c[1],u);if(h){let r=OR(e,t,i,0,n[0]||e.length,u,h);const s={pos:r[0].pos,types:r[0].types,holes:[]},a={pos:r[1].pos,types:r[1].types,holes:[]};l.push(s,a);for(let l=0;l<n.length;l++)r=OR(e,t,i,n[l],n[l+1]||e.length,u,h),r[0]&&(s.holes.push(s.pos.length),s.pos=zR(s.pos,r[0].pos),o&&(s.types=zR(s.types,r[0].types))),r[1]&&(a.holes.push(a.pos.length),a.pos=zR(a.pos,r[1].pos),o&&(a.types=zR(a.types,r[1].types)))}else{const i={positions:e};o&&(i.edgeTypes=t),n.length&&(i.holeIndices=n),a.push(i)}}return a}function OR(e,t,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],h=[],d=[];let f,p,g;const m=PR(e,a-1,n,i);let y=Math.sign(8&o?m[1]-s[3]:m[0]-s[2]),v=t&&t[a-1],_=0,b=0;for(let E=0;E<a;E++)f=PR(e,E,n,i,f),p=Math.sign(8&o?f[1]-s[3]:f[0]-s[2]),g=t&&t[i/n+E],p&&y&&y!==p&&(MR(m,f,o,s,d),kR(l,d)&&u.push(v),kR(c,d)&&h.push(v)),p<=0?(kR(l,f)&&u.push(g),_-=p):u.length&&(u[u.length-1]=0),p>=0?(kR(c,f)&&h.push(g),b+=p):h.length&&(h[h.length-1]=0),RR(m,f),y=p,v=g;return[_?{pos:l,types:t&&u}:null,b?{pos:c,types:t&&h}:null]}function DR(e,t,n,i){const r=Math.floor((e[0]-n[0])/t)*t+n[0],s=Math.floor((e[1]-n[1])/t)*t+n[1];return i[0]=r,i[1]=s,i[2]=r+t,i[3]=s+t,i}function FR(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function UR(e,t,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=t){const t=e[l],n=e[l+1];r=t<r?t:r,s=t>s?t:s,o=n<o?n:o,a=n>a?n:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}function zR(e,t){for(let n=0;n<t.length;n++)e.push(t[n]);return e}function GR(e,t,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=t){const t=Math.abs(e[o]);t>r&&(r=t,s=o-1)}return s}function VR(e,t,n,i,r=85.051129){const s=e[n],o=e[i-t];if(Math.abs(s-o)>180){const i=PR(e,0,t,n);i[0]+=360*Math.round((o-s)/360),kR(e,i),i[1]=Math.sign(i[1])*r,kR(e,i),i[0]=s,kR(e,i)}}function HR(e,t,n,i){let r,s=e[0];for(let o=n;o<i;o+=t){r=e[o];const t=r-s;(t>180||t<-180)&&(r-=360*Math.round(t/360)),e[o]=s=r}}function jR(e,t){let n;const i=e.length/t;for(let s=0;s<i&&(n=e[s*t],(n+180)%360==0);s++);const r=360*-Math.round(n/360);if(0!==r)for(let s=0;s<i;s++)e[s*t]+=r}function WR(e,t,n,i){let r;if(Array.isArray(e[0])){const n=e.length*t;r=new Array(n);for(let i=0;i<e.length;i++)for(let n=0;n<t;n++)r[i*t+n]=e[i][n]||0}else r=e;return n?BR(r,{size:t,gridResolution:n}):i?function(e,t){const{size:n=2,startIndex:i=0,endIndex:r=e.length,normalize:s=!0}=t||{},o=e.slice(i,r);HR(o,n,0,r-i);const a=BR(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)jR(l,n);return a}(r,{size:t}):r}class $R extends Ok{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?WR(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(XR(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&XR(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const n=this.attributes.segmentTypes,i=!!e&&this.isClosed(e),{vertexStart:r,geometrySize:s}=t;n.fill(0,r,r+s),i?(n[r]=4,n[r+s-2]=4):(n[r]+=1,n[r+s-2]+=2),n[r+s-1]=4}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:r}=t,s=new Array(3);for(let o=i,a=0;a<r;o++,a++)this.getPointOnPath(e,a,s),n[3*o]=s[0],n[3*o+1]=s[1],n[3*o+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const r=t*i;return n[0]=e[r],n[1]=e[r+1],n[2]=3===i&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}function XR(e){return Array.isArray(e[0])}const qR="uniform pathUniforms {\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  float jointType;\n  float capType;\n  float miterLimit;\n  bool billboard;\n  highp int widthUnits;\n} path;\n",KR={name:"path",vs:qR,fs:qR,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},YR=[0,0,0,255],JR={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:YR},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ZR={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class QR extends Ck{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME path-layer-vertex-shader\nin vec2 positions;\nin float instanceTypes;\nin vec3 instanceStartPositions;\nin vec3 instanceEndPositions;\nin vec3 instanceLeftPositions;\nin vec3 instanceRightPositions;\nin vec3 instanceLeftPositions64Low;\nin vec3 instanceStartPositions64Low;\nin vec3 instanceEndPositions64Low;\nin vec3 instanceRightPositions64Low;\nin float instanceStrokeWidths;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nuniform float opacity;\nout vec4 vColor;\nout vec2 vCornerOffset;\nout float vMiterLength;\nout vec2 vPathPosition;\nout float vPathLength;\nout float vJointType;\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\nfloat flipIfTrue(bool flag) {\nreturn -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\nvec3 prevPoint, vec3 currPoint, vec3 nextPoint,\nvec2 width\n) {\nbool isEnd = positions.x > 0.0;\nfloat sideOfPath = positions.y;\nfloat isJoint = float(sideOfPath == 0.0);\nvec3 deltaA3 = (currPoint - prevPoint);\nvec3 deltaB3 = (nextPoint - currPoint);\nmat3 rotationMatrix;\nbool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);\nif (needsRotation) {\ndeltaA3 = deltaA3 * rotationMatrix;\ndeltaB3 = deltaB3 * rotationMatrix;\n}\nvec2 deltaA = deltaA3.xy / width;\nvec2 deltaB = deltaB3.xy / width;\nfloat lenA = length(deltaA);\nfloat lenB = length(deltaB);\nvec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\nvec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\nvec2 perpA = vec2(-dirA.y, dirA.x);\nvec2 perpB = vec2(-dirB.y, dirB.x);\nvec2 tangent = dirA + dirB;\ntangent = length(tangent) > 0. ? normalize(tangent) : perpA;\nvec2 miterVec = vec2(-tangent.y, tangent.x);\nvec2 dir = isEnd ? dirA : dirB;\nvec2 perp = isEnd ? perpA : perpB;\nfloat L = isEnd ? lenA : lenB;\nfloat sinHalfA = abs(dot(miterVec, perp));\nfloat cosHalfA = abs(dot(dirA, miterVec));\nfloat turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\nfloat cornerPosition = sideOfPath * turnDirection;\nfloat miterSize = 1.0 / max(sinHalfA, EPSILON);\nmiterSize = mix(\nmin(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\nmiterSize,\nstep(0.0, cornerPosition)\n);\nvec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n* (sideOfPath + isJoint * turnDirection);\nbool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\nbool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\nbool isCap = isStartCap || isEndCap;\nif (isCap) {\noffsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);\nvJointType = path.capType;\n} else {\nvJointType = path.jointType;\n}\nvPathLength = L;\nvCornerOffset = offsetVec;\nvMiterLength = dot(vCornerOffset, miterVec * turnDirection);\nvMiterLength = isCap ? isJoint : vMiterLength;\nvec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\nvPathPosition = vec2(\ndot(offsetFromStartOfPath, perp),\ndot(offsetFromStartOfPath, dir)\n);\ngeometry.uv = vPathPosition;\nfloat isValid = step(instanceTypes, 3.5);\nvec3 offset = vec3(offsetVec * width * isValid, 0.0);\nif (needsRotation) {\noffset = rotationMatrix * offset;\n}\nreturn offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\nif (position.w < EPSILON) {\nfloat r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\nposition = refPosition + (position - refPosition) * r;\n}\n}\nvoid main() {\ngeometry.pickingColor = instancePickingColors;\nvColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);\nfloat isEnd = positions.x;\nvec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\nvec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\nvec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\nvec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\nvec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\nvec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\ngeometry.worldPosition = currPosition;\nvec2 widthPixels = vec2(clamp(\nproject_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),\npath.widthMinPixels, path.widthMaxPixels) / 2.0);\nvec3 width;\nif (path.billboard) {\nvec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\nvec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\nvec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\nclipLine(prevPositionScreen, currPositionScreen);\nclipLine(nextPositionScreen, currPositionScreen);\nclipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\nwidth = vec3(widthPixels, 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(\nprevPositionScreen.xyz / prevPositionScreen.w,\ncurrPositionScreen.xyz / currPositionScreen.w,\nnextPositionScreen.xyz / nextPositionScreen.w,\nproject_pixel_size_to_clipspace(width.xy)\n);\nDECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\ngl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n} else {\nprevPosition = project_position(prevPosition, prevPosition64Low);\ncurrPosition = project_position(currPosition, currPosition64Low);\nnextPosition = project_position(nextPosition, nextPosition64Low);\nwidth = vec3(project_pixel_size(widthPixels), 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\ngeometry.position = vec4(currPosition + offset, 1.0);\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME path-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 vCornerOffset;\nin float vMiterLength;\nin vec2 vPathPosition;\nin float vPathLength;\nin float vJointType;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vPathPosition;\nif (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\nif (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\ndiscard;\n}\nif (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {\ndiscard;\n}\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[$w,Cx,KR]})}get wrapLongitude(){return!1}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["vertexPositions"])}initializeState(){const e=!0;this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:ZR,accessor:"getPath",update:this.calculatePositions,noAlloc:e,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:e},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ZR,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:ZR,defaultValue:YR},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}}),this.setState({pathTesselator:new $R({fp64:this.use64bitPositions()})})}updateState(e){var t;super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,t=n.data.attributes||{};e.updateGeometry({data:n.data,geometryBuffer:t.getPath,buffers:t,normalize:!n._pathType,loop:"loop"===n._pathType,getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),i.dataChanged||r.invalidateAll()}i.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:n,billboard:i,miterLimit:r,widthUnits:s,widthScale:o,widthMinPixels:a,widthMaxPixels:l}=this.props,c=this.state.model,u={jointType:Number(t),capType:Number(n),billboard:i,widthUnits:Iw[s],widthScale:o,miterLimit:r,widthMinPixels:a,widthMaxPixels:l};c.shaderInputs.setProps({path:u}),c.draw(this.context.renderPass)}_getModel(){return new zA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jA({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}QR.defaultProps=JR,QR.layerName="PathLayer";var eP,tP={exports:{}};var nP=function(){if(eP)return tP.exports;function e(e,n,r){r=r||2;var s,o,a,u,h,f,p,g=n&&n.length,m=g?n[0]*r:e.length,y=t(e,0,m,r,!0),v=[];if(!y||y.next===y.prev)return v;if(g&&(y=function(e,n,i,r){var s,o,a,u=[];for(s=0,o=n.length;s<o;s++)(a=t(e,n[s]*r,s<o-1?n[s+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),u.push(d(a));for(u.sort(l),s=0;s<u.length;s++)i=c(u[s],i);return i}(e,n,y,r)),e.length>80*r){s=a=e[0],o=u=e[1];for(var _=r;_<m;_+=r)(h=e[_])<s&&(s=h),(f=e[_+1])<o&&(o=f),h>a&&(a=h),f>u&&(u=f);p=0!==(p=Math.max(a-s,u-o))?32767/p:0}return i(y,v,r,s,o,p,0),v}function t(e,t,n,i,r){var s,o;if(r===S(e,t,n,i)>0)for(s=t;s<n;s+=i)o=w(s,e[s],e[s+1],o);else for(s=n-i;s>=t;s-=i)o=w(s,e[s],e[s+1],o);return o&&m(o,o.next)&&(x(o),o=o.next),o}function n(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!m(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(x(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function i(e,t,l,c,u,d,f){if(e){!f&&d&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=h(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,s,o,a,l,c=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1)}(r)}(e,c,u,d);for(var p,g,m=e;e.prev!==e.next;)if(p=e.prev,g=e.next,d?s(e,c,u,d):r(e))t.push(p.i/l|0),t.push(e.i/l|0),t.push(g.i/l|0),x(e),e=g.next,m=g.next;else if((e=g)===m){f?1===f?i(e=o(n(e),t,l),t,l,c,u,d,2):2===f&&a(e,t,l,c,u,d):i(n(e),t,l,c,u,d,1);break}}}function r(e){var t=e.prev,n=e,i=e.next;if(g(t,n,i)>=0)return!1;for(var r=t.x,s=n.x,o=i.x,a=t.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,p=a>l?a>c?a:c:l>c?l:c,m=i.next;m!==t;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=p&&f(r,a,s,l,o,c,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function s(e,t,n,i){var r=e.prev,s=e,o=e.next;if(g(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,c=o.x,u=r.y,d=s.y,p=o.y,m=a<l?a<c?a:c:l<c?l:c,y=u<d?u<p?u:p:d<p?d:p,v=a>l?a>c?a:c:l>c?l:c,_=u>d?u>p?u:p:d>p?d:p,b=h(m,y,t,n,i),E=h(v,_,t,n,i),w=e.prevZ,x=e.nextZ;w&&w.z>=b&&x&&x.z<=E;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=_&&w!==r&&w!==o&&f(a,u,l,d,c,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,x.x>=m&&x.x<=v&&x.y>=y&&x.y<=_&&x!==r&&x!==o&&f(a,u,l,d,c,p,x.x,x.y)&&g(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;w&&w.z>=b;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=_&&w!==r&&w!==o&&f(a,u,l,d,c,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;x&&x.z<=E;){if(x.x>=m&&x.x<=v&&x.y>=y&&x.y<=_&&x!==r&&x!==o&&f(a,u,l,d,c,p,x.x,x.y)&&g(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function o(e,t,i){var r=e;do{var s=r.prev,o=r.next.next;!m(s,o)&&y(s,r,r.next,o)&&b(s,o)&&b(o,s)&&(t.push(s.i/i|0),t.push(r.i/i|0),t.push(o.i/i|0),x(r),x(r.next),r=e=o),r=r.next}while(r!==e);return n(r)}function a(e,t,r,s,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&p(l,c)){var u=E(l,c);return l=n(l,l.next),u=n(u,u.next),i(l,t,r,s,o,a,0),void i(u,t,r,s,o,a,0)}c=c.next}l=l.next}while(l!==e)}function l(e,t){return e.x-t.x}function c(e,t){var i=function(e,t){var n,i=t,r=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o&&(o=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==t);if(!n)return null;var l,c=n,h=n.x,d=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=h&&r!==i.x&&f(s<d?r:o,s,h,d,s<d?o:r,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(r-i.x),b(i,e)&&(l<p||l===p&&(i.x>n.x||i.x===n.x&&u(n,i)))&&(n=i,p=l)),i=i.next}while(i!==c);return n}(e,t);if(!i)return t;var r=E(i,e);return n(r,r.next),n(i,i.next)}function u(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function h(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function d(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function f(e,t,n,i,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(i-a)>=(n-o)*(t-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||m(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,i){var r=_(g(e,t,n)),s=_(g(e,t,i)),o=_(g(n,i,e)),a=_(g(n,i,t));return r!==s&&o!==a||(!(0!==r||!v(e,n,t))||(!(0!==s||!v(e,i,t))||(!(0!==o||!v(n,e,i))||!(0!==a||!v(n,t,i)))))}function v(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function _(e){return e>0?1:e<0?-1:0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function E(e,t){var n=new A(e.i,e.x,e.y),i=new A(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function w(e,t,n,i){var r=new A(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function x(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(e,t,n,i){for(var r=0,s=t,o=n-i;s<n;s+=i)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}return eP=1,tP.exports=e,tP.exports.default=e,e.deviation=function(e,t,n,i){var r=t&&t.length,s=r?t[0]*n:e.length,o=Math.abs(S(e,0,s,n));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;o-=Math.abs(S(e,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,f=i[a+1]*n,p=i[a+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)n.vertices.push(e[r][s][o]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n},tP.exports}();const iP=he(nP),rP=SR,sP=TR,oP={};function aP(e){return"positions"in e?e.positions:e}function lP(e){return"holeIndices"in e?e.holeIndices:null}function cP(e,t,n,i,r){let s=t;const o=n.length;for(let a=0;a<o;a++)for(let t=0;t<i;t++)e[s++]=n[a][t]||0;if(!function(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(let a=0;a<i;a++)e[s++]=n[0][a]||0;return oP.start=t,oP.end=s,oP.size=i,CR(e,r,oP),s}function uP(e,t,n,i,r=0,s,o){const a=(s=s||n.length)-r;if(a<=0)return t;let l=t;for(let c=0;c<a;c++)e[l++]=n[r+c];if(!function(e,t,n,i){for(let r=0;r<t;r++)if(e[n+r]!==e[i-t+r])return!1;return!0}(n,i,r,s))for(let c=0;c<i;c++)e[l++]=n[r+c];return oP.start=t,oP.end=l,oP.size=i,CR(e,o,oP),l}function hP(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const n=[],i=[];if("positions"in e){const{positions:r,holeIndices:s}=e;if(s){let e=0;for(let o=0;o<=s.length;o++)e=uP(n,e,r,t,s[o-1],s[o],0===o?rP:sP),i.push(e);return i.pop(),{positions:n,holeIndices:i}}e=r}if(!function(e){return Array.isArray(e[0])}(e))return uP(n,0,e,t,0,n.length,rP),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let r=0;for(const[s,o]of e.entries())r=cP(n,r,o,t,0===s?rP:sP),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return cP(n,0,e,t,rP),n}function dP(e,t,n){const i=e.length/3;let r=0;for(let s=0;s<i;s++){const o=(s+1)%i;r+=e[3*s+t]*e[3*o+n],r-=e[3*o+t]*e[3*s+n]}return Math.abs(r/2)}function fP(e,t,n,i){const r=e.length/3;for(let s=0;s<r;s++){const r=3*s,o=e[r+0],a=e[r+1],l=e[r+2];e[r+t]=o,e[r+n]=a,e[r+i]=l}}class pP extends Ok{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=hP(e,this.positionSize);return this.opts.resolution?NR(aP(t),lP(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(e,t=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};t=t||[];const o=[],a=[];let l=0,c=0;for(let h=0;h<=t.length;h++){const r=t[h]||e.length,s=c,u=GR(e,i,l,r);for(let t=u;t<r;t++)o[c++]=e[t];for(let t=l;t<u;t++)o[c++]=e[t];HR(o,i,s,c),VR(o,i,s,c,null==n?void 0:n.maxLatitude),l=r,a[h]=c}a.pop();const u=NR(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const h of u)jR(h.positions,i);return u}(aP(t),lP(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(gP(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return aP(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&gP(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const n=e;this._updateIndices(n,t),this._updatePositions(n,t),this._updateVertexValid(n,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:r,indexStarts:s,typedArrayManager:o}=this;let a=r.indices;if(!a||!e)return;let l=i;const c=function(e,t,n,i){let r=lP(e);r&&(r=r.map(e=>e/t));let s=aP(e);const o=i&&3===t;if(n){const e=s.length;s=s.slice();const i=[];for(let r=0;r<e;r+=t){i[0]=s[r],i[1]=s[r+1],o&&(i[2]=s[r+2]);const e=n(i);s[r]=e[0],s[r+1]=e[1],o&&(s[r+2]=e[2])}}if(o){const e=dP(s,0,1),t=dP(s,0,2),i=dP(s,1,2);if(!e&&!t&&!i)return[];e>t&&e>i||(t>i?(n||(s=s.slice()),fP(s,0,2,1)):(n||(s=s.slice()),fP(s,2,0,1)))}return iP(s,r,t)}(e,this.positionSize,this.opts.preproject,this.opts.full3d);a=o.allocate(a,i+c.length,{copy:!0});for(let u=0;u<c.length;u++)a[l++]=c[u]+n;s[t+1]=i+c.length,r.indices=a}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i},positionSize:r}=this;if(!i||!e)return;const s=aP(e);for(let o=t,a=0;a<n;o++,a++){const e=s[a*r],t=s[a*r+1],n=r>2?s[a*r+2]:0;i[3*o]=e,i[3*o+1]=t,i[3*o+2]=n}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{positionSize:i}=this,r=this.attributes.vertexValid,s=e&&lP(e);if(e&&e.edgeTypes?r.set(e.edgeTypes,t):r.fill(1,t,t+n),s)for(let o=0;o<s.length;o++)r[t+s[o]/i-1]=0;r[t+n-1]=0}}function gP(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const mP="uniform solidPolygonUniforms {\n  bool extruded;\n  bool isWireframe;\n  float elevationScale;\n} solidPolygon;\n",yP={name:"solidPolygon",vs:mP,fs:mP,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},vP="in vec4 fillColors;\nin vec4 lineColors;\nin vec3 pickingColors;\nout vec4 vColor;\nstruct PolygonProps {\nvec3 positions;\nvec3 positions64Low;\nvec3 normal;\nfloat elevations;\n};\nvec3 project_offset_normal(vec3 vector) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\nreturn normalize(vector * project.commonUnitsPerWorldUnit);\n}\nreturn project_normal(vector);\n}\nvoid calculatePosition(PolygonProps props) {\nvec3 pos = props.positions;\nvec3 pos64Low = props.positions64Low;\nvec3 normal = props.normal;\nvec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;\ngeometry.worldPosition = props.positions;\ngeometry.pickingColor = pickingColors;\nif (solidPolygon.extruded) {\npos.z += props.elevations * solidPolygon.elevationScale;\n}\ngl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (solidPolygon.extruded) {\n#ifdef IS_SIDE_VERTEX\nnormal = project_offset_normal(normal);\n#else\nnormal = project_normal(normal);\n#endif\ngeometry.normal = normal;\nvec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, colors.a * layer.opacity);\n} else {\nvColor = vec4(colors.rgb, colors.a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",_P=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader\nin vec3 vertexPositions;\nin vec3 vertexPositions64Low;\nin float elevations;\n${vP}\nvoid main(void) {\nPolygonProps props;\nprops.positions = vertexPositions;\nprops.positions64Low = vertexPositions64Low;\nprops.elevations = elevations;\nprops.normal = vec3(0.0, 0.0, 1.0);\ncalculatePosition(props);\n}\n`,bP=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\nin vec2 positions;\nin vec3 vertexPositions;\nin vec3 nextVertexPositions;\nin vec3 vertexPositions64Low;\nin vec3 nextVertexPositions64Low;\nin float elevations;\nin float instanceVertexValid;\n${vP}\nvoid main(void) {\nif(instanceVertexValid < 0.5){\ngl_Position = vec4(0.);\nreturn;\n}\nPolygonProps props;\nvec3 pos;\nvec3 pos64Low;\nvec3 nextPos;\nvec3 nextPos64Low;\n#if RING_WINDING_ORDER_CW == 1\npos = vertexPositions;\npos64Low = vertexPositions64Low;\nnextPos = nextVertexPositions;\nnextPos64Low = nextVertexPositions64Low;\n#else\npos = nextVertexPositions;\npos64Low = nextVertexPositions64Low;\nnextPos = vertexPositions;\nnextPos64Low = vertexPositions64Low;\n#endif\nprops.positions = mix(pos, nextPos, positions.x);\nprops.positions64Low = mix(pos64Low, nextPos64Low, positions.x);\nprops.normal = vec3(\npos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),\nnextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),\n0.0);\nprops.elevations = elevations * positions.y;\ncalculatePosition(props);\n}\n`,EP=[0,0,0,255],wP={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:EP},getLineColor:{type:"accessor",value:EP},material:!0},xP={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class AP extends Ck{getShaders(e){return super.getShaders({vs:"top"===e?_P:bP,fs:"#version 300 es\n#define SHADER_NAME solid-polygon-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[$w,yE,Cx,yP]})}get wrapLongitude(){return!1}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:n}=this.props;let i;e.isGeospatial&&t===Tw.DEFAULT&&(t=Tw.LNGLAT),t===Tw.LNGLAT&&(i=n?e.projectPosition.bind(e):e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new pP({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),s=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:xP,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:xP,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:xP,accessor:"getFillColor",defaultValue:EP},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:xP,accessor:"getLineColor",defaultValue:EP},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:s,sideModel:o,wireframeModel:a,polygonTesselator:l}=this.state,c={extruded:Boolean(t),elevationScale:r,isWireframe:!1};a&&i&&(a.setInstanceCount(l.instanceCount-1),a.shaderInputs.setProps({solidPolygon:{...c,isWireframe:!0}}),a.draw(this.context.renderPass)),o&&n&&(o.setInstanceCount(l.instanceCount-1),o.shaderInputs.setProps({solidPolygon:c}),o.draw(this.context.renderPass)),s&&n&&(s.setVertexCount(l.vertexCount),s.shaderInputs.setProps({solidPolygon:c}),s.draw(this.context.renderPass))}updateState(e){var t;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded)&&(null==(t=this.state.models)||t.forEach(e=>e.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:t}=this.state,i=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:n}=this.props;let i,r,s;if(t){const t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;const n=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new zA(this.context.device,{...t,id:`${e}-top`,topology:"triangle-list",bufferLayout:n,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const t=this.getAttributeManager().getBufferLayouts({isInstanced:!0});r=new zA(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:t,geometry:new jA({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new zA(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:t,geometry:new jA({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[r,s,i].filter(Boolean),topModel:i,sideModel:r,wireframeModel:s}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}function SP({data:e,getIndex:t,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=e.length;let a=o,l=o;for(let h=0;h<o;h++){const n=t(e[h]);if(a>h&&n>=r&&(a=h),n>=s){l=h;break}}let c=a;const u=l-a!==i.length?e.slice(l):void 0;for(let h=0;h<i.length;h++)e[c++]=i[h];if(u){for(let t=0;t<u.length;t++)e[c++]=u[t];e.length=c}return{startRow:a,endRow:a+i.length}}AP.defaultProps=wP,AP.layerName="SolidPolygonLayer";const TP="uniform sdfUniforms {\n  float gamma;\n  bool enabled;\n  float buffer;\n  float outlineBuffer;\n  vec4 outlineColor;\n} sdf;\n",CP={name:"sdf",vs:TP,fs:TP,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},IP=.75,kP=[];class RP extends fR{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,CP],fs:"#version 300 es\n#define SHADER_NAME multi-icon-layer-fragment-shader\nprecision highp float;\nuniform sampler2D iconsTexture;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nif (!bool(picking.isActive)) {\nfloat alpha = texture(iconsTexture, vTextureCoords).a;\nvec4 color = vColor;\nif (sdf.enabled) {\nfloat distance = alpha;\nalpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);\nif (sdf.outlineBuffer > 0.0) {\nfloat inFill = alpha;\nfloat inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);\ncolor = mix(sdf.outlineColor, vColor, inFill);\nalpha = inBorder;\n}\n}\nfloat a = alpha * color.a;\nif (a < icon.alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color.rgb, a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){super.initializeState();this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:t,target:n})=>this.encodePickingColor(t,n)}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:i}=t;i!==n.outlineColor&&(i=i.map(e=>e/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&Op.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:n,outlineWidth:i}=this.props,{outlineColor:r}=this.state,s=i?Math.max(n,IP*(1-i)):-1,o=this.state.model,a={buffer:IP,outlineBuffer:s,gamma:n,enabled:Boolean(t),outlineColor:r};if(o.shaderInputs.setProps({sdf:a}),super.draw(e),t&&i){const{iconManager:e}=this.state;e.getTexture()&&(o.shaderInputs.setProps({sdf:{...a,outlineBuffer:IP}}),o.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(e=>super.getInstanceOffset(e)):kP}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(e=>super.getInstanceIconFrame(e)):kP}}RP.defaultProps={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},RP.layerName="MultiIconLayer";const PP=1e20;class MP{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:s="normal",fontStyle:o="normal",lang:a=null}={}){this.buffer=t,this.cutoff=i,this.radius=n,this.lang=a;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${o} ${s} ${e}px ${r}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:s}=this.ctx.measureText(e),o=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-r))),l=Math.min(this.size-this.buffer,o+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),f={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return f;const{ctx:p,buffer:g,gridInner:m,gridOuter:y}=this;this.lang&&(p.lang=this.lang),p.clearRect(g,g,a,l),p.fillText(e,g,g+o);const v=p.getImageData(g,g,a,l);y.fill(PP,0,h),m.fill(0,0,h);for(let _=0;_<l;_++)for(let e=0;e<a;e++){const t=v.data[4*(_*a+e)+3]/255;if(0===t)continue;const n=(_+g)*c+e+g;if(1===t)y[n]=0,m[n]=PP;else{const e=.5-t;y[n]=e>0?e*e:0,m[n]=e<0?e*e:0}}LP(y,0,0,c,u,c,this.f,this.v,this.z),LP(m,g,g,a,l,c,this.f,this.v,this.z);for(let _=0;_<h;_++){const e=Math.sqrt(y[_])-Math.sqrt(m[_]);d[_]=Math.round(255-255*(e/this.radius+this.cutoff))}return f}}function LP(e,t,n,i,r,s,o,a,l){for(let c=t;c<t+i;c++)BP(e,n*s+c,s,r,o,a,l);for(let c=n;c<n+r;c++)BP(e,c*s+t,1,i,o,a,l)}function BP(e,t,n,i,r,s,o){s[0]=0,o[0]=-PP,o[1]=PP,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=s[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=PP}for(let a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;const i=s[l],c=a-i;e[t+a*n]=r[i]+c*c}}const NP=[];function OP(e,t,n,i){var r;let s=0;for(let o=t;o<n;o++){s+=(null==(r=i[e[o]])?void 0:r.layoutWidth)||0}return s}function DP(e,t,n,i,r,s){let o=t,a=0;for(let l=t;l<n;l++){const t=OP(e,l,l+1,r);a+t>i&&(o<l&&s.push(l),o=l,a=0),a+=t}return a}function FP(e,t,n,i,r=0,s){void 0===s&&(s=e.length);const o=[];return"break-all"===t?DP(e,r,s,n,i,o):function(e,t,n,i,r,s){let o=t,a=t,l=t,c=0;for(let u=t;u<n;u++)if(" "===e[u]?l=u+1:" "!==e[u+1]&&u+1!==n||(l=u+1),l>a){let t=OP(e,a,l,r);c+t>i&&(o<a&&(s.push(a),o=a,c=0),t>i&&(t=DP(e,a,l,i,r,s),o=s[s.length-1])),a=l,c+=t}}(e,r,s,n,i,o),o}function UP(e,t,n,i,r,s){let o=0,a=0;for(let l=t;l<n;l++){const t=e[l],n=i[t];n?(a||(a=n.layoutHeight),r[l]=o+n.layoutWidth/2,o+=n.layoutWidth):(Op.warn(`Missing character: ${t} (${t.codePointAt(0)})`)(),r[l]=o,o+=32)}s[0]=o,s[1]=a}class zP{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}const GP={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1};let VP=new zP(3);function HP(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function jP(e,t,n,i){e.font=`${i} ${n}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}class WP{constructor(){this.props={...GP}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(1.2*e+2*t)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=function(e,t){let n;n="string"==typeof t?new Set(Array.from(t)):new Set(t);const i=VP.get(e);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}(this._key,this.props.characterSet),n=VP.get(this._key);if(n&&0===t.size)return void(this._atlas!==n&&(this._atlas=n));const i=this._generateFontAtlas(t,n);this._atlas=i,VP.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:n,fontWeight:i,fontSize:r,buffer:s,sdf:o,radius:a,cutoff:l}=this.props;let c=t&&t.data;c||(c=document.createElement("canvas"),c.width=1024);const u=c.getContext("2d",{willReadFrequently:!0});jP(u,n,r,i);const{mapping:h,canvasHeight:d,xOffset:f,yOffset:p}=function({characterSet:e,getFontWidth:t,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+2*i;for(const d of e)if(!s[d]){const e=t(d);c+e+2*i>r&&(c=0,l++),s[d]={x:c+i,y:a+l*u+i,width:e,height:u,layoutWidth:e,layoutHeight:n},c+=e+2*i}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:(h=a+(l+1)*u,Math.pow(2,Math.ceil(Math.log2(h))))};var h}({getFontWidth:e=>u.measureText(e).width,fontHeight:1.2*r,buffer:s,characterSet:e,maxCanvasWidth:1024,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(c.height!==d){const e=u.getImageData(0,0,c.width,c.height);c.height=d,u.putImageData(e,0,0)}if(jP(u,n,r,i),o){const t=new MP({fontSize:r,buffer:s,radius:a,cutoff:l,fontFamily:n,fontWeight:`${i}`});for(const n of e){const{data:e,width:i,height:s,glyphTop:o}=t.draw(n);h[n].width=i,h[n].layoutOffsetY=.9*r-o;const a=u.createImageData(i,s);HP(e,a),u.putImageData(a,h[n].x,h[n].y)}}else for(const g of e)u.fillText(g,h[g].x,h[g].y+s+.9*r);return{xOffset:f,yOffset:p,mapping:h,data:c,width:c.width,height:c.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:i,sdf:r,radius:s,cutoff:o}=this.props;return r?`${e} ${t} ${n} ${i} ${s} ${o}`:`${e} ${t} ${n} ${i}`}}const $P="uniform textBackgroundUniforms {\n  bool billboard;\n  float sizeScale;\n  float sizeMinPixels;\n  float sizeMaxPixels;\n  vec4 borderRadius;\n  vec4 padding;\n  highp int sizeUnits;\n  bool stroked;\n} textBackground;\n",XP={name:"textBackground",vs:$P,fs:$P,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},qP={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class KP extends Ck{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME text-background-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceRects;\nin float instanceSizes;\nin float instanceAngles;\nin vec2 instancePixelOffsets;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout float vLineWidth;\nout vec2 uv;\nout vec2 dimensions;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = radians(angle);\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvLineWidth = instanceLineWidths;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),\ntextBackground.sizeMinPixels, textBackground.sizeMaxPixels\n);\ndimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;\nvec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\npixelOffset += instancePixelOffsets;\npixelOffset.y *= -1.0;\nif (textBackground.billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME text-background-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin float vLineWidth;\nin vec2 uv;\nin vec2 dimensions;\nout vec4 fragColor;\nfloat round_rect(vec2 p, vec2 size, vec4 radii) {\nvec2 pixelPositionCB = (p - 0.5) * size;\nvec2 sizeCB = size * 0.5;\nfloat maxBorderRadius = min(size.x, size.y) * 0.5;\nvec4 borderRadius = vec4(min(radii, maxBorderRadius));\nborderRadius.xy =\n(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;\nborderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;\nvec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;\nreturn -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);\n}\nfloat rect(vec2 p, vec2 size) {\nvec2 pixelPosition = p * size;\nreturn min(min(pixelPosition.x, size.x - pixelPosition.x),\nmin(pixelPosition.y, size.y - pixelPosition.y));\n}\nvec4 get_stroked_fragColor(float dist) {\nfloat isBorder = smoothedge(dist, vLineWidth);\nreturn mix(vFillColor, vLineColor, isBorder);\n}\nvoid main(void) {\ngeometry.uv = uv;\nif (textBackground.borderRadius != vec4(0.0)) {\nfloat distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);\nif (textBackground.stroked) {\nfragColor = get_stroked_fragColor(distToEdge);\n} else {\nfragColor = vFillColor;\n}\nfloat shapeAlpha = smoothedge(-distToEdge, 0.0);\nfragColor.a *= shapeAlpha;\n} else {\nif (textBackground.stroked) {\nfloat distToEdge = rect(uv, dimensions);\nfragColor = get_stroked_fragColor(distToEdge);\n} else {\nfragColor = vFillColor;\n}\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[$w,Cx,XP]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:n,sizeUnits:i,sizeMinPixels:r,sizeMaxPixels:s,getLineWidth:o}=this.props;let{padding:a,borderRadius:l}=this.props;a.length<4&&(a=[a[0],a[1],a[0],a[1]]),Array.isArray(l)||(l=[l,l,l,l]);const c=this.state.model,u={billboard:t,stroked:Boolean(o),borderRadius:l,padding:a,sizeUnits:Iw[i],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:s};c.shaderInputs.setProps({textBackground:u}),c.draw(this.context.renderPass)}_getModel(){return new zA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new jA({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,0,1,1,1])}}}),isInstanced:!0})}}KP.defaultProps=qP,KP.layerName="TextBackgroundLayer";const YP={start:1,middle:0,end:-1},JP={top:1,center:0,bottom:-1},ZP=[0,0,0,255],QP={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ZP},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:GP.characterSet},fontFamily:GP.fontFamily,fontWeight:GP.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ZP},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:ZP},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class eM extends Ik{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[n,i]}=this.transformParagraph(e,t);const{fontSize:r}=this.state.fontAtlasManager.props;n/=r,i/=r;const{getTextAnchor:s,getAlignmentBaseline:o}=this.props;return[(YP["function"==typeof s?s(e,t):s]-1)*n/2,(JP["function"==typeof o?o(e,t):o]-1)*i/2,n,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:r,y:s,rowWidth:o,size:[a,l]}=this.transformParagraph(e,t),c=YP["function"==typeof n?n(e,t):n],u=JP["function"==typeof i?i(e,t):i],h=r.length,d=new Array(2*h);let f=0;for(let p=0;p<h;p++){const e=(1-c)*(a-o[p])/2;d[f++]=(c-1)*a/2+e+r[p],d[f++]=(u-1)*l/2+s[p]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new WP},this.props.maxWidth>0&&Op.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText();(this._updateFontAtlas()||t.lineHeight!==n.lineHeight||t.wordBreak!==n.wordBreak||t.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:r}=this.state,s={...e,characterSet:r,fontFamily:t,fontWeight:n};if(!i.mapping)return i.setProps(s),!0;for(const o in s)if(s[o]!==i.props[o])return i.setProps(s),!0;return!1}_updateText(){var e;const{data:t,characterSet:n}=this.props,i=null==(e=t.attributes)?void 0:e.getText;let r,{getText:s}=this.props,o=t.startIndices;const a="auto"===n&&new Set;if(i&&o){const{texts:e,characterCount:n}=function({value:e,length:t,stride:n,offset:i,startIndices:r,characterSet:s}){const o=e.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[t]||Math.ceil((e.length-l)/a),u=s&&new Set,h=new Array(t);let d=e;if(a>1||l>0){d=new(0,e.constructor)(c);for(let t=0;t<c;t++)d[t]=e[t*a+l]}for(let f=0;f<t;f++){const e=r[f],t=r[f+1]||c,n=d.subarray(e,t);h[f]=String.fromCodePoint.apply(null,n),u&&n.forEach(u.add,u)}if(u)for(const f of u)s.add(String.fromCodePoint(f));return{texts:h,characterCount:c}}({...ArrayBuffer.isView(i)?{value:i}:i,length:t.length,startIndices:o,characterSet:a});r=n,s=(t,{index:n})=>e[n]}else{const{iterable:e,objectInfo:n}=bI(t);o=[0],r=0;for(const t of e){n.index++;const e=Array.from(s(t,n)||"");a&&e.forEach(a.add,a),r+=e.length,o.push(r)}}this.setState({getText:s,startIndices:o,numInstances:r,characterSet:a||n})}transformParagraph(e,t){const{fontAtlasManager:n}=this.state,i=n.mapping,r=this.state.getText,{wordBreak:s,lineHeight:o,maxWidth:a}=this.props;return function(e,t,n,i,r){var s;const o=Array.from(e),a=o.length,l=new Array(a),c=new Array(a),u=new Array(a),h=("break-word"===n||"break-all"===n)&&isFinite(i)&&i>0,d=[0,0],f=[0,0];let p=0,g=0,m=0;for(let y=0;y<=a;y++){const e=o[y];if("\n"!==e&&y!==a||(m=y),m>g){const e=h?FP(o,n,i,r,g,m):NP;for(let n=0;n<=e.length;n++){const i=0===n?g:e[n-1],a=n<e.length?e[n]:m;UP(o,i,a,r,l,f);for(let e=i;e<a;e++){const t=(null==(s=r[o[e]])?void 0:s.layoutOffsetY)||0;c[e]=p+f[1]/2+t,u[e]=f[0]}p+=f[1]*t,d[0]=Math.max(d[0],f[0])}g=m}"\n"===e&&(l[g]=0,c[g]=0,u[g]=0,g++)}return d[1]=p,{x:l,y:c,rowWidth:u,size:d}}(r(e,t)||"",o,s,a*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:i,atlas:r,mapping:s},styleVersion:o}=this.state,{data:a,_dataDiff:l,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,getBackgroundColor:p,getBorderColor:g,getBorderWidth:m,backgroundBorderRadius:y,backgroundPadding:v,background:_,billboard:b,fontSettings:E,outlineWidth:w,outlineColor:x,sizeScale:A,sizeUnits:S,sizeMinPixels:T,sizeMaxPixels:C,transitions:I,updateTriggers:k}=this.props,R=this.getSubLayerClass("characters",RP),P=this.getSubLayerClass("background",KP);return[_&&new P({getFillColor:p,getLineColor:g,getLineWidth:m,borderRadius:y,padding:v,getPosition:c,getSize:h,getAngle:d,getPixelOffset:f,billboard:b,sizeScale:A,sizeUnits:S,sizeMinPixels:T,sizeMaxPixels:C,transitions:I&&{getPosition:I.getPosition,getAngle:I.getAngle,getSize:I.getSize,getFillColor:I.getBackgroundColor,getLineColor:I.getBorderColor,getLineWidth:I.getBorderWidth,getPixelOffset:I.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:k.getPosition,getAngle:k.getAngle,getSize:k.getSize,getFillColor:k.getBackgroundColor,getLineColor:k.getBorderColor,getLineWidth:k.getBorderWidth,getPixelOffset:k.getPixelOffset,getBoundingRect:{getText:k.getText,getTextAnchor:k.getTextAnchor,getAlignmentBaseline:k.getAlignmentBaseline,styleVersion:o}}}),{data:a.attributes&&a.attributes.background?{length:a.length,attributes:a.attributes.background}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new R({sdf:E.sdf,smoothing:Number.isFinite(E.smoothing)?E.smoothing:GP.smoothing,outlineWidth:w/(E.radius||GP.radius),outlineColor:x,iconAtlas:r,iconMapping:s,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,billboard:b,sizeScale:A*i,sizeUnits:S,sizeMinPixels:T*i,sizeMaxPixels:C*i,transitions:I&&{getPosition:I.getPosition,getAngle:I.getAngle,getColor:I.getColor,getSize:I.getSize,getPixelOffset:I.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:k.getText,getPosition:k.getPosition,getAngle:k.getAngle,getColor:k.getColor,getSize:k.getSize,getPixelOffset:k.getPixelOffset,getIconOffsets:{getTextAnchor:k.getTextAnchor,getAlignmentBaseline:k.getAlignmentBaseline,styleVersion:o}}}),{data:a,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){!function(e){Op.assert(Number.isFinite(e)&&e>=3,"Invalid cache limit"),VP=new zP(e)}(e)}}eM.defaultProps=QP,eM.layerName="TextLayer";const tM={circle:{type:AR,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:fR,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:eM,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},nM={type:QR,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},iM={type:AP,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function rM({type:e,props:t}){const n={};for(const i in t)n[i]=e.defaultProps[t[i]];return n}function sM(e,t){const{transitions:n,updateTriggers:i}=e.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in t){const o=t[s];let a=e.props[s];s.startsWith("get")&&(a=e.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function oM(e,t,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=e.length}=n;for(let o=r;o<s;o++){const n=e[o],{geometry:r}=n;if(r)if("GeometryCollection"===r.type){Op.assert(Array.isArray(r.geometries),"GeoJSON does not have geometries array");const{geometries:e}=r;for(let r=0;r<e.length;r++){aM(e[r],i,t,n,o)}}else aM(r,i,t,n,o)}return i}function aM(e,t,n,i,r){const{type:s,coordinates:o}=e,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=t;if(function(e,t){let n=lM[e];Op.assert(n,`Unknown GeoJSON type ${e}`);for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(s,o))switch(s){case"Point":a.push(n({geometry:e},i,r));break;case"MultiPoint":o.forEach(e=>{a.push(n({geometry:{type:"Point",coordinates:e}},i,r))});break;case"LineString":l.push(n({geometry:e},i,r));break;case"MultiLineString":o.forEach(e=>{l.push(n({geometry:{type:"LineString",coordinates:e}},i,r))});break;case"Polygon":c.push(n({geometry:e},i,r)),o.forEach(e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))});break;case"MultiPolygon":o.forEach(e=>{c.push(n({geometry:{type:"Polygon",coordinates:e}},i,r)),e.forEach(e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))})})}else Op.warn(`${s} coordinates are malformed`)()}const lM={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function cM(e){return e.geometry.coordinates}function uM(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:i,lines:r,polygons:s}=e,o=function(e,t){const n={points:null,lines:null,polygons:null};for(const i in n){const r=e[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(4*r.length);const s=[];for(let e=0;e<r.length;e++)t(r[e],s),n[i][4*e+0]=s[0],n[i][4*e+1]=s[1],n[i][4*e+2]=s[2],n[i][4*e+3]=255}return n}(e,t);n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open";const a=s.positions.value.length/s.positions.size,l=Array(a).fill(1);for(const c of s.primitivePolygonIndices.value)l[c-1]=0;return n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,instanceVertexValid:{size:1,value:new Uint16Array(l)},pickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const hM=["points","linestrings","polygons"],dM={...rM(tM.circle),...rM(tM.icon),...rM(tM.text),...rM(nM),...rM(iM),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class fM extends Ik{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const n=uM(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:t}){const n=function(e){if(Array.isArray(e))return e;switch(Op.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return Op.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e.data),i=this.getSubLayerRow.bind(this);let r={};const s={};if(Array.isArray(t.dataChanged)){const e=this.state.features;for(const t in e)r[t]=e[t].slice(),s[t]=[];for(const o of t.dataChanged){const t=oM(n,i,o);for(const n in e)s[n].push(SP({data:r[n],getIndex:e=>e.__source.index,dataRange:o,replace:t[n]}))}}else r=oM(n,i);const o=function(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=e;return n.points.data=i,n.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),n.points.getPosition=cM,n.lines.data=r,n.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),n.lines.getPath=cM,n.polygons.data=s,n.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),n.polygons.getPolygon=cM,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),n.polygonsOutline.getPath=cM,n}(r,s);this.setState({features:r,featuresDiff:s,layerProps:o})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n,sourceLayer:i}=t;return t.featureType=hM.find(e=>i.id.startsWith(`${this.id}-${e}-`)),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[n]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,n="points"===e.featureType;for(const i of this.getSubLayers())i.id.startsWith(t)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var e;const{extruded:t,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,null==(e=i.polygons)?void 0:e.data)&&this.getSubLayerClass(r,iM.type);if(s){const e=sM(this,iM.props),o=t&&n;return o||delete e.getLineColor,e.updateTriggers.lineColors=o,new s(e,this.getSubLayerProps({id:r,updateTriggers:e.updateTriggers}),i.polygons)}return null}_renderLineLayers(){var e,t;const{extruded:n,stroked:i}=this.props,{layerProps:r}=this.state,s="polygons-stroke",o="linestrings",a=!n&&i&&this.shouldRenderSubLayer(s,null==(e=r.polygonsOutline)?void 0:e.data)&&this.getSubLayerClass(s,nM.type),l=this.shouldRenderSubLayer(o,null==(t=r.lines)?void 0:t.data)&&this.getSubLayerClass(o,nM.type);if(a||l){const e=sM(this,nM.props);return[a&&new a(e,this.getSubLayerProps({id:s,updateTriggers:e.updateTriggers}),r.polygonsOutline),l&&new l(e,this.getSubLayerProps({id:o,updateTriggers:e.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var e;const{pointType:t}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(e=>e.__source.index===r));const s=new Set(t.split("+")),o=[];for(const a of s){const t=`points-${a}`,s=tM[a],l=s&&this.shouldRenderSubLayer(t,null==(e=n.points)?void 0:e.data)&&this.getSubLayerClass(t,s.type);if(l){const e=sM(this,s.props);let c=n.points;if("text"===a&&i){const{instancePickingColors:e,...t}=c.data.attributes;c={...c,data:{...c.data,attributes:t}}}o.push(new l(e,this.getSubLayerProps({id:t,updateTriggers:e.updateTriggers,highlightedObjectIndex:r}),c))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return t&&"function"==typeof e?(t,n)=>{const{data:i,index:r}=n,s=function(e,t){if(!e)return null;const n="startIndices"in e?e.startIndices[t]:t,i=e.featureIds.value[n];return-1!==n?function(e,t,n){const i={properties:{...e.properties[t]}};for(const r in e.numericProps)i.properties[r]=e.numericProps[r].value[n];return i}(e,i,n):null}(i,r);return e(s,n)}:super.getSubLayerAccessor(e)}}fM.layerName="GeoJsonLayer",fM.defaultProps=dM;class pM{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,this.boundingBox="west"in e?[[e.west,e.south],[e.east,e.north]]:[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e),e}async _loadData({getData:e,requestScheduler:t,onLoad:n,onError:i}){const{index:r,id:s,bbox:o,userData:a,zoom:l}=this,c=this._loaderId;this._abortController=new AbortController;const{signal:u}=this._abortController,h=await t.scheduleRequest(this,e=>e.isSelected?1:-1);if(!h)return void(this._isCancelled=!0);if(this._isCancelled)return void h.done();let d,f=null;try{f=await e({index:r,id:s,bbox:o,userData:a,zoom:l,signal:u})}catch(p){d=p||!0}finally{h.done()}c===this._loaderId&&(this._loader=void 0,this.content=f,!this._isCancelled||f?(this._isLoaded=!0,this._isCancelled=!1,d?i(d,this):n(this)):this._isLoaded=!1)}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,null==(e=this._abortController)||e.abort())}}const gM=-1,mM=0,yM=1,vM=new hb,_M=new hb;class bM{constructor(e=[0,0,0],t=[0,0,0],n){n=n||vM.copy(e).add(t).scale(.5),this.center=new hb(n),this.halfDiagonal=new hb(t).subtract(this.center),this.minimum=new hb(e),this.maximum=new hb(t)}clone(){return new bM(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,n=_M.from(e.normal),i=t.x*Math.abs(n.x)+t.y*Math.abs(n.y)+t.z*Math.abs(n.z),r=this.center.dot(n)+e.distance;return r-i>0?yM:r+i<0?gM:mM}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=vM.from(e).subtract(this.center),{halfDiagonal:n}=this;let i,r=0;return i=Math.abs(t.x)-n.x,i>0&&(r+=i*i),i=Math.abs(t.y)-n.y,i>0&&(r+=i*i),i=Math.abs(t.z)-n.z,i>0&&(r+=i*i),r}}const EM=new hb,wM=new hb;class xM{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new hb,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=EM.from(t),this.center=(new hb).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new xM(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,r=e.radius,s=EM.copy(i).subtract(t),o=s.magnitude();if(n>=o+r)return this.clone();if(r>=o+n)return e.clone();const a=.5*(n+o+r);return wM.copy(s).scale((-n+a)/o).add(t),this.center.copy(wM),this.radius=a,this}expand(e){const t=EM.from(e).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);const t=function(e,t){const n=t[0],i=t[1],r=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(n*n+i*i+r*r),e[1]=Math.sqrt(s*s+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}(EM,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const t=EM.from(e).subtract(this.center);return Math.max(0,t.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,i=e.normal.dot(t)+e.distance;return i<-n?gM:i<n?mM:yM}}const AM=new hb,SM=new hb,TM=new hb,CM=new hb,IM=new hb,kM=new hb,RM=new hb,PM=0,MM=1,LM=2,BM=3,NM=4,OM=5,DM=6,FM=7,UM=8;class zM{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=(new hb).from(e),this.halfAxes=new _b(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new hb(e).len(),new hb(t).len(),new hb(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new hb(e).normalize(),r=new hb(t).normalize(),s=new hb(n).normalize();return(new nE).fromMatrix3(new _b([...i,...r,...s]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new nE(n),r=(new _b).fromQuaternion(i);return r[0]=r[0]*t[0],r[1]=r[1]*t[0],r[2]=r[2]*t[0],r[3]=r[3]*t[1],r[4]=r[4]*t[1],r[5]=r[5]*t[1],r[6]=r[6]*t[2],r[7]=r[7]*t[2],r[8]=r[8]*t[2],this.center=(new hb).from(e),this.halfAxes=r,this}clone(){return new zM(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new xM){const t=this.halfAxes,n=t.getColumn(0,TM),i=t.getColumn(1,CM),r=t.getColumn(2,IM),s=AM.copy(n).add(i).add(r);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,r=n.x,s=n.y,o=n.z,a=Math.abs(r*i[PM]+s*i[MM]+o*i[LM])+Math.abs(r*i[BM]+s*i[NM]+o*i[OM])+Math.abs(r*i[DM]+s*i[FM]+o*i[UM]),l=n.dot(t)+e.distance;return l<=-a?gM:l>=a?yM:mM}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=SM.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,TM),r=n.getColumn(1,CM),s=n.getColumn(2,IM),o=i.magnitude(),a=r.magnitude(),l=s.magnitude();i.normalize(),r.normalize(),s.normalize();let c,u=0;return c=Math.abs(t.dot(i))-o,c>0&&(u+=c*c),c=Math.abs(t.dot(r))-a,c>0&&(u+=c*c),c=Math.abs(t.dot(s))-l,c>0&&(u+=c*c),u}computePlaneDistances(e,t,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const s=this.center,o=this.halfAxes,a=o.getColumn(0,TM),l=o.getColumn(1,CM),c=o.getColumn(2,IM),u=kM.copy(a).add(l).add(c).add(s),h=RM.copy(u).subtract(e);let d=t.dot(h);return i=Math.min(d,i),r=Math.max(d,r),u.copy(s).add(a).add(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),u.copy(s).add(a).subtract(l).add(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),u.copy(s).add(a).subtract(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),s.copy(u).subtract(a).add(l).add(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),s.copy(u).subtract(a).add(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),s.copy(u).subtract(a).subtract(l).add(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),s.copy(u).subtract(a).subtract(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),n[0]=i,n[1]=r,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,TM);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,CM);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,IM);return i.transformAsPoint(e),this.halfAxes=new _b([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const GM=new hb,VM=new hb;class HM{constructor(e=[0,0,1],t=0){this.normal=new hb,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return U_(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=GM.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),U_(B_(this.normal.len(),1)),this.distance=i,this}clone(){return new HM(this.normal,this.distance)}equals(e){return B_(this.distance,e.distance)&&B_(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=VM.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e,t=[0,0,0]){const n=GM.from(e),i=this.getPointDistance(n),r=VM.copy(this.normal).scale(i);return n.subtract(r).to(t)}}const jM=[new hb([1,0,0]),new hb([0,1,0]),new hb([0,0,1])],WM=new hb,$M=new hb;class XM{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*jM.length;const t=e.center,n=e.radius;let i=0;for(const r of jM){let e=this.planes[i],s=this.planes[i+1];e||(e=this.planes[i]=new HM),s||(s=this.planes[i+1]=new HM);const o=WM.copy(r).scale(-n).add(t);e.fromPointNormal(o,r);const a=WM.copy(r).scale(n).add(t),l=$M.copy(r).negate();s.fromPointNormal(a,l),i+=2}return this}computeVisibility(e){let t=yM;for(const n of this.planes){switch(e.intersectPlane(n)){case gM:return gM;case mM:t=mM}}return t}computeVisibilityWithPlaneMask(e,t){if(U_(Number.isFinite(t),"parentPlaneMask is required."),t===XM.MASK_OUTSIDE||t===XM.MASK_INSIDE)return t;let n=XM.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const s=r<31?1<<r:0;if(r<31&&0===(t&s))continue;const o=i[r],a=e.intersectPlane(o);if(a===gM)return XM.MASK_OUTSIDE;a===mM&&(n|=s)}return n}}XM.MASK_OUTSIDE=4294967295,XM.MASK_INSIDE=0,XM.MASK_INDETERMINATE=2147483647,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb,new hb;const qM=new _b,KM=new _b,YM=new _b,JM=new _b,ZM=new _b;function QM(e,t={}){let n=0,i=0;const r=KM,s=YM;r.identity(),s.copy(e);const o=1e-20*function(e){let t=0;for(let n=0;n<9;++n){const i=e[n];t+=i*i}return Math.sqrt(t)}(s);for(;i<10&&nL(s)>o;)iL(s,JM),ZM.copy(JM).transpose(),s.multiplyRight(JM),s.multiplyLeft(ZM),r.multiplyRight(JM),++n>2&&(++i,n=0);return t.unitary=r.toTarget(t.unitary),t.diagonal=s.toTarget(t.diagonal),t}const eL=[1,0,0],tL=[2,2,1];function nL(e){let t=0;for(let n=0;n<3;++n){const i=e[qM.getElementIndex(tL[n],eL[n])];t+=2*i*i}return Math.sqrt(t)}function iL(e,t){let n=0,i=1;for(let l=0;l<3;++l){const t=Math.abs(e[qM.getElementIndex(tL[l],eL[l])]);t>n&&(i=l,n=t)}const r=eL[i],s=tL[i];let o=1,a=0;if(Math.abs(e[qM.getElementIndex(s,r)])>1e-15){const t=(e[qM.getElementIndex(s,s)]-e[qM.getElementIndex(r,r)])/2/e[qM.getElementIndex(s,r)];let n;n=t<0?-1/(-t+Math.sqrt(1+t*t)):1/(t+Math.sqrt(1+t*t)),o=1/Math.sqrt(1+n*n),a=n*o}return _b.IDENTITY.to(t),t[qM.getElementIndex(r,r)]=t[qM.getElementIndex(s,s)]=o,t[qM.getElementIndex(s,r)]=a,t[qM.getElementIndex(r,s)]=-a,t}const rL=new hb,sL=new hb,oL=new hb,aL=new hb,lL=new hb,cL=new _b,uL={diagonal:new _b,unitary:new _b};function hL(e,t=new zM){if(!e||0===e.length)return t.halfAxes=new _b([0,0,0,0,0,0,0,0,0]),t.center=new hb,t;const n=e.length,i=new hb(0,0,0);for(const S of e)i.add(S);const r=1/n;i.multiplyByScalar(r);let s=0,o=0,a=0,l=0,c=0,u=0;for(const S of e){const e=rL.copy(S).subtract(i);s+=e.x*e.x,o+=e.x*e.y,a+=e.x*e.z,l+=e.y*e.y,c+=e.y*e.z,u+=e.z*e.z}s*=r,o*=r,a*=r,l*=r,c*=r,u*=r;const h=cL;h[0]=s,h[1]=o,h[2]=a,h[3]=o,h[4]=l,h[5]=c,h[6]=a,h[7]=c,h[8]=u;const{unitary:d}=QM(h,uL),f=t.halfAxes.copy(d);let p=f.getColumn(0,oL),g=f.getColumn(1,aL),m=f.getColumn(2,lL),y=-Number.MAX_VALUE,v=-Number.MAX_VALUE,_=-Number.MAX_VALUE,b=Number.MAX_VALUE,E=Number.MAX_VALUE,w=Number.MAX_VALUE;for(const S of e)rL.copy(S),y=Math.max(rL.dot(p),y),v=Math.max(rL.dot(g),v),_=Math.max(rL.dot(m),_),b=Math.min(rL.dot(p),b),E=Math.min(rL.dot(g),E),w=Math.min(rL.dot(m),w);p=p.multiplyByScalar(.5*(b+y)),g=g.multiplyByScalar(.5*(E+v)),m=m.multiplyByScalar(.5*(w+_)),t.center.copy(p).add(g).add(m);const x=sL.set(y-b,v-E,_-w).multiplyByScalar(.5),A=new _b([x[0],0,0,0,x[1],0,0,0,x[2]]);return t.halfAxes.multiplyRight(A),t}const dL=512,fL=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],pL=fL.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),gL=pL.concat([[.25,.5],[.75,.5]]);class mL{constructor(e,t,n){this.x=e,this.y=t,this.z=n}get children(){if(!this._children){const e=2*this.x,t=2*this.y,n=this.z+1;this._children=[new mL(e,t,n),new mL(e,t+1,n),new mL(e+1,t,n),new mL(e+1,t+1,n)]}return this._children}update(e){const{viewport:t,cullingVolume:n,elevationBounds:i,minZ:r,maxZ:s,bounds:o,offset:a,project:l}=e,c=this.getBoundingVolume(i,a,l);if(o&&!this.insideBounds(o))return!1;if(n.computeVisibility(c)<0)return!1;if(!this.childVisible){let{z:e}=this;if(e<s&&e>=r){const n=c.distanceTo(t.cameraPosition)*t.scale/t.height;e+=Math.floor(Math.log2(n))}if(e>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const u of this.children)u.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,n,i]){const r=Math.pow(2,this.z),s=dL/r;return this.x*s<n&&this.y*s<i&&(this.x+1)*s>e&&(this.y+1)*s>t}getBoundingVolume(e,t,n){if(n){const t=this.z<1?gL:this.z<2?pL:fL,i=[];for(const r of t){const t=SL(this.x+r[0],this.y+r[1],this.z);t[2]=e[0],i.push(n(t)),e[0]!==e[1]&&(t[2]=e[1],i.push(n(t)))}return hL(i)}const i=Math.pow(2,this.z),r=dL/i,s=this.x*r+t*dL,o=dL-(this.y+1)*r;return new bM([s,o,e[0]],[s+r,o+r,e[1]])}}const yL=512,vL=[-1/0,-1/0,1/0,1/0],_L={equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}};function bL(e,t){const n=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...n.map(e=>e[0])),Math.min(...n.map(e=>e[1])),Math.max(...n.map(e=>e[0])),Math.max(...n.map(e=>e[1]))]}function EL(e,t){if(!e||!e.length)return null;const{index:n,id:i}=t;if(Array.isArray(e)){e=e[(r=i,Math.abs(r.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))%e.length)]}var r;let s=e;for(const o of Object.keys(n)){const e=new RegExp(`{${o}}`,"g");s=s.replace(e,String(n[o]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),s}function wL({viewport:e,z:t,cullRect:n}){return(e.subViewports||[e]).map(e=>xL(e,t||0,n))}function xL(e,t,n){if(!Array.isArray(t)){const i=n.x-e.x,r=n.y-e.y,{width:s,height:o}=n,a={targetZ:t},l=e.unproject([i,r],a),c=e.unproject([i+s,r],a),u=e.unproject([i,r+o],a),h=e.unproject([i+s,r+o],a);return[Math.min(l[0],c[0],u[0],h[0]),Math.min(l[1],c[1],u[1],h[1]),Math.max(l[0],c[0],u[0],h[0]),Math.max(l[1],c[1],u[1],h[1])]}const i=xL(e,t[0],n),r=xL(e,t[1],n);return[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[2],r[2]),Math.max(i[3],r[3])]}function AL(e,t){return Math.pow(2,e)*yL/t}function SL(e,t,n){const i=AL(n,yL),r=e/i*360-180,s=Math.PI-2*Math.PI*t/i;return[r,180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)))]}function TL(e,t,n,i){const r=AL(n,i);return[e/r*yL,t/r*yL]}function CL(e,t,n,i,r=yL){if(e.isGeospatial){const[e,r]=SL(t,n,i),[s,o]=SL(t+1,n+1,i);return{west:e,north:r,east:s,south:o}}const[s,o]=TL(t,n,i,r),[a,l]=TL(t+1,n+1,i,r);return{left:s,top:o,right:a,bottom:l}}function IL(e,t,n,i,r){const s=function(e,t,n){let i;return i=e.getBounds(),e.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}(e,0,i),o=AL(t,n),[a,l,c,u]=function(e,t,n){if(n)return bL(e,n).map(e=>e*t/yL);return e.map(e=>e*t/yL)}(s,o,r),h=[];for(let d=Math.floor(a);d<c;d++)for(let e=Math.floor(l);e<u;e++)h.push({x:d,y:e,z:t});return h}function kL({viewport:e,maxZoom:t,minZoom:n,zRange:i,extent:r,tileSize:s=yL,modelMatrix:o,modelMatrixInverse:a,zoomOffset:l=0}){let c=e.isGeospatial?Math.round(e.zoom+Math.log2(yL/s))+l:Math.ceil(e.zoom)+l;if("number"==typeof n&&Number.isFinite(n)&&c<n){if(!r)return[];c=n}"number"==typeof t&&Number.isFinite(t)&&c>t&&(c=t);let u=r;return o&&a&&r&&!e.isGeospatial&&(u=bL(r,o)),e.isGeospatial?function(e,t,n,i){const r=e instanceof Bk&&e.resolution?e.projectPosition:null,s=Object.values(e.getFrustumPlanes()).map(({normal:e,distance:t})=>new HM(e.clone().negate(),t)),o=new XM(s),a=e.distanceScales.unitsPerMeter[2],l=n&&n[0]*a||0,c=n&&n[1]*a||0,u=e instanceof lA&&e.pitch<=60?t:0;if(i){const[e,t,n,r]=i,s=ox([e,r]),o=ox([n,t]);i=[s[0],dL-s[1],o[0],dL-o[1]]}const h=new mL(0,0,0),d={viewport:e,project:r,cullingVolume:o,elevationBounds:[l,c],minZ:u,maxZ:t,bounds:i,offset:0};if(h.update(d),e instanceof lA&&e.subViewports&&e.subViewports.length>1){for(d.offset=-1;h.update(d)&&!(--d.offset<-3););for(d.offset=1;h.update(d)&&!(++d.offset>3););}return h.getSelected()}(e,c,i,r):IL(e,c,s,u||vL,a)}function RL(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}const PL="never",ML="no-overlap",LL="best-available",BL={[LL]:function(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&!OL(t)&&DL(t);for(const t of e)t.isVisible=Boolean(2&t.state)},[ML]:function(e){for(const n of e)n.state=0;for(const n of e)n.isSelected&&OL(n);const t=Array.from(e).sort((e,t)=>e.zoom-t.zoom);for(const n of t)if(n.isVisible=Boolean(2&n.state),n.children&&(n.isVisible||1&n.state))for(const e of n.children)e.state=1;else n.isSelected&&DL(n)},[PL]:()=>{}},NL={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};function OL(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=2,!0;t=t.parent}return!1}function DL(e){for(const t of e.children)t.isLoaded||t.content?t.state|=2:DL(t)}const FL={TilesetClass:class{constructor(e){this._getCullBounds=function(e){let t,n={};return i=>{for(const r in i)if(!RL(i[r],n[r])){t=e(i),n=i;break}return t}}(wL),this.opts={...NL,...e},this.setOptions(this.opts),this.onTileLoad=e=>{var t,n;null==(n=(t=this.opts).onTileLoad)||n.call(t,e),null!==this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new of({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Fb,this._modelMatrixInverse=new Fb}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return null!==this._selectedTiles&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return null!==this._selectedTiles&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);this._selectedTiles&&this._selectedTiles.includes(t)?t.setNeedsReload():this._cache.delete(e)}}update(e,{zRange:t,modelMatrix:n}={zRange:null,modelMatrix:null}){const i=n?new Fb(n):new Fb,r=!i.equals(this._modelMatrix);if(this._viewport&&e.equals(this._viewport)&&B_(this._zRange,t)&&!r)this.needsReload&&(this._selectedTiles=this._selectedTiles.map(e=>this._getTile(e.index,!0)));else{r&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=t;const n=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=n.map(e=>this._getTile(e,!0)),this._dirty&&this._rebuildTree()}const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,t,n){if(!e.isVisible)return!1;if(t&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t});let{bbox:r}=e;for(const[e,t,s,o]of i){let i;if("west"in r)i=r.west<s&&r.east>e&&r.south<o&&r.north>t;else{if(n&&!Fb.IDENTITY.equals(n)){const[e,t,i,s]=bL([r.left,r.top,r.right,r.bottom],n);r={left:e,top:t,right:i,bottom:s}}const a=Math.min(r.top,r.bottom),l=Math.max(r.top,r.bottom);i=r.left<s&&r.right>e&&a<o&&l>t}if(i)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:n,zRange:i,modelMatrix:r,modelMatrixInverse:s}){const{tileSize:o,extent:a,zoomOffset:l}=this.opts;return kL({viewport:e,maxZoom:t,minZoom:n,zRange:i,tileSize:o,extent:a,modelMatrix:r,modelMatrixInverse:s,zoomOffset:l})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:CL(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){return{x:Math.floor(e.x/2),y:Math.floor(e.y/2),z:e.z-1}}updateTileStates(){const e=this.opts.refinementStrategy||LL,t=new Array(this._cache.size);let n=0;for(const i of this._cache.values())t[n++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;("function"==typeof e?e:BL[e])(Array.from(this._cache.values())),n=0;for(const i of this._cache.values())if(t[n++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let n=0;for(const i of this._cache.values())i.isLoading&&(n++,i.isSelected||i.isVisible||t.push(i));for(;e>0&&n>e&&t.length>0;){t.shift().abort(),n--}}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const e=this._getNearestAncestor(t);t.parent=e,(null==e?void 0:e.children)&&e.children.push(t)}}_resizeCache(){var e,t;const{_cache:n,opts:i}=this,r=i.maxCacheSize??(null!==i.maxCacheByteSize?1/0:5*this.selectedTiles.length),s=i.maxCacheByteSize??1/0;if(n.size>r||this._cacheByteSize>s){for(const[o,a]of n)if(a.isVisible||a.isSelected||(this._cacheByteSize-=null!==i.maxCacheByteSize?a.byteLength:0,n.delete(o),null==(t=(e=this.opts).onTileUnload)||t.call(e,a)),n.size<=r&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((e,t)=>e.zoom-t.zoom),this._dirty=!1)}_getTile(e,t){const n=this.getTileId(e);let i=this._cache.get(n),r=!1;return!i&&t?(i=new pM(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:n,zoom:this.getTileZoom(i.index)}),r=!0,this._cache.set(n,i),this._dirty=!0):i&&i.needsReload&&(r=!0),i&&r&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:t=0}=this;let n=e.index;for(;this.getTileZoom(n)>t;){n=this.getParentIndex(n);const e=this._getTile(n);if(e)return e}return null}},data:{type:"data",value:[]},dataComparator:_L.equal,renderSubLayers:{type:"function",value:e=>new fM(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>{}},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:LL,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class UL extends Ik{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;null==(t=null==(e=this.state)?void 0:e.tileset)||t.finalize()}get isLoaded(){var e,t,n;return Boolean(null==(n=null==(t=null==(e=this.state)?void 0:e.tileset)?void 0:t.selectedTiles)?void 0:n.every(e=>e.isLoaded&&e.layers&&e.layers.every(e=>e.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state;const n=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?n&&(t.setOptions(this._getTilesetOptions()),i?t.reloadAll():t.tiles.forEach(e=>{e.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:n,refinementStrategy:i,extent:r,maxZoom:s,minZoom:o,maxRequests:a,debounceTime:l,zoomOffset:c}=this.props;return{maxCacheSize:t,maxCacheByteSize:n,maxZoom:s,minZoom:o,tileSize:e,refinementStrategy:i,extent:r,maxRequests:a,debounceTime:l,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:n}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:n}),{isLoaded:r}=e,s=this.state.isLoaded!==r,o=this.state.frameNumber!==i;r&&(s||o)&&this._onViewportLoad(),o&&this.setState({frameNumber:i}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:n,fetch:i}=this.props,{signal:r}=e;return e.url="string"==typeof t||Array.isArray(t)?EL(t,e):null,n?n(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:r}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,n=t.props.tile,i=e.info;return i.picked&&(i.tile=n),i.sourceTile=n,i.sourceTileSubLayer=t,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const t=this.getSubLayerPropsByTile(e);if(e.isLoaded||e.content)if(e.layers)t&&e.layers[0]&&Object.keys(t).some(n=>e.layers[0].props[n]!==t[n])&&(e.layers=e.layers.map(e=>e.clone(t)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=cS(n,Boolean).map(n=>n.clone({tile:e,...t}))}else;return e.layers})}filterSubLayer({layer:e,cullRect:t}){const{tile:n}=e.props,{modelMatrix:i}=this.props;return this.state.tileset.isTileVisible(n,t,i?new Fb(i):null)}}UL.defaultProps=FL,UL.layerName="TileLayer";const zL=Math.PI/180,VL=new Float32Array(16),HL=new Float32Array(12);function jL(e,t,n){const i=t[0]*zL,r=t[1]*zL,s=t[2]*zL,o=Math.sin(s),a=Math.sin(i),l=Math.sin(r),c=Math.cos(s),u=Math.cos(i),h=Math.cos(r),d=n[0],f=n[1],p=n[2];e[0]=d*h*u,e[1]=d*l*u,e[2]=d*-a,e[3]=f*(-l*c+h*a*o),e[4]=f*(h*c+l*a*o),e[5]=f*u*o,e[6]=p*(l*o+h*a*c),e[7]=p*(-h*o+l*a*c),e[8]=p*u*c}function WL(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const $L={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:n}){const{data:i,getOrientation:r,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,l=Array.isArray(a),c=l&&16===a.length,u=Array.isArray(s),h=Array.isArray(r),d=Array.isArray(o),f=c||!l&&Boolean(a(i[0]));e.constant=f?c:h&&u&&d;const p=e.value;if(e.constant){let t;if(f)VL.set(a),t=WL(VL);else{t=HL;jL(t,r,s),t.set(o,9)}e.value=new Float32Array(t)}else{let l=t*e.size;const{iterable:g,objectInfo:m}=bI(i,t,n);for(const e of g){let t;if(m.index++,f)VL.set(c?a:a(e,m)),t=WL(VL);else{t=HL;jL(t,h?r:r(e,m),u?s:s(e,m)),t.set(d?o:o(e,m),9)}p[l++]=t[0],p[l++]=t[1],p[l++]=t[2],p[l++]=t[3],p[l++]=t[4],p[l++]=t[5],p[l++]=t[6],p[l++]=t[7],p[l++]=t[8],p[l++]=t[9],p[l++]=t[10],p[l++]=t[11]}}}};function XL(e,t){return t===Tw.CARTESIAN||t===Tw.METER_OFFSETS||t===Tw.DEFAULT&&!e.isGeospatial}const qL="uniform simpleMeshUniforms {\n  float sizeScale;\n  bool composeModelMatrix;\n  bool hasTexture;\n  bool flatShading;\n} simpleMesh;\n",KL={name:"simpleMesh",vs:qL,fs:qL,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}};function YL(e){const t=e.positions||e.POSITION;Op.assert(t,'no "postions" or "POSITION" attribute in mesh');const n=t.value.length/t.size;let i=e.COLOR_0||e.colors;i||(i={size:3,value:new Float32Array(3*n).fill(1)});let r=e.NORMAL||e.normals;r||(r={size:3,value:new Float32Array(3*n).fill(0)});let s=e.TEXCOORD_0||e.texCoords;return s||(s={size:2,value:new Float32Array(2*n).fill(0)}),{positions:t,colors:i,normals:r,texCoords:s}}function JL(e){return e instanceof jA?(e.attributes=YL(e.attributes),e):e.attributes?new jA({...e,topology:"triangle-list",attributes:YL(e.attributes)}):new jA({topology:"triangle-list",attributes:YL(e)})}const ZL={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class QL extends Ck{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec3 instanceModelMatrixCol0;\nin vec3 instanceModelMatrixCol1;\nin vec3 instanceModelMatrixCol2;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = texCoords;\ngeometry.pickingColor = instancePickingColors;\nvTexCoord = texCoords;\ncameraPosition = project.cameraPosition;\nvColor = vec4(colors * instanceColors.rgb, instanceColors.a);\nmat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);\nvec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;\nif (simpleMesh.composeModelMatrix) {\nDECKGL_FILTER_SIZE(pos, geometry);\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\ngeometry.worldPosition += pos;\ngl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\ngeometry.position = position_commonspace;\n}\nelse {\npos = project_size(pos);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\ngeometry.position = position_commonspace;\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\n}\ngeometry.normal = normals_commonspace;\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\nprecision highp float;\nuniform sampler2D sampler;\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vTexCoord;\nvec3 normal;\nif (simpleMesh.flatShading) {\nnormal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n} else {\nnormal = normals_commonspace;\n}\nvec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;\nDECKGL_FILTER_COLOR(color, geometry);\nvec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\nfragColor = vec4(lightColor, color.a * layer.opacity);\n}\n",modules:[$w,vE,Cx,KL]})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:n}=this.props;if(!n)return null;if(t=null==(e=n.header)?void 0:e.boundingBox,!t){const{attributes:e}=JL(n);e.POSITION=e.POSITION||e.positions,t=up(e)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:$L}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var t;super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e;if(n.mesh!==i.mesh||r.extensionsChanged){if(this.state.positionBounds=null,null==(t=this.state.model)||t.destroy(),n.mesh){this.state.model=this.getModel(n.mesh);const e=n.mesh.attributes||n.mesh;this.setState({hasNormals:Boolean(e.NORMAL||e.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==i.texture&&n.texture instanceof Em&&this.setTexture(n.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:n,renderPass:i}=this.context,{sizeScale:r,coordinateSystem:s,_instanced:o}=this.props,a={sizeScale:r,composeModelMatrix:!o||XL(n,s),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:a}),t.draw(i)}get isLoaded(){var e;return Boolean((null==(e=this.state)?void 0:e.model)&&super.isLoaded)}getModel(e){const t=new zA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:JL(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state,r={sampler:n||i,hasTexture:Boolean(n)};return t.shaderInputs.setProps({simpleMesh:r}),t}setTexture(e){const{emptyTexture:t,model:n}=this.state;if(n){const i={sampler:e||t,hasTexture:Boolean(e)};n.shaderInputs.setProps({simpleMesh:i})}}}QL.defaultProps=ZL,QL.layerName="SimpleMeshLayer";const eB="4.3.3",tB="basis_transcoder.js",nB="basis_transcoder.wasm",iB="basis_encoder.js",rB="basis_encoder.wasm";let sB,oB;async function aB(e){!function(e){var t;globalThis.loaders||(globalThis.loaders={}),(t=globalThis.loaders).modules||(t.modules={}),Object.assign(globalThis.loaders.modules,e)}(e.modules);const t=function(e){var t,n;return(null==(n=null==(t=globalThis.loaders)?void 0:t.modules)?void 0:n[e])||null}("basis");return t||(sB||(sB=async function(e){let t=null,n=null;return[t,n]=await Promise.all([await $d(tB,"textures",e),await $d(nB,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const n={};t&&(n.wasmBinary=t);return new Promise(t=>{e(n).then(e=>{const{BasisFile:n,initializeBasis:i}=e;i(),t({BasisFile:n})})})}(t,n)}(e)),await sB)}async function lB(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(oB=oB||async function(e){let t=null,n=null;return[t,n]=await Promise.all([await $d(iB,"textures",e),await $d(rB,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const n={};t&&(n.wasmBinary=t);return new Promise(t=>{e(n).then(e=>{const{BasisFile:n,KTX2File:i,initializeBasis:r,BasisEncoder:s}=e;r(),t({BasisFile:n,KTX2File:i,BasisEncoder:s})})})}(t,n)}(e),await oB)}const cB={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},uB=["","WEBKIT_","MOZ_"],hB={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let dB=null;function fB(e){if(!dB){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,dB=new Set;for(const t of uB)for(const n in hB)if(e&&e.getExtension(`${t}${n}`)){const e=hB[n];dB.add(e)}}return dB}class pB{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class gB{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const mB=[171,75,84,88,32,50,48,187,13,10,26,10];function yB(e){return(new TextDecoder).decode(e)}function vB(e,t){const n=new Array(t.mipMapLevels);let i=t.width,r=t.height,s=0;for(let o=0;o<t.mipMapLevels;++o){const a=bB(t,i,r,e,o),l=_B(e,o,s,a);n[o]={compressed:!0,format:t.internalFormat,data:l,width:i,height:r,levelSize:a},i=Math.max(1,i>>1),r=Math.max(1,r>>1),s+=a}return n}function _B(e,t,n,i){return Array.isArray(e)?e[t].levelData:new Uint8Array(e.buffer,e.byteOffset+n,i)}function bB(e,t,n,i,r){return Array.isArray(i)?e.sizeFunction(i[r]):e.sizeFunction(t,n)}const EB={131:cB.COMPRESSED_RGB_S3TC_DXT1_EXT,132:cB.COMPRESSED_SRGB_S3TC_DXT1_EXT,133:cB.COMPRESSED_RGBA_S3TC_DXT1_EXT,134:cB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,135:cB.COMPRESSED_RGBA_S3TC_DXT3_EXT,136:cB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,137:cB.COMPRESSED_RGBA_S3TC_DXT5_EXT,138:cB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,139:cB.COMPRESSED_RED_RGTC1_EXT,140:cB.COMPRESSED_SIGNED_RED_RGTC1_EXT,141:cB.COMPRESSED_RED_GREEN_RGTC2_EXT,142:cB.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,147:cB.COMPRESSED_RGB8_ETC2,148:cB.COMPRESSED_SRGB8_ETC2,149:cB.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,150:cB.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,151:cB.COMPRESSED_RGBA8_ETC2_EAC,152:cB.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,153:cB.COMPRESSED_R11_EAC,154:cB.COMPRESSED_SIGNED_R11_EAC,155:cB.COMPRESSED_RG11_EAC,156:cB.COMPRESSED_SIGNED_RG11_EAC,157:cB.COMPRESSED_RGBA_ASTC_4x4_KHR,158:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,159:cB.COMPRESSED_RGBA_ASTC_5x4_KHR,160:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR,161:cB.COMPRESSED_RGBA_ASTC_5x5_KHR,162:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,163:cB.COMPRESSED_RGBA_ASTC_6x5_KHR,164:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,165:cB.COMPRESSED_RGBA_ASTC_6x6_KHR,166:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,167:cB.COMPRESSED_RGBA_ASTC_8x5_KHR,168:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,169:cB.COMPRESSED_RGBA_ASTC_8x6_KHR,170:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,171:cB.COMPRESSED_RGBA_ASTC_8x8_KHR,172:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,173:cB.COMPRESSED_RGBA_ASTC_10x5_KHR,174:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,175:cB.COMPRESSED_RGBA_ASTC_10x6_KHR,176:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,177:cB.COMPRESSED_RGBA_ASTC_10x8_KHR,178:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,179:cB.COMPRESSED_RGBA_ASTC_10x10_KHR,180:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,181:cB.COMPRESSED_RGBA_ASTC_12x10_KHR,182:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,183:cB.COMPRESSED_RGBA_ASTC_12x12_KHR,184:cB.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,1000054e3:cB.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,1000054001:cB.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,1000066e3:cB.COMPRESSED_RGBA_ASTC_4x4_KHR,1000066001:cB.COMPRESSED_RGBA_ASTC_5x4_KHR,1000066002:cB.COMPRESSED_RGBA_ASTC_5x5_KHR,1000066003:cB.COMPRESSED_RGBA_ASTC_6x5_KHR,1000066004:cB.COMPRESSED_RGBA_ASTC_6x6_KHR,1000066005:cB.COMPRESSED_RGBA_ASTC_8x5_KHR,1000066006:cB.COMPRESSED_RGBA_ASTC_8x6_KHR,1000066007:cB.COMPRESSED_RGBA_ASTC_8x8_KHR,1000066008:cB.COMPRESSED_RGBA_ASTC_10x5_KHR,1000066009:cB.COMPRESSED_RGBA_ASTC_10x6_KHR,1000066010:cB.COMPRESSED_RGBA_ASTC_10x8_KHR,1000066011:cB.COMPRESSED_RGBA_ASTC_10x10_KHR,1000066012:cB.COMPRESSED_RGBA_ASTC_12x10_KHR,1000066013:cB.COMPRESSED_RGBA_ASTC_12x12_KHR};const wB=[171,75,84,88,32,50,48,187,13,10,26,10];function xB(e){const t=new Uint8Array(e);return!(t.byteLength<wB.length||t[0]!==wB[0]||t[1]!==wB[1]||t[2]!==wB[2]||t[3]!==wB[3]||t[4]!==wB[4]||t[5]!==wB[5]||t[6]!==wB[6]||t[7]!==wB[7]||t[8]!==wB[8]||t[9]!==wB[9]||t[10]!==wB[10]||t[11]!==wB[11])}function AB(e){const t=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,mB.length);if(t[0]!==mB[0]||t[1]!==mB[1]||t[2]!==mB[2]||t[3]!==mB[3]||t[4]!==mB[4]||t[5]!==mB[5]||t[6]!==mB[6]||t[7]!==mB[7]||t[8]!==mB[8]||t[9]!==mB[9]||t[10]!==mB[10]||t[11]!==mB[11])throw new Error("Missing KTX 2.0 identifier.");const n=new pB,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new gB(e,mB.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();const s=r._nextUint32();n.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),u=r._nextUint64(),h=r._nextUint64(),d=new gB(e,mB.length+i,3*s*8,!0);for(let L=0;L<s;L++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const f=new gB(e,o,a,!0),p={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},g=(p.descriptorBlockSize/4-6)/4;for(let L=0;L<g;L++){const e={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=f._nextInt32(),e.sampleUpper=f._nextInt32()):(e.sampleLower=f._nextUint32(),e.sampleUpper=f._nextUint32()),p.samples[L]=e}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(p);const m=new gB(e,l,c,!0);for(;m._offset<c;){const e=m._nextUint32(),t=m._scan(e),i=yB(t);if(n.keyValue[i]=m._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){const e=yB(n.keyValue[i]);n.keyValue[i]=e.substring(0,e.lastIndexOf("\0"))}const r=e%4?4-e%4:0;m._skip(r)}if(h<=0)return n;const y=new gB(e,u,h,!0),v=y._nextUint16(),_=y._nextUint16(),b=y._nextUint32(),E=y._nextUint32(),w=y._nextUint32(),x=y._nextUint32(),A=[];for(let L=0;L<s;L++)A.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const S=u+y._offset,T=S+b,C=T+E,I=C+w,k=new Uint8Array(e.buffer,e.byteOffset+S,b),R=new Uint8Array(e.buffer,e.byteOffset+T,E),P=new Uint8Array(e.buffer,e.byteOffset+C,w),M=new Uint8Array(e.buffer,e.byteOffset+I,x);return n.globalData={endpointCount:v,selectorCount:_,imageDescs:A,endpointsData:k,selectorsData:R,tablesData:P,extendedData:M},n}(new Uint8Array(e)),n=Math.max(1,t.levels.length),i=t.pixelWidth,r=t.pixelHeight,s=(o=t.vkFormat,EB[o]);var o;return vB(t.levels,{mipMapLevels:n,width:i,height:r,sizeFunction:e=>e.uncompressedByteLength,internalFormat:s})}const SB={etc1:{basisFormat:0,compressed:!0,format:cB.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:cB.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:cB.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:cB.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:cB.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:cB.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function TB(e,t){if("auto"===t.basis.containerFormat){if(xB(e)){return kB((await lB(t)).KTX2File,e,t)}const{BasisFile:n}=await aB(t);return CB(n,e,t)}if("encoder"===t.basis.module){const n=await lB(t);return"ktx2"===t.basis.containerFormat?kB(n.KTX2File,e,t):CB(n.BasisFile,e,t)}{const{BasisFile:n}=await aB(t);return CB(n,e,t)}}function CB(e,t,n){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const e=i.getNumImages(),t=[];for(let r=0;r<e;r++){const e=i.getNumLevels(r),s=[];for(let t=0;t<e;t++)s.push(IB(i,r,t,n));t.push(s)}return t}finally{i.close(),i.delete()}}function IB(e,t,n,i){const r=e.getImageWidth(t,n),s=e.getImageHeight(t,n),o=e.getHasAlpha(),{compressed:a,format:l,basisFormat:c}=PB(i,o),u=e.getImageTranscodedSizeInBytes(t,n,c),h=new Uint8Array(u);if(!e.transcodeImage(h,t,n,c,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:s,data:h,compressed:a,format:l,hasAlpha:o}}function kB(e,t,n){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const e=i.getLevels(),t=[];for(let r=0;r<e;r++)t.push(RB(i,r,n));return[t]}finally{i.close(),i.delete()}}function RB(e,t,n){const{alphaFlag:i,height:r,width:s}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:l}=PB(n,i),c=e.getImageTranscodedSizeInBytes(t,0,0,l),u=new Uint8Array(c);if(!e.transcodeImage(u,t,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:r,data:u,compressed:o,levelSize:c,hasAlpha:i,format:a}}function PB(e,t){let n=e&&e.basis&&e.basis.format;return"auto"===n&&(n=MB()),"object"==typeof n&&(n=t?n.alpha:n.noAlpha),n=n.toLowerCase(),SB[n]}function MB(){const e=fB();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const LB={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:eB,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:TB},BB=542327876,NB=31,OB=0,DB=1,FB=2,UB=3,zB=4,GB=7,VB=20,HB=21,jB=131072,WB=4,$B={DXT1:cB.COMPRESSED_RGB_S3TC_DXT1_EXT,DXT3:cB.COMPRESSED_RGBA_S3TC_DXT3_EXT,DXT5:cB.COMPRESSED_RGBA_S3TC_DXT5_EXT,"ATC ":cB.COMPRESSED_RGB_ATC_WEBGL,ATCA:cB.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,ATCI:cB.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL},XB={DXT1:KB,DXT3:YB,DXT5:YB,"ATC ":KB,ATCA:YB,ATCI:YB};function qB(e){const t=new Int32Array(e,0,NB),n=t[HB];Kh(Boolean(t[VB]&WB),"DDS: Unsupported format, must contain a FourCC code");const i=(r=n,String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255));var r;const s=$B[i],o=XB[i];Kh(s&&o,`DDS: Unknown pixel format ${n}`);let a=1;t[FB]&jB&&(a=Math.max(1,t[GB]));const l=t[zB],c=t[UB],u=t[DB]+4;return vB(new Uint8Array(e,u),{mipMapLevels:a,width:l,height:c,sizeFunction:o,internalFormat:s})}function KB(e,t){return(e+3>>2)*(t+3>>2)*8}function YB(e,t){return(e+3>>2)*(t+3>>2)*16}const JB=55727696,ZB=1347834371,QB=13,eN=52,tN=0,nN=2,iN=4,rN=6,sN=7,oN=11,aN=12,lN={0:[cB.COMPRESSED_RGB_PVRTC_2BPPV1_IMG],1:[cB.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG],2:[cB.COMPRESSED_RGB_PVRTC_4BPPV1_IMG],3:[cB.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],6:[cB.COMPRESSED_RGB_ETC1_WEBGL],7:[cB.COMPRESSED_RGB_S3TC_DXT1_EXT],9:[cB.COMPRESSED_RGBA_S3TC_DXT3_EXT],11:[cB.COMPRESSED_RGBA_S3TC_DXT5_EXT],22:[cB.COMPRESSED_RGB8_ETC2],23:[cB.COMPRESSED_RGBA8_ETC2_EAC],24:[cB.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2],25:[cB.COMPRESSED_R11_EAC],26:[cB.COMPRESSED_RG11_EAC],27:[cB.COMPRESSED_RGBA_ASTC_4X4_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR],28:[cB.COMPRESSED_RGBA_ASTC_5X4_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR],29:[cB.COMPRESSED_RGBA_ASTC_5X5_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR],30:[cB.COMPRESSED_RGBA_ASTC_6X5_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR],31:[cB.COMPRESSED_RGBA_ASTC_6X6_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR],32:[cB.COMPRESSED_RGBA_ASTC_8X5_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR],33:[cB.COMPRESSED_RGBA_ASTC_8X6_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR],34:[cB.COMPRESSED_RGBA_ASTC_8X8_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR],35:[cB.COMPRESSED_RGBA_ASTC_10X5_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR],36:[cB.COMPRESSED_RGBA_ASTC_10X6_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR],37:[cB.COMPRESSED_RGBA_ASTC_10X8_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR],38:[cB.COMPRESSED_RGBA_ASTC_10X10_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR],39:[cB.COMPRESSED_RGBA_ASTC_12X10_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR],40:[cB.COMPRESSED_RGBA_ASTC_12X12_KHR,cB.COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR]},cN={0:uN,1:uN,2:hN,3:hN,6:dN,7:dN,9:fN,11:fN,22:dN,23:fN,24:dN,25:dN,26:fN,27:fN,28:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16},29:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16},30:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16},31:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16},32:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16},33:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16},34:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16},35:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16},36:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16},37:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16},38:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16},39:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16},40:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16}};function uN(e,t){return(e=Math.max(e,16))*(t=Math.max(t,8))/4}function hN(e,t){return(e=Math.max(e,8))*(t=Math.max(t,8))/2}function dN(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function fN(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}function pN(e){if(xB(e))return AB(e);if(function(e){return new Uint32Array(e,0,NB)[OB]===BB}(e))return qB(e);if(function(e){const t=new Uint32Array(e,0,QB)[tN];return t===JB||t===ZB}(e))return function(e){const t=new Uint32Array(e,0,QB),n=t[nN],i=t[iN],r=lN[n]||[],s=r.length>1&&i?r[1]:r[0],o=cN[n],a=t[oN],l=t[sN],c=t[rN],u=eN+t[aN];return vB(new Uint8Array(e,u),{mipMapLevels:a,width:l,height:c,sizeFunction:o,internalFormat:s})}(e);throw new Error("Texture container format not recognized")}const gN={...{dataType:null,batchType:null,name:"Texture Containers",id:"compressed-texture",module:"textures",version:eB,worker:!0,extensions:["ktx","ktx2","dds","pvr"],mimeTypes:["image/ktx2","image/ktx","image/vnd-ms.dds","image/x-dds","application/octet-stream"],binary:!0,options:{"compressed-texture":{libraryPath:"libs/",useBasis:!1}}},parse:async(e,t)=>{var n;if(null==(n=null==t?void 0:t["compressed-texture"])?void 0:n.useBasis){t.basis={format:{alpha:"BC3",noAlpha:"BC1"},...t.basis,containerFormat:"ktx2",module:"encoder"};return(await TB(e,t))[0]}return pN(e)}};function mN(e){return{addressModeU:yN(e.wrapS),addressModeV:yN(e.wrapT),magFilter:vN(e.magFilter),..._N(e.minFilter)}}function yN(e){switch(e){case 33071:return"clamp-to-edge";case 10497:return"repeat";case 33648:return"mirror-repeat";default:return}}function vN(e){switch(e){case 9728:return"nearest";case 9729:return"linear";default:return}}function _N(e){switch(e){case 9728:return{minFilter:"nearest"};case 9729:return{minFilter:"linear"};case 9984:return{minFilter:"nearest",mipmapFilter:"nearest"};case 9985:return{minFilter:"linear",mipmapFilter:"nearest"};case 9986:return{minFilter:"nearest",mipmapFilter:"linear"};case 9987:return{minFilter:"linear",mipmapFilter:"linear"};default:return{}}}function bN(e,t,n,i){const r={defines:{MANUAL_SRGB:!0,SRGB_FAST_APPROXIMATION:!0},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};r.defines.USE_TEX_LOD=!0;const{imageBasedLightingEnvironment:s}=i;return s&&(r.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,r.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,r.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,r.uniforms.scaleIBLAmbient=[1,1]),(null==i?void 0:i.pbrDebug)&&(r.defines.PBR_DEBUG=!0,r.uniforms.scaleDiffBaseMR=[0,0,0,0],r.uniforms.scaleFGDSpec=[0,0,0,0]),n.NORMAL&&(r.defines.HAS_NORMALS=!0),n.TANGENT&&(null==i?void 0:i.useTangents)&&(r.defines.HAS_TANGENTS=!0),n.TEXCOORD_0&&(r.defines.HAS_UV=!0),(null==i?void 0:i.imageBasedLightingEnvironment)&&(r.defines.USE_IBL=!0),(null==i?void 0:i.lights)&&(r.defines.USE_LIGHTS=!0),t&&function(e,t,n){n.uniforms.unlit=Boolean(t.unlit),t.pbrMetallicRoughness&&function(e,t,n){t.baseColorTexture&&EN(e,t.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",n);n.uniforms.baseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&EN(e,t.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",n);const{metallicFactor:i=1,roughnessFactor:r=1}=t;n.uniforms.metallicRoughnessValues=[i,r]}(e,t.pbrMetallicRoughness,n);if(t.normalTexture){EN(e,t.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",n);const{scale:i=1}=t.normalTexture;n.uniforms.normalScale=i}if(t.occlusionTexture){EN(e,t.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",n);const{strength:i=1}=t.occlusionTexture;n.uniforms.occlusionStrength=i}t.emissiveTexture&&(EN(e,t.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",n),n.uniforms.emissiveFactor=t.emissiveFactor||[0,0,0]);switch(t.alphaMode||"MASK"){case"MASK":const{alphaCutoff:e=.5}=t;n.defines.ALPHA_CUTOFF=!0,n.uniforms.alphaCutoff=e;break;case"BLEND":Sg.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),n.parameters.blend=!0,n.parameters.blendColorOperation="add",n.parameters.blendColorSrcFactor="src-alpha",n.parameters.blendColorDstFactor="one-minus-src-alpha",n.parameters.blendAlphaOperation="add",n.parameters.blendAlphaSrcFactor="one",n.parameters.blendAlphaDstFactor="one-minus-src-alpha",n.glParameters.blend=!0,n.glParameters.blendEquation=32774,n.glParameters.blendFunc=[770,771,1,771]}}(e,t,r),r}function EN(e,t,n,i,r){var s;const o=t.texture.source.image;let a;a=o.compressed?o:{data:o};const l={wrapS:10497,wrapT:10497,...null==(s=null==t?void 0:t.texture)?void 0:s.sampler},c=e.createTexture({id:t.uniformName||t.id,sampler:mN(l),...a});r.bindings[n]=c,i&&(r.defines[i]=!0),r.generatedTextures.push(c)}var wN;!function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(wN||(wN={}));const xN={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:void 0,lights:!0,useTangents:!1};function AN(e,t,n={}){const i={...xN,...n},r=t.scenes.map(n=>function(e,t,n,i){const r=t.nodes||[],s=r.map(t=>SN(e,t,n,i)),o=new $A({id:t.name||t.id,children:s});return o}(e,n,t.nodes,i));return r}function SN(e,t,n,i){if(!t._node){const r=(t.children||[]).map(t=>SN(e,t,n,i));t.mesh&&r.push(function(e,t,n){if(!t._mesh){const i=(t.primitives||[]).map((i,r)=>function(e,t,n,i,r){const s=t.name||`${i.name||i.id}-primitive-${n}`,o=function(e){switch(e){case wN.POINTS:return"point-list";case wN.LINES:return"line-list";case wN.LINE_STRIP:return"line-strip";case wN.TRIANGLES:return"triangle-list";case wN.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(e))}}(t.mode||4),a=t.indices?t.indices.count:function(){throw new Error("getVertexCount not implemented")}(t.attributes),l=TN(s,t,o),c=bN(e,t.material,l.attributes,r),u=function(e,t){const{id:n,geometry:i,parsedPPBRMaterial:r,vertexCount:s,modelOptions:o={}}=t;Sg.info(4,"createGLTFModel defines: ",r.defines)();const a={id:n,source:"\nlayout(0) positions: vec4; // in vec4 POSITION;\n\n  #ifdef HAS_NORMALS\n    in vec4 normals; // in vec4 NORMAL;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    in vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    // in vec2 TEXCOORD_0;\n    in vec2 texCoords;\n  #endif\n\n@vertex\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = normals;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = texCoords;\n    #endif\n\n    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * positions;\n  }\n\n@fragment\n  out vec4 fragmentColor;\n\n  void main(void) {\n    vec3 pos = pbr_vPosition;\n    fragmentColor = pbr_filterColor(vec4(1.0));\n  }\n",vs:"#version 300 es\n\n  // in vec4 POSITION;\n  in vec4 positions;\n\n  #ifdef HAS_NORMALS\n    // in vec4 NORMAL;\n    in vec4 normals;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    in vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    // in vec2 TEXCOORD_0;\n    in vec2 texCoords;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = normals;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = texCoords;\n    #endif\n\n    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;\n  }\n",fs:"#version 300 es\n  out vec4 fragmentColor;\n\n  void main(void) {\n    vec3 pos = pbr_vPosition;\n    fragmentColor = pbr_filterColor(vec4(1.0));\n  }\n",geometry:i,topology:i.topology,vertexCount:s,modules:[bE],...o,defines:{...r.defines,...o.defines},parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back",...r.parameters,...o.parameters}},l=new zA(e,a),{camera:c,...u}={...r.uniforms,...o.uniforms,...r.bindings,...o.bindings};return l.shaderInputs.setProps({pbrMaterial:u,pbrProjection:{camera:c}}),new XA({managedResources:[],model:l})}(e,{id:s,geometry:TN(s,t,o),parsedPPBRMaterial:c,modelOptions:r.modelOptions,vertexCount:a});return u.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],u}(e,i,r,t,n)),r=new $A({id:t.name||t.id,children:i});t._mesh=r}return t._mesh}(e,t.mesh,i));const s=new $A({id:t.name||t.id,children:r});if(t.matrix)s.setMatrix(t.matrix);else{if(s.matrix.identity(),t.translation&&s.matrix.translate(t.translation),t.rotation){const e=(new Fb).fromQuaternion(t.rotation);s.matrix.multiplyRight(e)}t.scale&&s.matrix.scale(t.scale)}t._node=s}return n.find(e=>e.id===t.id)._node=t._node,t._node}function TN(e,t,n){const i={};for(const[r,s]of Object.entries(t.attributes)){const{components:e,size:t,value:n}=s;i[r]={size:t??e,value:n}}return new jA({id:e,topology:n,indices:t.indices.value,attributes:i})}const CN=new nE;function IN(e,{input:t,interpolation:n,output:i},r,s){const o=e%t[t.length-1],a=t.findIndex(e=>e>=o),l=Math.max(0,a-1);if(!Array.isArray(r[s]))switch(s){case"translation":r[s]=[0,0,0];break;case"rotation":r[s]=[0,0,0,1];break;case"scale":r[s]=[1,1,1];break;default:Sg.warn(`Bad animation path ${s}`)()}const c=t[l],u=t[a];switch(n){case"STEP":!function(e,t,n){if(!e[t])throw new Error;for(let i=0;i<n.length;i++)e[t][i]=n[i]}(r,s,i[l]);break;case"LINEAR":if(u>c){const e=(o-c)/(u-c);!function(e,t,n,i,r){if(!e[t])throw new Error;if("rotation"===t){CN.slerp({start:n,target:i,ratio:r});for(let n=0;n<CN.length;n++)e[t][n]=CN[n]}else for(let s=0;s<n.length;s++)e[t][s]=r*i[s]+(1-r)*n[s]}(r,s,i[l],i[a],e)}break;case"CUBICSPLINE":if(u>c){const e=(o-c)/(u-c),t=u-c;!function(e,t,{p0:n,outTangent0:i,inTangent1:r,p1:s,tDiff:o,ratio:a}){if(!e[t])throw new Error;for(let l=0;l<e[t].length;l++){const c=i[l]*o,u=r[l]*o;e[t][l]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*n[l]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*c+(-2*Math.pow(a,3)+3*Math.pow(a,2))*s[l]+(Math.pow(a,3)-Math.pow(a,2))*u}}(r,s,{p0:i[3*l+1],outTangent0:i[3*l+2],inTangent1:i[3*a+0],p1:i[3*a+1],tDiff:t,ratio:e})}break;default:Sg.warn(`Interpolation ${n} not supported`)()}}class kN{constructor(e){var t;i(this,"animation"),i(this,"startTime",0),i(this,"playing",!0),i(this,"speed",1),this.animation=e.animation,(t=this.animation).name||(t.name="unnamed"),Object.assign(this,e)}setTime(e){if(!this.playing)return;const t=(e/1e3-this.startTime)*this.speed;this.animation.channels.forEach(({sampler:e,target:n,path:i})=>{IN(t,e,n,i),function(e,t){t.matrix.identity(),e.translation&&t.matrix.translate(e.translation);if(e.rotation){const n=PN.fromQuaternion(e.rotation);t.matrix.multiplyRight(n)}e.scale&&t.matrix.scale(e.scale)}(n,n._node)})}}class RN{constructor(e){i(this,"animations"),this.animations=e.animations.map((e,t)=>{const n=e.name||`Animation-${t}`;return new kN({animation:{name:n,channels:e.channels}})})}animate(e){Sg.warn("GLTFAnimator#animate is deprecated. Use GLTFAnimator#setTime instead")(),this.setTime(e)}setTime(e){this.animations.forEach(t=>t.setTime(e))}getAnimations(){return this.animations}}const PN=new Fb;const MN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},LN={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function BN(e){if(!e._animation){const{typedArray:t,components:n}=function(e){var t;const n=LN[e.componentType],i=MN[e.type],r=i*e.count,{buffer:s,byteOffset:o=0}=(null==(t=e.bufferView)?void 0:t.data)??{};return{typedArray:new n(s,o+(e.byteOffset||0),r),components:i}}(e);if(1===n)e._animation=Array.from(t);else{const i=[];for(let e=0;e<t.length;e+=n)i.push(Array.from(t.slice(e,e+n)));e._animation=i}}return e._animation}function NN(e){if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof ImageBitmap)return e;if(Array.isArray(e))return e.map(NN);if(e&&"object"==typeof e){const t={};for(const n in e)t[n]=NN(e[n]);return t}return e}function ON(e,t,n){const i=AN(e,t=NN(t),n),r=function(e){return(e.animations||[]).map((t,n)=>{const i=t.name||`Animation-${n}`,r=t.samplers.map(({input:t,interpolation:n="LINEAR",output:i})=>({input:BN(e.accessors[t]),interpolation:n,output:BN(e.accessors[i])}));return{name:i,channels:t.channels.map(({sampler:t,target:n})=>({sampler:r[t],target:e.nodes[n.node??0],path:n.path}))}})}(t);return{scenes:i,animator:new RN({animations:r})}}function DN(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const FN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},UN={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},zN=["SCALAR","VEC2","VEC3","VEC4"],GN=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],VN=new Map(GN),HN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jN={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},WN={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function $N(e){return zN[e-1]||zN[0]}function XN(e){const t=VN.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function qN(e,t){const n=WN[e.componentType],i=HN[e.type],r=jN[e.componentType],s=e.count*i,o=e.count*i*r;DN(o>=0&&o<=t.byteLength);return{ArrayType:n,length:s,byteLength:o,componentByteSize:UN[e.componentType],numberOfComponentsInElement:FN[e.type]}}function KN(e){let{images:t,bufferViews:n}=e;t=t||[],n=n||[];const i=t.map(e=>e.bufferView);n=n.filter(e=>!i.includes(e));const r=n.reduce((e,t)=>e+t.byteLength,0),s=t.reduce((e,t)=>{const{width:n,height:i}=t.image;return e+n*i},0);return r+Math.ceil(4*s*1.33)}class YN{constructor(e){i(this,"gltf"),i(this,"sourceBuffers"),i(this,"byteLength"),this.gltf={json:(null==e?void 0:e.json)||{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:(null==e?void 0:e.buffers)||[],images:(null==e?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(t=>t===e),n=this.getRequiredExtensions().find(t=>t===e);return"string"==typeof t||"string"==typeof n}getExtension(e){const t=this.getUsedExtensions().find(t=>t===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(t=>t===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){const t=(e=this.getBufferView(e)).buffer,n=this.gltf.buffers[t];DN(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return function(e,t,n){var i,r;const s="number"==typeof n?null==(i=e.accessors)?void 0:i[n]:n;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const o=null==(r=e.bufferViews)?void 0:r[s.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:a,byteOffset:l}=t[o.buffer],c=(l||0)+(s.byteOffset||0)+(o.byteOffset||0),{ArrayType:u,length:h,componentByteSize:d,numberOfComponentsInElement:f}=qN(s,o),p=d*f,g=o.byteStride||p;if(void 0===o.byteStride||o.byteStride===p)return new u(a,c,h);const m=new u(h);for(let y=0;y<s.count;y++){const e=new u(a,c+y*g,f);m.set(e,y*f)}return m}(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,i=t.byteOffset||0;return new Uint8Array(n,i,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){(e.extensions||{})[t]=n}removeObjectExtension(e,t){const n=(null==e?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}delete n[t]}addExtension(e,t={}){return DN(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return DN(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if(null==(t=this.json.extensions)?void 0:t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:r=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(n){const e=this._addIndices(n);s.primitives[0].indices=e}return Number.isFinite(i)&&(s.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const n=Pp(e),i=t||(null==n?void 0:n.mimeType),r={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;DN(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=Qd(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:$N(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};i.min&&i.max||(i=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:XN(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;const n=this.byteLength,i=new ArrayBuffer(n),r=new Uint8Array(i);let s=0;for(const o of this.sourceBuffers||[])s=ef(o,r,s);(null==(t=null==(e=this.json)?void 0:e.buffers)?void 0:t[0])?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i],this.gltf.buffers=[{arrayBuffer:i,byteOffset:0,byteLength:i.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],r=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);t[r]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const r of i)n.min.push(r),n.max.push(r);for(let r=t;r<e.length;r+=t)for(let i=0;i<t;i++)n.min[0+i]=Math.min(n.min[0+i],e[r+i]),n.max[0+i]=Math.max(n.max[0+i],e[r+i]);return n}}function JN(e){return(e%1+1)%1}const ZN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},QN={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},eO={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function tO(e,t){return eO[t]*ZN[e]}function nO(e,t,n,i){if("UINT8"!==n&&"UINT16"!==n&&"UINT32"!==n&&"UINT64"!==n)return null;const r=iO(e.getTypedArrayForBufferView(t),"SCALAR",n,i+1);return r instanceof BigInt64Array||r instanceof BigUint64Array?null:r}function iO(e,t,n,i=1){const r=QN[n],s=eO[n],o=i*ZN[t],a=o*s;let l=e.buffer,c=e.byteOffset;if(c%s!==0){l=new Uint8Array(l).slice(c,c+a).buffer,c=0}return new r(l,c,o)}function rO(e,t,n){var i,r,s,o,a;const l=`TEXCOORD_${t.texCoord||0}`,c=n.attributes[l],u=e.getTypedArrayForAccessor(c),h=e.gltf.json,d=t.index,f=null==(r=null==(i=h.textures)?void 0:i[d])?void 0:r.source;if(void 0!==f){const n=null==(o=null==(s=h.images)?void 0:s[f])?void 0:o.mimeType,i=null==(a=e.gltf.images)?void 0:a[f];if(i&&void 0!==i.width){const e=[];for(let r=0;r<u.length;r+=2){const s=oO(i,n,u,r,t.channels);e.push(s)}return e}}return[]}function sO(e,t,n,i,r){if(!(null==n?void 0:n.length))return;const s=[];for(const u of n){let e=i.findIndex(e=>e===u);-1===e&&(e=i.push(u)-1),s.push(e)}const o=new Uint32Array(s),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,l=e.addBufferView(o,a,0),c=e.addAccessor(l,{size:1,componentType:XN(o),count:o.length});r.attributes[t]=c}function oO(e,t,n,i,r=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=n[i],a=n[i+1];let l=1;!t||-1===t.indexOf("image/jpeg")&&-1===t.indexOf("image/png")||(l=4);const c=function(e,t,n,i=1){const r=n.width,s=JN(e)*(r-1),o=Math.round(s),a=n.height,l=JN(t)*(a-1),c=Math.round(l),u=n.components?n.components:i,h=(c*r+o)*u;return h}(o,a,e,l);let u=0;for(const h of r){const t="number"==typeof h?Object.values(s)[h]:s[h],n=c+t.offset,i=_p(e);if(i.data.length<=n)throw new Error(`${i.data.length} <= ${n}`);u|=i.data[n]<<t.shift}return u}function aO(e,t,n,i,r){const s=[];for(let o=0;o<t;o++){const t=n[o],a=n[o+1]-n[o];if(a+t>i)break;const l=t/r,c=a/r;s.push(e.slice(l,l+c))}return s}function lO(e,t,n){const i=[];for(let r=0;r<t;r++){const t=r*n;i.push(e.slice(t,t+n))}return i}function cO(e,t,n,i){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){const n=[],r=new TextDecoder("utf8");let s=0;for(let o=0;o<e;o++){const e=i[o+1]-i[o];if(e+s<=t.length){const i=t.subarray(s,e+s),o=r.decode(i);n.push(o),s+=e}}return n}return[]}const uO="EXT_mesh_features",hO=uO;function dO(e,t,n){var i,r,s;if(!(null==(i=null==n?void 0:n.gltf)?void 0:i.loadBuffers))return;const o=null==(r=t.extensions)?void 0:r[uO],a=null==o?void 0:o.featureIds;if(a)for(const l of a){let i;if(void 0!==l.attribute){const n=`_FEATURE_ID_${l.attribute}`,r=t.attributes[n];i=e.getTypedArrayForAccessor(r)}else i=void 0!==l.texture&&(null==(s=null==n?void 0:n.gltf)?void 0:s.loadImages)?rO(e,l.texture,t):[];l.data=i}}function fO(e,t){var n;const i=null==(n=t.extensions)?void 0:n[uO];if(!i)return;const r=i.featureIds;r.forEach((n,i)=>{if(n.data){const{accessorKey:s,index:o}=function(e){const t="_FEATURE_ID_",n=Object.keys(e).filter(e=>0===e.indexOf(t));let i=-1;for(const s of n){const e=Number(s.substring(t.length));e>i&&(i=e)}i++;const r=`${t}${i}`;return{accessorKey:r,index:i}}(t.attributes),a=new Uint32Array(n.data);r[i]={featureCount:a.length,propertyTable:n.propertyTable,attribute:o},e.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength});const l=e.addBufferView(a),c=e.addAccessor(l,{size:1,componentType:XN(a),count:a.length});t.attributes[s]=c}})}const pO=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:function(e,t,n,i){t.extensions||(t.extensions={});let r=t.extensions[uO];r||(r={featureIds:[]},t.extensions[uO]=r);const{featureIds:s}=r,o={featureCount:n.length,propertyTable:i,data:n};s.push(o),e.addObjectExtension(t,uO,r)},decode:async function(e,t){!function(e,t){const n=e.gltf.json;if(!n.meshes)return;for(const i of n.meshes)for(const n of i.primitives)dO(e,n,t)}(new YN(e),t)},encode:function(e,t){const n=new YN(e);return function(e){const t=e.gltf.json.meshes;if(!t)return;for(const n of t)for(const t of n.primitives)fO(e,t)}(n),n.createBinaryChunk(),n.gltf},name:hO},Symbol.toStringTag,{value:"Module"})),gO="EXT_structural_metadata",mO=gO;function yO(e,t){for(const n of e)if(n.class===t)return n;return null}function vO(e,t,n,i){var r;if(!t)return;const s=null==(r=n.extensions)?void 0:r[gO],o=null==s?void 0:s.propertyTextures;if(o)for(const a of o){_O(e,t[a],n,i)}}function _O(e,t,n,i){var r;if(!t.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);const s=t.class;for(const o in t.properties){const a=`${s}_${o}`,l=null==(r=t.properties)?void 0:r[o];if(!l)continue;l.data||(l.data=[]);const c=l.data,u=rO(e,l,n);null!==u&&(sO(e,a,u,c,n),l.data=c,i.dataAttributeNames.push(a))}}function bO(e,t,n){var i,r;const s=null==(i=t.classes)?void 0:i[n.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const o=n.count;for(const a in s.properties){const i=s.properties[a],l=null==(r=n.properties)?void 0:r[a];if(l){const n=EO(e,t,i,o,l);l.data=n}}}function EO(e,t,n,i,r){let s=[];const o=r.values,a=e.getTypedArrayForBufferView(o),l=function(e,t,n,i){if(t.array&&void 0===t.count&&void 0!==n.arrayOffsets)return nO(e,n.arrayOffsets,n.arrayOffsetType||"UINT32",i);return null}(e,n,r,i),c=function(e,t,n){if(void 0!==t.stringOffsets)return nO(e,t.stringOffsets,t.stringOffsetType||"UINT32",n);return null}(e,r,i);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":s=function(e,t,n,i){const r=e.array,s=e.count,o=tO(e.type,e.componentType),a=n.byteLength/o;let l;l=e.componentType?iO(n,e.type,e.componentType,a):n;if(r)return i?aO(l,t,i,n.length,o):s?lO(l,t,s):[];return l}(n,i,a,l);break;case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":s=cO(i,a,l,c);break;case"ENUM":s=function(e,t,n,i,r){var s;const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=null==(s=e.enums)?void 0:s[o];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const l=a.valueType||"UINT16",c=tO(t.type,l),u=i.byteLength/c;let h=iO(i,t.type,l,u);h||(h=i);if(t.array){if(r)return function(e){const{valuesData:t,numberOfElements:n,arrayOffsets:i,valuesDataBytesLength:r,elementSize:s,enumEntry:o}=e,a=[];for(let l=0;l<n;l++){const e=i[l],n=i[l+1]-i[l];if(n+e>r)break;const c=wO(t,e/s,n/s,o);a.push(c)}return a}({valuesData:h,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:i.length,elementSize:c,enumEntry:a});const e=t.count;return e?function(e,t,n,i){const r=[];for(let s=0;s<t;s++){const t=wO(e,n*s,n,i);r.push(t)}return r}(h,n,e,a):[]}return wO(h,0,n,a)}(t,n,i,a,l);break;default:throw new Error(`Unknown classProperty type ${n.type}`)}return s}function wO(e,t,n,i){const r=[];for(let s=0;s<n;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const n=xO(i,e[t+s]);n?r.push(n.name):r.push("")}return r}function xO(e,t){for(const n of e.values)if(n.value===t)return n;return null}function AO(e,t,n){for(const i in e.properties){const r=e.properties[i].data;if(r){const s=t.properties[i];if(s){const t=SO(r,s,n);e.properties[i]=t}}}}function SO(e,t,n){const i={values:0};if("STRING"===t.type){const{stringData:t,stringOffsets:r}=function(e){const t=new TextEncoder,n=[];let i=0;for(const l of e){const e=t.encode(l);i+=e.length,n.push(e)}const r=new Uint8Array(i),s=[];let o=0;for(const l of n)r.set(l,o),s.push(o),o+=l.length;s.push(o);const a=new Uint32Array(s);return{stringData:r,stringOffsets:a}}(e);i.stringOffsets=CO(r,n),i.values=CO(t,n)}else if("SCALAR"===t.type&&t.componentType){const r=function(e,t){const n=[];for(const r of e)n.push(Number(r));const i=TO[t];if(!i)throw new Error("Illegal component type");return new i(n)}(e,t.componentType);i.values=CO(r,n)}return i}const TO={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function CO(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const IO=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:function(e,t,n="schemaClassId"){let i=e.getExtension(gO);i||(i=e.addExtension(gO)),i.schema=function(e,t,n){const i=n??{id:"schema_id"},r={properties:{}};for(const s of e){const e={type:s.elementType,componentType:s.componentType};r.properties[s.name]=e}return i.classes={},i.classes[t]=r,i}(t,n,i.schema);const r=function(e,t,n){var i;const r={class:t,count:0};let s=0;const o=null==(i=n.classes)?void 0:i[t];for(const a of e){if(0===s&&(s=a.values.length),s!==a.values.length&&a.values.length)throw new Error("Illegal values in attributes");(null==o?void 0:o.properties[a.name])&&(r.properties||(r.properties={}),r.properties[a.name]={values:0,data:a.values})}return r.count=s,r}(t,n,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(r)-1},decode:async function(e,t){!function(e,t){var n,i;if(!(null==(n=t.gltf)?void 0:n.loadBuffers))return;const r=e.getExtension(gO);if(!r)return;(null==(i=t.gltf)?void 0:i.loadImages)&&function(e,t){const n=t.propertyTextures,i=e.gltf.json;if(n&&i.meshes)for(const r of i.meshes)for(const i of r.primitives)vO(e,n,i,t)}(e,r);!function(e,t){const n=t.schema;if(!n)return;const i=n.classes,r=t.propertyTables;if(i&&r)for(const s in i){const t=yO(r,s);t&&bO(e,n,t)}}(e,r)}(new YN(e),t)},encode:function(e,t){const n=new YN(e);return function(e){var t,n;const i=e.getExtension(gO);if(!i)return;if(i.propertyTables)for(const r of i.propertyTables){const s=r.class,o=null==(n=null==(t=i.schema)?void 0:t.classes)?void 0:n[s];r.properties&&o&&AO(r,o,e)}}(n),n.createBinaryChunk(),n.gltf},name:mO},Symbol.toStringTag,{value:"Module"})),kO="EXT_feature_metadata",RO=kO;function PO(e,t){for(const n in e){const i=e[n];if(i.class===t)return i}return null}function MO(e,t){for(const n in e){const i=e[n];if(i.class===t)return i}return null}function LO(e,t,n){var i,r;if(!n.class)return;const s=null==(i=t.classes)?void 0:i[n.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const o=n.count;for(const a in s.properties){const i=s.properties[a],l=null==(r=n.properties)?void 0:r[a];if(l){const n=NO(e,t,i,o,l);l.data=n}}}function BO(e,t,n){var i;const r=t.class;for(const s in n.properties){const n=null==(i=null==t?void 0:t.properties)?void 0:i[s];if(n){const t=OO(e,n,r);n.data=t}}}function NO(e,t,n,i,r){let s=[];const o=r.bufferView,a=e.getTypedArrayForBufferView(o),l=function(e,t,n,i){if("ARRAY"===t.type&&void 0===t.componentCount&&void 0!==n.arrayOffsetBufferView)return nO(e,n.arrayOffsetBufferView,n.offsetType||"UINT32",i);return null}(e,n,r,i),c=function(e,t,n,i){if(void 0!==n.stringOffsetBufferView)return nO(e,n.stringOffsetBufferView,n.offsetType||"UINT32",i);return null}(e,0,r,i);return"STRING"===n.type||"STRING"===n.componentType?s=cO(i,a,l,c):function(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||void 0!==e.componentType&&t.includes(e.componentType)}(n)&&(s=function(e,t,n,i){const r="ARRAY"===e.type,s=e.componentCount,o="SCALAR",a=e.componentType||e.type,l=tO(o,a),c=n.byteLength/l,u=iO(n,o,a,c);if(r)return i?aO(u,t,i,n.length,l):s?lO(u,t,s):[];return u}(n,i,a,l)),s}function OO(e,t,n){const i=e.gltf.json;if(!i.meshes)return[];const r=[];for(const s of i.meshes)for(const i of s.primitives)DO(e,n,t,r,i);return r}function DO(e,t,n,i,r){const s=rO(e,{channels:n.channels,...n.texture},r);s&&sO(e,t,s,i,r)}const FO=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(e,t){!function(e,t){var n,i;if(!(null==(n=t.gltf)?void 0:n.loadBuffers))return;const r=e.getExtension(kO);if(!r)return;(null==(i=t.gltf)?void 0:i.loadImages)&&function(e,t){const n=t.schema;if(!n)return;const i=n.classes,{featureTextures:r}=t;if(i&&r)for(const s in i){const t=i[s],n=MO(r,s);n&&BO(e,n,t)}}(e,r);!function(e,t){const n=t.schema;if(!n)return;const i=n.classes,r=t.featureTables;if(i&&r)for(const s in i){const t=PO(r,s);t&&LO(e,n,t)}}(e,r)}(new YN(e),t)},name:RO},Symbol.toStringTag,{value:"Module"})),UO=!0,zO=1735152710,GO=1313821514,VO=5130562;function HO(e,t,n=0,i={}){const r=new DataView(t),s=function(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}(r,n+0),o=r.getUint32(n+4,UO),a=r.getUint32(n+8,UO);switch(Object.assign(e,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),n+=12,e.version){case 1:return function(e,t,n){Kh(e.header.byteLength>20);const i=t.getUint32(n+0,UO),r=t.getUint32(n+4,UO);return n+=8,Kh(0===r),jO(e,t,n,i),n+=i,n+=WO(e,t,n,e.header.byteLength),n}(e,r,n);case 2:return function(e,t,n,i){return Kh(e.header.byteLength>20),function(e,t,n,i){for(;n+8<=e.header.byteLength;){const r=t.getUint32(n+0,UO),s=t.getUint32(n+4,UO);switch(n+=8,s){case GO:jO(e,t,n,r);break;case VO:WO(e,t,n,r);break;case 0:i.strict||jO(e,t,n,r);break;case 1:i.strict||WO(e,t,n,r)}n+=Qd(r,4)}}(e,t,n,i),n+e.header.byteLength}(e,r,n,{});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function jO(e,t,n,i){const r=new Uint8Array(t.buffer,n,i),s=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(s),Qd(i,4)}function WO(e,t,n,i){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:t.buffer}),Qd(i,4)}function $O(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const n=t.baseUri||t.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return n.substr(0,n.lastIndexOf("/")+1)+e}const XO="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",qO="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",KO=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),YO=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),JO={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ZO={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function QO(e,t,n,i,r,s="NONE"){const o=await async function(){eD||(eD=async function(){let e=XO;WebAssembly.validate(KO)&&(e=qO);const t=await WebAssembly.instantiate(function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;++i){const n=e.charCodeAt(i);t[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let n=0;for(let i=0;i<e.length;++i)t[n++]=t[i]<60?YO[t[i]]:64*(t[i]-60)+t[++i];return t.buffer.slice(0,n)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}());return eD}();!function(e,t,n,i,r,s,o){const a=e.exports.sbrk,l=i+3&-4,c=a(l*r),u=a(s.length),h=new Uint8Array(e.exports.memory.buffer);h.set(s,u);const d=t(c,i,r,u,s.length);0===d&&o&&o(c,l,r);if(n.set(h.subarray(c,c+i*r)),a(c-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(o,o.exports[ZO[r]],e,t,n,i,o.exports[JO[s||"NONE"]])}let eD;const tD="EXT_meshopt_compression",nD=tD;async function iD(e,t){const n=e.getObjectExtension(t,tD);if(n){const{byteOffset:i=0,byteLength:r=0,byteStride:s,count:o,mode:a,filter:l="NONE",buffer:c}=n,u=e.gltf.buffers[c],h=new Uint8Array(u.arrayBuffer,u.byteOffset+i,r),d=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await QO(d,o,s,h,a,l),e.removeObjectExtension(t,tD)}}const rD=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(e,t){var n,i;const r=new YN(e);if(!(null==(n=null==t?void 0:t.gltf)?void 0:n.decompressMeshes)||!(null==(i=t.gltf)?void 0:i.loadBuffers))return;const s=[];for(const o of e.json.bufferViews||[])s.push(iD(r,o));await Promise.all(s),r.removeExtension(tD)},name:nD},Symbol.toStringTag,{value:"Module"})),sD="EXT_texture_webp",oD=sD;const aD=Object.freeze(Object.defineProperty({__proto__:null,name:oD,preprocess:function(e,t){const n=new YN(e);if(!Np("image/webp")){if(n.getRequiredExtensions().includes(sD))throw new Error(`gltf: Required extension ${sD} not supported by browser`);return}const{json:i}=n;for(const r of i.textures||[]){const e=n.getObjectExtension(r,sD);e&&(r.source=e.source),n.removeObjectExtension(r,sD)}n.removeExtension(sD)}},Symbol.toStringTag,{value:"Module"})),lD="KHR_texture_basisu",cD=lD;const uD=Object.freeze(Object.defineProperty({__proto__:null,name:cD,preprocess:function(e,t){const n=new YN(e),{json:i}=n;for(const r of i.textures||[]){const e=n.getObjectExtension(r,lD);e&&(r.source=e.source,n.removeObjectExtension(r,lD))}n.removeExtension(lD)}},Symbol.toStringTag,{value:"Module"})),hD={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.3",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function dD(e,t,n){return hp(e,t,n?fD(n.metadata):void 0)}function fD(e){Object.entries(e);const t={};for(const n in e)t[`${n}.string`]=JSON.stringify(e[n]);return t}const pD={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},gD={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class mD{constructor(e){i(this,"draco"),i(this,"decoder"),i(this,"metadataQuerier"),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),r=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let e;switch(i){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(n,r);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(n,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!r.ptr){const t=`DRACO decompression failed: ${e.error_msg()}`;throw new Error(t)}const s=this._getDracoLoaderData(r,i,t),o=this._getMeshData(r,s,t),a=up(o.attributes),l=function(e,t,n){const i=fD(t.metadata),r=[],s=function(e){const t={};for(const n in e){const i=e[n];t[i.name||"undefined"]=i}return t}(t.attributes);for(const o in e){const t=dD(o,e[o],s[o]);r.push(t)}if(n){const e=dD("indices",n);r.push(e)}return{fields:r,metadata:i}}(o.attributes,s,o.indices);return{loader:"draco",loaderData:s,header:{vertexCount:r.num_points(),boundingBox:a},...o,schema:l}}finally{this.draco.destroy(n),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:r}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const r=this.decoder.GetAttribute(e,i),s=this._getAttributeMetadata(e,i);n[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:i,metadata:s};const o=this._getQuantizationTransform(r,t);o&&(n[r.unique_id()].quantization_transform=o);const a=this._getOctahedronTransform(r,t);a&&(n[r.unique_id()].octahedron_transform=a)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===n.topology?{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const r of Object.values(e.attributes)){const e=this._deduceAttributeName(r,n);r.name=e;const s=this._getAttributeValues(t,r);if(s){const{value:t,size:n}=s;i[e]={value:t,size:n,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}}return i}_getTriangleListIndices(e){const t=3*e.num_faces(),n=4*t,i=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,i),new Uint32Array(this.draco.HEAPF32.buffer,i,t).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){const t=e.size(),n=new Int32Array(t);for(let i=0;i<t;i++)n[i]=e.GetValue(i);return n}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=gD[t.data_type];if(!n)return null;const i=t.num_components,r=e.num_points()*i,s=r*n.BYTES_PER_ELEMENT,o=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,n);let a;const l=this.draco._malloc(s);try{const i=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,i,o,s,l),a=new n(this.draco.HEAPF32.buffer,l,r).slice()}finally{this.draco._free(l)}return{value:a,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[s,o]of Object.entries(t.extraAttributes||{}))if(o===n)return s;const i=e.attribute_type;for(const s in pD){if(this.draco[s]===i)return pD[s]}const r=t.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const n=this.metadataQuerier.GetEntryName(e,i);t[n]=this._getDracoMetadataField(e,n)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=function(e){const t=e.size(),n=new Int32Array(t);for(let i=0;i<t;i++)n[i]=e.GetValue(i);return n}(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const r of i)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(e=>this.decoder[e]).includes(i)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits(),range:t.range(),min_values:new Float32Array([1,2,3]).map(e=>t.min_value(e))}}finally{this.draco.destroy(t)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(e=>this.decoder[e]).includes(i)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits()}}finally{this.draco.destroy(t)}}return null}}const yD="https://www.gstatic.com/draco/versioned/decoders/1.5.6",vD="draco_wasm_wrapper.js",_D="draco_decoder.wasm",bD="draco_decoder.js",ED="draco_encoder.js",wD={[vD]:`${yD}/${vD}`,[_D]:`${yD}/${_D}`,[bD]:`${yD}/${bD}`,[ED]:`https://raw.githubusercontent.com/google/draco/1.4.1/javascript/${ED}`};let xD;async function AD(e){const t=e.modules||{};return t.draco3d?xD||(xD=t.draco3d.createDecoderModule({}).then(e=>({draco:e}))):xD||(xD=async function(e){let t,n;if("js"===(e.draco&&e.draco.decoderType))t=await $d(wD[bD],"draco",e,bD);else[t,n]=await Promise.all([await $d(wD[vD],"draco",e,vD),await $d(wD[_D],"draco",e,_D)]);return t=t||globalThis.DracoDecoderModule,await function(e,t){const n={};t&&(n.wasmBinary=t);return new Promise(t=>{e({...n,onModuleLoaded:e=>t({draco:e})})})}(t,n)}(e)),await xD}const SD={...hD,parse:async function(e,t){const{draco:n}=await AD(t),i=new mD(n);try{return i.parseSync(e,null==t?void 0:t.draco)}finally{i.destroy()}}};function TD(e){const{buffer:t,size:n,count:i}=function(e){let t=e,n=1,i=0;e&&e.value&&(t=e.value,n=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t,n=!1){if(!e)return null;if(Array.isArray(e))return new t(e);if(n&&!(e instanceof t))return new t(e);return e}(t,Float32Array)),i=t.length/n);return{buffer:t,size:n,count:i}}(e);return{value:t,size:n,byteOffset:0,count:i,type:$N(n),componentType:XN(t)}}const CD="KHR_draco_mesh_compression",ID=CD;async function kD(e,t,n,i){const r=e.getObjectExtension(t,CD);if(!r)return;const s=e.getTypedArrayForBufferView(r.bufferView),o=Zd(s.buffer,s.byteOffset),a={...n};delete a["3d-tiles"];const l=await qh(o,SD,a,i),c=function(e){const t={};for(const n in e){const i=e[n];if("indices"!==n){const e=TD(i);t[n]=e}}return t}(l.attributes);for(const[u,h]of Object.entries(c))if(u in t.attributes){const n=t.attributes[u],i=e.getAccessor(n);(null==i?void 0:i.min)&&(null==i?void 0:i.max)&&(h.min=i.min,h.max=i.max)}t.attributes=c,l.indices&&(t.indices=TD(l.indices)),e.removeObjectExtension(t,CD),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}function RD(e,t,n=4,i,r){var s;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=i.DracoWriter.encodeSync({attributes:e}),a=null==(s=null==r?void 0:r.parseSync)?void 0:s.call(r,{attributes:e}),l=i._addFauxAttributes(a.attributes),c=i.addBufferView(o);return{primitives:[{attributes:l,mode:n,extensions:{[CD]:{bufferView:c,attributes:l}}}]}}function*PD(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e}const MD=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(e,t,n){var i;if(!(null==(i=null==t?void 0:t.gltf)?void 0:i.decompressMeshes))return;const r=new YN(e),s=[];for(const o of PD(r))r.getObjectExtension(o,CD)&&s.push(kD(r,o,t,n));await Promise.all(s),r.removeExtension(CD)},encode:function(e,t={}){const n=new YN(e);for(const i of n.json.meshes||[])RD(i),n.addRequiredExtension(CD)},name:ID,preprocess:function(e,t,n){const i=new YN(e);for(const r of PD(i))i.getObjectExtension(r,CD)}},Symbol.toStringTag,{value:"Module"})),LD="KHR_texture_transform",BD=LD,ND=new hb,OD=new _b,DD=new _b;function FD(e,t){var n,i,r,s;const o=null==(n=t.json.materials)?void 0:n[e],a=[null==(i=null==o?void 0:o.pbrMetallicRoughness)?void 0:i.baseColorTexture,null==o?void 0:o.emissiveTexture,null==o?void 0:o.normalTexture,null==o?void 0:o.occlusionTexture,null==(r=null==o?void 0:o.pbrMetallicRoughness)?void 0:r.metallicRoughnessTexture],l=[];for(const c of a)c&&(null==(s=null==c?void 0:c.extensions)?void 0:s[LD])&&UD(t,e,c,l)}function UD(e,t,n,i){const r=function(e,t){var n;const i=null==(n=e.extensions)?void 0:n[LD],{texCoord:r=0}=e,{texCoord:s=r}=i,o=-1!==t.findIndex(([e,t])=>e===r&&t===s);if(!o){const n=function(e){const{offset:t=[0,0],rotation:n=0,scale:i=[1,1]}=e,r=(new _b).set(1,0,0,0,1,0,t[0],t[1],1),s=OD.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=DD.set(i[0],0,0,0,i[1],0,0,0,1);return r.multiplyRight(s).multiplyRight(o)}(i);return r!==s&&(e.texCoord=s),t.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:n}}return null}(n,i);if(!r)return;const s=e.json.meshes||[];for(const o of s)for(const n of o.primitives){const i=n.material;Number.isFinite(i)&&t===i&&zD(e,n,r)}}function zD(e,t,n){var i,r;const{originalTexCoord:s,texCoord:o,matrix:a}=n,l=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(l)){const n=null==(i=e.json.accessors)?void 0:i[l];if(n&&n.bufferView){const i=null==(r=e.json.bufferViews)?void 0:r[n.bufferView];if(i){const{arrayBuffer:r,byteOffset:l}=e.buffers[i.buffer],c=(l||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:u,length:h}=qN(n,i),d=UN[n.componentType],f=FN[n.type],p=i.byteStride||d*f,g=new Float32Array(h);for(let e=0;e<n.count;e++){const t=new u(r,c+e*p,2);ND.set(t[0],t[1],1),ND.transformByMatrix3(a),g.set([ND[0],ND[1]],e*f)}s===o?function(e,t,n,i){e.componentType=5126,n.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),t.buffer=n.length-1,t.byteLength=i.buffer.byteLength,t.byteOffset=0,delete t.byteStride}(n,i,e.buffers,g):function(e,t,n,i,r){i.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const s=i.json.bufferViews;if(!s)return;s.push({buffer:i.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=i.json.accessors;if(!o)return;o.push({bufferView:(null==s?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),n.attributes[`TEXCOORD_${e}`]=o.length-1}(o,n,t,e,g)}}}}const GD=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(e,t){var n;if(!new YN(e).hasExtension(LD)||!(null==(n=t.gltf)?void 0:n.loadBuffers))return;const i=e.json.materials||[];for(let r=0;r<i.length;r++)FD(r,e)},name:BD},Symbol.toStringTag,{value:"Module"})),VD="KHR_lights_punctual",HD=VD;const jD=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(e){const t=new YN(e),{json:n}=t,i=t.getExtension(VD);i&&(t.json.lights=i.lights,t.removeExtension(VD));for(const r of n.nodes||[]){const e=t.getObjectExtension(r,VD);e&&(r.light=e.light),t.removeObjectExtension(r,VD)}},encode:async function(e){const t=new YN(e),{json:n}=t;if(n.lights){const e=t.addExtension(VD);DN(!e.lights),e.lights=n.lights,delete n.lights}if(t.json.lights){for(const e of t.json.lights){const n=e.node;t.addObjectExtension(n,VD,e)}delete t.json.lights}},name:HD},Symbol.toStringTag,{value:"Module"})),WD="KHR_materials_unlit",$D=WD;const XD=Object.freeze(Object.defineProperty({__proto__:null,decode:async function(e){const t=new YN(e),{json:n}=t;for(const i of n.materials||[]){i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),t.removeObjectExtension(i,WD)}t.removeExtension(WD)},encode:function(e){const t=new YN(e),{json:n}=t;if(t.materials)for(const i of n.materials||[])i.unlit&&(delete i.unlit,t.addObjectExtension(i,WD,{}),t.addExtension(WD))},name:$D},Symbol.toStringTag,{value:"Module"})),qD="KHR_techniques_webgl",KD=qD;function YD(e,t){const n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(t=>{e.uniforms[t].value&&!(t in n)&&(n[t]=e.uniforms[t].value)}),Object.keys(n).forEach(e=>{"object"==typeof n[e]&&void 0!==n[e].index&&(n[e].texture=t.getTexture(n[e].index))}),n}const JD=[IO,pO,rD,aD,uD,MD,jD,XD,Object.freeze(Object.defineProperty({__proto__:null,decode:async function(e){const t=new YN(e),{json:n}=t,i=t.getExtension(qD);if(i){const e=function(e,t){const{programs:n=[],shaders:i=[],techniques:r=[]}=e,s=new TextDecoder;return i.forEach(e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=s.decode(t.getTypedArrayForBufferView(e.bufferView))}),n.forEach(e=>{e.fragmentShader=i[e.fragmentShader],e.vertexShader=i[e.vertexShader]}),r.forEach(e=>{e.program=n[e.program]}),r}(i,t);for(const i of n.materials||[]){const n=t.getObjectExtension(i,qD);n&&(i.technique=Object.assign({},n,e[n.technique]),i.technique.values=YD(i.technique,t)),t.removeObjectExtension(i,qD)}t.removeExtension(qD)}},encode:async function(e,t){},name:KD},Symbol.toStringTag,{value:"Module"})),GD,FO];function ZD(e,t){var n;const i=(null==(n=null==t?void 0:t.gltf)?void 0:n.excludeExtensions)||{};return!(e in i&&!i[e])}const QD="KHR_binary_glTF";const eF={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},tF={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class nF{constructor(){i(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),i(this,"json")}normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return}if(!t.normalize)throw new Error("glTF v1 is not supported.");this._addAsset(n),this._convertTopLevelObjectsToArrays(n),function(e){const t=new YN(e),{json:n}=t;for(const i of n.images||[]){const e=t.getObjectExtension(i,QD);e&&Object.assign(i,e),t.removeObjectExtension(i,QD)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,t.removeExtension(QD)}(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in eF)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(n&&!Array.isArray(n)){e[t]=[];for(const i in n){const r=n[i];r.id=r.id||i;const s=e[t].length;e[t].push(r),this.idToIndexMap[t][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in eF)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:n,material:i}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),i&&(t.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(e=>this._convertIdToIndex(e,"node"))),e.meshes&&(e.meshes=e.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(e,t){e[t]||(e[t]=[]);for(const n of e[t])for(const e in n){const t=n[e],i=this._convertIdToIndex(t,e);n[e]=i}}_convertIdToIndex(e,t){const n=tF[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,n,i;for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=(null==(t=r.values)?void 0:t.tex)||(null==(n=r.values)?void 0:n.texture2d_0)||(null==(i=r.values)?void 0:i.diffuseTex),o=e.textures.findIndex(e=>e.id===s);-1!==o&&(r.pbrMetallicRoughness.baseColorTexture={index:o})}}}async function iF(e,t,n=0,i,r){var s,o,a;return function(e,t,n,i){i.uri&&(e.baseUri=i.uri);if(t instanceof ArrayBuffer&&!function(e,t=0,n={}){const i=new DataView(e),{magic:r=zO}=n,s=i.getUint32(t,!1);return s===r||s===zO}(t,n,i)){t=(new TextDecoder).decode(t)}if("string"==typeof t)e.json=Yd(t);else if(t instanceof ArrayBuffer){const r={};n=HO(r,t,n,i.glb),DN("glTF"===r.type,`Invalid GLB magic string ${r.type}`),e._glb=r,e.json=r.json}else DN(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}(e,t,n,i),function(e,t={}){(new nF).normalize(e,t)}(e,{normalize:null==(s=null==i?void 0:i.gltf)?void 0:s.normalize}),function(e,t={},n){var i;const r=JD.filter(e=>ZD(e.name,t));for(const s of r)null==(i=s.preprocess)||i.call(s,e,t,n)}(e,i,r),(null==(o=null==i?void 0:i.gltf)?void 0:o.loadBuffers)&&e.json.buffers&&await async function(e,t,n){var i,r;const s=e.json.buffers||[];for(let o=0;o<s.length;++o){const a=s[o];if(a.uri){const{fetch:s}=n;DN(s);const l=$O(a.uri,t),c=await(null==(i=null==n?void 0:n.fetch)?void 0:i.call(n,l)),u=await(null==(r=null==c?void 0:c.arrayBuffer)?void 0:r.call(c));e.buffers[o]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete a.uri}else null===e.buffers[o]&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}(e,i,r),(null==(a=null==i?void 0:i.gltf)?void 0:a.loadImages)&&await async function(e,t,n){const i=function(e){const t=new Set,n=e.json.textures||[];for(const i of n)void 0!==i.source&&t.add(i.source);return Array.from(t).sort()}(e),r=e.json.images||[],s=[];for(const o of i)s.push(rF(e,r[o],o,t,n));return await Promise.all(s)}(e,i,r),await async function(e,t={},n){var i;const r=JD.filter(e=>ZD(e.name,t));for(const s of r)await(null==(i=s.decode)?void 0:i.call(s,e,t,n))}(e,i,r),e}async function rF(e,t,n,i,r){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){const e=$O(t.uri,i),{fetch:n}=r,o=await n(e);s=await o.arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){const n=function(e,t,n){const i=e.bufferViews[n];DN(i);const r=t[i.buffer];DN(r);const s=(i.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,i.byteLength)}(e.json,e.buffers,t.bufferView);s=Zd(n.buffer,n.byteOffset,n.byteLength)}DN(s,"glTF image has no data");let o=await qh(s,[Lp,LB],{...i,mimeType:t.mimeType,basis:i.basis||{format:MB()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[n]=o}const sF={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:"4.3.3",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e,t={},n){(t={...sF.options,...t}).gltf={...sF.options.gltf,...t.gltf};const{byteOffset:i=0}=t;return await iF({},e,i,t,n)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};const oF={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},aF={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},lF=10240,cF=10241,uF=10242,hF=10243,dF=10497,fF=9729,pF=9986,gF={magFilter:lF,minFilter:cF,wrapS:uF,wrapT:hF},mF={[lF]:fF,[cF]:pF,[uF]:dF,[hF]:dF};class yF{constructor(){i(this,"baseUri",""),i(this,"jsonUnprocessed"),i(this,"json"),i(this,"buffers",[]),i(this,"images",[])}postProcess(e,t={}){const{json:n,buffers:i=[],images:r=[]}=e,{baseUri:s=""}=e;return DN(n),this.baseUri=s,this.buffers=i,this.images=r,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((e,t)=>this._resolveBufferView(e,t))),e.images&&(n.images=e.images.map((e,t)=>this._resolveImage(e,t))),e.samplers&&(n.samplers=e.samplers.map((e,t)=>this._resolveSampler(e,t))),e.textures&&(n.textures=e.textures.map((e,t)=>this._resolveTexture(e,t))),e.accessors&&(n.accessors=e.accessors.map((e,t)=>this._resolveAccessor(e,t))),e.materials&&(n.materials=e.materials.map((e,t)=>this._resolveMaterial(e,t))),e.meshes&&(n.meshes=e.meshes.map((e,t)=>this._resolveMesh(e,t))),e.nodes&&(n.nodes=e.nodes.map((e,t)=>this._resolveNode(e,t)),n.nodes=n.nodes.map((e,t)=>this._resolveNodeChildren(e))),e.skins&&(n.skins=e.skins.map((e,t)=>this._resolveSkin(e,t))),e.scenes&&(n.scenes=e.scenes.map((e,t)=>this._resolveScene(e,t))),"number"==typeof this.json.scene&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if("object"==typeof t)return t;const n=e&&e[t];return n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(e=>this.getNode(e))}}_resolveNode(e,t){const n={...e,id:(null==e?void 0:e.id)||`node-${t}`};return void 0!==e.mesh&&(n.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(n.camera=this.getCamera(e.camera)),void 0!==e.skin&&(n.skin=this.getSkin(e.skin)),void 0!==e.meshes&&e.meshes.length&&(n.mesh=e.meshes.reduce((e,t)=>{const n=this.getMesh(t);return e.id=n.id,e.primitives=e.primitives.concat(n.primitives),e},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(e=>this.getNode(e))),e}_resolveSkin(e,t){const n="number"==typeof e.inverseBindMatrices?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(e=>{const t={...e,attributes:{},indices:void 0,material:void 0},n=e.attributes;for(const i in n)t.attributes[i]=this.getAccessor(n[i]);return void 0!==e.indices&&(t.indices=this.getAccessor(e.indices)),void 0!==e.material&&(t.material=this.getMaterial(e.material)),t})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const e=n.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=(i=e.componentType,aF[i]);var i;const r=(s=e.type,oF[s]);var s;const o=n*r,a={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:r,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(void 0!==e.bufferView&&(a.bufferView=this.getBufferView(e.bufferView)),a.bufferView){const e=a.bufferView.buffer,{ArrayType:t,byteLength:n}=qN(a,a.bufferView),i=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+e.byteOffset;let r=e.arrayBuffer.slice(i,i+n);a.bufferView.byteStride&&(r=this._getValueFromInterleavedBuffer(e,i,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new t(r)}return a}_getValueFromInterleavedBuffer(e,t,n,i,r){const s=new Uint8Array(r*i);for(let o=0;o<r;o++){const r=t+o*n;s.set(new Uint8Array(e.arrayBuffer.slice(r,r+i)),o*i)}return s.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:"number"==typeof e.sampler?this.getSampler(e.sampler):{id:"default-sampler",parameters:mF},source:"number"==typeof e.source?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const e=this._enumSamplerParameter(i);void 0!==e&&(n.parameters[e]=n[i])}return n}_enumSamplerParameter(e){return gF[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:void 0!==e.bufferView?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let r=this.buffers[n].byteOffset||0;e.byteOffset&&(r+=e.byteOffset);return{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,r,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}}function vF(e,t){return(new yF).postProcess(e,t)}async function _F(e){const t=[];return e.scenes.forEach(e=>{e.traverse(e=>{})}),await async function(e){for(;e();)await new Promise(e=>requestAnimationFrame(e))}(()=>t.some(e=>!e.loaded))}const bF="uniform scenegraphUniforms {\n  float sizeScale;\n  float sizeMinPixels;\n  float sizeMaxPixels;\n  mat4 sceneModelMatrix;\n  bool composeModelMatrix;\n} scenegraph;\n",EF={name:"scenegraph",vs:bF,fs:bF,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},wF=[255,255,255,255],xF={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?"object"==typeof e.scene?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:wF},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[sF]};class AF extends Ck{getShaders(){const e={};let t;"pbr"===this.props._lighting?(t=bE,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const n=[$w,Cx,EF,t];return super.getShaders({defines:e,vs:"#version 300 es\n#define SHADER_NAME scenegraph-layer-vertex-shader\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec3 instanceModelMatrixCol0;\nin vec3 instanceModelMatrixCol1;\nin vec3 instanceModelMatrixCol2;\nin vec3 instanceTranslation;\nin vec3 positions;\n#ifdef HAS_UV\nin vec2 texCoords;\n#endif\n#ifdef LIGHTING_PBR\n#ifdef HAS_NORMALS\nin vec3 normals;\n#endif\n#endif\nout vec4 vColor;\n#ifndef LIGHTING_PBR\n#ifdef HAS_UV\nout vec2 vTEXCOORD_0;\n#endif\n#endif\nvoid main(void) {\n#if defined(HAS_UV) && !defined(LIGHTING_PBR)\nvTEXCOORD_0 = texCoords;\ngeometry.uv = texCoords;\n#endif\ngeometry.worldPosition = instancePositions;\ngeometry.pickingColor = instancePickingColors;\nmat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);\nvec3 normal = vec3(0.0, 0.0, 1.0);\n#ifdef LIGHTING_PBR\n#ifdef HAS_NORMALS\nnormal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;\n#endif\n#endif\nfloat originalSize = project_size_to_pixel(scenegraph.sizeScale);\nfloat clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);\nvec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;\nif(scenegraph.composeModelMatrix) {\nDECKGL_FILTER_SIZE(pos, geometry);\ngeometry.normal = project_normal(normal);\ngeometry.worldPosition += pos;\ngl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n}\nelse {\npos = project_size(pos);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);\ngeometry.normal = project_normal(normal);\n}\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n#ifdef LIGHTING_PBR\npbr_vPosition = geometry.position.xyz;\n#ifdef HAS_NORMALS\npbr_vNormal = geometry.normal;\n#endif\n#ifdef HAS_UV\npbr_vUV = texCoords;\n#else\npbr_vUV = vec2(0., 0.);\n#endif\ngeometry.uv = pbr_vUV;\n#endif\nvColor = instanceColors;\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scenegraph-layer-fragment-shader\nin vec4 vColor;\nout vec4 fragColor;\n#ifndef LIGHTING_PBR\n#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\nin vec2 vTEXCOORD_0;\nuniform sampler2D pbr_baseColorSampler;\n#endif\n#endif\nvoid main(void) {\n#ifdef LIGHTING_PBR\nfragColor = vColor * pbr_filterColor(vec4(0));\ngeometry.uv = pbr_vUV;\n#else\n#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\nfragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);\ngeometry.uv = vTEXCOORD_0;\n#else\nfragColor = vColor;\n#endif\n#endif\nfragColor.a *= layer.opacity;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:wF,transition:!0},instanceModelMatrix:$L})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.scenegraph!==n.scenegraph?this._updateScenegraph():t._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){var t;super.finalizeState(e),null==(t=this.state.scenegraph)||t.destroy()}get isLoaded(){var e;return Boolean((null==(e=this.state)?void 0:e.scenegraph)&&super.isLoaded)}_updateScenegraph(){var e;const t=this.props,{device:n}=this.context;let i=null;if(t.scenegraph instanceof WA)i={scenes:[t.scenegraph]};else if(t.scenegraph&&"object"==typeof t.scenegraph){const e=t.scenegraph,r=e.json?vF(e):e,s=ON(n,r,this._getModelOptions());i={gltf:r,...s},_F(s).then(()=>{this.setNeedsRedraw()}).catch(e=>{this.raiseError(e,"loading glTF")})}const r={layer:this,device:this.context.device},s=t.getScene(i,r),o=t.getAnimator(i,r);if(s instanceof $A){null==(e=this.state.scenegraph)||e.destroy(),this._applyAnimationsProp(o,t._animations);const n=[];s.traverse(e=>{e instanceof XA&&n.push(e.model)}),this.setState({scenegraph:s,animator:o,models:n}),this.getAttributeManager().invalidateAll()}else null!==s&&Op.warn("invalid scenegraph:",s)()}_applyAnimationsProp(e,t){if(!e||!t)return;const n=e.getAnimations();Object.keys(t).sort().forEach(e=>{const i=t[e];if("*"===e)n.forEach(e=>{Object.assign(e,i)});else if(Number.isFinite(Number(e))){const t=Number(e);t>=0&&t<n.length?Object.assign(n[t],i):Op.warn(`animation ${e} not found`)()}else{const t=n.find(({animation:t})=>t.name===e);t?Object.assign(t,i):Op.warn(`animation ${e} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(t="function"==typeof e?e({gl:this.context.gl,layer:this}):e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:t,renderPass:n}=this.context,{sizeScale:i,sizeMinPixels:r,sizeMaxPixels:s,coordinateSystem:o}=this.props,a={camera:t.cameraPosition},l=this.getNumInstances();this.state.scenegraph.traverse((e,{worldMatrix:c})=>{if(e instanceof XA){const{model:u}=e;u.setInstanceCount(l);const h={sizeScale:i,sizeMinPixels:r,sizeMaxPixels:s,composeModelMatrix:XL(t,o),sceneModelMatrix:c};u.shaderInputs.setProps({pbrProjection:a,scenegraph:h}),u.draw(n)}})}}AF.defaultProps=xF,AF.layerName="ScenegraphLayer";const SF="uniform meshUniforms {\n  bool pickFeatureIds;\n} mesh;\n",TF={name:"mesh",vs:SF,fs:SF,uniformTypes:{pickFeatureIds:"f32"}};class CF extends QL{getShaders(){const e=super.getShaders();return e.modules.push(bE,TF),{...e,vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec4 uvRegions;\nin vec3 featureIdsPickingColors;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec3 instanceModelMatrixCol0;\nin vec3 instanceModelMatrixCol1;\nin vec3 instanceModelMatrixCol2;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\nvec2 applyUVRegion(vec2 uv) {\n#ifdef HAS_UV_REGIONS\nreturn fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;\n#else\nreturn uv;\n#endif\n}\nvoid main(void) {\nvec2 uv = applyUVRegion(texCoords);\ngeometry.uv = uv;\nif (mesh.pickFeatureIds) {\ngeometry.pickingColor = featureIdsPickingColors;\n} else {\ngeometry.pickingColor = instancePickingColors;\n}\nmat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);\nvTexCoord = uv;\ncameraPosition = project.cameraPosition;\nvColor = vec4(colors * instanceColors.rgb, instanceColors.a);\nvec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;\nvec3 projectedPosition = project_position(positions);\nposition_commonspace = vec4(projectedPosition, 1.0);\ngl_Position = project_common_position_to_clipspace(position_commonspace);\ngeometry.position = position_commonspace;\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\ngeometry.normal = normals_commonspace;\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n#ifdef MODULE_PBRMATERIAL\npbr_vPosition = geometry.position.xyz;\n#ifdef HAS_NORMALS\npbr_vNormal = geometry.normal;\n#endif\n#ifdef HAS_UV\npbr_vUV = uv;\n#else\npbr_vUV = vec2(0., 0.);\n#endif\ngeometry.uv = pbr_vUV;\n#endif\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\nprecision highp float;\nuniform sampler2D sampler;\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\n#ifdef MODULE_PBRMATERIAL\nfragColor = vColor * pbr_filterColor(vec4(0));\ngeometry.uv = pbr_vUV;\nfragColor.a *= layer.opacity;\n#else\ngeometry.uv = vTexCoord;\nvec3 normal;\nif (simpleMesh.flatShading) {\nnormal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n} else {\nnormal = normals_commonspace;\n}\nvec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;\nvec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\nfragColor = vec4(lightColor, color.a * layer.opacity);\n#endif\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props,{model:n}=this.state;if(!n)return;const i={pickFeatureIds:Boolean(t)},r={camera:this.context.viewport.cameraPosition};n.shaderInputs.setProps({pbrProjection:r,mesh:i}),super.draw(e)}getModel(e){const{id:t}=this.props,n=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:n});const i=this.getShaders();!function(e){const t=e.positions||e.POSITION,n=t.value.length/t.size;e.COLOR_0||e.colors||(e.colors={size:4,value:new Uint8Array(4*n).fill(255),normalized:!0})}(e.attributes);return new zA(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...null==n?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:null==n?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i});const{pbr_baseColorSampler:r}=i.bindings,{emptyTexture:s}=this.state,o={sampler:r||s,hasTexture:Boolean(r)},{camera:a,...l}={...i.bindings,...i.uniforms};t.shaderInputs.setProps({simpleMesh:o,pbrMaterial:l})}}parseMaterial(e,t){const n=Boolean(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return bN(this.context.device,{unlit:n,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,n=new Uint8ClampedArray(t.length*e.size),i=[];for(let r=0;r<t.length;r++)this.encodePickingColor(t[r],i),n[3*r]=i[0],n[3*r+1]=i[1],n[3*r+2]=i[2];e.value=n}finalizeState(e){var t;super.finalizeState(e),null==(t=this.state.parsedPBRMaterial)||t.generatedTextures.forEach(e=>e.destroy()),this.setState({parsedPBRMaterial:null})}}CF.layerName="MeshLayer",CF.defaultProps={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};function IF(e){return e}function kF(e,t=[]){return function(e,t=[],n=IF){return"longitude"in e?(t[0]=n(e.longitude),t[1]=n(e.latitude),t[2]=e.height):"x"in e?(t[0]=n(e.x),t[1]=n(e.y),t[2]=e.z):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}(e,t,T_._cartographicRadians?IF:k_)}function RF(e,t){return function(e,t,n=IF){return"longitude"in t?(t.longitude=n(e[0]),t.latitude=n(e[1]),t.height=e[2]):"x"in t?(t.x=n(e[0]),t.y=n(e[1]),t.z=e[2]):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}(e,t,T_._cartographicRadians?IF:R_)}new hb;const PF=new hb,MF={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},LF={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},BF={east:new hb,north:new hb,up:new hb,west:new hb,south:new hb,down:new hb},NF=new hb,OF=new hb,DF=new hb;function FF(e,t,n,i,r,s){const o=MF[t]&&MF[t][n];let a,l,c;U_(o&&(!i||i===o));const u=PF.copy(r);if(B_(u.x,0,1e-14)&&B_(u.y,0,1e-14)){const e=Math.sign(u.z);a=NF.fromArray(LF[t]),"east"!==t&&"west"!==t&&a.scale(e),l=OF.fromArray(LF[n]),"east"!==n&&"west"!==n&&l.scale(e),c=DF.fromArray(LF[i]),"east"!==i&&"west"!==i&&c.scale(e)}else{const{up:r,east:s,north:o}=BF;s.set(-u.y,u.x,0).normalize(),e.geodeticSurfaceNormal(u,r),o.copy(r).cross(s);const{down:h,west:d,south:f}=BF;h.copy(r).scale(-1),d.copy(s).scale(-1),f.copy(o).scale(-1),a=BF[t],l=BF[n],c=BF[i]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=l.x,s[5]=l.y,s[6]=l.z,s[7]=0,s[8]=c.x,s[9]=c.y,s[10]=c.z,s[11]=0,s[12]=u.x,s[13]=u.y,s[14]=u.z,s[15]=1,s}const UF=new hb,zF=new hb,GF=new hb;const VF=new hb,HF=new hb,jF=new hb,WF=new hb,$F=new hb,XF=new hb;class qF{constructor(e=0,t=0,n=0){this.centerToleranceSquared=.1,U_(e>=0),U_(t>=0),U_(n>=0),this.radii=new hb(e,t,n),this.radiiSquared=new hb(e*e,t*t,n*n),this.radiiToTheFourth=new hb(e*e*e*e,t*t*t*t,n*n*n*n),this.oneOverRadii=new hb(0===e?0:1/e,0===t?0:1/t,0===n?0:1/n),this.oneOverRadiiSquared=new hb(0===e?0:1/(e*e),0===t?0:1/(t*t),0===n?0:1/(n*n)),this.minimumRadius=Math.min(e,t,n),this.maximumRadius=Math.max(e,t,n),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const n=HF,i=jF,[,,r]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const s=Math.sqrt(n.dot(i));return i.scale(1/s),n.scale(r),i.add(n),i.to(t)}cartesianToCartographic(e,t=[0,0,0]){XF.from(e);const n=this.scaleToGeodeticSurface(XF,WF);if(!n)return;const i=this.geodeticSurfaceNormal(n,HF),r=$F;r.copy(XF).subtract(n);return RF([Math.atan2(i.y,i.x),Math.asin(i.z),Math.sign(eb(r,XF))*Z_(r)],t)}eastNorthUpToFixedFrame(e,t=new Fb){return FF(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,n,i,r=new Fb){return FF(this,e,t,n,i,r)}geocentricSurfaceNormal(e,t=[0,0,0]){return VF.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const n=kF(e),i=n[0],r=n[1],s=Math.cos(r);return VF.set(s*Math.cos(i),s*Math.sin(i),Math.sin(r)).normalize(),VF.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return VF.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return function(e,t,n=[]){const{oneOverRadii:i,oneOverRadiiSquared:r,centerToleranceSquared:s}=t;UF.from(e);const o=UF.x,a=UF.y,l=UF.z,c=i.x,u=i.y,h=i.z,d=o*o*c*c,f=a*a*u*u,p=l*l*h*h,g=d+f+p,m=Math.sqrt(1/g);if(!Number.isFinite(m))return;const y=zF;if(y.copy(e).scale(m),g<s)return y.to(n);const v=r.x,_=r.y,b=r.z,E=GF;E.set(y.x*v*2,y.y*_*2,y.z*b*2);let w,x,A,S,T=(1-m)*UF.len()/(.5*E.len()),C=0;do{T-=C,w=1/(1+T*v),x=1/(1+T*_),A=1/(1+T*b);const e=w*w,t=x*x,n=A*A;S=d*e+f*t+p*n-1,C=S/(-2*(d*(e*w)*v+f*(t*x)*_+p*(n*A)*b))}while(Math.abs(S)>1e-12);return UF.scale([w,x,A]).to(n)}(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){WF.from(e);const n=WF.x,i=WF.y,r=WF.z,s=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*s.x+i*i*s.y+r*r*s.z);return WF.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return WF.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return WF.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,n=[0,0,0]){U_(B_(this.radii.x,this.radii.y,1e-15)),U_(this.radii.z>0),WF.from(e);const i=WF.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return WF.set(0,0,i).to(n)}}qF.WGS84=new qF(6378137,6378137,6356752.314245179);class KF{constructor(e,t,n){i(this,"item"),i(this,"previous"),i(this,"next"),this.item=e,this.previous=t,this.next=n}}class YF{constructor(){i(this,"head",null),i(this,"tail",null),i(this,"_length",0)}get length(){return this._length}add(e){const t=new KF(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}}class JF{constructor(){i(this,"_list"),i(this,"_sentinel"),i(this,"_trimTiles"),this._list=new YF,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,n){t._cacheNode||(t._cacheNode=this._list.add(t),n&&n(e,t))}unloadTile(e,t,n){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,n&&n(e,t))}unloadTiles(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,r=1024*e.maximumMemoryUsage*1024,s=this._sentinel;let o=i.head;for(;o!==s&&(e.gpuMemoryUsageInBytes>r||n);){const n=o.item;o=o.next,this.unloadTile(e,n,t)}}trim(){this._trimTiles=!0}}const ZF=new hb,QF=new hb,eU=new XM([new HM,new HM,new HM,new HM,new HM,new HM]);function tU(e,t){const{cameraDirection:n,cameraUp:i,height:r}=e,{metersPerUnit:s}=e.distanceScales,o=iU(e,e.center),a=qF.WGS84.eastNorthUpToFixedFrame(o),l=e.unprojectPosition(e.cameraPosition),c=qF.WGS84.cartographicToCartesian(l,new hb),u=new hb(a.transformAsVector(new hb(n).scale(s))).normalize(),h=new hb(a.transformAsVector(new hb(i).scale(s))).normalize();!function(e){const t=e.getFrustumPlanes(),n=nU(t.near,e.cameraPosition),i=iU(e,n),r=iU(e,e.cameraPosition,QF);let s=0;eU.planes[s++].fromPointNormal(i,ZF.copy(i).subtract(r));for(const o in t){if("near"===o)continue;const r=iU(e,nU(t[o],n,QF),QF);eU.planes[s++].fromPointNormal(r,ZF.copy(i).subtract(r))}}(e);const d=e.constructor,{longitude:f,latitude:p,width:g,bearing:m,zoom:y}=e;return{camera:{position:c,direction:u,up:h},viewport:e,topDownViewport:new d({longitude:f,latitude:p,height:r,width:g,bearing:m,zoom:y,pitch:0}),height:r,cullingVolume:eU,frameNumber:t,sseDenominator:1.15}}function nU(e,t,n=new hb){const i=e.normal.dot(t);return n.copy(e.normal).scale(e.distance-i).add(t),n}function iU(e,t,n=new hb){const i=e.unprojectPosition(t);return qF.WGS84.cartographicToCartesian(i,n)}const rU=6356752.314245179,sU=new hb;function oU(e,t){if(e instanceof zM){const{halfAxes:n}=e,i=function(e){e.getColumn(0,sU);const t=e.getColumn(1),n=e.getColumn(2),i=sU.add(t).add(n);return i.len()}(n);return Math.log2(rU/(i+t[2]))}if(e instanceof xM){const{radius:n}=e;return Math.log2(rU/(n+t[2]))}if(e.width&&e.height){const{width:t,height:n}=e;return(Math.log2(6378137/t)+Math.log2(6378137/n))/2}return 1}function aU(e,t,n){qF.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],sU);const i=Math.sqrt(Math.pow(sU[0]-n[0],2)+Math.pow(sU[1]-n[1],2)+Math.pow(sU[2]-n[2],2));return Math.log2(rU/(i+t[2]))}const lU=0,cU=1,uU=3,hU=4,dU=5;var fU,pU,gU,mU,yU,vU,_U,bU;(pU=fU||(fU={}))[pU.ADD=1]="ADD",pU[pU.REPLACE=2]="REPLACE",(mU=gU||(gU={})).EMPTY="empty",mU.SCENEGRAPH="scenegraph",mU.POINTCLOUD="pointcloud",mU.MESH="mesh",(vU=yU||(yU={})).I3S="I3S",vU.TILES3D="TILES3D",(bU=_U||(_U={})).GEOMETRIC_ERROR="geometricError",bU.MAX_SCREEN_THRESHOLD="maxScreenThreshold";const EU=1;function wU(e){return null!=e}const xU=new hb,AU=new hb,SU=new hb,TU=new hb,CU=new hb,IU=new hb,kU=new hb,RU=new hb;function PU(e,t,n){if(Kh(e,"3D Tile: boundingVolume must be defined"),e.box)return LU(e.box,t,n);if(e.region)return function(e){const[t,n,i,r,s,o]=e,a=qF.WGS84.cartographicToCartesian([P_(t),P_(r),s],SU),l=qF.WGS84.cartographicToCartesian([P_(i),P_(n),o],TU),c=(new hb).addVectors(a,l).multiplyByScalar(.5);return qF.WGS84.cartesianToCartographic(c,CU),qF.WGS84.cartographicToCartesian([P_(i),CU[1],CU[2]],IU),qF.WGS84.cartographicToCartesian([CU[0],P_(r),CU[2]],kU),qF.WGS84.cartographicToCartesian([CU[0],CU[1],o],RU),LU([...c,...IU.subtract(c),...kU.subtract(c),...RU.subtract(c)],new Fb)}(e.region);if(e.sphere)return function(e,t,n){const i=new hb(e[0],e[1],e[2]);t.transform(i,i);const r=t.getScale(AU),s=Math.max(Math.max(r[0],r[1]),r[2]),o=e[3]*s;if(wU(n))return n.center=i,n.radius=o,n;return new xM(i,o)}(e.sphere,t,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function MU(e,t){if(e.box)return function(e){const t=BU(),{halfAxes:n}=e,i=new hb(n.getColumn(0)),r=new hb(n.getColumn(1)),s=new hb(n.getColumn(2));for(let o=0;o<2;o++){for(let n=0;n<2;n++){for(let n=0;n<2;n++)xU.copy(e.center),xU.add(i),xU.add(r),xU.add(s),NU(t,xU),s.negate();r.negate()}i.negate()}return t}(t);if(e.region){const[t,n,i,r,s,o]=e.region;return[[P_(t),P_(n),s],[P_(i),P_(r),o]]}if(e.sphere)return function(e){const t=BU(),{center:n,radius:i}=e,r=qF.WGS84.scaleToGeodeticSurface(n,xU);let s;s=r?qF.WGS84.geodeticSurfaceNormal(r):new hb(0,0,1);let o=new hb(s[2],-s[1],0);o.len()>0?o.normalize():o=new hb(0,1,0);const a=o.clone().cross(s);for(const l of[o,a,s]){AU.copy(l).scale(i);for(let e=0;e<2;e++)xU.copy(n),xU.add(AU),NU(t,xU),AU.negate()}return t}(t);throw new Error("Unkown boundingVolume type")}function LU(e,t,n){const i=new hb(e[0],e[1],e[2]);t.transform(i,i);let r=[];if(10===e.length){const t=e.slice(3,6),n=new nE;n.fromArray(e,6);const i=new hb([1,0,0]),s=new hb([0,1,0]),o=new hb([0,0,1]);i.transformByQuaternion(n),i.scale(t[0]),s.transformByQuaternion(n),s.scale(t[1]),o.transformByQuaternion(n),o.scale(t[2]),r=[...i.toArray(),...s.toArray(),...o.toArray()]}else r=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const s=t.transformAsVector(r.slice(0,3)),o=t.transformAsVector(r.slice(3,6)),a=t.transformAsVector(r.slice(6,9)),l=new _b([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return wU(n)?(n.center=i,n.halfAxes=l,n):new zM(i,l)}function BU(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function NU(e,t){qF.WGS84.cartesianToCartographic(t,xU),e[0][0]=Math.min(e[0][0],xU[0]),e[0][1]=Math.min(e[0][1],xU[1]),e[0][2]=Math.min(e[0][2],xU[2]),e[1][0]=Math.max(e[1][0],xU[0]),e[1][1]=Math.max(e[1][1],xU[1]),e[1][2]=Math.max(e[1][2],xU[2])}function OU(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const n=e.dynamicScreenSpaceErrorComputedDensity,i=e.dynamicScreenSpaceErrorFactor,r=function(e,t){const n=e*t;return 1-Math.exp(-n*n)}(t,n)*i;return r}return 0}new hb,new hb,new Fb,new hb,new hb,new hb;const DU=new hb,FU=new hb,UU=new hb,zU=new hb,GU=new hb,VU=new Fb,HU=new Fb;function jU(e,t){const{topDownViewport:n}=t,i=e.header.mbs[1],r=e.header.mbs[0],s=e.header.mbs[2],o=e.header.mbs[3],a=[...e.boundingVolume.center],l=n.unprojectPosition(n.cameraPosition);qF.WGS84.cartographicToCartesian(l,DU),FU.copy(DU).subtract(a).normalize(),qF.WGS84.eastNorthUpToFixedFrame(a,VU),HU.copy(VU).invert(),UU.copy(DU).transform(HU);const c=Math.sqrt(UU[0]*UU[0]+UU[1]*UU[1]),u=c*c/UU[2];zU.copy([UU[0],UU[1],u]);const h=zU.transform(VU).subtract(a).normalize(),d=FU.cross(h).normalize().scale(o).add(a),f=qF.WGS84.cartesianToCartographic(d),p=n.project([r,i,s]),g=n.project(f);return GU.copy(p).subtract(g).magnitude()}class WU{constructor(e=0){i(this,"_map",new Map),i(this,"_array"),i(this,"_length"),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Kh(e<this._array.length),this._array[e]}set(e,t){Kh(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Kh(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Kh(e>=0),this.length=e}trim(e){null==e&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const $U={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class XU{constructor(e){i(this,"options"),i(this,"root",null),i(this,"selectedTiles",{}),i(this,"requestedTiles",{}),i(this,"emptyTiles",{}),i(this,"lastUpdate",(new Date).getTime()),i(this,"updateDebounceTime",1e3),i(this,"_traversalStack",new WU),i(this,"_emptyTraversalStack",new WU),i(this,"_frameNumber",null),this.options={...$U,...e}}traversalFinished(e){return!0}traverse(e,t,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const e=n.pop();let i=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),i=this.updateAndPushChildren(e,t,n,e.hasRenderContent?e._selectionDepth+1:e._selectionDepth));const r=e.parent,s=Boolean(!r||r._shouldRefine),o=!i;e.hasRenderContent?e.refine===fU.ADD?(this.loadTile(e,t),this.selectTile(e,t)):e.refine===fU.REPLACE&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=i&&s}const i=(new Date).getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const n=e.children;for(const i of n)this.updateTile(i,t)}updateAndPushChildren(e,t,n,i){const{loadSiblings:r,skipLevelOfDetail:s}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const a=e.refine===fU.REPLACE&&e.hasRenderContent&&!s;let l=!1,c=!0;for(const u of o)if(u._selectionDepth=i,u.isVisibleAndInRequestVolume?(n.find(u)&&n.delete(u),n.push(u),l=!0):(a||r)&&(this.loadTile(u,t),this.touchTile(u,t)),a){let e;if(e=!!u._inRequestVolume&&(u.hasRenderContent?u.contentAvailable:this.executeEmptyTraversal(u,t)),c=c&&e,!c)return!1}return l||(c=!1),c}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t))}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,n=!1){let i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap){this.options.viewportTraversersMap[i]===t.viewport.id&&n.push(i)}else n.push(t.viewport.id);e.updateVisibility(t,n)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let n=!1;for(const i of e.children)i.updateVisibility(t),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,t){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const e=i.pop(),r=!e.hasRenderContent&&this.canTraverse(e,t),s=!e.hasRenderContent&&0===e.children.length;if(r||e.contentAvailable||s||(n=!1),this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t)),r){const t=e.children;for(const e of t)i.push(e)}}return n}}const qU=new hb;class KU{constructor(e,t,n,r=""){i(this,"tileset"),i(this,"header"),i(this,"id"),i(this,"url"),i(this,"parent"),i(this,"refine"),i(this,"type"),i(this,"contentUrl"),i(this,"lodMetricType","geometricError"),i(this,"lodMetricValue",0),i(this,"boundingVolume",null),i(this,"content",null),i(this,"contentState",lU),i(this,"gpuMemoryUsageInBytes",0),i(this,"children",[]),i(this,"depth",0),i(this,"viewportIds",[]),i(this,"transform",new Fb),i(this,"extensions",null),i(this,"implicitTiling",null),i(this,"userData",{}),i(this,"computedTransform"),i(this,"hasEmptyContent",!1),i(this,"hasTilesetContent",!1),i(this,"traverser",new XU({})),i(this,"_cacheNode",null),i(this,"_frameNumber",null),i(this,"_expireDate",null),i(this,"_expiredContent",null),i(this,"_boundingBox"),i(this,"_distanceToCamera",0),i(this,"_screenSpaceError",0),i(this,"_visibilityPlaneMask"),i(this,"_visible"),i(this,"_contentBoundingVolume"),i(this,"_viewerRequestVolume"),i(this,"_initialTransform",new Fb),i(this,"_priority",0),i(this,"_selectedFrame",0),i(this,"_requestedFrame",0),i(this,"_selectionDepth",0),i(this,"_touchedFrame",0),i(this,"_centerZDepth",0),i(this,"_shouldRefine",!1),i(this,"_stackLength",0),i(this,"_visitedFrame",0),i(this,"_inRequestVolume",!1),i(this,"_lodJudge",null),this.header=t,this.tileset=e,this.id=r||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===uU||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===lU}get contentExpired(){return this.contentState===hU}get contentFailed(){return this.contentState===dU}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=MU(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case yU.I3S:return jU(this,e);case yU.TILES3D:return function(e,t,n){const i=e.tileset,r=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=n?r:e.lodMetricValue;if(0===s)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:c}=i.options;let u=s*a*(c||1)/(o*l);return u-=OU(i,o),u}(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,n=this.refine===fU.ADD||t;if(n&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===lU)return-1;const i=this.parent,r=i&&(!n||0===this._screenSpaceError||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-r,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=cU;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=lU,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,n={...this.tileset.loadOptions,[t.id]:{...this.tileset.loadOptions[t.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)}};return this.content=await dp(e,t,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=uU,this._onContentLoaded(),!0}catch(t){throw this.contentState=dU,t}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=lU,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:XM.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const e=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(e)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==XM.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return qU.subVectors(t.center,e.position),e.direction.dot(qU)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=hU,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){this.lodMetricType="lodMetricType"in e?e.lodMetricType:this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,this.lodMetricValue="lodMetricValue"in e?e.lodMetricValue:this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue}_initializeTransforms(e){this.transform=e.transform?new Fb(e.transform):new Fb;const t=this.parent,n=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new Fb(i).multiplyRight(this.transform);const r=t&&t._initialTransform?t._initialTransform.clone():new Fb;this._initialTransform=new Fb(r).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=lU,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=XM.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||fU.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=PU(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=PU(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=PU(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Fb){const t=e.clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){return"i3s"===e?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"};var t}}class YU extends XU{compareDistanceToCamera(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const n=e.children[0];return this.updateTileVisibility(n,t),void(e._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))return void(e._visible=!1);const i=e.refine===fU.REPLACE,r=e._optimChildrenWithinParent===EU;i&&r&&n&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}meetsScreenSpaceErrorEarly(e,t){const{parent:n}=e;return!(!n||n.hasTilesetContent||n.refine!==fU.ADD)&&!this.shouldRefine(e,t,!0)}}class JU{constructor(){i(this,"frameNumberMap",new Map)}register(e,t){const n=this.frameNumberMap.get(e)||new Map,i=n.get(t)||0;n.set(t,i+1),this.frameNumberMap.set(e,n)}deregister(e,t){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(t)||1;n.set(t,i-1)}isZero(e,t){var n;return 0===((null==(n=this.frameNumberMap.get(e))?void 0:n.get(t))||0)}}const ZU="REQUESTED",QU="COMPLETED",ez="ERROR";class tz{constructor(){i(this,"_statusMap"),i(this,"pendingTilesRegister",new JU),this._statusMap={}}add(e,t,n,i){if(!this._statusMap[t]){const{frameNumber:r,viewport:{id:s}}=i;this._statusMap[t]={request:e,callback:n,key:t,frameState:i,status:ZU},this.pendingTilesRegister.register(s,r),e().then(e=>{this._statusMap[t].status=QU;const{frameNumber:n,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,n),this._statusMap[t].callback(e,i)}).catch(e=>{this._statusMap[t].status=ez;const{frameNumber:i,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,i),n(e)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:r,viewport:{id:s}}=t;this.pendingTilesRegister.register(s,r),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class nz extends XU{constructor(e){super(e),i(this,"_tileManager"),this._tileManager=new tz}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=function(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";const n=2*jU(e,t);return n<2?"OUT":!e.header.children||n<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const n=e.header.children||[],i=e.children,r=e.tileset;for(const s of n){const n=`${s.id}-${t.viewport.id}`,o=i&&i.find(e=>e.id===n);if(o)o&&this.updateTile(o,t);else{let i=()=>this._loadTile(s.id,r);this._tileManager.find(n)?this._tileManager.update(n,t):(r.tileset.nodePages&&(i=()=>r.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(i,n,t=>this._onTileLoad(t,e,n),t))}}return!1}async _loadTile(e,t){const{loader:n}=t,i=t.getTileUrl(`${t.url}/nodes/${e}`),r={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await dp(i,n,r)}_onTileLoad(e,t,n){const i=new KU(t.tileset,e,t,n);t.children.push(i);const r=this._tileManager.find(i.id).frameState;this.updateTile(i,r),this._frameNumber===r.frameNumber&&(this.traversalFinished(r)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,r)}}const iz={description:"",ellipsoid:qF.WGS84,modelMatrix:new Fb,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},rz="Tiles In Tileset(s)",sz="Tiles In Memory",oz="Tiles In View",az="Tiles To Render",lz="Tiles Loaded",cz="Tiles Loading",uz="Tiles Unloaded",hz="Failed Tile Loads",dz="Points/Vertices",fz="Tile Memory Use",pz="Maximum Screen Space Error";class gz{constructor(e,t){i(this,"options"),i(this,"loadOptions"),i(this,"type"),i(this,"tileset"),i(this,"loader"),i(this,"url"),i(this,"basePath"),i(this,"modelMatrix"),i(this,"ellipsoid"),i(this,"lodMetricType"),i(this,"lodMetricValue"),i(this,"refine"),i(this,"root",null),i(this,"roots",{}),i(this,"asset",{}),i(this,"description",""),i(this,"properties"),i(this,"extras",null),i(this,"attributions",{}),i(this,"credits",{}),i(this,"stats"),i(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),i(this,"cartographicCenter",null),i(this,"cartesianCenter",null),i(this,"zoom",1),i(this,"boundingVolume",null),i(this,"dynamicScreenSpaceErrorComputedDensity",0),i(this,"maximumMemoryUsage",32),i(this,"gpuMemoryUsageInBytes",0),i(this,"memoryAdjustedScreenSpaceError",0),i(this,"_cacheBytes",0),i(this,"_cacheOverflowBytes",0),i(this,"_frameNumber",0),i(this,"_queryParams",{}),i(this,"_extensionsUsed",[]),i(this,"_tiles",{}),i(this,"_pendingCount",0),i(this,"selectedTiles",[]),i(this,"traverseCounter",0),i(this,"geometricError",0),i(this,"lastUpdatedVieports",null),i(this,"_requestedTiles",[]),i(this,"_emptyTiles",[]),i(this,"frameStateData",{}),i(this,"_traverser"),i(this,"_cache",new JF),i(this,"_requestScheduler"),i(this,"updatePromise",null),i(this,"tilesetInitializationPromise"),this.options={...iz,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||hf(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new of({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=1024*this.options.maximumMemoryUsage*1024,this._cacheOverflowBytes=1024*this.options.memoryCacheOverflow*1024,this.stats=new rf({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let t=e;return this.queryParams.length&&(t=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),t}hasExtension(e){return Boolean(this._extensionsUsed.indexOf(e)>-1)}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const n=[];for(const i of t){const e=i.id;this._needTraverse(e)?n.push(e):this.traverseCounter--}for(const i of t){const e=i.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null)),!n.includes(e))continue;const t=tU(i,this._frameNumber);this._traverser.traverse(this.roots[e],t,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[r,s]=function(e,t,n){if(0===n||e.length<=n)return[e,[]];const i=[],{longitude:r,latitude:s}=t.viewport;for(const[c,u]of e.entries()){const[e,t]=u.header.mbs,n=Math.abs(r-e),o=Math.abs(s-t),a=Math.sqrt(o*o+n*n);i.push([c,a])}const o=i.sort((e,t)=>e[1]-t[1]),a=[];for(let c=0;c<n;c++)a.push(e[o[c][0]]);const l=[];for(let c=n;c<o.length;c++)l.push(e[o[c][0]]);return[a,l]}(i,e,this.options.maximumTilesSelected);n.selectedTiles=r;for(const o of s)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const n=new Set(e.map(e=>e.id)),i=new Set(t.map(e=>e.id));let r=e.filter(e=>!i.has(e.id)).length>0;return r=r||t.filter(e=>!n.has(e.id)).length>0,r}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?t+=n.content.pointCount:t+=n.content.vertexCount);this.stats.get(oz).count=this.selectedTiles.length,this.stats.get(az).count=e,this.stats.get(dz).count=t,this.stats.get(pz).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===yU.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===yU.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===yU.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const t=this.tileset.fullExtent;if(t){const{xmin:e,xmax:n,ymin:i,ymax:r,zmin:s,zmax:o}=t;return this.cartographicCenter=new hb(e+(n-e)/2,i+(r-i)/2,s+(o-s)/2),this.cartesianCenter=new hb,qF.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=aU(t,this.cartographicCenter,this.cartesianCenter))}const n=null==(e=this.tileset.store)?void 0:e.extent;if(n){const[e,t,i,r]=n;return this.cartographicCenter=new hb(e+(i-e)/2,t+(r-t)/2,0),this.cartesianCenter=new hb,qF.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=function(e,t,n){const[i,r,s,o]=e;return aU({xmax:s,ymax:o,zmax:0},t,n)}(n,this.cartographicCenter,this.cartesianCenter))}this.cartographicCenter=new hb,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t)return this.cartographicCenter=new hb,void(this.zoom=1);0!==t[0]||0!==t[1]||0!==t[2]?(this.cartographicCenter=new hb,qF.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new hb(0,0,-qF.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=oU(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(rz),this.stats.get(cz),this.stats.get(sz),this.stats.get(oz),this.stats.get(az),this.stats.get(lz),this.stats.get(uz),this.stats.get(hz),this.stats.get(dz),this.stats.get(fz,"memory"),this.stats.get(pz)}_initializeTileHeaders(e,t){var n;const i=new KU(this,e.root,t);if(t&&(t.children.push(i),i.depth=t.depth+1),this.type===yU.TILES3D){const e=[];for(e.push(i);e.length>0;){const t=e.pop();this.stats.get(rz).incrementCount();const i=t.header.children||[];for(const r of i){const i=new KU(this,r,t);if(null==(n=i.contentUrl)?void 0:n.includes("?session=")){const e=new URL(i.contentUrl).searchParams.get("session");e&&(this._queryParams.session=e)}t.children.push(i),i.depth=t.depth+1,e.push(i)}}}return i}_initializeTraverser(){let e;switch(this.type){case yU.TILES3D:e=YU;break;case yU.I3S:e=nz;break;default:e=XU}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(hz).incrementCount();const n=t.message||t.toString(),i=e.url;this.options.onTileError(e,n,i)}_onTileLoad(e,t){var n,i;if(t){if(this.type===yU.I3S){const e=(null==(i=null==(n=this.tileset)?void 0:n.nodePagesTile)?void 0:i.nodesInNodePages)||0;this.stats.get(rz).reset(),this.stats.get(rz).addCount(e)}e&&e.content&&function(e,t){Kh(e),Kh(t);const{rtcCenter:n,gltfUpAxis:i}=t,{computedTransform:r,boundingVolume:{center:s}}=e;let o=new Fb(r);switch(n&&o.translate(n),i){case"Z":break;case"Y":const e=(new Fb).rotateX(Math.PI/2);o=o.multiplyRight(e);break;case"X":const t=(new Fb).rotateY(-Math.PI/2);o=o.multiplyRight(t)}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const a=new hb(s);t.cartesianModelMatrix=o,t.cartesianOrigin=a;const l=qF.WGS84.cartesianToCartographic(a,new hb),c=qF.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=c.multiplyRight(o),t.cartographicOrigin=l,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var t;if(this.type===yU.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===yU.TILES3D){const{extensionsRemoved:n=[]}=(null==(t=e.content)?void 0:t.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(cz).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(cz).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(lz).incrementCount(),this.stats.get(sz).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(fz).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(sz).decrementCount(),this.stats.get(uz).incrementCount(),this.stats.get(fz).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const n of t.children)e.push(n);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,n=[];for(n.push(t);n.length>0;){e=n.pop();for(const t of e.children)n.push(t);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),n=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const mz="4.3.3",yz="cmpt",vz="pnts",_z="b3dm",bz="i3dm",Ez="glTF";function wz(e,t,n){Kh(e instanceof ArrayBuffer);const i=new TextDecoder("utf8"),r=new Uint8Array(e,t,n);return i.decode(r)}const xz={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Az={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...xz},Sz={[xz.DOUBLE]:Float64Array,[xz.FLOAT]:Float32Array,[xz.UNSIGNED_SHORT]:Uint16Array,[xz.UNSIGNED_INT]:Uint32Array,[xz.UNSIGNED_BYTE]:Uint8Array,[xz.BYTE]:Int8Array,[xz.SHORT]:Int16Array,[xz.INT]:Int32Array},Tz={DOUBLE:xz.DOUBLE,FLOAT:xz.FLOAT,UNSIGNED_SHORT:xz.UNSIGNED_SHORT,UNSIGNED_INT:xz.UNSIGNED_INT,UNSIGNED_BYTE:xz.UNSIGNED_BYTE,BYTE:xz.BYTE,SHORT:xz.SHORT,INT:xz.INT},Cz="Failed to convert GL type";class Iz{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in Sz){if(Sz[t]===e)return t}throw new Error(Cz)}static fromName(e){const t=Tz[e];if(!t)throw new Error(Cz);return t}static getArrayType(e){switch(e){case xz.UNSIGNED_SHORT_5_6_5:case xz.UNSIGNED_SHORT_4_4_4_4:case xz.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=Sz[e];if(!t)throw new Error(Cz);return t}}static getByteSize(e){return Iz.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(Iz.getArrayType(e))}static createTypedArray(e,t,n=0,i){void 0===i&&(i=(t.byteLength-n)/Iz.getByteSize(e));return new(Iz.getArrayType(e))(t,n,i)}}function kz(e,t=[0,0,0]){const n=e>>11&31,i=e>>5&63,r=31&e;return t[0]=n<<3,t[1]=i<<2,t[2]=r<<3,t}function Rz(e,t=255){return M_(e,0,t)/t*2-1}function Pz(e){return e<0?-1:1}function Mz(e,t,n,i){if(function(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}(i),e<0||e>n||t<0||t>n)throw new Error(`x and y must be unsigned normalized integers between 0 and ${n}`);if(i.x=Rz(e,n),i.y=Rz(t,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const e=i.x;i.x=(1-Math.abs(i.y))*Pz(e),i.y=(1-Math.abs(e))*Pz(i.y)}return i.normalize()}function Lz(e,t,n){return Mz(e,t,255,n)}new Y_,new hb,new Y_,new Y_;class Bz{constructor(e,t){i(this,"json"),i(this,"buffer"),i(this,"featuresLength",0),i(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,t=Az.UNSIGNED_INT,n=1){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,i.byteOffset):i}getPropertyArray(e,t,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=Iz.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,n,i,r){const s=this.json[e];if(!s)return s;const o=this.getPropertyArray(e,t,n);if(1===n)return o[i];for(let a=0;a<n;++a)r[a]=o[n*i+a];return r}_getTypedArrayFromBinary(e,t,n,i,r){const s=this._cachedTypedArrays;let o=s[e];return o||(o=Iz.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+r,i*n),s[e]=o),o}_getTypedArrayFromArray(e,t,n){const i=this._cachedTypedArrays;let r=i[e];return r||(r=Iz.createTypedArray(t,n),i[e]=r),r}}const Nz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Oz={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},Dz={SCALAR:(e,t,n)=>{t[n]=e},VEC2:(e,t,n)=>{t[2*n+0]=e[0],t[2*n+1]=e[1]},VEC3:(e,t,n)=>{t[3*n+0]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2]},VEC4:(e,t,n)=>{t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT2:(e,t,n)=>{t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT3:(e,t,n)=>{t[9*n+0]=e[0],t[9*n+1]=e[1],t[9*n+2]=e[2],t[9*n+3]=e[3],t[9*n+4]=e[4],t[9*n+5]=e[5],t[9*n+6]=e[6],t[9*n+7]=e[7],t[9*n+8]=e[8],t[9*n+9]=e[9]},MAT4:(e,t,n)=>{t[16*n+0]=e[0],t[16*n+1]=e[1],t[16*n+2]=e[2],t[16*n+3]=e[3],t[16*n+4]=e[4],t[16*n+5]=e[5],t[16*n+6]=e[6],t[16*n+7]=e[7],t[16*n+8]=e[8],t[16*n+9]=e[9],t[16*n+10]=e[10],t[16*n+11]=e[11],t[16*n+12]=e[12],t[16*n+13]=e[13],t[16*n+14]=e[14],t[16*n+15]=e[15]}};const Fz=e=>void 0!==e;function Uz(e,t,n){if(!t)return null;let i=e.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,i=r),i?function(e,t){let n,i,r;const s=e.instancesLength,o=e.classes;let a,l=e.classIds,c=e.parentCounts,u=e.parentIds,h=s;Fz(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,s));if(Fz(c))for(Fz(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,s)),a=new Uint16Array(s),h=0,n=0;n<s;++n)a[n]=h,h+=c[n];Fz(u)&&Fz(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,r=getBinaryAccessor(u),u=r.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,h));const d=o.length;for(n=0;n<d;++n){const e=o[n].length,i=o[n].instances,r=getBinaryProperties(e,i,t);o[n].instances=combine(r,i)}const f=new Array(d).fill(0),p=new Uint16Array(s);for(n=0;n<s;++n)i=l[n],p[n]=f[i],++f[i];const g={classes:o,classIds:l,classIndexes:p,parentCounts:c,parentIndexes:a,parentIds:u};return function(e){const t=e.classIds,n=t.length;for(let i=0;i<n;++i)Gz(e,i,stack)}(g),g}(i,n):null}function zz(e,t,n){if(!e)return;const i=e.parentCounts;return e.parentIds?n(e,t):i>0?function(e,t,n){const i=e.classIds,r=e.parentCounts,s=e.parentIds,o=e.parentIndexes,a=i.length,l=scratchVisited;l.length=Math.max(l.length,a);const c=++marker,u=scratchStack;u.length=0,u.push(t);for(;u.length>0;){if(l[t=u.pop()]===c)continue;l[t]=c;const i=n(e,t);if(Fz(i))return i;const a=r[t],h=o[t];for(let e=0;e<a;++e){const n=s[h+e];n!==t&&u.push(n)}}return null}(e,t,n):function(e,t,n){let i=!0;for(;i;){const r=n(e,t);if(Fz(r))return r;const s=e.parentIds[t];i=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}(e,t,n)}function Gz(e,t,n){const i=e.parentCounts,r=e.parentIds,s=e.parentIndexes,o=e.classIds.length;if(!Fz(r))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(-1===n.indexOf(t),"Circular dependency detected in the batch table hierarchy."),n.push(t);const a=Fz(i)?i[t]:1,l=Fz(i)?s[t]:t;for(let c=0;c<a;++c){const i=r[l+c];i!==t&&Gz(e,i,n)}n.pop(t)}function Vz(e){return null!=e}const Hz=(e,t)=>e,jz={HIERARCHY:!0,extensions:!0,extras:!0};class Wz{constructor(e,t,n,r={}){var s;i(this,"json"),i(this,"binary"),i(this,"featureCount"),i(this,"_extensions"),i(this,"_properties"),i(this,"_binaryProperties"),i(this,"_hierarchy"),Kh(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=(null==(s=this.json)?void 0:s.extensions)||{},this._properties={};for(const i in this.json)jz[i]||(this._properties[i]=this.json[i]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Uz(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Kh("string"==typeof t,t),this._hierarchy){return Vz(zz(this._hierarchy,e,(e,n)=>{const i=e.classIds[n];return e.classes[i].name===t}))}return!1}isExactClass(e,t){return Kh("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Kh("string"==typeof t,t),Vz(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=Vz(t)?t:[]).length=0;const n=Object.keys(this._properties);return t.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Kh("string"==typeof t,t),this._binaryProperties){const n=this._binaryProperties[t];if(Vz(n))return this._getBinaryProperty(n,e)}const n=this._properties[t];if(Vz(n))return Hz(n[e]);if(this._hierarchy){const n=this._getHierarchyProperty(e,t);if(Vz(n))return n}}setProperty(e,t,n){const i=this.featureCount;if(this._checkBatchId(e),Kh("string"==typeof t,t),this._binaryProperties){const i=this._binaryProperties[t];if(i)return void this._setBinaryProperty(i,e,n)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,n))return;let r=this._properties[t];Vz(r)||(this._properties[t]=new Array(i),r=this._properties[t]),r[e]=Hz(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,n){e.pack(n,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const n=this._properties[t],i=this._initializeBinaryProperty(t,n);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const n=t;Kh(this.binary,`Property ${e} requires a batch table binary.`),Kh(n.type,`Property ${e} requires a type.`);const i=function(e,t,n,i){const{componentType:r}=e;Kh(e.componentType);const s="string"==typeof r?Iz.fromName(r):r,o=Nz[e.type],a=Oz[e.type],l=Dz[e.type];return n+=e.byteOffset,{values:Iz.createTypedArray(s,t,n,o*i),type:s,size:o,unpacker:a,packer:l}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const n=zz(this._hierarchy,e,(e,n)=>{const i=e.classIds[n];return Vz(e.classes[i].instances[t])});return Vz(n)}_getPropertyNamesInHierarchy(e,t){zz(this._hierarchy,e,(e,n)=>{const i=e.classIds[n],r=e.classes[i].instances;for(const s in r)r.hasOwnProperty(s)&&-1===t.indexOf(s)&&t.push(s)})}_getHierarchyProperty(e,t){return zz(this._hierarchy,e,(e,n)=>{const i=e.classIds[n],r=e.classes[i],s=e.classIndexes[n],o=r.instances[t];return Vz(o)?Vz(o.typedArray)?this._getBinaryProperty(o,s):Hz(o[s]):null})}_setHierarchyProperty(e,t,n,i){const r=zz(this._hierarchy,t,(e,r)=>{const s=e.classIds[r],o=e.classes[s],a=e.classIndexes[r],l=o.instances[n];return!!Vz(l)&&(Kh(r===t,`Inherited property "${n}" is read-only.`),Vz(l.typedArray)?this._setBinaryProperty(l,a,i):l[a]=Hz(i),!0)});return Vz(r)}}function $z(e,t,n=0){const i=new DataView(t);if(e.magic=i.getUint32(n,!0),n+=4,e.version=i.getUint32(n,!0),n+=4,e.byteLength=i.getUint32(n,!0),n+=4,1!==e.version)throw new Error(`3D Tile Version ${e.version} not supported`);return n}function Xz(e,t,n){const i=new DataView(t);let r;e.header=e.header||{};let s=i.getUint32(n,!0);n+=4;let o=i.getUint32(n,!0);n+=4;let a=i.getUint32(n,!0);n+=4;let l=i.getUint32(n,!0);return n+=4,a>=570425344?(n-=8,r=s,a=o,l=0,s=0,o=0):l>=570425344&&(n-=4,r=a,a=s,l=o,s=0,o=0),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=l,e.header.batchLength=r,n}function qz(e,t,n,i){return n=function(e,t,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:r,batchLength:s}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:s||0},i&&i>0){const r=wz(t,n,i);e.featureTableJson=JSON.parse(r)}return n+=i||0,e.featureTableBinary=new Uint8Array(t,n,r),n+=r||0,n}(e,t,n),n=function(e,t,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:r}=e.header||{};if(i&&i>0){const s=wz(t,n,i);e.batchTableJson=JSON.parse(s),n+=i,r&&r>0&&(e.batchTableBinary=new Uint8Array(t,n,r),e.batchTableBinary=new Uint8Array(e.batchTableBinary),n+=r)}return n}(e,t,n),n}function Kz(e,t,n){if(!(t||e&&e.batchIds&&n))return null;const{batchIds:i,isRGB565:r,pointCount:s=0}=e;if(i&&n){const e=new Uint8ClampedArray(3*s);for(let t=0;t<s;t++){const r=i[t],s=n.getProperty(r,"dimensions").map(e=>255*e);e[3*t]=s[0],e[3*t+1]=s[1],e[3*t+2]=s[2]}return{type:Az.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(t&&r){const e=new Uint8ClampedArray(3*s);for(let n=0;n<s;n++){const i=kz(t[n]);e[3*n]=i[0],e[3*n+1]=i[1],e[3*n+2]=i[2]}return{type:Az.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*s?{type:Az.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Az.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const Yz=new hb;function Jz(e,t,n){return e.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){const n=new hb,i=new Float32Array(3*e.pointCount);for(let r=0;r<e.pointCount;r++)n.set(t[3*r],t[3*r+1],t[3*r+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(i,3*r);return i}(e,t)):{type:Az.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}async function Zz(e,t,n,i,r){n=qz(e,t,n=Xz(e,t,n=$z(e,t,n))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}(e);const{featureTable:s,batchTable:o}=function(e){const t=new Bz(e.featureTableJson,e.featureTableBinary),n=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=n,e.featuresLength=n,e.pointsLength=n,e.pointCount=n,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",Az.FLOAT,3);const i=function(e,t){let n=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",Az.UNSIGNED_SHORT,1),e.batchIds)){const i=t.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:s}=e;n=new Wz(r,s,i)}return n}(e,t);return{featureTable:t,batchTable:i}}(e);return await async function(e,t,n,i,r){let s,o,a;const l=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const c=t.getExtension("3DTILES_draco_point_compression");if(c){o=c.properties;const t=c.byteOffset,n=c.byteLength;if(!o||!Number.isFinite(t)||!n)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(e.featureTableBinary||[]).slice(t,t+n),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const u={buffer:s,properties:{...o,...a},batchTableProperties:a};return await async function(e,t,n,i){if(!i)return;const r={...n,draco:{...null==n?void 0:n.draco,extraAttributes:t.batchTableProperties||{}}};delete r["3d-tiles"];const s=await qh(t.buffer,SD,r,i),o=s.attributes.POSITION&&s.attributes.POSITION.value,a=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,l=s.attributes.NORMAL&&s.attributes.NORMAL.value,c=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,u=o&&s.attributes.POSITION.value.quantization,h=l&&s.attributes.NORMAL.value.quantization;if(u){const t=s.POSITION.data.quantization,n=t.range;e.quantizedVolumeScale=new hb(n,n,n),e.quantizedVolumeOffset=new hb(t.minValues),e.quantizedRange=(1<<t.quantizationBits)-1,e.isQuantizedDraco=!0}h&&(e.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const d={};if(t.batchTableProperties)for(const f of Object.keys(t.batchTableProperties))s.attributes[f]&&s.attributes[f].value&&(d[f.toLowerCase()]=s.attributes[f].value);e.attributes={positions:o,colors:Kz(e,a,void 0),normals:l,batchIds:c,...d}}(e,u,i,r)}(e,s,0,i,r),function(e,t,n){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",Az.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const i=t.getPropertyArray("POSITION_QUANTIZED",Az.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Az.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Az.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=Jz(e,i,n)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(e,s,i),function(e,t,n){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let i=null;t.hasProperty("RGBA")?(i=t.getPropertyArray("RGBA",Az.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?i=t.getPropertyArray("RGB",Az.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(i=t.getPropertyArray("RGB565",Az.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=Kz(e,i,n)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Az.UNSIGNED_BYTE,4))}(e,s,o),function(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let n=null;t.hasProperty("NORMAL")?n=t.getPropertyArray("NORMAL",Az.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(n=t.getPropertyArray("NORMAL_OCT16P",Az.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){const n=new Float32Array(3*(e.pointsLength||0));for(let i=0;i<(e.pointsLength||0);i++)Lz(t[2*i],t[2*i+1],Yz),Yz.toArray(n,3*i);return{type:Az.FLOAT,size:2,value:n}}return{type:Az.FLOAT,size:2,value:t}}(e,n)}}(e,s),n}const Qz=0,eG=1;function tG(e,t,n,i){e.rotateYtoZ=!0;const r=(e.byteOffset||0)+(e.byteLength||0)-n;if(0===r)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=(null==i?void 0:i["3d-tiles"])&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=Zd(t,n,r),e.gltfByteOffset=0,e.gltfByteLength=r,(e.byteOffset||0)+(e.byteLength||0)}async function nG(e,t,n,i){const r=(null==n?void 0:n["3d-tiles"])||{};if(function(e,t){switch(t){case Qz:if(e.gltfArrayBuffer){const t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),n=(new TextDecoder).decode(t);e.gltfUrl=n.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case eG:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),r.loadGLTF){if(!i)return;if(e.gltfUrl){const{fetch:t}=i,r=await t(e.gltfUrl,n);e.gltfArrayBuffer=await r.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const t=await qh(e.gltfArrayBuffer,sF,n,i);e.gltf=vF(t),e.gpuMemoryUsageInBytes=KN(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}async function iG(e,t,n,i,r){var s;n=function(e,t,n,i){n=$z(e,t,n),n=Xz(e,t,n),n=qz(e,t,n),n=tG(e,t,n,i);const r=new Bz(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=r.getGlobalProperty("RTC_CENTER",Az.FLOAT,3),n}(e,t,n,i),await nG(e,eG,i,r);const o=null==(s=null==e?void 0:e.gltf)?void 0:s.extensions;return o&&o.CESIUM_RTC&&(e.rtcCenter=o.CESIUM_RTC.center),n}async function rG(e,t,n,i,r){return n=function(e,t,n,i){var r;if(n=$z(e,t,n),1!==e.version)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);n=Xz(e,t,n);const s=new DataView(t);if(e.gltfFormat=s.getUint32(n,!0),n+=4,n=qz(e,t,n),n=tG(e,t,n,i),!(null==(r=null==e?void 0:e.header)?void 0:r.featureTableJsonByteLength)||0===e.header.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Bz(e.featureTableJson,e.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",Az.FLOAT,3);new Wz(e.batchTableJson,e.batchTableBinary,a);return function(e,t,n,i){const r=new Array(i),s=new hb;new hb,new hb,new hb;const o=new _b,a=new nE,l=new hb,c={},u=new Fb,h=[],d=[],f=[],p=[];for(let g=0;g<i;g++){let n;if(t.hasProperty("POSITION"))n=t.getProperty("POSITION",Az.FLOAT,3,g,s);else if(t.hasProperty("POSITION_QUANTIZED")){n=t.getProperty("POSITION_QUANTIZED",Az.UNSIGNED_SHORT,3,g,s);const e=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Az.FLOAT,3);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Az.FLOAT,3);if(!i)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const r=65535;for(let t=0;t<3;t++)n[t]=n[t]/r*i[t]+e[t]}if(!n)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(n),c.translation=s,e.normalUp=t.getProperty("NORMAL_UP",Az.FLOAT,3,g,h),e.normalRight=t.getProperty("NORMAL_RIGHT",Az.FLOAT,3,g,d),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Az.UNSIGNED_SHORT,2,g,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Az.UNSIGNED_SHORT,2,g,d),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(qF.WGS84.eastNorthUpToFixedFrame(s,u),u.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),c.rotation=a,l.set(1,1,1);const i=t.getProperty("SCALE",Az.FLOAT,1,g,f);Number.isFinite(i)&&l.multiplyByScalar(i);const m=t.getProperty("SCALE_NON_UNIFORM",Az.FLOAT,3,g,h);m&&l.scale(m),c.scale=l;let y=t.getProperty("BATCH_ID",Az.UNSIGNED_SHORT,1,g,p);void 0===y&&(y=g);const v=(new Fb).fromQuaternion(c.rotation);u.identity(),u.translate(c.translation),u.multiplyRight(v),u.scale(c.scale);const _=u.clone();r[g]={modelMatrix:_,batchId:y}}e.instances=r}(e,o,0,a),n}(e,t,n,i),await nG(e,e.gltfFormat||0,i,r),n}async function sG(e,t=0,n,i,r={shape:"tile3d"}){switch(r.byteOffset=t,r.type=function(e,t=0){const n=new DataView(e);return`${String.fromCharCode(n.getUint8(t+0))}${String.fromCharCode(n.getUint8(t+1))}${String.fromCharCode(n.getUint8(t+2))}${String.fromCharCode(n.getUint8(t+3))}`}(e,t),r.type){case yz:return await async function(e,t,n,i,r,s){n=$z(e,t,n);const o=new DataView(t);for(e.tilesLength=o.getUint32(n,!0),n+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-n>12;){const o={shape:"tile3d"};e.tiles.push(o),n=await s(t,n,i,r,o)}return n}(r,e,t,n,i,sG);case _z:return await iG(r,e,t,n,i);case Ez:return await async function(e,t,n,i){var r,s;if(e.rotateYtoZ=!0,e.gltfUpAxis=(null==(r=null==n?void 0:n["3d-tiles"])?void 0:r.assetGltfUpAxis)?n["3d-tiles"].assetGltfUpAxis:"Y",null==(s=null==n?void 0:n["3d-tiles"])?void 0:s.loadGLTF){if(!i)return t.byteLength;const r=await qh(t,sF,n,i);e.gltf=vF(r),e.gpuMemoryUsageInBytes=KN(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}(r,e,n,i);case bz:return await rG(r,e,t,n,i);case vz:return await Zz(r,e,t,n,i);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}async function oG(e,t,n,i){const r=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if("number"!=typeof r)return;const s=e.bufferViews[r],o=e.buffers[s.buffer];if(!(null==i?void 0:i.baseUrl))throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(o.uri){const e=`${(null==i?void 0:i.baseUrl)||""}/${o.uri}`,n=await i.fetch(e),r=await n.arrayBuffer();return void(t.explicitBitstream=new Uint8Array(r,s.byteOffset,s.byteLength))}const a=e.buffers.slice(0,s.buffer).reduce((e,t)=>e+t.byteLength,0);t.explicitBitstream=new Uint8Array(n.slice(a,a+o.byteLength),s.byteOffset,s.byteLength)}function aG(e){const t=new DataView(e);return t.getUint32(0,!0)+2**32*t.getUint32(4,!0)}const lG={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:mz,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(e,t,n){if(1952609651!==new Uint32Array(e.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(e.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");const i=aG(e.slice(8,16)),r=new Uint8Array(e,24,i),s=new TextDecoder("utf8").decode(r),o=JSON.parse(s),a=aG(e.slice(16,24));let l=new ArrayBuffer(0);if(a&&(l=e.slice(24+i)),await oG(o,o.tileAvailability,l,n),Array.isArray(o.contentAvailability))for(const c of o.contentAvailability)await oG(o,c,l,n);else await oG(o,o.contentAvailability,l,n);return await oG(o,o.childSubtreeAvailability,l,n),o},options:{}};
/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var cG=null;try{cG=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function uG(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function hG(e){return!0===(e&&e.__isLong__)}function dG(e){var t=Math.clz32(e&-e);return e?31-t:t}uG.prototype.__isLong__,Object.defineProperty(uG.prototype,"__isLong__",{value:!0}),uG.isLong=hG;var fG={},pG={};function gG(e,t){var n,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=pG[e])?i:(n=yG(e,0,!0),r&&(pG[e]=n),n):(r=-128<=(e|=0)&&e<128)&&(i=fG[e])?i:(n=yG(e,e<0?-1:0,!1),r&&(fG[e]=n),n)}function mG(e,t){if(isNaN(e))return t?TG:SG;if(t){if(e<0)return TG;if(e>=wG)return PG}else{if(e<=-xG)return MG;if(e+1>=xG)return RG}return e<0?mG(-e,t).neg():yG(e%EG|0,e/EG|0,t)}function yG(e,t,n){return new uG(e,t,n)}uG.fromInt=gG,uG.fromNumber=mG,uG.fromBits=yG;var vG=Math.pow;function _G(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?TG:SG;if((n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return _G(e.substring(1),t,n).neg();for(var r=mG(vG(n,8)),s=SG,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),l=parseInt(e.substring(o,o+a),n);if(a<8){var c=mG(vG(n,a));s=s.mul(c).add(mG(l))}else s=(s=s.mul(r)).add(mG(l))}return s.unsigned=t,s}function bG(e,t){return"number"==typeof e?mG(e,t):"string"==typeof e?_G(e,t):yG(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}uG.fromString=_G,uG.fromValue=bG;var EG=4294967296,wG=EG*EG,xG=wG/2,AG=gG(1<<24),SG=gG(0);uG.ZERO=SG;var TG=gG(0,!0);uG.UZERO=TG;var CG=gG(1);uG.ONE=CG;var IG=gG(1,!0);uG.UONE=IG;var kG=gG(-1);uG.NEG_ONE=kG;var RG=yG(-1,2147483647,!1);uG.MAX_VALUE=RG;var PG=yG(-1,-1,!0);uG.MAX_UNSIGNED_VALUE=PG;var MG=yG(0,-2147483648,!1);uG.MIN_VALUE=MG;var LG=uG.prototype;LG.toInt=function(){return this.unsigned?this.low>>>0:this.low},LG.toNumber=function(){return this.unsigned?(this.high>>>0)*EG+(this.low>>>0):this.high*EG+(this.low>>>0)},LG.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MG)){var t=mG(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=mG(vG(e,6),this.unsigned),s=this,o="";;){var a=s.div(r),l=(s.sub(a.mul(r)).toInt()>>>0).toString(e);if((s=a).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},LG.getHighBits=function(){return this.high},LG.getHighBitsUnsigned=function(){return this.high>>>0},LG.getLowBits=function(){return this.low},LG.getLowBitsUnsigned=function(){return this.low>>>0},LG.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MG)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},LG.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&(-1===e&&!(0===this.low&&-2097152===this.high))},LG.isZero=function(){return 0===this.high&&0===this.low},LG.eqz=LG.isZero,LG.isNegative=function(){return!this.unsigned&&this.high<0},LG.isPositive=function(){return this.unsigned||this.high>=0},LG.isOdd=function(){return!(1&~this.low)},LG.isEven=function(){return!(1&this.low)},LG.equals=function(e){return hG(e)||(e=bG(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},LG.eq=LG.equals,LG.notEquals=function(e){return!this.eq(e)},LG.neq=LG.notEquals,LG.ne=LG.notEquals,LG.lessThan=function(e){return this.comp(e)<0},LG.lt=LG.lessThan,LG.lessThanOrEqual=function(e){return this.comp(e)<=0},LG.lte=LG.lessThanOrEqual,LG.le=LG.lessThanOrEqual,LG.greaterThan=function(e){return this.comp(e)>0},LG.gt=LG.greaterThan,LG.greaterThanOrEqual=function(e){return this.comp(e)>=0},LG.gte=LG.greaterThanOrEqual,LG.ge=LG.greaterThanOrEqual,LG.compare=function(e){if(hG(e)||(e=bG(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},LG.comp=LG.compare,LG.negate=function(){return!this.unsigned&&this.eq(MG)?MG:this.not().add(CG)},LG.neg=LG.negate,LG.add=function(e){hG(e)||(e=bG(e));var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,s=e.high>>>16,o=65535&e.high,a=e.low>>>16,l=0,c=0,u=0,h=0;return u+=(h+=r+(65535&e.low))>>>16,c+=(u+=i+a)>>>16,l+=(c+=n+o)>>>16,l+=t+s,yG((u&=65535)<<16|(h&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},LG.subtract=function(e){return hG(e)||(e=bG(e)),this.add(e.neg())},LG.sub=LG.subtract,LG.multiply=function(e){if(this.isZero())return this;if(hG(e)||(e=bG(e)),cG)return yG(cG.mul(this.low,this.high,e.low,e.high),cG.get_high(),this.unsigned);if(e.isZero())return this.unsigned?TG:SG;if(this.eq(MG))return e.isOdd()?MG:SG;if(e.eq(MG))return this.isOdd()?MG:SG;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(AG)&&e.lt(AG))return mG(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,s=e.high>>>16,o=65535&e.high,a=e.low>>>16,l=65535&e.low,c=0,u=0,h=0,d=0;return h+=(d+=r*l)>>>16,u+=(h+=i*l)>>>16,h&=65535,u+=(h+=r*a)>>>16,c+=(u+=n*l)>>>16,u&=65535,c+=(u+=i*a)>>>16,u&=65535,c+=(u+=r*o)>>>16,c+=t*l+n*a+i*o+r*s,yG((h&=65535)<<16|(d&=65535),(c&=65535)<<16|(u&=65535),this.unsigned)},LG.mul=LG.multiply,LG.divide=function(e){if(hG(e)||(e=bG(e)),e.isZero())throw Error("division by zero");var t,n,i;if(cG)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?yG((this.unsigned?cG.div_u:cG.div_s)(this.low,this.high,e.low,e.high),cG.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?TG:SG;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return TG;if(e.gt(this.shru(1)))return IG;i=TG}else{if(this.eq(MG))return e.eq(CG)||e.eq(kG)?MG:e.eq(MG)?CG:(t=this.shr(1).div(e).shl(1)).eq(SG)?e.isNegative()?CG:kG:(n=this.sub(e.mul(t)),i=t.add(n.div(e)));if(e.eq(MG))return this.unsigned?TG:SG;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=SG}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var r=Math.ceil(Math.log(t)/Math.LN2),s=r<=48?1:vG(2,r-48),o=mG(t),a=o.mul(e);a.isNegative()||a.gt(n);)a=(o=mG(t-=s,this.unsigned)).mul(e);o.isZero()&&(o=CG),i=i.add(o),n=n.sub(a)}return i},LG.div=LG.divide,LG.modulo=function(e){return hG(e)||(e=bG(e)),cG?yG((this.unsigned?cG.rem_u:cG.rem_s)(this.low,this.high,e.low,e.high),cG.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},LG.mod=LG.modulo,LG.rem=LG.modulo,LG.not=function(){return yG(~this.low,~this.high,this.unsigned)},LG.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},LG.clz=LG.countLeadingZeros,LG.countTrailingZeros=function(){return this.low?dG(this.low):dG(this.high)+32},LG.ctz=LG.countTrailingZeros,LG.and=function(e){return hG(e)||(e=bG(e)),yG(this.low&e.low,this.high&e.high,this.unsigned)},LG.or=function(e){return hG(e)||(e=bG(e)),yG(this.low|e.low,this.high|e.high,this.unsigned)},LG.xor=function(e){return hG(e)||(e=bG(e)),yG(this.low^e.low,this.high^e.high,this.unsigned)},LG.shiftLeft=function(e){return hG(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?yG(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):yG(0,this.low<<e-32,this.unsigned)},LG.shl=LG.shiftLeft,LG.shiftRight=function(e){return hG(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?yG(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):yG(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},LG.shr=LG.shiftRight,LG.shiftRightUnsigned=function(e){return hG(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?yG(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):yG(32===e?this.high:this.high>>>e-32,0,this.unsigned)},LG.shru=LG.shiftRightUnsigned,LG.shr_u=LG.shiftRightUnsigned,LG.rotateLeft=function(e){var t;return hG(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?yG(this.high,this.low,this.unsigned):e<32?(t=32-e,yG(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(t=32-(e-=32),yG(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},LG.rotl=LG.rotateLeft,LG.rotateRight=function(e){var t;return hG(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?yG(this.high,this.low,this.unsigned):e<32?(t=32-e,yG(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(t=32-(e-=32),yG(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},LG.rotr=LG.rotateRight,LG.toSigned=function(){return this.unsigned?yG(this.low,this.high,!1):this},LG.toUnsigned=function(){return this.unsigned?this:yG(this.low,this.high,!0)},LG.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},LG.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},LG.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},uG.fromBytes=function(e,t,n){return n?uG.fromBytesLE(e,t):uG.fromBytesBE(e,t)},uG.fromBytesLE=function(e,t){return new uG(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},uG.fromBytesBE=function(e,t){return new uG(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(uG.fromBigInt=function(e,t){return yG(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},uG.fromValue=function(e,t){return"bigint"==typeof e?uG.fromBigInt(e,t):bG(e,t)},LG.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e});function BG(e){"X"===e&&(e="");const t=e.padEnd(16,"0");return uG.fromString(t,!0,16)}const NG=180/Math.PI;function OG(e,t,n){const i=1<<t;return[(e[0]+n[0])/i,(e[1]+n[1])/i]}function DG(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function FG(e){return[DG(e[0]),DG(e[1])]}function UG(e,[t,n]){switch(e){case 0:return[1,t,n];case 1:return[-t,1,n];case 2:return[-t,-n,1];case 3:return[-1,-n,-t];case 4:return[n,-1,-t];case 5:return[n,t,-1];default:throw new Error("Invalid face")}}function zG([e,t,n]){const i=Math.atan2(n,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*NG,i*NG]}function GG(e,t,n,i){if(0===i){1===n&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}function VG(e){const{face:t,ij:n,level:i}=e,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(100*Math.pow(2,-i))),o=new Float64Array(4*s*2+2);let a=0,l=0;for(let c=0;c<4;c++){const e=r[c].slice(0),u=r[c+1],h=(u[0]-e[0])/s,d=(u[1]-e[1])/s;for(let r=0;r<s;r++){e[0]+=h,e[1]+=d;const r=zG(UG(t,FG(OG(n,i,e))));Math.abs(r[1])>89.999&&(r[0]=l);const s=r[0]-l;r[0]+=s>180?-360:s<-180?360:0,o[a++]=r[0],o[a++]=r[1],l=r[0]}}return o[a++]=o[0],o[a++]=o[1],o}function HG(e){const t=function(e){if(e.indexOf("/")>0)return e;const t=BG(e);return function(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<64;)t="0"+t;const n=t.lastIndexOf("1"),i=t.substring(0,3),r=t.substring(3,n),s=r.length/2,o=uG.fromString(i,!0,2).toString(10);let a="";if(0!==s)for(a=uG.fromString(r,!0,2).toString(4);a.length<s;)a="0"+a;return`${o}/${a}`}(t)}(e);return function(e){if(0===e.length)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),n=parseInt(t[0],10),i=t[1],r=i.length;let s=0;const o=[0,0];for(let a=r-1;a>=0;a--){s=r-a;const e=i[a];let t=0,n=0;"1"===e?n=1:"2"===e?(t=1,n=1):"3"===e&&(t=1);const l=Math.pow(2,s-1);GG(l,o,t,n),o[0]+=l*t,o[1]+=l*n}if(n%2==1){const e=o[0];o[0]=o[1],o[1]=e}return{face:n,ij:o,level:s}}(t)}function jG(e){return function(e){const t=FG(OG(e.ij,e.level,[.5,.5]));return zG(UG(e.face,t))}(HG(e))}function WG(e){if(e.length%2!=0)throw new Error("Invalid corners");const t=[],n=[];for(let i=0;i<e.length;i+=2)t.push(e[i]),n.push(e[i+1]);return t.sort((e,t)=>e-t),n.sort((e,t)=>e-t),{west:t[0],east:t[t.length-1],north:n[n.length-1],south:n[0]}}function $G(e,t){const n=(null==t?void 0:t.minimumHeight)||0,i=(null==t?void 0:t.maximumHeight)||0,r=function(e){let t;if(2===e.face||5===e.face){let n=null,i=0;for(let t=0;t<4;t++){const r=VG(HG(`${e.face}/${t}`));null==n&&(n=new Float64Array(4*r.length)),n.set(r,i),i+=r.length}t=WG(n)}else t=WG(VG(e));return t}(HG(e)),s=r.west,o=r.south,a=r.east,l=r.north,c=[];return c.push(new hb(s,l,n)),c.push(new hb(a,l,n)),c.push(new hb(a,o,n)),c.push(new hb(s,o,n)),c.push(new hb(s,l,i)),c.push(new hb(a,l,i)),c.push(new hb(a,o,i)),c.push(new hb(s,o,i)),c}function XG(e){const t=e.token,n={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},i=$G(t,n),r=jG(t),s=r[0],o=r[1],a=qF.WGS84.cartographicToCartesian([s,o,n.maximumHeight]),l=new hb(a[0],a[1],a[2]);i.push(l);const c=hL(i);return[...c.center,...c.halfAxes]}const qG={QUADTREE:4,OCTREE:8};function KG(e,t,n){if(null==e?void 0:e.box){const i=function(e,t){const n=function(e){return e.and(e.not().add(1))}(e).shiftRightUnsigned(2);return e.add(uG.fromNumber(2*t+1-4).multiply(n))}(BG(e.s2VolumeInfo.token),t),r=function(e){if(e.isZero())return"X";let t=e.countTrailingZeros();t=(t-t%4)/4;const n=t;t*=4;const i=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-i.length).join("0")+i}(i),s={...e.s2VolumeInfo};if(s.token=r,"OCTREE"===n){const t=e.s2VolumeInfo,n=t.maximumHeight-t.minimumHeight,i=n/2,r=t.minimumHeight+n/2;t.minimumHeight=r-i,t.maximumHeight=r+i}return{box:XG(s),s2VolumeInfo:s}}}async function YG(e){const{subtree:t,subtreeData:n={level:0,x:0,y:0,z:0},parentData:i={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:r=0,implicitOptions:s,loaderOptions:o,s2VolumeBox:a}=e,{subdivisionScheme:l,subtreeLevels:c,maximumLevel:u,contentUrlTemplate:h,subtreesUriTemplate:d,basePath:f}=s,p={children:[],lodMetricValue:0,contentUrl:""};if(!u)return _d.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${h} won't be loaded...`),p;const g=i.localLevel+1,m=n.level+g;if(m>u)return p;const y=qG[l],v=Math.log2(y),_=1&r,b=r>>1&1,E=r>>2&1,w=ZG(i.localX,_,1),x=ZG(i.localY,b,1),A=ZG(i.localZ,E,1),S=ZG(n.x,w,g),T=ZG(n.y,x,g),C=ZG(n.z,A,g),I=ZG(i.mortonIndex,r,v);let k,R,P,M;if(g===c&&JG(t.childSubtreeAvailability,I)){const e=QG(`${f}/${d}`,m,S,T,C);k=await dp(e,lG,o),M=0,R={level:m,x:S,y:T,z:C},P={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else{k=t;M=(y**g-1)/(y-1)+I,R=n,P={mortonIndex:I,localLevel:g,localX:w,localY:x,localZ:A}}if(!JG(k.tileAvailability,M))return p;JG(k.contentAvailability,M)&&(p.contentUrl=QG(h,m,S,T,C));for(let L=0;L<y;L++){const e=KG(a,L,l),t=await YG({subtree:k,subtreeData:R,parentData:P,childIndex:L,implicitOptions:s,loaderOptions:o,s2VolumeBox:e});(t.contentUrl||t.children.length)&&p.children.push(t)}if(p.contentUrl||p.children.length){const e=function(e,t,n,i){const{basePath:r,refine:s,getRefine:o,lodMetricType:a,getTileType:l,rootLodMetricValue:c,rootBoundingVolume:u}=n,h=e.contentUrl&&e.contentUrl.replace(`${r}/`,""),d=c/2**t.level,f=(null==i?void 0:i.box)?{box:i.box}:u,p=function(e,t,n){if(e.region){const{level:i,x:r,y:s,z:o}=t,[a,l,c,u,h,d]=e.region,f=2**i,p=(c-a)/f,[g,m]=[a+p*r,a+p*(r+1)],y=(u-l)/f,[v,_]=[l+y*s,l+y*(s+1)];let b,E;if("OCTREE"===n){const e=(d-h)/f;[b,E]=[h+e*o,h+e*(o+1)]}else[b,E]=[h,d];return{region:[g,v,m,_,b,E]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}(f,t,n.subdivisionScheme);return{children:e.children,contentUrl:e.contentUrl,content:{uri:h},id:e.contentUrl,refine:o(s),type:l(e),lodMetricType:a,lodMetricValue:d,geometricError:d,transform:e.transform,boundingVolume:p}}(p,{level:m,x:S,y:T,z:C},s,a);return e}return p}function JG(e,t){let n;return Array.isArray(e)?(n=e[0],e.length>1&&_d.once('Not supported extension "3DTILES_multiple_contents" has been detected')):n=e,"constant"in n?Boolean(n.constant):!!n.explicitBitstream&&function(e,t){const n=Math.floor(e/8),i=e%8;return 1==(t[n]>>i&1)}(t,n.explicitBitstream)}function ZG(e,t,n){return(e<<n)+t}function QG(e,t,n,i,r){const s=function(e){const t={};for(const n in e)t[`{${n}}`]=e[n];return t}({level:t,x:n,y:i,z:r});return e.replace(/{level}|{x}|{y}|{z}/gi,e=>s[e])}function eV(e,t=""){if(!t)return gU.EMPTY;const n=t.split("?")[0].split(".").pop();switch(n){case"pnts":return gU.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return gU.SCENEGRAPH;default:return n||gU.EMPTY}}function tV(e){switch(e){case"REPLACE":case"replace":return fU.REPLACE;case"ADD":case"add":return fU.ADD;default:return e}}function nV(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const n=new URL(e,`${t}/`);return decodeURI(n.toString())}return e.startsWith("/")?e:df(t,e)}function iV(e,t){var n;if(!e)return null;let i;if(e.content){const r=e.content.uri||(null==(n=e.content)?void 0:n.url);void 0!==r&&(i=nV(r,t))}return{...e,id:i,contentUrl:i,lodMetricType:_U.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:eV(0,i),refine:tV(e.refine)}}async function rV(e,t,n,i,r){var s,o,a;const{subdivisionScheme:l,maximumLevel:c,availableLevels:u,subtreeLevels:h,subtrees:{uri:d}}=i,f=nV(QG(d,0,0,0,0),n),p=await dp(f,lG,r),g=null==(s=e.content)?void 0:s.uri,m=g?nV(g,n):"",y=null==(o=null==t?void 0:t.root)?void 0:o.refine,v=e.geometricError,_=null==(a=e.boundingVolume.extensions)?void 0:a["3DTILES_bounding_volume_S2"];if(_){const t={box:XG(_),s2VolumeInfo:_};e.boundingVolume=t}const b=e.boundingVolume,E={contentUrlTemplate:m,subtreesUriTemplate:d,subdivisionScheme:l,subtreeLevels:h,maximumLevel:Number.isFinite(u)?u-1:c,refine:y,basePath:n,lodMetricType:_U.GEOMETRIC_ERROR,rootLodMetricValue:v,rootBoundingVolume:b,getTileType:eV,getRefine:tV};return await async function(e,t,n,i,r){if(!e)return null;const{children:s,contentUrl:o}=await YG({subtree:n,implicitOptions:i,loaderOptions:r});let a,l=null;o&&(a=o,l={uri:o.replace(`${t}/`,"")});const c={...e,id:a,contentUrl:a,lodMetricType:_U.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:eV(0,a),refine:tV(e.refine),content:l||e.content,children:s};return c}(e,n,p,E,r)}function sV(e){var t;return(null==(t=null==e?void 0:e.extensions)?void 0:t["3DTILES_implicit_tiling"])||(null==e?void 0:e.implicitTiling)}const oV={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:mz,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(e,t={},n){const i=t["3d-tiles"]||{};let r;r="auto"===i.isTileset?(null==n?void 0:n.url)&&-1!==n.url.indexOf(".json"):i.isTileset;return r?async function(e,t,n){var i;const r=JSON.parse((new TextDecoder).decode(e)),s=(null==n?void 0:n.url)||"",o=function(e){return hf(e)}(s),a=await async function(e,t,n){let i=null;const r=sV(e.root);i=r&&e.root?await rV(e.root,e,t,r,n):iV(e.root,t);const s=[];for(s.push(i);s.length>0;){const i=s.pop()||{},r=i.children||[],o=[];for(const a of r){const i=sV(a);let r;r=i?await rV(a,e,t,i,n):iV(a,t),r&&(o.push(r),s.push(r))}i.children=o}return i}(r,o,t||{}),l={...r,shape:"tileset3d",loader:oV,url:s,queryString:(null==n?void 0:n.queryString)||"",basePath:o,root:a||r.root,type:yU.TILES3D,lodMetricType:_U.GEOMETRIC_ERROR,lodMetricValue:(null==(i=r.root)?void 0:i.geometricError)||0};return l}(e,t,n):async function(e,t,n){const i={content:{shape:"tile3d",featureIds:null}},r=0;return await sG(e,r,t,n,i.content),i.content}(e,t,n)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};const aV=[0],lV={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:oV,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,n)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}};class cV extends Ik{initializeState(){"onTileLoadFail"in this.props&&Op.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return Boolean((null==(t=null==(e=this.state)?void 0:e.tileset3d)?void 0:t.isLoaded())&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:n}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:e}=this.state;Object.keys(e).length&&(this._updateTileset(e),this.state.lastUpdatedViewports=e,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:e}=this.state;for(const t in e)e[t].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,t[e.id]=e;const i=null==n?void 0:n[e.id];i&&e.equals(i)||(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const n=t&&t.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer({layer:e,viewport:t}){const{tile:n}=e.props,{id:i}=t;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(e){const t=e.sourceTile,n=this.state.layerMap[null==t?void 0:t.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,r={loadOptions:{...t}};let s=e;if(i.preload){const n=await i.preload(e,t);n.url&&(s=n.url),n.headers&&(r.loadOptions.fetch={...r.loadOptions.fetch,headers:n.headers}),Object.assign(r,n)}const o=await dp(s,i,r.loadOptions),a=new gz(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...r});this.setState({tileset3d:a,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(a)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;n&&i&&t&&t.selectTiles(Object.values(e)).then(e=>{this.state.frameNumber!==e&&this.setState({frameNumber:e})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case gU.POINTCLOUD:return this._makePointCloudLayer(e,t);case gU.SCENEGRAPH:return this._make3DModelLayer(e);case gU.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:n,pointCount:i,constantRGBA:r,cartographicOrigin:s,modelMatrix:o}=e.content,{positions:a,normals:l,colors:c}=n;if(!a)return null;const u=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:a,NORMAL:l,COLOR_0:c}},{pointSize:h,getPointColor:d}=this.props;return new(this.getSubLayerClass("pointcloud",_R))({pointSize:h},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:u,coordinateSystem:Tw.METER_OFFSETS,coordinateOrigin:s,modelMatrix:o,getColor:r||d,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:n,cartographicOrigin:i,modelMatrix:r}=e.content;return new(this.getSubLayerClass("scenegraph",AF))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||aV,scenegraph:t,coordinateSystem:Tw.METER_OFFSETS,coordinateOrigin:i,modelMatrix:r,getTransformMatrix:e=>e.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const n=e.content,{attributes:i,indices:r,modelMatrix:s,cartographicOrigin:o,coordinateSystem:a=Tw.METER_OFFSETS,material:l,featureIds:c}=n,{_getMeshColor:u}=this.props,h=t&&t.props.mesh||new jA({topology:"triangle-list",attributes:uV(i),indices:r});return new(this.getSubLayerClass("mesh",CF))(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:h,data:aV,getColor:u(e),pbrMaterial:l,modelMatrix:s,coordinateOrigin:o,coordinateSystem:a,featureIds:c,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(e=>{const n=t[e.id]=t[e.id]||{tile:e};let{layer:i}=n;return e.selected&&(i?n.needsUpdate&&(i=this._getSubLayer(e,i),n.needsUpdate=!1):i=this._getSubLayer(e)),n.layer=i,i}).filter(Boolean):null}}function uV(e){const t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}function hV(e){switch(e){case"UInt8":return Uint8Array;case"UInt16":return Uint16Array;case"UInt32":return Uint32Array;case"Float32":return Float32Array;case"UInt64":return Float64Array;default:throw new Error(`parse i3s tile content: unknown type of data: ${e}`)}}cV.defaultProps=lV,cV.layerName="Tile3DLayer";const dV={UInt8:Az.UNSIGNED_BYTE,UInt16:Az.UNSIGNED_SHORT,Float32:Az.FLOAT,UInt32:Az.UNSIGNED_INT,UInt64:Az.DOUBLE};function fV(e){switch(e){case"UInt8":return 1;case"UInt16":case"Int16":return 2;case"UInt32":case"Int32":case"Float32":return 4;case"UInt64":case"Int64":case"Float64":return 8;default:throw new Error(`parse i3s tile content: unknown size of data: ${e}`)}}var pV,gV,mV,yV;function vV(e){let t;try{const n=new URL(e);t=`${n.origin}${n.pathname}`,t.startsWith("null")&&(t=null)}catch(dy){t=null}return t||e}function _V(e,t=null){return t?`${e}?token=${t}`:e}(gV=pV||(pV={}))[gV.DEFAULT=-1]="DEFAULT",gV[gV.LNGLAT=1]="LNGLAT",gV[gV.METER_OFFSETS=2]="METER_OFFSETS",gV[gV.LNGLAT_OFFSETS=3]="LNGLAT_OFFSETS",gV[gV.CARTESIAN=0]="CARTESIAN",(yV=mV||(mV={})).vertexCount="vertexCount",yV.featureCount="featureCount";const bV=new hb([0,0,0]);const EV="i3s-attribute-type";async function wV(e,t,n,i,r){var s;const o={attributes:{},indices:null,featureIds:[],vertexCount:0,modelMatrix:new Fb,coordinateSystem:0,byteLength:0,texture:null};if(t.textureUrl){const e=_V(t.textureUrl,null==(s=null==i?void 0:i.i3s)?void 0:s.token),n=function(e){switch(e){case"ktx-etc2":case"dds":return gN;case"ktx2":return LB;default:return Lp}}(t.textureFormat),a=(null==r?void 0:r.fetch)||fetch,l=await a(e),c=await l.arrayBuffer();if(null==i?void 0:i.i3s.decodeTextures){if(n===Lp){const e={...t.textureLoaderOptions,image:{type:"data"}};try{const t=await qh(c,[],e,r);o.texture=t}catch(dy){const i=await cp(c,n,e,r);o.texture=i}}else if(n===gN||n===LB){let e=await dp(c,n,t.textureLoaderOptions);n===LB&&(e=e[0]),o.texture={compressed:!0,mipmaps:!1,width:e[0].width,height:e[0].height,data:e}}}else o.texture=c}return o.material=function(e,t){let n;e?n={...e,pbrMetallicRoughness:e.pbrMetallicRoughness?{...e.pbrMetallicRoughness}:{baseColorFactor:[255,255,255,255]}}:(n={pbrMetallicRoughness:{}},t?n.pbrMetallicRoughness.baseColorTexture={texCoord:0}:n.pbrMetallicRoughness.baseColorFactor=[255,255,255,255]);n.alphaCutoff=n.alphaCutoff||.25,n.alphaMode&&(n.alphaMode=n.alphaMode.toUpperCase());n.emissiveFactor&&(n.emissiveFactor=TV(n.emissiveFactor));n.pbrMetallicRoughness&&n.pbrMetallicRoughness.baseColorFactor&&(n.pbrMetallicRoughness.baseColorFactor=TV(n.pbrMetallicRoughness.baseColorFactor));t&&function(e,t){const n={source:{image:t}};e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture?e.pbrMetallicRoughness.baseColorTexture={...e.pbrMetallicRoughness.baseColorTexture,texture:n}:e.emissiveTexture?e.emissiveTexture={...e.emissiveTexture,texture:n}:e.pbrMetallicRoughness&&e.pbrMetallicRoughness.metallicRoughnessTexture?e.pbrMetallicRoughness.metallicRoughnessTexture={...e.pbrMetallicRoughness.metallicRoughnessTexture,texture:n}:e.normalTexture?e.normalTexture={...e.normalTexture,texture:n}:e.occlusionTexture&&(e.occlusionTexture={...e.occlusionTexture,texture:n})}(n,t);return n}(t.materialDefinition,o.texture),o.material&&(o.texture=null),await async function(e,t,n,i,r){var s,o;const a=e.byteLength;let l,c,u,h=0,d=0;if(n.isDracoGeometry){const t=await cp(e,SD,{draco:{attributeNameEntry:EV}});c=t.header.vertexCount,u=null==(s=t.indices)?void 0:s.value;const{POSITION:n,NORMAL:i,COLOR_0:r,TEXCOORD_0:o,"feature-index":a,"uv-region":h}=t.attributes;l={position:n,normal:i,color:r,uv0:o,uvRegion:h,id:a},function(e,t){for(const n in t.loaderData.attributes){const i=t.loaderData.attributes[n];switch(i.name){case"POSITION":e.position.metadata=i.metadata;break;case"feature-index":e.id.metadata=i.metadata}}}(l,t);const d=function(e){var t,n;return null==(n=null==(t=null==e?void 0:e.metadata)?void 0:t["i3s-feature-ids"])?void 0:n.intArray}(a);d&&function(e,t){const n=e.id.value,i=new Float32Array(n.length);for(let r=0;r<n.length;r++)i[r]=t[n[r]];e.id.value=i}(l,d)}else{const{vertexAttributes:t,ordering:n,featureAttributes:r,featureAttributeOrder:s}=i.store.defaultGeometrySchema,o=function(e,t){let n=0,i=0,r=0;for(const{property:s,type:o}of t.store.defaultGeometrySchema.header){const t=hV(o);switch(s){case mV.vertexCount.toString():i=new t(e,0,4)[0],n+=fV(o);break;case mV.featureCount.toString():r=new t(e,4,4)[0],n+=fV(o)}}return{vertexCount:i,featureCount:r,byteOffset:n}}(e,i);h=o.byteOffset,c=o.vertexCount,d=o.featureCount;const{attributes:a,byteOffset:u}=AV(e,h,t,c,n),{attributes:f}=AV(e,u,r,d,s);!function(e){const{id:t,faceRange:n}=e;if(!t||!n)return;const i=t.value,r=n.value,s=r[r.length-1]+1,o=new Uint32Array(3*s);let a=0,l=0;for(let c=1;c<r.length;c+=2){const e=Number(i[a]),t=l+3*(r[c]-r[c-1]+1);o.fill(e,l,t),a++,l=t}e.id.value=o}(f),l=function(e,t){return{...e,...t}}(a,f)}if((null==(o=null==r?void 0:r.i3s)?void 0:o.coordinateSystem)&&r.i3s.coordinateSystem!==pV.METER_OFFSETS)t.modelMatrix=function(e){var t,n;const i=e.metadata,r=(null==(t=null==i?void 0:i["i3s-scale_x"])?void 0:t.double)||1,s=(null==(n=null==i?void 0:i["i3s-scale_y"])?void 0:n.double)||1,o=new Fb;return o[0]=r,o[5]=s,o}(l.position),t.coordinateSystem=pV.LNGLAT_OFFSETS;else{const e=function(e,t){const n=t.mbs,i=e.value,r=e.metadata,s=new Fb,o=new hb(n[0],n[1],n[2]),a=new hb;return qF.WGS84.cartographicToCartesian(o,a),qF.WGS84.eastNorthUpToFixedFrame(a,s),e.value=function(e,t={},n){const i=new Float64Array(e.length),r=t["i3s-scale_x"]&&t["i3s-scale_x"].double||1,s=t["i3s-scale_y"]&&t["i3s-scale_y"].double||1;for(let o=0;o<i.length;o+=3)i[o]=e[o]*r+n.x,i[o+1]=e[o+1]*s+n.y,i[o+2]=e[o+2]+n.z;for(let o=0;o<i.length;o+=3)qF.WGS84.cartographicToCartesian(i.subarray(o,o+3),bV),i[o]=bV.x,i[o+1]=bV.y,i[o+2]=bV.z;return i}(i,r,o),s}(l.position,n);t.modelMatrix=e.invert(),t.coordinateSystem=pV.METER_OFFSETS}t.attributes={positions:l.position,normals:l.normal,colors:xV(l.color),texCoords:l.uv0,uvRegions:xV(l.uvRegion||l.region)},t.indices=u||null,l.id&&l.id.value&&(t.featureIds=l.id.value);for(const f in t.attributes)t.attributes[f]||delete t.attributes[f];return t.vertexCount=c,t.byteLength=a,t}(e,o,t,n,i)}function xV(e){return e?(e.normalized=!0,e):e}function AV(e,t,n,i,r){const s={};for(const o of r)if(n[o]){const{valueType:r,valuesPerElement:a}=n[o];if(t+i*a*fV(r)<=e.byteLength){const n=e.slice(t);let l;if("UInt64"===r)l=SV(n,i*a,fV(r));else{l=new(hV(r))(n,0,i*a)}if(s[o]={value:l,type:dV[r],size:a},"color"===o)s.color.normalized=!0;t+=i*a*fV(r)}else if("uv0"!==o)break}return{attributes:s,byteOffset:t}}function SV(e,t,n){const i=[],r=new DataView(e);let s=0;for(let o=0;o<t;o++){const e=r.getUint32(s,!0)+2**32*r.getUint32(s+4,!0);i.push(e),s+=n}return new Uint32Array(i)}function TV(e){const t=[...e];for(let n=0;n<e.length;n++)t[n]=e[n]/255;return t}const CV={dataType:null,batchType:null,name:"I3S Content (Indexed Scene Layers)",id:"i3s-content",module:"i3s",worker:!0,version:"4.3.3",mimeTypes:["application/octet-stream"],parse:async function(e,t,n){const{tile:i,_tileOptions:r,tileset:s,_tilesetOptions:o}=(null==t?void 0:t.i3s)||{},a=r||i,l=o||s;if(!a||!l)return null;return await wV(e,a,l,t,n)},extensions:["bin"],options:{"i3s-content":{}}};const IV={dataType:null,batchType:null,name:"I3S Node Page",id:"i3s-node-page",module:"i3s",version:"4.3.3",mimeTypes:["application/json"],parse:async function(e,t){return JSON.parse((new TextDecoder).decode(e))},extensions:["json"],options:{i3s:{}}};class kV{constructor(e,t="",n){var r,s;i(this,"tileset"),i(this,"nodePages",[]),i(this,"pendingNodePages",[]),i(this,"nodesPerPage"),i(this,"options"),i(this,"lodSelectionMetricType"),i(this,"textureDefinitionsSelectedFormats",[]),i(this,"nodesInNodePages"),i(this,"url"),i(this,"textureLoaderOptions",{}),this.tileset={...e},this.url=t,this.nodesPerPage=(null==(r=e.nodePages)?void 0:r.nodesPerPage)||64,this.lodSelectionMetricType=null==(s=e.nodePages)?void 0:s.lodSelectionMetricType,this.options=n,this.nodesInNodePages=0,this.initSelectedFormatsForTextureDefinitions(e)}async getNodeById(e){var t;const n=Math.floor(e/this.nodesPerPage);if(!this.nodePages[n]&&!this.pendingNodePages[n]){const e=_V(`${this.url}/nodepages/${n}`,null==(t=this.options.i3s)?void 0:t.token);this.pendingNodePages[n]={status:"Pending",promise:dp(e,IV,this.options)},this.nodePages[n]=await this.pendingNodePages[n].promise,this.nodesInNodePages+=this.nodePages[n].nodes.length,this.pendingNodePages[n].status="Done"}"Pending"===this.pendingNodePages[n].status&&(this.nodePages[n]=await this.pendingNodePages[n].promise);const i=e%this.nodesPerPage;return this.nodePages[n].nodes[i]}async formTileFromNodePages(e){const t=await this.getNodeById(e),n=[],i=[];for(const d of t.children||[])i.push(this.getNodeById(d));const r=await Promise.all(i);for(const d of r)n.push({id:d.index.toString(),obb:d.obb});let s,o,a,l="jpg",c=[],u=!1;if(t&&t.mesh){const{url:e,isDracoGeometry:n}=t.mesh.geometry&&this.getContentUrl(t.mesh.geometry)||{isDracoGeometry:!1};s=e,u=n;const{textureData:i,materialDefinition:r}=this.getInformationFromMaterial(t.mesh.material);a=r,l=i.format||l,i.name&&(o=`${this.url}/nodes/${t.mesh.material.resource}/textures/${i.name}`),this.tileset.attributeStorageInfo&&(c=function(e,t,n){const i=[],{attributeStorageInfo:r=[]}=e;for(let s=0;s<r.length;s++){const e=r[s].key;i.push(`${t}/nodes/${n}/attributes/${e}/0`)}return i}(this.tileset,this.url,t.mesh.attribute.resource))}const h=this.getLodSelection(t);return RV({id:e.toString(),lodSelection:h,obb:t.obb,contentUrl:s,textureUrl:o,attributeUrls:c,materialDefinition:a,textureFormat:l,textureLoaderOptions:this.textureLoaderOptions,children:n,isDracoGeometry:u})}getContentUrl(e){let t=null;const n=this.tileset.geometryDefinitions[e.definition];let i=-1;if(this.options.i3s&&this.options.i3s.useDracoGeometry&&(i=n.geometryBuffers.findIndex(e=>e.compressedAttributes&&"draco"===e.compressedAttributes.encoding)),-1===i&&(i=n.geometryBuffers.findIndex(e=>!e.compressedAttributes)),-1!==i){const r=Boolean(n.geometryBuffers[i].compressedAttributes);t={url:`${this.url}/nodes/${e.resource}/geometries/${i}`,isDracoGeometry:r}}return t}getLodSelection(e){const t=[];return"maxScreenThresholdSQ"===this.lodSelectionMetricType&&t.push({metricType:"maxScreenThreshold",maxError:Math.sqrt(e.lodThreshold/(.25*Math.PI))}),t.push({metricType:this.lodSelectionMetricType,maxError:e.lodThreshold}),t}getInformationFromMaterial(e){var t,n,i;const r={textureData:{name:null}};if(e){const s=null==(t=this.tileset.materialDefinitions)?void 0:t[e.definition];if(s){r.materialDefinition=s;const e=null==(i=null==(n=null==s?void 0:s.pbrMetallicRoughness)?void 0:n.baseColorTexture)?void 0:i.textureSetDefinitionId;"number"==typeof e&&(r.textureData=this.textureDefinitionsSelectedFormats[e]||r.textureData)}}return r}initSelectedFormatsForTextureDefinitions(e){this.textureDefinitionsSelectedFormats=[];const t=this.getSupportedTextureFormats(),n=e.textureSetDefinitions||[];for(const i of n){const e=i&&i.formats||[];let n=null;for(const i of t){const t=e.find(e=>e.format===i);if(t){n=t;break}}n&&"ktx2"===n.format&&(this.textureLoaderOptions.basis={format:MB(),containerFormat:"ktx2",module:"encoder"}),this.textureDefinitionsSelectedFormats.push(n)}}getSupportedTextureFormats(){const e=[];if(!this.options.i3s||this.options.i3s.useCompressedTextures){const t=fB();t.has("etc2")&&e.push("ktx-etc2"),t.has("dxt")&&e.push("dds"),e.push("ktx2")}return e.push("jpg"),e.push("png"),e}}function RV(e){var t,n;const i={};let r=[0,0,0,1];if(e.mbs)r=e.mbs,i.sphere=[...qF.WGS84.cartographicToCartesian(e.mbs.slice(0,3)),e.mbs[3]];else if(e.obb){i.box=[...qF.WGS84.cartographicToCartesian(e.obb.center),...e.obb.halfSize,...e.obb.quaternion];const t=(new zM).fromCenterHalfSizeQuaternion(i.box.slice(0,3),e.obb.halfSize,e.obb.quaternion).getBoundingSphere();i.sphere=[...t.center,t.radius],r=[...e.obb.center,t.radius]}const s=null==(t=e.lodSelection)?void 0:t[0].metricType,o=null==(n=e.lodSelection)?void 0:n[0].maxError,a=gU.MESH,l=fU.REPLACE;return{...e,mbs:r,boundingVolume:i,lodMetricType:s,lodMetricValue:o,type:a,refine:l}}const PV=/layers\/[0-9]+$/,MV=/\.slpk$/,LV=/nodes\/([0-9-]+|root)$/,BV="PointCloud",NV={dataType:null,batchType:null,name:"I3S (Indexed Scene Layers)",id:"i3s",module:"i3s",version:"4.3.3",mimeTypes:["application/octet-stream"],parse:async function(e,t={},n){const i=n.url;t.i3s=t.i3s||{};if("504b0304"===function(e){if(e instanceof ArrayBuffer)return[...new Uint8Array(e,0,4)].map(e=>e.toString(16).padStart(2,"0")).join("");return null}(e))throw new Error("Files with .slpk extention currently are not supported by I3SLoader");const r=vV(i);let s,o;s="auto"===t.i3s.isTileset?PV.test(r)||MV.test(r):t.i3s.isTileset;o="auto"===t.isTileHeader?LV.test(r):t.i3s.isTileHeader;e=s?await async function(e,t,n){const i=JSON.parse((new TextDecoder).decode(e));if((null==i?void 0:i.layerType)===BV)throw new Error("Point Cloud layers currently are not supported by I3SLoader");const r=await async function(e,t,n){const i=vV(n.url||"");let r,s;if(e.nodePages)r=new kV(e,i,t),s=await r.formTileFromNodePages(0);else{const e=_V(`${i}/nodes/root`,t.i3s.token);s=await dp(e,NV,{...t,i3s:{...t.i3s,loadContent:!1,isTileHeader:!0,isTileset:!1}})}return{...e,loader:NV,url:i,basePath:i,type:yU.I3S,nodePagesTile:r,root:s,lodMetricType:s.lodMetricType,lodMetricValue:s.lodMetricValue}}(i,t,n);return r}(e,t,n):o?await async function(e,t){return e=JSON.parse((new TextDecoder).decode(e)),function(e,t){const n=t.url||"";let i,r,s;e.geometryData&&(i=`${n}/${e.geometryData[0].href}`),e.textureData&&(r=`${n}/${e.textureData[0].href}`),e.attributeData&&(s=function(e,t){const{attributeData:n=[]}=t,i=[];for(let r=0;r<n.length;r++){const t=n[r].href.replace("./","");i.push(`${e}/${t}`)}return i}(n,e));const o=e.children||[];return RV({...e,children:o,url:n,contentUrl:i,textureUrl:r,textureFormat:"jpg",attributeUrls:s,isDracoGeometry:!1})}(e,t)}(e,n):await async function(e,t){return await cp(e,CV,t)}(e,t);return e},extensions:["bin"],options:{i3s:{token:null,isTileset:"auto",isTileHeader:"auto",tile:null,tileset:null,_tileOptions:null,_tilesetOptions:null,useDracoGeometry:!0,useCompressedTextures:!0,decodeTextures:!0,coordinateSystem:pV.METER_OFFSETS}}};function OV({initialViewState:e,onViewStateChange:t,dzUrl:n,className:i,style:r}){const s={longitude:Math.max(-180,Math.min(180,e.longitude)),latitude:Math.max(-90,Math.min(90,e.latitude)),zoom:Math.max(2,Math.min(19,e.zoom)),pitch:Math.max(0,Math.min(90,e.pitch??45)),bearing:e.bearing??0},[o,a]=ve.useState(s),l=ve.useCallback(({viewState:e})=>{const n={longitude:Math.max(-180,Math.min(180,e.longitude)),latitude:Math.max(-90,Math.min(90,e.latitude)),zoom:Math.max(2,Math.min(19,e.zoom)),pitch:e.pitch,bearing:e.bearing};a(n),null==t||t(n)},[t]),c=ve.useMemo(()=>[function(e="basemap"){return new UL({id:e,data:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",tileSize:256,minZoom:0,maxZoom:19,renderSubLayers:e=>{const{west:t,south:n,east:i,north:r}=e.tile.bbox,s=e.data;return s?new eR(e,{id:`${e.id}-bmp-${e.tile.id}`,bounds:[t,n,i,r],image:s,pickable:!1}):null}})}("basemap"),new cV({id:"dz-nrw-i3s",data:"https://www.gis.nrw.de/geobasis/3D_mesh/SceneServer/layers/0",loader:NV,pickable:!1,loadOptions:{i3s:{coordinateSystem:"LNGLAT"},fetch:{mode:"cors",credentials:"omit"}}})],[]);return Ae.jsxs("div",{className:i,style:{position:"absolute",inset:0,...r||{}},children:[Ae.jsx($k,{views:new $S({id:"main",repeat:!1}),controller:WS,viewState:o,onViewStateChange:l,layers:c}),Ae.jsx("div",{style:{position:"absolute",right:10,bottom:8,background:"rgba(0,0,0,0.45)",color:"#fff",fontSize:12,padding:"4px 8px",borderRadius:6},children:"3D  Digitaler Zwilling NRW  Basemap  OSM/Carto"})]})}$f(NV);function DV(e){const t=(e??"").toString().trim();return t.length?t:null}const FV={}||{},UV={DZ_URL:DV(FV.VITE_DZNRW_SCENESERVER_URL),DZ_PROXY:DV(FV.VITE_DZNRW_SCENESERVER_PROXY),BASEMAP:DV(FV.VITE_BASEMAP_PROVIDER)||"carto"};function zV(){var e;let t=document.getElementById("deck3d-root");if(t||(t=document.getElementById("deckgl-mount")),!t){t=document.createElement("div"),t.id="deckgl-mount",Object.assign(t.style,{position:"absolute",inset:"0",display:"none",zIndex:"500",pointerEvents:"auto"});(document.getElementById("map-wrapper")||(null==(e=document.getElementById("map"))?void 0:e.parentElement)||document.body).appendChild(t)}t.getBoundingClientRect();return t}const GV=[5.86,50.32,9.46,52.53],VV={is3D:!1,deckRoot:null};async function HV(e,t){const n=t??zV(),i=e.getBounds(),r=[i.getWest(),i.getSouth(),i.getEast(),i.getNorth()];if(VV.last2D={center:[e.getCenter().lng,e.getCenter().lat],zoom:e.getZoom()},!(e=>!(e[0]>GV[2]||e[2]<GV[0]||e[1]>GV[3]||e[3]<GV[1]))(r))return void alert("3D-Daten (DZ NRW) nicht verfgbar  auerhalb NRW.");let s;try{s=function(){const e=UV.DZ_URL||"https://www.gis.nrw.de/geobasis/3D_mesh/SceneServer/layers/0";if(UV.DZ_PROXY)return`${UV.DZ_PROXY}?url=${encodeURIComponent(e)}`;return e}()}catch(dy){return void alert((null==dy?void 0:dy.message)||"3DURL fehlt. Bitte in .env.local setzen.")}if(!(await async function(e){try{const t=await fetch(e+(e.includes("?")?"&":"?")+"f=pjson",{method:"GET"});if(!t.ok)return!1;const n=await t.text();return/"layerType"|"\blayers\b"|"serviceItemId"|"capabilities"/.test(n)}catch(dy){return!1}}(s)))return void alert("3DDaten (DZ NRW) antworten unerwartet. Prfe URL/CORS oder entferne Proxy.");const o=e.getContainer();o.style.visibility="hidden",o.style.pointerEvents="none",n.style.display="block",n.style.zIndex="500";const a=n.getBoundingClientRect();0===a.width||a.height,setTimeout(()=>window.dispatchEvent(new Event("resize")),0);const l=VV.last2D.center[0],c=VV.last2D.center[1],u=VV.last2D.zoom,h=Math.max(-90,Math.min(90,c)),d=Math.max(-180,Math.min(180,l)),f=Math.max(2,Math.min(19,u)),p=VV.current3D??{longitude:d,latitude:h,zoom:f,pitch:45,bearing:0};VV.deckRoot||(VV.deckRoot=Ql.createRoot(n)),VV.deckRoot.render(_e.createElement(OV,{initialViewState:p,dzUrl:s,onViewStateChange:e=>{VV.current3D=e}})),VV.is3D=!0}function jV(e,t=!0){let n=e.normalize("NFC");return n=n.replace(//g,"<=").replace(//g,">=").replace(/'/g,"'").replace(/'/g,"'").replace(/"/g,'"').replace(/"/g,'"').replace(//g,"..."),n=n.replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F]/g,""),n=n.replace(/[\u200B-\u200D\uFEFF]/g,""),n=n.replace(/[ \t]+/g," "),t&&(n=n.replace(/\//g,"/").replace(/-/g,"-").replace(/_/g,"_").replace(/\(/g,"(").replace(/\)/g,")")),n.trim()}const WV=[12,90,14,12,20,22],$V=WV;const XV=Object.freeze(Object.defineProperty({__proto__:null,LV_COL_WIDTHS:$V,LV_COL_WIDTHS_MM:WV,createTenderPdf:async function(e,t,n,i,r,s){var o;const{jsPDF:a}=window.jspdf,l=new a({orientation:"portrait",unit:"mm",format:"a4"}),c=()=>{const e=l.internal.pageSize.getWidth(),t=l.internal.pageSize.getHeight();if(l.saveGraphicsState(),l.setFont("helvetica","bold"),l.setFontSize(120),l.setTextColor(200,200,200),a.GState){const e=new a.GState({opacity:.2});l.setGState(e)}l.text("Vertraulich",e/2+50,t/2+50,{align:"center",angle:45}),l.restoreGraphicsState()},u=l.internal.pageSize.getWidth(),h=l.internal.pageSize.getHeight(),d=20,f=u-40;let p=d;const g=(t,n)=>{const i=l.internal.getFont(),r=l.internal.getFontSize(),s=h-10;l.setFontSize(8),l.setFont("helvetica","normal"),l.setTextColor(0,0,0);const o=`${e.KOMMUNE}  ${e.VERFAHRENSNR}  Stand: ${e.DATUM_STAND}`;l.text(o,u/2,s,{align:"center"});const a=`Seite ${t} von ${n}`;l.text(a,u/2,s+5,{align:"center"}),l.setFont(i.fontName,i.fontStyle),l.setFontSize(r)},m=(e,t=!1)=>p+e>h-20&&(l.addPage(),p=d,t||(l.setFont("helvetica","normal"),l.setFontSize(10)),!0),y=(e,t=1)=>{m(15,!0),l.setFont("helvetica","bold"),l.setFontSize(1===t?14:2===t?12:10),l.text(e,d,p),p+=8,l.setFont("helvetica","normal"),l.setFontSize(10)};l.setFontSize(20),l.setFont("helvetica","bold");const v=`Ausschreibung Zufahrtschutz  ${e.KOMMUNE}`,_=u-40,b=l.splitTextToSize(v,_);let E=40;b.forEach((e,t)=>{E=40+8*t,l.text(e,u/2,E,{align:"center"})}),l.setFontSize(10),l.setFont("helvetica","normal");let w=`${e.VERFAHRENSNR}  ${e.VERGABEART}`;e.LOS_NR.length>0&&(w+=`  Los ${e.LOS_NR.join(", ")}`),w+=`  ${e.STRASSEN_PLANGEBIET}`;const x=u-40,A=l.splitTextToSize(w,x),S=E+10;let T=S;A.forEach((e,t)=>{T=S+5*t,l.text(e,u/2,T,{align:"center"})}),p=Math.max(70,T+20),l.setFontSize(10),l.text("Ansprechpartner:",d,p);const C=l.splitTextToSize(e.ANSPRECHPARTNER,80);C.forEach((e,t)=>{l.text(e,70,p+6*t)}),p+=Math.max(6,6*C.length),l.text("Amt:",d,p);const I=l.splitTextToSize(e.AMT,80);I.forEach((e,t)=>{l.text(e,70,p+6*t)}),p+=Math.max(6,6*I.length),l.text("Kontakt:",d,p);const k=l.splitTextToSize(e.KONTAKT,80);if(k.forEach((e,t)=>{l.text(e,70,p+6*t)}),p+=Math.max(6,6*k.length),l.text("Datum:",d,p),l.text(e.DATUM_STAND,70,p),p+=16,s)try{const e=new Image;e.src=s,await new Promise((t,n)=>{const i=setTimeout(()=>n(new Error("Image load timeout")),5e3);e.onload=()=>{clearTimeout(i),t()},e.onerror=n});const t=e.width/e.height,n=.7*f,i=80,r=n/t,o=r>i?i*t:n,a=r>i?i:r;p+a<h-30&&(l.addImage(s,"PNG",d+f/2-o/2,p,o,a),p+=a+10)}catch(dy){}p=d,l.addPage(),y("1. Vergabe-/Verfahrensdaten",1),l.setFontSize(10),l.setFont("helvetica","normal"),[`Auftraggeber: ${e.KOMMUNE}/${e.AMT}`,`Ausfhrungsort: ${e.STRASSEN_PLANGEBIET}`,`Vergabeart: ${e.VERGABEART}`,`Losaufteilung: ${e.LOS_NR.length>0?e.LOS_NR.join(", "):"Ein Los"}`,"Ausfhrungsfristen:",`  - Aufbau: ${t.aufbau_ab}`,`  - Abbau: ${t.abbau_bis}`,`  - Bauzeitenfenster: ${t.zeitraum}`,"Nebenangebote: zugelassen","Bieterkommunikation: Vergabemarktplatz, Anfragen bis 14 Tage vor Angebotsfrist","Eignungsanforderungen:","  - Leistungsfhigkeit im Bereich HVM/Hochschutz","  - Referenzen vergleichbarer Projekte","  - Qualifikationen fr Montage und Inbetriebnahme"].forEach(e=>{m(6);const t=e.startsWith("  ")?10:0,n=f-t,i=jV(e,!1);l.splitTextToSize(i,n).forEach(e=>{p>h-25&&(l.addPage(),p=d,l.setFont("helvetica","normal"),l.setFontSize(10)),l.text(e,d+t,p),p+=6})}),p+=10,y("2. Vorbemerkung / Vertragstext",1),l.setFontSize(10),l.setFont("helvetica","normal"),["Kurzbeschreibung der Manahme:",`Zufahrtschutz fr ${t.veranstaltung} im Bereich ${e.STRASSEN_PLANGEBIET}.`,"","Gegenstand der Ausschreibung:","Die Ausschreibung umfasst die Lieferung, Montage, Inbetriebnahme, Dokumentation, Einweisung und Wartung von Zufahrtsicherungsbarrieren.","","Abrechnung:","Die Abrechnung erfolgt nach Aufma.","","Hinweise zur Ausfhrung/Installation:","Die Ausfhrung hat nach folgenden Normen und Regeln zu erfolgen:","- DIN SPEC 91414-2","- IWA 14-1/2","- ASTM F2656 (falls anwendbar)","- VDE/Elektro (falls motorische Anlagen)","- Unfallverhtungsvorschriften","- TAB/rtliche Vorgaben","","Verkehrsrechtliche Anordnung:","Gem  45 StVO ist eine verkehrsrechtliche Anordnung durch das Ordnungsamt erforderlich.","Die Kosten hierfr sind in den Positionen enthalten.","","Schutz von Zielkonflikten:","Folgende Zielkonflikte sind zu bercksichtigen:","- Rettungswege mssen jederzeit freigehalten werden","- Barrierefreiheit gem DIN 18040","- Winterdienst und Entsorgung","- Zugangsfenster fr Mllfahrzeuge definieren","","Koordinierungsleistungen:","Koordinierung mit Versorgern, Feuerwehr, Rettungsdienst und Polizei ist erforderlich.","","Dokumentation & Abnahme:","Es sind vorzulegen:","- Prf-/Funktionsprotokolle","- Bestands-/Revisionsunterlagen","- Betriebs-/Wartungsanleitung","- Fotodokumentation","- Einweisungspauschale ist in Positionen enthalten"].forEach(e=>{if(m(6),e.trim()){const t=e.startsWith("-")?5:0,n=f-t,i=jV(e,!1);l.splitTextToSize(i,n).forEach(e=>{p>h-25&&(l.addPage(),p=d,l.setFont("helvetica","normal"),l.setFontSize(10)),l.text(e,d+t,p),p+=6})}else p+=3}),p+=10,y("3. Technische Mindestanforderungen",1),y("3.1 Allgemeine Anforderungen",2),l.setFontSize(10),l.setFont("helvetica","normal");const R=Array.from(i.values()),P=R.length>0?Math.round(R.reduce((e,t)=>e+t.anprallgeschwindigkeit,0)/R.length):50,M=R.length>0?R.reduce((e,t)=>e+t.penetration,0)/R.length:.5,L=R.length>0?R[0].fahrzeugklasse:"K12";["Schutzniveau:",`Mindestens ${P} km/h bei ${L} mit zulssiger Eindringtiefe  ${M.toFixed(2)} m.`,"","ffnungs-/Betriebsart:",`${(null==(o=R[0])?void 0:o.ffnungsart)||"manuell/motorisch"} inkl. Notentriegelung.`,"Verriegelung: Profilzylinder oder gleichschlieend.","Witterungsbestndigkeit: Einsatz bei Temperaturen von -20C bis +50C.","Oberflchenbehandlung: Korrosionsschutz nach DIN EN ISO 12944.","","Untergrund:","Fundament/Fuplatten/Verankerungen gem Bodenklasse.","Verlegen von Leitungen/Induktionsschleifen falls erforderlich.","","Barrierefreiheit & Rettung:","Gehwegbreiten gem DIN 18040 einhalten.","Stolperkanten vermeiden.","Aufstellflchen fr Rettungsfahrzeuge vorsehen.","","Gleichwertigkeit:","Angebote mssen Gleichwertigkeit zu den geforderten Leistungs-/Sicherheitsmerkmalen nachweisen.","Erforderliche Nachweise:","- Crash-Testberichte","- Zertifikate","- Prfprotokolle","- Montagefreigaben"].forEach(e=>{if(m(6),e.trim()){const t=e.startsWith("-")?5:0,n=f-t,i=jV(e,!1);l.splitTextToSize(i,n).forEach(e=>{p>h-25&&(l.addPage(),p=d,l.setFont("helvetica","normal"),l.setFontSize(10)),l.text(e,d+t,p),p+=6})}else p+=3}),p+=10,y("3.2 Zufahrtsbezogene Anforderungen",2),n.forEach((e,t)=>{const n=i.get(e.id);m(25,!0),l.setFont("helvetica","bold"),l.setFontSize(11),l.text(`Zufahrt ${e.id}  ${e.strasse_platz}`,d,p),p+=8,l.setFont("helvetica","normal"),l.setFontSize(10);const r=["Geometrie & Logistik:",`  Freihaltebreite: ${e.freihaltebreite} m`,`  Radien: ${e.radien} m`,`  Lngsgeflle: ${e.lngsgeflle} %`,`  Medien/Leitungslage: ${e.medien_leitungslage}`,"","Schutzbedarf:"];n&&r.push(`  Anprallenergie: ${n.anprallenergie} kJ`,`  Restfahrzeuggeschwindigkeit:  ${n.restfahrzeuggeschwindigkeit} km/h`,`  Zulssige Eindringtiefe:  ${n.penetration} m`),r.push("","Betriebslogik:",`  ffnungsart: ${(null==n?void 0:n.ffnungsart)||"manuell"}`,"  Notffnung: "+((null==n?void 0:n.notentriegelung)?"erforderlich":"nicht erforderlich"),`  Schliesystem: ${(null==n?void 0:n.schliesssystem)||"Profilzylinder"}`,"  Winterdienst: "+(e.rumfahrzeugbedarf?"Rumfahrzeugzugang erforderlich":"kein spezieller Zugang"),"","Einbaubedingungen:",`  Untergrund: ${e.untergrund}`,"  Bodengruppe: nach Baugrundgutachten","  Medienleitungen sichern: "+("keine"!==e.medien_leitungslage?"ja":"nein")),r.forEach(e=>{if(m(6),e.trim()){const t=e.startsWith("  ")?10:0,n=f-t,i=jV(e,!1);l.splitTextToSize(i,n).forEach(e=>{p>h-25&&(l.addPage(),p=d,l.setFont("helvetica","normal"),l.setFontSize(10)),l.text(e,d+t,p),p+=6})}else p+=3}),p+=5}),p+=10,y("4. Leistungsverzeichnis",1);const B=[];let N=1;y("01 Lieferung/Barriereelemente",2),p-=3,n.forEach(e=>{const t=i.get(e.id),n="motorisch"===(null==t?void 0:t.ffnungsart)?"motorisch betrieben":"manuell"===(null==t?void 0:t.ffnungsart)?"manuell betrieben":"fest/abnehmbar";B.push({position:`${String(N).padStart(2,"0")}`,beschreibung:`Lieferung von HVM-Barriereelement(en) fr Zufahrt ${e.strasse_platz} (Typ: ${n}), Mindest-Schutzniveau ${(null==t?void 0:t.anprallgeschwindigkeit)||P} km/h bei ${(null==t?void 0:t.fahrzeugklasse)||L}, zul. Eindringtiefe <= ${(null==t?void 0:t.penetration)||M.toFixed(2)} m, Durchfahrtsbreite ${(null==t?void 0:t.durchfahrtsbreite)||4} m. inkl. Zubehr, Befestigungsmittel, Nebenleistungen.`,menge:1,einheit:"Stk",ep:0,gp:0}),N++}),m(10),y("02 Montage/Grndungen/Verankerungen",2),p-=3,n.forEach(e=>{B.push({position:`${String(N).padStart(2,"0")}`,beschreibung:`Herstellen Fundament/Unterkonstruktion fr Zufahrt ${e.strasse_platz} gem. Bodenklasse, inkl. Aushub, Entsorgung, Verdichtung, Bewehrung, Verguss, Nachbehandlung.`,menge:1,einheit:"Stk",ep:0,gp:0}),N++}),m(10),y("03 Rck-/Umbaumanahmen am Umfeld",2),p-=3,n.length>0&&B.push({position:`${String(N++).padStart(2,"0")}`,beschreibung:"Rck-/Umbaumanahmen am Umfeld der Zufahrten, inkl. Herstellen Oberflche, Entsorgung.",menge:1,einheit:"Pausch",ep:0,gp:0}),m(10),y("04 Verkehrssicherung/Baustellensicherung",2),p-=3,B.push({position:`${String(N++).padStart(2,"0")}`,beschreibung:"Verkehrssicherung nach RSA: Absperrungen, Beschilderung, Fugngerfhrung, Nachtkennzeichnung; inklusive Vorhaltung whrend der Bauzeit.",menge:1,einheit:"Pausch",ep:0,gp:0}),Array.from(i.values()).some(e=>"motorisch"===e.ffnungsart)&&(m(10),y("05 Elektro/Steuerung",2),p-=3,B.push({position:`${String(N++).padStart(2,"0")}`,beschreibung:"Elektro/Steuerung: Verkabelung, Schaltschrank, Antrieb, Fernbedienung, Notffnung fr motorische Anlagen.",menge:1,einheit:"Kompl.",ep:0,gp:0})),m(10),y("06 Dokumentation/Einweisung",2),p-=3,B.push({position:`${String(N++).padStart(2,"0")}`,beschreibung:"Dokumentation: Bestands-/Revisionsunterlagen, Betriebs-/Wartungsanleitung, Prf-/Funktionsprotokoll, Fotodokumentation. Einweisungspauschale.",menge:1,einheit:"Pausch",ep:0,gp:0}),m(10),y("07 Optionen/Alternativpositionen",2),p-=3,B.push({position:`${String(N++).padStart(2,"0")}`,beschreibung:"Jhrliche Wartung (optional, abrechenbar nach Aufwand/Einheit)",menge:1,einheit:"Jahr",ep:0,gp:0}),l.setFont("helvetica","normal");const O=$V;((e,t,n)=>{m(30,!0);l.setFont("helvetica","bold"),l.setFontSize(9);let i=d;e.forEach((e,t)=>{const r=t>=2?i+n[t]-2:i;l.text(e,r,p,{align:t>=2?"right":"left"}),i+=n[t]}),p+=8,l.setLineWidth(.5);const r=n.reduce((e,t)=>e+t,0);l.line(d,p-2,d+r,p-2),p+=2,l.setFont("helvetica","normal"),l.setFontSize(8),t.forEach((t,s)=>{p+7>h-20&&(l.setFont("helvetica","italic"),l.setFontSize(7),l.text("bertrag",d+r-5,p,{align:"right"}),p+=7,l.addPage(),p=d,l.setFont("helvetica","bold"),l.setFontSize(9),i=d,e.forEach((e,t)=>{const r=t>=2?i+n[t]-2:i;l.text(e,r,p,{align:t>=2?"right":"left"}),i+=n[t]}),p+=8,l.line(d,p-2,d+r,p-2),p+=2,l.setFont("helvetica","normal"),l.setFontSize(8)),i=d,t.forEach((e,t)=>{if(1===t&&e.length>60){const r=n[t]-2,s=l.splitTextToSize(e,r);s.forEach((e,t)=>{t>0&&p+7>h-20&&(m(7,!0),l.setFont("helvetica","normal"),l.setFontSize(8)),l.text(e,i+1,p+4*t,{align:"left"})}),p+=Math.max(7,4*(s.length-1))}else{const r=t>=2?"right":"left";l.text(e,i+(t>=2?n[t]-2:1),p,{align:r})}i+=n[t]}),p+=7}),p+=5})(["Pos.","Beschreibung","Menge","Einh","EP","GP"],B.map(e=>{var t,n;return[e.position,jV(e.beschreibung,!1),e.menge.toString(),e.einheit,(null==(t=e.ep)?void 0:t.toFixed(2).replace(".",","))||"0,00",(null==(n=e.gp)?void 0:n.toFixed(2).replace(".",","))||"0,00"]}),O),m(20),l.setFont("helvetica","bold"),l.setFontSize(11),l.text("Zusammenstellung",150,p,{align:"right"}),p+=7,l.setFont("helvetica","normal"),l.setFontSize(10);const D=B.reduce((e,t)=>e+(t.gp||0),0),F=.19*D,U=D+F,z=O.reduce((e,t)=>e+t,0);l.text("Summe (netto):",d+z-45,p,{align:"right"}),l.text(D.toFixed(2).replace(".",",")+" EUR",d+z,p,{align:"right"}),p+=6,l.text("zzgl. MwSt. 19%:",d+z-45,p,{align:"right"}),l.text(F.toFixed(2).replace(".",",")+" EUR",d+z,p,{align:"right"}),p+=6,l.setFont("helvetica","bold"),l.text("Gesamtsumme:",d+z-45,p,{align:"right"}),l.text(U.toFixed(2).replace(".",",")+" EUR",d+z,p,{align:"right"}),p+=15,y("5. Vertrags-/Besondere Bedingungen",1),l.setFontSize(10),l.setFont("helvetica","normal"),["Leistungsumfang:","Der Leistungsumfang umfasst die Lieferung, Montage, Inbetriebnahme, Dokumentation und Einweisung.",`Service/Wartung nach Vereinbarung (siehe Position ${N-1}).`,"","Laufzeit/Termine:",`Aufbau/Abbaufenster: ${t.aufbau_ab} bis ${t.abbau_bis}`,"Reaktionszeiten bei Strung: 4 Stunden (werktags), 8 Stunden (auerhalb Werktage)","","Abrechnung/Nachweise:","- Abrechnung nach Aufma","- Lieferscheine","- Prfberichte","- Entsorgungsnachweise","","Gerichtsstand/Erfllungsort:",`Gerichtsstand und Erfllungsort ist ${e.KOMMUNE}.`,"nderungen bedrfen der Schriftform.","","Datenschutz/IT-Sicherheit:","Bei Steuerungselektrik/Netzwerk sind die Anforderungen der DSGVO einzuhalten."].forEach(e=>{if(m(6),e.trim()){const t=e.startsWith("-")?5:0,n=f-t,i=jV(e,!1);l.splitTextToSize(i,n).forEach(e=>{p>h-25&&(l.addPage(),p=d,l.setFont("helvetica","normal"),l.setFontSize(10)),l.text(e,d+t,p),p+=6})}else p+=3}),p+=10,y("6. Anlagen",1),l.setFontSize(10),l.text("Folgende Anlagen sind diesem Leistungsverzeichnis beigefgt:",d,p),p+=8,l.text("- bersichtsplan Sicherheitsbereich mit Zufahrten",25,p),p+=6,l.text("- Detailplne je Zufahrt",25,p),p+=6,l.text("- Risiko-/Anprallberechnung je Zufahrt (Tabellen)",25,p),p+=6,l.text("- Bieterangabenblatt (leer)",25,p),p+=6,l.text("- Preisblatt/Losblatt",25,p);const G=l.internal.getNumberOfPages();for(let V=1;V<=G;V++)l.setPage(V),c(),g(V,G);return l},sanitizeDe:jV},Symbol.toStringTag,{value:"Module"})),qV="barricadix_authenticated";function KV(){const e=document.getElementById("welcome-screen"),t=document.getElementById("app-container");e&&t&&(e.style.display="flex",t.style.display="none")}function YV(){const e=document.getElementById("welcome-screen"),t=document.getElementById("app-container");e&&t&&(e.style.display="none",t.style.display="flex",async function(){var e,t,n;(function(){const e=window.loadOsmDataForCurrentPolygon;e&&(window.loadOsmDataForCurrentPolygon=async function(...t){const n=await e.apply(this,t),i=window.drawnPolygon,r=window.currentOsmData;return i&&r&&await Xh.detectEntries(i,r),n}),window.entryDetectionManager=Xh})(),function(){const e=document.createElement("style");e.textContent='\n    .entry-detection-panel {\n      background: rgba(12, 47, 77, 0.95);\n      backdrop-filter: blur(10px);\n      border-radius: 12px;\n      padding: 16px;\n      margin: 16px 0;\n      color: white;\n      max-height: 400px;\n      overflow-y: auto;\n    }\n\n    .entry-detection-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 12px;\n    }\n\n    .entry-detection-header h3 {\n      margin: 0;\n      font-size: 16px;\n      font-weight: 600;\n    }\n\n    .entry-detection-controls {\n      display: flex;\n      gap: 8px;\n    }\n\n    .btn-primary, .btn-secondary {\n      padding: 6px 12px;\n      border: none;\n      border-radius: 6px;\n      font-size: 12px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    }\n\n    .btn-primary {\n      background: #3b82f6;\n      color: white;\n    }\n\n    .btn-primary:hover {\n      background: #2563eb;\n    }\n\n    .btn-secondary {\n      background: rgba(255, 255, 255, 0.2);\n      color: white;\n    }\n\n    .btn-secondary:hover {\n      background: rgba(255, 255, 255, 0.3);\n    }\n\n    .entry-detection-status {\n      margin-bottom: 12px;\n    }\n\n    .status-indicator {\n      padding: 6px 12px;\n      border-radius: 6px;\n      font-size: 12px;\n      font-weight: 500;\n    }\n\n    .status-indicator.loading {\n      background: rgba(251, 191, 36, 0.2);\n      color: #fbbf24;\n    }\n\n    .status-indicator.success {\n      background: rgba(74, 222, 128, 0.2);\n      color: #4ade80;\n    }\n\n    .status-indicator.error {\n      background: rgba(248, 113, 113, 0.2);\n      color: #f87171;\n    }\n\n    .candidates-list {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    .candidate-item {\n      background: rgba(255, 255, 255, 0.1);\n      border-radius: 8px;\n      padding: 12px;\n      border-left: 4px solid transparent;\n    }\n\n    .candidate-item[data-confidence*="0.7"] {\n      border-left-color: #4ade80;\n    }\n\n    .candidate-item[data-confidence*="0.4"]:not([data-confidence*="0.7"]) {\n      border-left-color: #fbbf24;\n    }\n\n    .candidate-item[data-confidence*="0.3"]:not([data-confidence*="0.4"]) {\n      border-left-color: #f87171;\n    }\n\n    .candidate-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 8px;\n    }\n\n    .candidate-id {\n      font-family: monospace;\n      font-size: 11px;\n      color: #ccc;\n    }\n\n    .confidence-badge {\n      background: rgba(255, 255, 255, 0.2);\n      padding: 2px 6px;\n      border-radius: 4px;\n      font-size: 10px;\n      font-weight: 600;\n    }\n\n    .candidate-details {\n      display: grid;\n      grid-template-columns: 1fr 1fr 1fr;\n      gap: 8px;\n      font-size: 10px;\n    }\n\n    .metric {\n      display: flex;\n      flex-direction: column;\n      gap: 2px;\n    }\n\n    .metric .label {\n      color: #aaa;\n      font-size: 9px;\n    }\n\n    .metric .value {\n      font-weight: 600;\n    }\n  ',document.head.appendChild(e)}(),FH(),await aj(),vH=new uc({useMaxspeed:!0,useTrafficCalming:!0,useSurface:!1,weather:"dry"}),function(){try{const e=document.getElementById("osm-maxspeed"),t=document.getElementById("osm-traffic-calming"),n=document.getElementById("osm-surface"),i=document.getElementById("weather-select");e&&(e.checked="false"!==localStorage.getItem("osm-maxspeed")),t&&(t.checked="false"!==localStorage.getItem("osm-traffic-calming")),n&&(n.checked="true"===localStorage.getItem("osm-surface")),i&&(i.value=localStorage.getItem("osm-weather")||"dry"),RW()}catch(e){}}(),function(){const e=document.getElementById("osm-maxspeed"),t=document.getElementById("osm-traffic-calming"),n=document.getElementById("osm-surface"),i=document.getElementById("weather-select"),r=()=>{RW(),function(){try{const e=document.getElementById("osm-maxspeed"),t=document.getElementById("osm-traffic-calming"),n=document.getElementById("osm-surface"),i=document.getElementById("weather-select");e&&localStorage.setItem("osm-maxspeed",e.checked.toString()),t&&localStorage.setItem("osm-traffic-calming",t.checked.toString()),n&&localStorage.setItem("osm-surface",n.checked.toString()),i&&localStorage.setItem("osm-weather",i.value)}catch(e){}}(),lH&&MW()};e&&e.addEventListener("change",r),t&&t.addEventListener("change",r),n&&n.addEventListener("change",r),i&&i.addEventListener("change",r)}();let i=0;const r=3;for(;i<r&&(!OH.de||!OH.en);)await sj(),i++,!(i<r)||OH.de&&OH.en||await new Promise(e=>setTimeout(e,500));OH.de&&OH.en||(OH=DH);NH="de",await rj(),OW();const s=localStorage.getItem("language")||"de";s!==NH&&await oj(s);document.querySelectorAll(".lang-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.lang;t&&t!==NH&&oj(t)})});const o=document.getElementById("tooltip");document.querySelectorAll(".info-icon").forEach(e=>{const t=e,n=()=>{const e=t.dataset.tooltip||"";o.textContent=e,o.style.opacity="1";const n=t.getBoundingClientRect();o.style.left=`${n.left+window.scrollX}px`,o.style.top=`${n.bottom+window.scrollY+5}px`},i=()=>{o.style.opacity="0"};t.addEventListener("mouseover",n),t.addEventListener("mouseout",i),t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),"1"===o.style.opacity&&o.textContent===(t.dataset.tooltip||"")?i():n()})});const a=document.getElementById("map-search-input");a&&!a.value&&(a.value=ij("map.searchPlaceholder"));const l=document.getElementById("map-search-button"),c=document.getElementById("toggle-sidebar"),u=document.querySelector(".sidebar");setTimeout(()=>{CW()},500),setTimeout(()=>{IW()},600),setTimeout(()=>{kW()},1e3);const h=()=>{const e=document.getElementById("hazard-analysis-bubble"),t=document.getElementById("hazard-analysis-strip");if(e&&t){e.style.transform="translateX(-100%)",e.style.opacity="0",setTimeout(()=>{e.style.visibility="hidden"},300),t.style.display="block",t.style.visibility="visible",t.style.opacity="1";const n=document.getElementById("toggle-hazard-analysis-bubble"),i=null==n?void 0:n.querySelector("i");i&&(i.className="fas fa-chevron-right")}},d=()=>{const e=document.getElementById("parameter-bubble"),t=document.getElementById("parameter-strip");if(e&&t){e.style.transform="translateX(-100%)",e.style.opacity="0",setTimeout(()=>{e.style.visibility="hidden"},300),t.style.display="block",t.style.visibility="visible",t.style.opacity="1";const n=document.getElementById("toggle-parameter-bubble"),i=null==n?void 0:n.querySelector("i");i&&(i.className="fas fa-chevron-right")}};document.addEventListener("click",e=>{const t=e.target;("nav-param-input"===t.id||"tab-param-input"===t.id||t.closest("#nav-param-input")||t.closest("#tab-param-input"))&&setTimeout(()=>{const e=document.getElementById("parameter-bubble"),t=document.getElementById("parameter-strip");if(h(),e&&t){e.style.visibility="visible",e.style.transform="translateX(0)",e.style.opacity="1",t.style.display="block",t.style.visibility="visible",t.style.opacity="1";const n=document.getElementById("toggle-parameter-bubble"),i=null==n?void 0:n.querySelector("i");i&&(i.className="fas fa-chevron-left")}},100);("nav-hazard-analysis"===t.id||"tab-hazard-analysis"===t.id||t.closest("#nav-hazard-analysis")||t.closest("#tab-hazard-analysis"))&&setTimeout(()=>{const e=document.getElementById("hazard-analysis-bubble"),t=document.getElementById("hazard-analysis-strip");if(d(),e&&t){e.style.visibility="visible",e.style.transform="translateX(0)",e.style.opacity="1",t.style.display="block",t.style.visibility="visible",t.style.opacity="1";const n=document.getElementById("toggle-hazard-analysis-bubble"),i=null==n?void 0:n.querySelector("i");i&&(i.className="fas fa-chevron-left")}},100);("nav-marking-area"===t.id||"tab-marking-area"===t.id||"nav-threat-analysis"===t.id||"tab-threat-analysis"===t.id||"nav-risk-report"===t.id||"tab-risk-report"===t.id||"nav-product-selection"===t.id||"tab-product-selection"===t.id||"nav-project-description"===t.id||"tab-project-description"===t.id||"nav-publish-project"===t.id||t.closest("#nav-marking-area")||t.closest("#tab-marking-area")||t.closest("#nav-threat-analysis")||t.closest("#tab-threat-analysis")||t.closest("#nav-risk-report")||t.closest("#tab-risk-report")||t.closest("#nav-product-selection")||t.closest("#tab-product-selection")||t.closest("#nav-project-description")||t.closest("#tab-project-description")||t.closest("#nav-publish-project"))&&(h(),d())},!0);const f=async()=>{const e=a.value.trim();if(!e)return;const t=`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(e)}`;try{const e=await fetch(t,{headers:{"Accept-Language":NH}});if(!e.ok)throw new Error(`API request failed with status ${e.status}`);const n=await e.json();if(n&&n.length>0){const{lat:e,lon:t,display_name:i}=n[0];eH.setView([e,t],15),nH&&eH.removeLayer(nH),nH&&(eH.removeLayer(nH),nH=null);const r=L.divIcon({className:"search-marker",html:'<i class="fas fa-map-marker-alt" style="color: #dc2626; font-size: 20px;"></i>',iconSize:[25,41],iconAnchor:[12,41]});nH=L.marker([e,t],{icon:r,zIndexOffset:1e3}).addTo(eH),nH.bindPopup(`<b>${i}</b>`).openPopup(),eH.invalidateSize()}else alert(ij("alerts.locationNotFound"))}catch(n){alert(ij("alerts.searchError"))}};l.addEventListener("click",f),a.addEventListener("keypress",e=>{"Enter"===e.key&&f()}),c&&u&&c.addEventListener("click",()=>{u.classList.toggle("open")});const p=document.getElementById("toggle-draw-mode"),g=document.getElementById("reset-drawing"),m=document.getElementById("map"),y=e=>{iH=e;const t=p.querySelector("span");e?(p.classList.add("active"),t&&(t.textContent=ij("map.setWaypointsActive")),null==m||m.classList.add("drawing-mode")):(p.classList.remove("active"),t&&(t.textContent=ij("map.setWaypoints")),null==m||m.classList.remove("drawing-mode"))},v=()=>{oH.forEach(e=>eH.removeLayer(e)),oH=[],aH&&eH.removeLayer(aH),aH=null,rH=[],iH&&y(!1),uH.forEach(({polygon:e,label:t})=>{e&&eH.removeLayer(e),t&&eH.removeLayer(t)}),uH=[],lH=null,cH=null,_()},_=()=>{const e=document.getElementById("add-security-area-btn");e&&("nav-marking-area"===sH&&!iH&&uH.length>0?e.classList.remove("hidden"):e.classList.add("hidden"))},b=()=>{aH&&eH.removeLayer(aH),rH.length>1&&(aH=L.polyline(rH,{color:"var(--accent-color)",weight:3}).addTo(eH))},E=()=>{if(rH.length<3)return void alert("Bitte mindestens 3 Punkte setzen, um einen Sicherheitsbereich zu schlieen.");const e=L.polygon(rH,{color:"yellow",fillColor:"#FFFF00",fillOpacity:.3,weight:2}).addTo(eH);mj(e);const t=e.getBounds().getCenter(),n=L.marker(t,{icon:L.divIcon({className:"polygon-label",html:`<div>${ij("map.securityAreaLabel")} ${uH.length+1}</div>`,iconSize:[150,24]})}).addTo(eH),i=`polygon-${Date.now()}`;uH.push({polygon:e,label:n,id:i}),lH=e,cH=n,aH&&eH.removeLayer(aH),aH=null,oH.forEach(e=>eH.removeLayer(e)),oH=[],rH=[],y(!1),PW()&&MW(),_()},w=e=>{if(mH)return void function(e){if(!mH)return;const t=yH.get(mH);if(!t||0===t.length)return;const n=t[t.length-1];let i=e.latlng;if(n.waypoints.length>0){if(n.waypoints[n.waypoints.length-1].distanceTo(i)<.1)return}if(_H&&_H.ways){const e=function(e,t){var n,i,r;if(!t.ways||0===t.ways.length)return null;if(!t.nodes)return null;const s=new Map;t.nodes.forEach(e=>{s.set(String(e.id),e)});let o=null,a=1/0;const l=50;for(const c of t.ways)if("footway"!==(null==(n=c.tags)?void 0:n.highway)&&"cycleway"!==(null==(i=c.tags)?void 0:i.highway)&&"path"!==(null==(r=c.tags)?void 0:r.highway)&&c.nodeIds&&!(c.nodeIds.length<2))for(let t=0;t<c.nodeIds.length-1;t++){const n=String(c.nodeIds[t]),i=String(c.nodeIds[t+1]),r=s.get(n),u=s.get(i);if(!r||!u)continue;const h=iW(e,L.latLng(r.lat,r.lon),L.latLng(u.lat,u.lon)),d=111e3*e.distanceTo(h);d<l&&d<a&&(a=d,o=h)}return o}(i,_H);e&&(i=e)}n.waypoints.push(i),n.pathLine?n.pathLine.setLatLngs(n.waypoints):n.pathLine=L.polyline(n.waypoints,{color:"#0ea5e9",weight:3}).addTo(eH);const r=Yj(i,{id:mH},t.length-1,n.waypoints.length-1);n.waypointMarkers.push(r),Jj(mH)}(e);if(!iH)return;const t=e.latlng,n=L.marker(t).addTo(eH);0===rH.length&&n.on("click",()=>{iH&&rH.length>=3&&E()}),rH.push(t),oH.push(n),b()};eH.on("click",w);const x=document.querySelectorAll(".main-nav a"),A=document.querySelectorAll(".map-tabs a"),S=document.getElementById("analyze-threats"),T=document.getElementById("create-report-btn"),C=document.getElementById("download-report-btn"),I=document.getElementById("report-iframe"),k=document.getElementById("map"),R=document.getElementById("report-preview-area"),P=document.getElementById("vehicle-select");pH=document.getElementById("manual-entry-toggle"),pH&&(pH.addEventListener("click",()=>{(null==pH?void 0:pH.disabled)||pj(!fH)}),gj("nav-threat-analysis"===sH));const M=document.getElementById("manual-path-drawing-toggle");M&&M.addEventListener("click",()=>{if(mH)Kj();else{const e=window.entryDetectionManager;if(!e||!e.candidates)return void nj("Bitte zuerst eine manuelle Zufahrt hinzufgen.","warning");const t=e.candidates.filter(e=>e.manual);if(0===t.length)return void nj("Bitte zuerst eine manuelle Zufahrt hinzufgen (Rechtsklick auf Polygon-Rand).","warning");1===t.length?Xj(t[0].id):(Xj(t[0].id),nj(`Pfadzeichnen fr Zufahrtspunkt gestartet. (${t.length} manuelle Zufahrten verfgbar)`,"info"))}});const B=document.getElementById("calculate-speeds-btn");B&&B.addEventListener("click",()=>{rW(),nj("Geschwindigkeiten fr manuelle Pfade berechnet.","success")});const N=async(e,t)=>{sH=e;const n=document.getElementById("deletion-bubble");if(n&&n.remove(),t&&(x.forEach(e=>e.classList.remove("active")),t.classList.add("active")),A.forEach(t=>{const n=t;n.classList.toggle("active",n.getAttribute("data-target")===e)}),gj("nav-threat-analysis"===e),"nav-param-input"===e){wH=null,AH="";const e=document.getElementById("add-security-area-btn");e&&e.classList.add("hidden")}if("nav-marking-area"===e){wH=null,AH="";const e=document.getElementById("add-security-area-btn");e&&(uH.length>0&&!iH?e.classList.remove("hidden"):e.classList.add("hidden")),cj()}if("nav-threat-analysis"===e){wH=null,AH="";const e=document.getElementById("add-security-area-btn");e&&e.classList.add("hidden"),cj()}"nav-product-selection"===e?await Vj():"nav-project-description"!==e&&hW(),"nav-project-description"===e&&(wH=null,AH=""),p.classList.add("hidden"),g.classList.add("hidden"),S.classList.add("hidden"),T.classList.add("hidden"),C.classList.add("hidden");const i=document.getElementById("add-security-area-btn");i&&i.classList.add("hidden");const r=document.getElementById("manual-entry-toggle"),s=document.getElementById("manual-path-drawing-toggle"),o=document.getElementById("calculate-speeds-btn");r&&r.classList.add("hidden"),s&&s.classList.add("hidden"),o&&o.classList.add("hidden");const a=document.getElementById("create-tender-btn"),l=document.getElementById("download-tender-btn");a&&a.classList.add("hidden"),l&&l.classList.add("hidden");const c="nav-risk-report"===e,u="nav-project-description"===e,h=document.getElementById("tender-preview-area"),d=u&&null!==SH;if(k.classList.toggle("view-hidden",c||d),R.classList.toggle("view-hidden",!c),h&&h.classList.toggle("view-hidden",!u||null===SH),eH&&(c||u||eH.invalidateSize()),wH||(I.src="about:blank",C.disabled=!0),"nav-marking-area"===e)p.classList.remove("hidden"),g.classList.remove("hidden");else if("nav-threat-analysis"===e){S.classList.remove("hidden");const e=document.getElementById("manual-entry-toggle"),t=document.getElementById("manual-path-drawing-toggle"),n=document.getElementById("calculate-speeds-btn");e&&e.classList.remove("hidden"),t&&t.classList.remove("hidden"),n&&n.classList.remove("hidden")}else if("nav-risk-report"===e)T.classList.remove("hidden"),C.classList.remove("hidden"),C.disabled=!wH;else if("nav-project-description"===e){const e=document.getElementById("create-tender-btn"),t=document.getElementById("download-tender-btn");e&&e.classList.remove("hidden"),t&&(t.classList.remove("hidden"),t.disabled=!SH)}};x.forEach(e=>{e.addEventListener("click",async e=>{e.preventDefault();const t=e.currentTarget,n=t.id;if("nav-threat-analysis"===n){const e=document.getElementById("tab-threat-analysis"),t=document.getElementById("threat-analysis-submenu");if(e&&t){if(!t.classList.contains("show"))return t.style.display="",t.classList.add("show"),void e.classList.add("submenu-open")}}await N(n,t)})}),A.forEach(e=>{e.addEventListener("click",async e=>{e.preventDefault();const t=e.currentTarget,n=t.getAttribute("data-target");if("nav-threat-analysis"===n){const e=document.getElementById("threat-analysis-submenu"),n=null==e?void 0:e.classList.contains("show");if(document.querySelectorAll(".threat-submenu").forEach(e=>{e.classList.remove("show"),e.style.display="none"}),e&&(n?(e.classList.remove("show"),e.style.display="none"):(e.style.display="",e.classList.add("show")),t.classList.toggle("submenu-open",!n)),!n)return}else document.querySelectorAll(".threat-submenu").forEach(e=>{e.classList.remove("show"),e.style.display="none"}),document.querySelectorAll(".has-submenu").forEach(e=>{e.classList.remove("submenu-open")});const i=document.getElementById(n);await N(n,i??void 0)})});const O=document.getElementById("threat-analysis-submenu");O&&O.addEventListener("click",async e=>{const t=e.target.closest(".submenu-item");if(!t)return;e.preventDefault(),e.stopPropagation();const n=t.getAttribute("data-submenu-action");if(t.classList.contains("disabled")){const e=document.getElementById("module-contact-modal");e&&(e.style.display="flex")}else if("access-analysis"===n){const e=document.getElementById("tab-threat-analysis");if(e){O.style.display="none",e.classList.remove("submenu-open");const t=document.getElementById("nav-threat-analysis");await N("nav-threat-analysis",t??void 0)}}});document.addEventListener("click",e=>{const t=e.target;t.closest(".has-submenu")||t.closest(".threat-submenu")||t.closest(".tab-with-submenu")||(document.querySelectorAll(".threat-submenu").forEach(e=>{e.classList.remove("show"),e.style.display="none"}),document.querySelectorAll(".has-submenu").forEach(e=>{e.classList.remove("submenu-open")}))});const D=document.getElementById("module-contact-modal"),F=document.getElementById("close-module-modal-btn"),U=document.getElementById("close-module-modal");function z(){D&&(D.style.display="none")}F&&F.addEventListener("click",z);U&&U.addEventListener("click",z);D&&(null==(e=D.querySelector(".modal-overlay"))||e.addEventListener("click",z),null==(t=D.querySelector(".modal-content-box"))||t.addEventListener("click",e=>{e.stopPropagation()}));P.addEventListener("change",async()=>{var e;dH.size>0&&await Dj(),!1===(null==(e=document.querySelector(".product-recommendations-container"))?void 0:e.classList.contains("hidden"))&&await Vj()}),p.addEventListener("click",()=>{if(iH){y(!1);const e=document.getElementById("add-security-area-btn");e&&(uH.length>0?e.classList.remove("hidden"):e.classList.add("hidden"))}else{y(!0);const e=document.getElementById("add-security-area-btn");e&&e.classList.add("hidden")}});const G=document.getElementById("add-security-area-btn");G&&G.addEventListener("click",()=>{if(iH&&rH.length>0)return void alert("Bitte schlieen Sie zuerst den aktuellen Sicherheitsbereich, bevor Sie einen neuen hinzufgen.");!uH.every(e=>{const t=e.polygon.getLatLngs();return t&&t.length>0&&t[0].length>=3})&&uH.length>0?alert("Bitte schlieen Sie zuerst alle vorhandenen Sicherheitsbereiche, bevor Sie einen neuen hinzufgen."):(y(!0),G.classList.add("hidden"))});g.addEventListener("click",()=>{v(),bj()}),S.addEventListener("click",Dj),T.addEventListener("click",xW),C.addEventListener("click",AW);const V=document.getElementById("create-tender-btn"),H=document.getElementById("download-tender-btn");V&&V.addEventListener("click",TW);H&&H.addEventListener("click",SW);function j(){if(lH&&eH){const e=lH.getLatLngs()[0],t=lH.getBounds();window.savedSecurityArea={polygonData:e,bounds:t,center:t.getCenter(),hasPolygon:!0}}else window.savedSecurityArea={hasPolygon:!1}}function W(){const e=window.savedSecurityArea;e&&e.hasPolygon&&e.polygonData&&eH&&(lH&&eH.removeLayer(lH),cH&&eH.removeLayer(cH),lH=L.polygon(e.polygonData,{color:"#2563eb",weight:3,fillOpacity:.1}).addTo(eH),mj(lH),cH=L.marker(e.center,{icon:L.divIcon({className:"polygon-label",html:`<div class="polygon-label-content">${ij("map.securityArea")}</div>`,iconSize:[100,20],iconAnchor:[50,10]})}).addTo(eH))}function $(){const e=L.Polygon.prototype.addTo;L.Polygon.prototype.addTo=function(t){const n=e.call(this,t);return this===lH&&setTimeout(()=>{j()},100),n}}function X(){var e,t,n,i;const r=document.getElementById("nav-marking-area"),s=document.getElementById("nav-param-input");if(r){const t=r.cloneNode(!0);null==(e=r.parentNode)||e.replaceChild(t,r),t.addEventListener("click",e=>{e.preventDefault(),N("nav-marking-area",t),setTimeout(()=>{W()},100)})}if(s){const e=s.cloneNode(!0);null==(t=s.parentNode)||t.replaceChild(e,s),e.addEventListener("click",t=>{t.preventDefault(),j(),N("nav-param-input",e)})}const o=document.getElementById("tab-marking-area"),a=document.getElementById("tab-param-input");if(o){const e=o.cloneNode(!0);null==(n=o.parentNode)||n.replaceChild(e,o),e.addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("nav-marking-area");t&&N("nav-marking-area",t)})}if(a){const e=a.cloneNode(!0);null==(i=a.parentNode)||i.replaceChild(e,a),e.addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("nav-param-input");t&&N("nav-param-input",t)})}}null==(n=document.getElementById("nav-marking-area"))||n.click();const q=()=>{const e=document.querySelector(".osm-controls");if(e){e.querySelectorAll(".checkbox-label").forEach(e=>{e.style.cssText+="\n                margin: 0 !important;\n                padding: 1px 0 !important;\n                line-height: 1.3 !important;\n                min-height: auto !important;\n                height: auto !important;\n            "});e.querySelectorAll(".checkbox-group").forEach(e=>{e.style.cssText+="\n                margin: 2px 0 !important;\n                padding: 1px 0 !important;\n                line-height: 1.3 !important;\n            "})}};setTimeout(q,100),setTimeout(q,500),setTimeout(q,1e3),$(),setTimeout(()=>{X()},1e3);const K=document.getElementById("chatbot-react-root");if(K)try{Zl.createRoot(K).render(ve.createElement(Ol))}catch(dy){}FH()}(),setTimeout(()=>{eH&&eH.invalidateSize()},200),setTimeout(()=>{eH&&eH.invalidateSize()},500))}function JV(){const e=document.getElementById("auth-form"),t=document.getElementById("password-input"),n=document.getElementById("auth-error"),i=document.getElementById("auth-submit");e&&t&&n&&i&&(e.addEventListener("submit",e=>{e.preventDefault(),ZV(t.value)}),t.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),ZV(t.value))}),t.addEventListener("input",()=>{!function(){const e=document.getElementById("auth-error");e&&(e.style.display="none")}()}),t.focus())}function ZV(e){const t=document.getElementById("auth-error"),n=document.getElementById("auth-submit"),i=document.getElementById("password-input");t&&n&&i&&(n.style.opacity="0.7",n.style.pointerEvents="none",i.disabled=!0,setTimeout(()=>{"1919"===e?(sessionStorage.setItem(qV,"true"),n.innerHTML='<i class="fas fa-check"></i> Erfolgreich!',n.style.background="linear-gradient(45deg, #10b981, #059669)",setTimeout(()=>{YV()},800)):(!function(){const e=document.getElementById("auth-error");e&&(e.style.display="flex",setTimeout(()=>{e.style.display="none"},3e3))}(),n.style.opacity="1",n.style.pointerEvents="auto",i.disabled=!1,i.value="",i.focus(),n.innerHTML='<i class="fas fa-sign-in-alt"></i> Anmelden')},500))}function QV(){sessionStorage.removeItem(qV),KV(),JV()}let eH;window.logout=QV,window.getCurrentTab=()=>sH;let tH=null,nH=null,iH=!1,rH=[],sH="nav-marking-area",oH=[],aH=null,lH=null,cH=null,uH=[],hH=new Map,dH=new Map,fH=!1,pH=null,gH=0,mH=null,yH=new Map,vH=null,_H=null,bH=null,EH=null,wH=null,xH=null,AH="",SH=null,TH=null,CH=null,IH=new Map,kH=!1,RH=new Set,PH=new Map,MH=[],LH=[],BH=[],NH="de",OH=null;const DH={de:{header:{planning:"Planer",manufacturer:"Hersteller"},nav:{paramInput:"Parameter",markingArea:"Sicherheitsbereich",threatAnalysis:"Zufahrtanalyse",riskReport:"Risikobericht",productSelection:"Produktauswahl",projectDescription:"Ausschreibung",publishProject:"Projektausschreibung verffentlichen"},aria:{search:"Suche",email:"E-Mail",settings:"Einstellungen"},user:{loggedIn:"Angemeldet: BarricadiX Admin"},sidebar:{osmLimits:{title:"Einfluss auf Geschwindigkeit:",maxspeed:"Tempolimit",trafficCalming:"Verkehrsberuhiger",weather:"Wetter",weatherOptions:{dry:"trocken",wet:"nass",snow:"Schnee",ice:"Eis"},surface:"Fahrbahnbelag"},trafficData:"Parameterwahl",vehicleSelect:"Fahrzeugauswahl",accessRoads:"Zufahrten",curbs:"Bordsteinkanten",obstacles:"Hindernisse",protectionSelection:"Schutzauswahl",protectionPeriod:"Schutzzeitraum",protectionProducts:"Schutzprodukte",productProperty:"Produkteigenschaft",riskAssessment:"Risikobewertung",assetToProtect:"Was geschtzt werden soll",securityRisk:"Sicherheitsrisiko",recommendedProductClass:"Empfohlene Produktklasse",low:"niedrig",high:"hoch",options:{vehicle:{all:"alle",motorcycle:"Motorrad",car_light:"KFZ <3.5t",truck_light:"LKW <7.5t",truck_medium:"LKW <12t",truck_heavy:"LKW <40t"},access:{all:"alle",meadow:"Wiese",forest_path:"Waldweg",pedestrian_path:"Fugngerweg",one_way:"Einbahnstrae",two_lane:"Zweispur",three_lane:"Dreispur",four_lane:"Vierspur"},curbs:{yes:"ja",no:"nein"},obstacles:{none:"keine",trees:"Bume",posts:"Pfosten",bins:"Mlltonnen"},period:{permanent:"dauerhaft",temporary:"temporr",eventual:"eventuell"},products:{bollard:"Poller",barrier:"Barriere",post:"Pfosten",ditch:"Graben"},property:{automatic_rigid:"aut./starr",retractable:"versenkbar",removable:"entfernbar"}}},products:{resistanceMedium:"Widerstandsmedium",resistanceHigh:"Hoher Widerstand",resistanceLow:"Niedriger Widerstand",contactAdvice:"Kontaktempfehlung",requiredSpeed:"Erforderliche Geschwindigkeit",noSuitableProduct:"Kein passendes Produkt in der Datenbank gefunden. Bitte kontaktieren Sie einen zertifizierten Sicherheitsberater",pinned:"Angepinnt",clickToPin:"Klicken zum Anpinnen"},ai:{reportPrompt:'ROLLE / IDENTITT:\nDu bist ein hochspezialisierter Sicherheitsberater mit 30 Jahren Erfahrung in Terrorprvention, Tterverhalten, Zufahrtsschutz und Sicherheitsanforderungsmanagement. Du arbeitest als externer Experte fr das Unternehmen BarricadiX.\n\nSTIL:\n- Schreibe in formalem Verwaltungsdeutsch" / Gutachtenstil\n- Klar strukturiert, nachvollziehbar und normorientiert\n- Produktspezifisch neutral (produktoffen), d.h. keine Produktnamen nennen\n\nNORMATIVE GRUNDLAGEN:\n- DIN SPEC 91414-1/-2 (Zufahrtsschutzkonzepte, Risikobeurteilung, Sicherungsgrade)\n- DIN ISO 22343-1/-2 (Fahrzeugsicherheitsbarrieren  Leistungsanforderungen & Anwendung)\n- TR Mobile Fahrzeugsperren" (Schutzklassen SK1/SK2, Betrieb)\n- ProPK-Handreichung Schutz vor berfahrtaten"\n- Polizeilicher Pflichtenkatalog Fachplanung Zufahrtsschutz"\n\nKONTEXTVARIABLEN (aus BarricadiX):\n- Veranstaltung/Schutzgut: {assetToProtect}\n- Standort: {locationName}\n- Lagebeschreibung: {locationContext}\n- Schutzzeitraum: {protectionPeriod}\n- Sicherheitsniveau: {securityLevel}, Sicherungsgrad: {protectionGrade}\n- Identifizierte Zufahrten: {threatList}\n- Bedrohungsniveau: {averageThreatLevel}/10, Verteilung: {threatLevelDistribution}\n- Kritischste Zufahrten: {highestThreatRoads}\n- Empfohlene Produkttypen: {recommendedProductTypes}, {productType}\n- Begrndung: {productTypeJustification}\n- Eindringtiefe: {penetration}, Trmmerflug: {debrisDistance}\n- Gefhrdungsanalyse: {hazardAssessment}\n- Fahrdynamische Daten: {vehicleDynamicsTable}\n- Energiestufen: {energyClassification}\n\nFAHRZEUGKLASSEN (Referenzwerte):\n- Kleinwagen: m=1.200kg, a=2,75m/s\n- Mittelklasse-Pkw: m=1.500kg, a=3,20m/s\n- Full-Size-Pkw/Van: m=1.800kg, a=3,70m/s\n- Performance-/Sportwagen: m=1.600kg, a=5,00m/s\n- Pick-up: m=2.500kg, a=2,50m/s\n- Transporter/Flatbed: m=3.500kg, a=1,90m/s\n- Lkw 7,5t: m=7.200kg, a=2,00m/s\n- Lkw 12t: m=12.000kg, a=1,25m/s\n- Lkw 30t: m=30.000kg, a=0,75m/s\n\nENERGIESTUFEN (Schwellwerte):\n- E1 (niedrig): E < 250 kJ  einfache Sperren\n- E2 (mittel, SK1-Bereich): 250 kJ  E < 800 kJ  SK1-Barrieren\n- E3 (hoch, SK2-Bereich): 800 kJ  E < 1.950 kJ  SK2-Barrieren\n- E4 (sehr hoch): E  1.950 kJ  Hochsicherheitsbarrieren\n\nAUFGABE:\nErstelle einen vollstndigen, professionellen Risikobericht im Gutachtenstil. Nutze AUSSCHLIESSLICH die bergebenen Kontextvariablen  erfinde KEINE Orts- oder Straennamen.\n\nAUSGABEFORMAT:\nGib GENAU 11 nummerierte Textblcke aus, getrennt durch eine Leerzeile (zwei Zeilenumbrche).\nJeder Block beginnt mit seiner fettgedruckten Nummer und Titel. Kein JSON, keine Code-Fences.\n\n**1. Auftrag, Zielsetzung und Geltungsbereich**\n- Auftraggeber (Kommune/Veranstalter), Bearbeiter (BarricadiX), Datum\n- Zielsetzung: Risikobewertung und Schutzkonzept fr {assetToProtect} am Standort {locationName}\n- Rumlicher Geltungsbereich: definierter Sicherheitsperimeter\n- Zeitlicher Geltungsbereich: {protectionPeriod}\n- Hinweis: Gutachten ersetzt keine polizeiliche Gefhrdungsbewertung\n\n**2. Normative Grundlagen und Referenzen**\n- Liste aller angewandten Normen (DIN SPEC 91414-1/-2, DIN ISO 22343-1/-2, TR Mobile Fahrzeugsperren")\n- Erluterung der Sicherungsgrade SG0SG4 und Schutzklassen SK1/SK2\n- Verweis auf ProPK-Handreichung und polizeiliche Vorgaben\n\n**3. Beschreibung des Veranstaltungsbereichs**\n- 3.1 Lage und Nutzung: {locationContext}, stdtebauliche Situation, Besonderheiten\n- 3.2 Erhebung durch BarricadiX: GIS-gesttzte Analyse, identifizierte Zufahrten ({threatList})\n- Beschreibung des Sicherheitsperimeters und der Schutzzone\n\n**4. Bedrohungsanalyse und Tterverhalten**\n- 4.1 Relevante Bedrohungsszenarien: Vehicle-as-a-Weapon, spontane vs. geplante Taten\n- Fahrzeugtypen: Pkw, Transporter, Lkw (verschiedene Massen und Beschleunigungen)\n- 4.2 Zielattraktivitt: Personendichte, Symbolik, mediale Wirkung, Fluchtmglichkeiten\n- Integration der Gefhrdungsanalyse: {hazardAssessment}\n\n**5. Methodik der BarricadiX-Analyse**\n- 5.1 GIS-gesttzte Analyse des Straennetzes (OpenStreetMap/Overpass)\n- 5.2 Fahrzeugklassen und Parameter (Masse m, Beschleunigung a)\n- 5.3 Anfahrtsstrecken der Zufahrten (effektive Beschleunigungsstrecke s)\n- Formeln: v = (2as) fr Endgeschwindigkeit, E = mas fr kinetische Energie\n\n**6. Fahrdynamische Analyse und Maximalenergien**\n- 6.1 Grundlagen: Berechnung von Endgeschwindigkeit v [km/h] und Aufprallenergie E [kJ]\n- 6.2 Einteilung in Energiestufen E1E4 mit Schwellwerten\n- 6.3 Worst-Case-Tabelle: Fr jede Zufahrt die maximale Energie E_max und zugehrige Fahrzeugklasse\n- Nutze {vehicleDynamicsTable} und {energyClassification}\n\n**7. Risikoanalyse nach dem ALARP-Prinzip**\n- 7.1 Bewertungsansatz: ALARP (As Low As Reasonably Practicable)\n- 7.2 Energetische Einstufung der Zufahrten (E1E4)\n- 7.3 Eintrittswahrscheinlichkeit: Pkw-Szenarien (hher) vs. Lkw-Szenarien (niedriger, aber schwerwiegender)\n- 7.4 Schadensausma: sehr hoch bei Personendichte im Schutzbereich\n- 7.5 Risikokategorien (niedrig/mittel/hoch) und abgeleitete Schutzklassen (SK1/SK2)\n- Bedrohungsniveau: {averageThreatLevel}/10, Verteilung: {threatLevelDistribution}\n\n**8. Schutzzieldefinition**\n- Spezifisches Schutzziel fr {assetToProtect} am Standort {locationName}\n- Verhindern des Eindringens mehrspuriger Fahrzeuge (Pkw bis schwere Lkw) in den Schutzbereich\n- Auch im Worst Case (schwerstes Fahrzeug mit maximaler Anfahrenergie)\n- Abgeleiteter Sicherungsgrad: {protectionGrade}\n\n**9. Schutzkonzept und produktoffene Empfehlungen**\n- 9.1 Kategorisierung der Zufahrten nach Schutzbedarf:\n  - Kategorie A (hochkritisch, E3/E4): SK2-Barrieren erforderlich\n  - Kategorie B (mittel, E2): SK1-Barrieren ausreichend\n  - Kategorie C (gering, E1): einfache Sperren\n- 9.2 Anforderungen an Fahrzeugsperren (DIN ISO 22343-1, IWA 14-1)\n- 9.3 Systemtypen (produktoffen): Hochsicherheitspoller, Roadblocker, mobile Sperren, crash-getestete Stadtmbel\n- 9.4 Rettungswege und Betriebsorganisation: BOS-Zufahrten, ffnungskonzept\n- Empfohlene Produkttypen: {recommendedProductTypes}\n\n**10. Restgefahren und Grenzen**\n- Verbleibende Restgefahren: atypische Fahrzeuge, kombinierte Szenarien, Fehlbedienung\n- Grenzen der technischen Manahmen\n- Notwendigkeit organisatorischer Ergnzung (Betriebskonzept, Schulung, berwachung)\n- Hinweis auf regelmige berprfung und Fortschreibung\n\n**11. Schlussfolgerungen und Empfehlung**\n- Gesamtbewertung: Mit Umsetzung der SK1-/SK2-Manahmen und Betriebskonzept wird Risiko auf ALARP-Niveau reduziert\n- Klare Empfehlung an Kommune/Veranstalter\n- Nchste Schritte: Detailplanung, Ausschreibung, Umsetzung\n- Abschlieender Hinweis: Dieser Bericht ist eine technische Planungsgrundlage und ersetzt keine hoheitliche Gefhrdungsbewertung der Polizei',chatbot:{title:"Zufahrtsschutz-Assistent",welcome:"Willkommen zum Zufahrtsschutz-Assistenten. Ich stelle nur Fragen, die noch fehlen oder unsicher sind. Bereit?",assetQuestion:"Welche Schutzgter mchten Sie absichern?",assetOptions:"Menschenmenge,Gebude,KRITIS-Prozess,Veranstaltungsflche",assetPlaceholder:"z. B. Menschenmenge, Bhne",assetQuestionInfo:"Grundlage fr Schutzziel & Schutzklasse (DIN SPEC 91414-2 / ISO 22343-2)",inputPlaceholder:"Antwort eingeben...",sendButton:"Senden",stakeholderQuestion:"Wer sind die relevanten Stakeholder (Behrden, Veranstalter, Betreiber)?",stakeholderOptions:"Behrden,Veranstalter,Betreiber",restRiskQuestion:"Welches akzeptable Restrisiko gilt?",restRiskOptions:"niedrig,mittel,hoch",restRiskQuestionInfo:"Steuert Schutzklasse/Sicherungsgrad (DIN SPEC 91414-2)",operationalQuestion:"Betriebsanforderungen (mehrfach whlbar)",operationalOptions:"Feuerwehrzufahrt,Fluchtwege,Verkehrssicherheit,Betriebssicherheit",threatQuestion:"Welche Art fahrzeuggesttzter Bedrohung ist zu erwarten?",threatOptions:"intentional,unbeabsichtigt,beides",vehicleTypesQuestion:"Welche Fahrzeugtypen sind relevant?",vehicleOptions:"PKW,Transporter,LKW,Bus",accessCorridorsQuestion:"Wo knnten Fahrzeuge eindringen? (Karte markieren oder beschreiben)",accessCorridorsPlaceholder:"Polyline/Polygon auswhlen oder kurz beschreiben",speedQuestion:"Maximale Zufahrtsgeschwindigkeit (km/h)",speedQuestionInfo:"Pflichtparameter fr FSB-Performance (ISO 22343-2/-1)",angleQuestion:"Wahrscheinlicher Anprallwinkel ()",angleQuestionInfo:"Pflichtparameter fr FSB-Performance (ISO 22343-2/-1)",groundQuestion:"Untergrund/Fundamente am Standort",groundOptions:"Asphalt,Beton,Pflaster,Erde,Unbekannt",riskMatrixQuestion:"Risikobewertung: Eintrittswahrscheinlichkeit & Schadensausma",riskMatrixOptions:"EW:niedrig|SA:gering,EW:niedrig|SA:mittel,EW:mittel|SA:mittel,EW:hoch|SA:schwer",riskMatrixQuestionInfo:"Erzeugt Sicherungsgrad & Schutzklasse (DIN SPEC 91414-2)",infoPrefix:"Hinweis: ",completionMessage:"Danke! Alle erforderlichen Angaben sind vorhanden. Mchten Sie den normkonformen PDF-Plan erzeugen?"},error:"Fehler bei der KI-Analyse",retry:"Erneut versuchen",loading:"KI-Analyse wird erstellt...",timeout:"Zeitberschreitung bei der Analyse",networkError:"Netzwerkfehler bei der KI-Analyse",serviceUnavailable:"KI-Service vorbergehend nicht verfgbar"},manufacturer:{title:"Herstelleransicht",subtitle:"Verwalten Sie Ihren Produktkatalog und Kundenanfragen",products:"Produkte",quotations:"Angebote",customers:"Kunden",analytics:"Analysen",manageCatalog:"Verwalten Sie Ihren Produktkatalog",createQuotations:"Erstellen und verwalten Sie Angebote",manageContacts:"Verwalten Sie Ihre Kundenkontakte",businessAnalytics:"Betriebs- und Verkaufsanalysen",open:"ffnen",nav:{products:"Produkte",quotations:"Angebote",customers:"Kunden",analytics:"Analysen",settings:"Einstellungen"},sidebar:{productManagement:"Produktverwaltung",productCategory:"Produktkategorie",productStatus:"Produktstatus",customerManagement:"Kundenverwaltung",customerType:"Kundentyp",customerRegion:"Region",analytics:"Analysen",dateRange:"Zeitraum",options:{category:{all:"Alle Kategorien",bollards:"Poller",barriers:"Barrieren",posts:"Pfosten",ditches:"Grben"},status:{all:"Alle Status",active:"Aktiv",inactive:"Inaktiv",draft:"Entwurf"},customerType:{all:"Alle Typen",private:"Privat",business:"Geschft",government:"Behrde"},region:{all:"Alle Regionen",north:"Nord",south:"Sd",east:"Ost",west:"West"},dateRange:{"7days":"Letzte 7 Tage","30days":"Letzte 30 Tage","90days":"Letzte 90 Tage","1year":"Letztes Jahr"},manufacturer:{all:"Alle Hersteller"},standard:{all:"Alle Standards"},vehicleType:{all:"Alle Fahrzeugtypen"}},productDatabase:{title:"Produktdatenbank",subtitle:"Technische Daten und Spezifikationen aller verfgbaren Produkte",search:"Produktsuche",searchPlaceholder:"Produktname, Hersteller, Standard oder Fahrzeugtyp eingeben...",filterBy:"Filtern nach",manufacturer:"Hersteller",type:"Typ",standard:"Standard",productType:"Produkttyp",cluster:"Cluster",performance:"Leistungsbewertung",dimensions:"Abmessungen",foundation:"Fundamenttiefe",material:"Material",vehicleWeight:"Fahrzeuggewicht (kg)",vehicleType:"Fahrzeugtyp",speed:"Geschwindigkeit (km/h)",impactAngle:"Anprallwinkel ()",penetration:"Penetration (m)",debrisDistance:"Trmmerdistanz (m)",actions:"Aktionen",noProducts:"Keine Produkte gefunden",loading:"Produkte werden geladen...",technicalSpecs:"Technische Spezifikationen",performanceData:"Leistungsdaten",certification:"Zertifizierung",certificationStandard:"Zertifizierungsstandard",testConditions:"Testbedingungen",atSpeed:"bei",viewDetails:"Details anzeigen",closeDetails:"Schlieen",exportData:"Daten exportieren",printSpecs:"Spezifikationen drucken",modal:{title:"Produktdetails",technicalSpecs:"Technische Spezifikationen",performanceData:"Leistungsdaten",certification:"Zertifizierung",exportData:"Daten exportieren",printSpecs:"Spezifikationen drucken"},toggleToGrid:"Kachelansicht",toggleToTable:"Tabellenansicht",table:{manufacturer:"Hersteller",type:"Typ",standard:"Standard",vehicleWeight:"Fahrzeuggewicht (kg)",vehicleType:"Fahrzeugtyp",speed:"Geschwindigkeit (km/h)",impactAngle:"Anprallwinkel ()",penetration:"Penetration (m)",debrisDistance:"Trmmerdistanz (m)",actions:"Aktionen"}}}},tooltips:{securityRisk:"Informationen zum Sicherheitsrisiko.",productClass:"Informationen zur empfohlenen Produktklasse."},report:{mainTitle:"Risikobewertung fr Zufahrtsschutz",watermark:"VERTRAULICH",undefinedAsset:"Nicht definiertes Schutzgut",undefinedValue:"Nicht definierter Wert",noThreatAnalysis:"Keine Gefahrenanalyse verfgbar",generating:"Bericht wird generiert...",status:{draft:"Entwurf",final:"Final",approved:"Genehmigt"},metadata:{date:"Datum",author:"Autor",version:"Version",classification:"Klassifizierung"},sections:{chapter1:{title:"1. Auftrag, Zielsetzung und Geltungsbereich"},chapter2:{title:"2. Normative Grundlagen und Referenzen"},chapter3:{title:"3. Beschreibung des Veranstaltungsbereichs"},chapter4:{title:"4. Bedrohungsanalyse und Tterverhalten"},chapter5:{title:"5. Methodik der BarricadiX-Analyse"},chapter6:{title:"6. Fahrdynamische Analyse und Maximalenergien"},chapter7:{title:"7. Risikoanalyse nach dem ALARP-Prinzip"},chapter8:{title:"8. Schutzzieldefinition"},chapter9:{title:"9. Schutzkonzept und produktoffene Empfehlungen"},chapter10:{title:"10. Restgefahren und Grenzen"},chapter11:{title:"11. Schlussfolgerungen und Empfehlung"},purpose:{title:"Zweck und Zielsetzung",description:"Dieser Bericht dient der Bewertung der Sicherheitsrisiken fr die zu schtzenden Zufahrten und der Empfehlung geeigneter Schutzmanahmen."},threatAnalysis:{title:"Gefahrenanalyse",description:"Analyse der identifizierten Bedrohungen und deren potenzielle Auswirkungen."},riskAssessment:{title:"Risikobewertung",description:"Bewertung der identifizierten Risiken und deren Klassifizierung."},recommendations:{title:"Empfehlungen",description:"Konkrete Handlungsempfehlungen fr die Implementierung von Schutzmanahmen."},vulnerabilities:{title:"Schwachstellenanalyse",description:"Identifizierung und Bewertung von Sicherheitsschwachstellen."},hvmMeasures:{title:"HVM-Schutzmanahmen",description:"Spezifische Schutzmanahmen gegen High-Velocity Missile Angriffe."},siteConsiderations:{title:"Standortbetrachtungen",description:"Besondere Aspekte des Standorts und der Umgebung."},operationalImpact:{title:"Betriebliche Auswirkungen",description:"Auswirkungen der Schutzmanahmen auf den laufenden Betrieb."}},threatsTable:{title:"Identifizierte Bedrohungen",street:"Strae",distance:"Strecke",maxSpeed:"Max. erreichbare Geschw."},identifiedCorridors:"{count} identifizierte Korridore",noChatGeometry:"keine Geometrie aus Chatbot bergeben",actions:{save:"Speichern",print:"Drucken",export:"Exportieren",share:"Teilen"},generation:{failed:"Berichterstellung fehlgeschlagen",networkError:"Netzwerkfehler bei der Berichterstellung",retry:"Bericht erneut generieren",loading:"Bericht wird erstellt..."},ai:{error:"Fehler bei der KI-Berichterstellung",loading:"KI-Bericht wird generiert...",timeout:"Zeitberschreitung bei der KI-Berichterstellung"},keyFacts:{title:"Eckdaten des Zufahrtsschutzkonzepts",location:"Standort",asset:"Schutzgut",securityLevel:"Sicherheitsniveau",protectionGrade:"Sicherungsgrad",dataBasis:"Datenbasis: {source}, Stand: {date}"},threatListIntro:"Aus der GIS-Analyse der Anfahrkorridore ergeben sich folgende Zufahrten mit potenziell kritischen Annherungswegen:"},threats:{title:"Gefahrenanalyse",speed:"Geschwindigkeit",analysisFailed:"Gefahrenanalyse fehlgeschlagen",noCrossingWaysBoundary:"Keine kreuzenden Wege an der Grenze gefunden",popupHeader:"Gefahreninformationen",loading:"Lade Gefahrenanalyse...",minimize:"Minimieren",maximize:"Maximieren",close:"Schlieen",editMode:"Zufahrten bearbeiten",manualEntry:"Manuelle Zufahrt"},map:{createReport:"Bericht erstellen",downloadReport:"Bericht herunterladen",searchPlaceholder:"Soest",searchButton:"Suchen",setWaypoints:"Wegpunkte setzen",setWaypointsActive:"Zeichnen aktiv",reset:"Zurcksetzen",securityAreaLabel:"Sicherheitsbereich",securityArea:"Sicherheitsbereich",analyzeAccess:"Zufahrt analysieren"},placeholders:{assetToProtect:"Bitte eintragen"},alerts:{noPolygon:"Bitte zeichnen Sie zuerst einen Sicherheitsbereich auf der Karte.",overpassError:"Fehler beim Laden der Straendaten (Status: {status}).",analysisError:"Fehler bei der Gefahrenanalyse. Bitte versuchen Sie es erneut.",invalidPolygon:"Ungltiges Polygon. Bitte zeichnen Sie den Sicherheitsbereich neu.",emptyPolygon:"Das gezeichnete Polygon hat keine gltigen Koordinaten.",polygonCoordinateError:"Fehler beim Verarbeiten der Polygon-Koordinaten.",locationNotFound:"Standort nicht gefunden. Bitte berprfen Sie die Eingabe.",noThreatsFound:"Keine Bedrohungen in diesem Bereich gefunden.",reportGenerationError:"Fehler beim Erstellen des Berichts. Bitte versuchen Sie es erneut.",reportCreationError:"Fehler bei der Berichtserstellung. Bitte versuchen Sie es erneut.",geminiError:"Die KI-gesttzte Analyse konnte aufgrund eines Fehlers nicht generiert werden."}},en:{header:{planning:"Planner",manufacturer:"Manufacturer"},nav:{paramInput:"Parameters",markingArea:"Security Area",threatAnalysis:"Threat Analysis",riskReport:"Risk Report",productSelection:"Product Selection",projectDescription:"Specification",publishProject:"Publish Project Specification"},aria:{search:"Search",email:"Email",settings:"Settings"},user:{loggedIn:"Logged in: BarricadiX Admin"},sidebar:{osmLimits:{title:"Speed Influence:",maxspeed:"Speed limit",trafficCalming:"Traffic calming",weather:"Weather",weatherOptions:{dry:"dry",wet:"wet",snow:"snow",ice:"ice"},surface:"Road surface"},trafficData:"Parameter Selection",vehicleSelect:"Vehicle Selection",accessRoads:"Access Roads",curbs:"Curbs",obstacles:"Obstacles",protectionSelection:"Protection Selection",protectionPeriod:"Protection Period",protectionProducts:"Protection Products",productProperty:"Product Property",riskAssessment:"Risk Assessment",assetToProtect:"What to Protect",securityRisk:"Security Risk",recommendedProductClass:"Recommended Product Class",low:"low",high:"high",options:{vehicle:{all:"all",motorcycle:"Motorcycle",car_light:"Car <3.5t",truck_light:"Truck <7.5t",truck_medium:"Truck <12t",truck_heavy:"Truck <40t"},access:{all:"all",meadow:"Meadow",forest_path:"Forest Path",pedestrian_path:"Pedestrian Path",one_way:"One Way",two_lane:"Two Lane",three_lane:"Three Lane",four_lane:"Four Lane"},curbs:{yes:"yes",no:"no"},obstacles:{none:"none",trees:"Trees",posts:"Posts",bins:"Bins"},period:{permanent:"permanent",temporary:"temporary",eventual:"eventual"},products:{bollard:"Bollard",barrier:"Barrier",post:"Post",ditch:"Ditch"},property:{automatic_rigid:"auto/rigid",retractable:"retractable",removable:"removable"}}},products:{resistanceMedium:"Resistance Medium",resistanceHigh:"High Resistance",resistanceLow:"Low Resistance",contactAdvice:"Contact Recommendation",requiredSpeed:"Required Speed",noSuitableProduct:"No suitable product found in database. Please contact a certified security consultant",pinned:"Pinned",clickToPin:"Click to pin"},ai:{reportPrompt:'You are a security planner specializing in Hostile Vehicle Mitigation (HVM) and protection against vehicle ramming attacks.\nYou work according to standards:\n- DIN SPEC 91414-2 (Operational planning and application guidelines, incl. Annex E "Operational requirements for an access protection concept"),\n- DIN ISO 22343-2 (Application  especially chapters on operational requirements and maintenance/inspection),\n- DIN SPEC 91414-1, TR "Mobile Vehicle Barriers", relevant police guidance on vehicle attacks,\n- Police requirements catalog "Specialist Planning Access Protection".\n\nContext variables:\n- {locationName}, {assetToProtect}, {securityLevel}, {protectionGrade},\n- {protectionPeriod}, {locationContext},\n- {threatList}, {averageThreatLevel}, {threatLevelDistribution}, {highestThreatRoads},\n- {recommendedProductTypes}, {productType}, {productTypeJustification},\n- {penetration}, {debrisDistance} (if set),\n- {hazardAssessment} (results from the hazard analysis input dialog, including rated factors and risk classification).\n\nUse these values to formulate the report specifically for the project. Do not invent place or street names and do not adopt names from examples  everything must come from the current context. Integrate the hazard analysis results ({hazardAssessment}) meaningfully into the risk assessment and vulnerability analysis.\n\nGoal:\nThe report is to be understood as an **operational requirement** in the sense of DIN SPEC 91414-2 Annex E (Table E.1). It comprehensibly documents what the operator can expect from the access protection concept, from planning to implementation and operation.\n\nOutput EXACTLY 6 text blocks, separated by an empty line (two newlines).\nEach block starts with its bold header name (e.g. **purpose**). No other headers. No JSON, no code fences.\n\nThe blocks are:\n\n**purpose**\nCover the following points (Master Data / Assignment / Basics):\n- Designation of the project / access protection concept for {assetToProtect} at location {locationName}.\n- Client, operator, specialist planner, contact point (if unknown, define generically as placeholder).\n- Fundamental goals and functions of the access protection concept.\n- Description of the protection zone(s) and operating times ({protectionPeriod}).\n- Used basics (e.g. site plans, standards DIN SPEC 91414-2, DIN ISO 22343-2).\n\n**threatAnalysis**\nCover the following points (Risk Assessment):\n- Risk identification: Vehicle-as-a-Weapon acts, vehicle types, attack possibilities.\n- Police threat assessment (if known or generically referenced).\n- Evaluation using qualitative risk matrix (probability of occurrence  extent of damage).\n- Explanation of the threat situation based on {averageThreatLevel} and {threatLevelDistribution}.\n- Integration of hazard analysis results ({hazardAssessment}): Rated factors (event-related, spatial, security-related, attack-influencing), total score and risk classification.\n- Derivation of the protection grade {protectionGrade} and classification (SG0SG4).\n\n**vulnerabilities**\nCover the following points (Vulnerability Analysis according to Table E.1):\n- Definition and description of the protection zone.\n- Topography, location, structural weaknesses, and nature of the locality ({locationContext}).\n- Identification of all access possibilities based on {threatList} (number, lengths, speeds).\n- Access authorizations and usage times (delivery traffic, residents, public transport).\n- Requirements of BOS (fire brigade, rescue service, police) and other conditions.\n\n**hvmMeasures**\nCover the following points (Concept / System Selection):\n- Formulation of protection goals (e.g. preventing unauthorized entry, limiting penetration depth).\n- Product-neutral pre-selection of suitable protection systems based on {recommendedProductTypes} and {productType} (with justification {productTypeJustification}).\n- Requirements for tested vehicle security barriers (DIN ISO 22343-1, IWA 14, TR "Mobile Vehicle Barriers").\n- Derivation of performance requirements from the driving dynamics analysis (penetration depth {penetration}, debris flight {debrisDistance}).\n- Reference to necessary deviations or modifications.\n\n**siteConsiderations**\nCover the following points (Integration / Location):\n- Integration of measures into the urban context ({locationContext}) and usage.\n- Consideration of accessibility and cityscape ("Security by Design").\n- Coordination with stakeholders (operator, residents, businesses, authorities).\n- Impact on traffic, logistics, and accessibility.\n\n**operationalImpact**\nCover the following points (Operational requirements in the sense of DIN SPEC 91414-2 / DIN ISO 22343-2):\n- Operating times and operating states (open/closed, setup/dismantling times).\n- Operation, personnel requirements, training, and briefing.\n- Maintenance, upkeep, and regular inspections (reference to ISO 22343-2 Chap. 15/16).\n- Documentation (test certificates, protocols, operating instructions).\n- Reporting obligations for changes, handling of deviations and residual risks.\n- Concluding note: This report is a technical operational requirement and does not replace a sovereign threat assessment by the police.',chatbot:{title:"Access Protection Assistant",welcome:"Welcome to the Access Protection Assistant. I only ask questions that are still missing or uncertain. Ready?",assetQuestion:"Which protective assets would you like to secure?",assetOptions:"Crowd,Building,KRITIS Process,Event Area",assetPlaceholder:"e.g. Crowd, Stage",assetQuestionInfo:"Basis for Protection Goal & Protection Class (DIN SPEC 91414-2 / ISO 22343-2)",inputPlaceholder:"Enter answer...",sendButton:"Send",stakeholderQuestion:"Who are the relevant stakeholders (authorities, organizers, operators)?",stakeholderOptions:"Authorities,Organizers,Operators",restRiskQuestion:"What acceptable residual risk applies?",restRiskOptions:"low,medium,high",restRiskQuestionInfo:"Controls protection class/security level (DIN SPEC 91414-2)",operationalQuestion:"Operational requirements (multiple choice)",operationalOptions:"Fire brigade access,Escape routes,Traffic safety,Operational safety",threatQuestion:"What type of vehicle-based threat is expected?",threatOptions:"intentional,unintentional,both",vehicleTypesQuestion:"Which vehicle types are relevant?",vehicleOptions:"Car,Van,Truck,Bus",accessCorridorsQuestion:"Where could vehicles penetrate? (Mark on map or describe)",accessCorridorsPlaceholder:"Select polyline/polygon or describe briefly",speedQuestion:"Maximum access speed (km/h)",speedQuestionInfo:"Mandatory parameter for FSB performance (ISO 22343-2/-1)",angleQuestion:"Probable impact angle ()",angleQuestionInfo:"Mandatory parameter for FSB performance (ISO 22343-2/-1)",groundQuestion:"Ground/foundations at the site",groundOptions:"Asphalt,Concrete,Paving,Earth,Unknown",riskMatrixQuestion:"Risk assessment: probability of occurrence & extent of damage",riskMatrixOptions:"Prob:low|Damage:minor,Prob:low|Damage:medium,Prob:medium|Damage:medium,Prob:high|Damage:severe",riskMatrixQuestionInfo:"Generates security level & protection class (DIN SPEC 91414-2)",infoPrefix:"Note: ",completionMessage:"Thank you! All required information is available. Would you like to generate the standards-compliant PDF plan?"},error:"Error in AI analysis",retry:"Try again",loading:"AI analysis is being created...",timeout:"Analysis timeout",networkError:"Network error in AI analysis",serviceUnavailable:"AI service temporarily unavailable"},manufacturer:{title:"Manufacturer View",subtitle:"Manage your product catalog and customer inquiries",products:"Products",quotations:"Quotations",customers:"Customers",analytics:"Analytics",manageCatalog:"Manage your product catalog",createQuotations:"Create and manage quotations",manageContacts:"Manage your customer contacts",businessAnalytics:"Business and sales analytics",open:"Open",nav:{products:"Products",quotations:"Quotations",customers:"Customers",analytics:"Analytics",settings:"Settings"},sidebar:{productManagement:"Product Management",productCategory:"Product Category",productStatus:"Product Status",customerManagement:"Customer Management",customerType:"Customer Type",customerRegion:"Region",analytics:"Analytics",dateRange:"Date Range",options:{category:{all:"All Categories",bollards:"Bollards",barriers:"Barriers",posts:"Posts",ditches:"Ditches"},status:{all:"All Status",active:"Active",inactive:"Inactive",draft:"Draft"},customerType:{all:"All Types",private:"Private",business:"Business",government:"Government"},region:{all:"All Regions",north:"North",south:"South",east:"East",west:"West"},dateRange:{"7days":"Last 7 Days","30days":"Last 30 Days","90days":"Last 90 Days","1year":"Last Year"},manufacturer:{all:"All Manufacturers"},standard:{all:"All Standards"},vehicleType:{all:"All Vehicle Types"}},productDatabase:{title:"Product Database",subtitle:"Technical data and specifications of all available products",search:"Product Search",searchPlaceholder:"Enter product name, manufacturer, standard or vehicle type...",filterBy:"Filter by",manufacturer:"Manufacturer",type:"Type",standard:"Standard",productType:"Product Type",cluster:"Cluster",performance:"Performance Rating",dimensions:"Dimensions",foundation:"Foundation Depth",material:"Material",vehicleWeight:"Vehicle Weight (kg)",vehicleType:"Vehicle Type",speed:"Speed (km/h)",impactAngle:"Impact Angle ()",penetration:"Penetration (m)",debrisDistance:"Debris Distance (m)",actions:"Actions",noProducts:"No products found",loading:"Loading products...",technicalSpecs:"Technical Specifications",performanceData:"Performance Data",certification:"Certification",certificationStandard:"Certification Standard",testConditions:"Test Conditions",atSpeed:"at",viewDetails:"View Details",closeDetails:"Close",exportData:"Export Data",printSpecs:"Print Specifications",modal:{title:"Product Details",technicalSpecs:"Technical Specifications",performanceData:"Performance Data",certification:"Certification",exportData:"Export Data",printSpecs:"Print Specifications"},toggleToGrid:"Grid View",toggleToTable:"Table View",table:{manufacturer:"Manufacturer",type:"Type",standard:"Standard",vehicleWeight:"Vehicle Weight (kg)",vehicleType:"Vehicle Type",speed:"Speed (km/h)",impactAngle:"Impact Angle ()",penetration:"Penetration (m)",debrisDistance:"Debris Distance (m)",actions:"Actions"}}}},tooltips:{securityRisk:"Information about security risk.",productClass:"Information about recommended product class."},report:{mainTitle:"Risk Assessment for Access Protection",watermark:"CONFIDENTIAL",undefinedAsset:"Undefined asset",undefinedValue:"Undefined value",noThreatAnalysis:"No threat analysis available",generating:"Generating report...",identifiedCorridors:"{count} identified corridors",noChatGeometry:"no geometry from chatbot",status:{draft:"Draft",final:"Final",approved:"Approved"},metadata:{date:"Date",author:"Author",version:"Version",classification:"Classification"},sections:{chapter1:{title:"1. Assignment, Objectives and Scope"},chapter2:{title:"2. Normative Framework and References"},chapter3:{title:"3. Description of the Event Area"},chapter4:{title:"4. Threat Analysis and Perpetrator Behavior"},chapter5:{title:"5. BarricadiX Analysis Methodology"},chapter6:{title:"6. Vehicle Dynamics Analysis and Maximum Energies"},chapter7:{title:"7. Risk Analysis according to ALARP Principle"},chapter8:{title:"8. Protection Goal Definition"},chapter9:{title:"9. Protection Concept and Product-Neutral Recommendations"},chapter10:{title:"10. Residual Risks and Limitations"},chapter11:{title:"11. Conclusions and Recommendations"},purpose:{title:"Purpose and Objectives",description:"This report serves to assess security risks for the access routes to be protected and to recommend appropriate protective measures."},threatAnalysis:{title:"Threat Analysis",description:"Analysis of identified threats and their potential impacts."},riskAssessment:{title:"Risk Assessment",description:"Assessment of identified risks and their classification."},recommendations:{title:"Recommendations",description:"Concrete action recommendations for implementing protective measures."},vulnerabilities:{title:"Vulnerability Analysis",description:"Identification and assessment of security vulnerabilities."},hvmMeasures:{title:"HVM Protection Measures",description:"Specific protection measures against High-Velocity Missile attacks."},siteConsiderations:{title:"Site Considerations",description:"Special aspects of the site and environment."},operationalImpact:{title:"Operational Impact",description:"Impact of protection measures on ongoing operations."}},threatsTable:{title:"Identified Threats",street:"Street",distance:"Distance",maxSpeed:"Max. achievable speed"},actions:{save:"Save",print:"Print",export:"Export",share:"Share"},generation:{failed:"Report generation failed",networkError:"Network error in report generation",retry:"Generate report again",loading:"Report is being created..."},ai:{error:"Error in AI report generation",loading:"AI report is being generated...",timeout:"Timeout in AI report generation"},keyFacts:{title:"Key Facts of the Access Protection Concept",location:"Location",asset:"Asset to Protect",securityLevel:"Security Level",protectionGrade:"Protection Grade",dataBasis:"Data basis: {source}, as of: {date}"},threatListIntro:"Based on the GIS analysis of approach corridors, the following access routes show potentially critical approach paths:"},threats:{title:"Threat Analysis",speed:"Speed",analysisFailed:"Threat analysis failed",noCrossingWaysBoundary:"No crossing ways found at boundary",popupHeader:"Threat Information",loading:"Loading threat analysis...",minimize:"Minimize",maximize:"Maximize",close:"Close",editMode:"Edit access points",manualEntry:"Manual Access"},map:{createReport:"Create Report",downloadReport:"Download Report",searchPlaceholder:"Soest",searchButton:"Search",setWaypoints:"Set Waypoints",setWaypointsActive:"Drawing Active",reset:"Reset",securityAreaLabel:"Security Area",securityArea:"Security Area",analyzeAccess:"Analyze Access"},placeholders:{assetToProtect:"Please enter"},alerts:{noPolygon:"Please draw a security area on the map first.",overpassError:"Error loading road data (Status: {status}).",analysisError:"Error in threat analysis. Please try again.",invalidPolygon:"Invalid polygon. Please redraw the security area.",emptyPolygon:"The drawn polygon has no valid coordinates.",polygonCoordinateError:"Error processing polygon coordinates.",locationNotFound:"Location not found. Please check your input.",noThreatsFound:"No threats found in this area.",reportGenerationError:"Error creating report. Please try again.",reportCreationError:"Error in report generation. Please try again.",geminiError:"The AI-powered analysis could not be generated due to an error."}}};function FH(){setTimeout(()=>{const e=document.getElementById("planning-view-btn"),t=document.getElementById("manufacturer-view-btn");e&&t&&(e.addEventListener("click",()=>{!function(){const e=document.getElementById("planning-view-btn"),t=document.getElementById("manufacturer-view-btn");e&&t&&(e.classList.add("active"),t.classList.remove("active"));!function(){hW();const e=document.getElementById("manufacturer-view");e&&(e.style.display="none");const t=document.querySelector(".manufacturer-sidebar");t&&(t.innerHTML="");const n=document.getElementById("planning-view");n&&(n.style.display="block");["map","map-area","sidebar","map-tabs","map-toolbar","chatbot-react-root"].forEach(e=>{const t=document.getElementById(e);t&&(t.classList.remove("view-hidden"),t.style.display="block",t.style.visibility="visible",t.style.opacity="1")}),eH&&(eH.remove(),eH=null);if(setTimeout(async()=>{if(await aj(),window.savedMapState){const e=window.savedMapState;eH&&(eH.setView(e.center,e.zoom),eH.invalidateSize(),setTimeout(()=>null==eH?void 0:eH.invalidateSize(),100),setTimeout(()=>null==eH?void 0:eH.invalidateSize(),300))}},100),window.savedChatbotState&&window.savedChatbotState.open){const e=document.querySelector('#chatbot-react-root [aria-label="Zufahrtsschutz-Assistent ffnen"]');e&&e.click()}nj("Planungs-Ansicht aktiviert - Map neu initialisiert","success")}()}()}),t.addEventListener("click",()=>{!function(){const e=document.getElementById("planning-view-btn"),t=document.getElementById("manufacturer-view-btn");e&&t&&(t.classList.add("active"),e.classList.remove("active"));(function(){hW(),eH&&(window.savedMapState={center:eH.getCenter(),zoom:eH.getZoom(),waypoints:rH,drawnPolygon:lH?lH.getLatLngs()[0]:null,waypointMarkers:oH.length>0,pathLine:null!==aH});const e=document.querySelector('#chatbot-react-root aside[aria-label="Zufahrtsschutz-Assistent Panel"]');window.savedChatbotState={open:e&&!e.classList.contains("hidden")};const t=document.getElementById("planning-view");t&&(t.style.display="none");const n=document.getElementById("manufacturer-view");n&&(n.style.display="block",n.style.position="relative",n.style.width="100%",n.style.height="100%",n.style.zIndex="auto",n.style.backgroundColor="transparent");const i=document.querySelector(".sidebar");i&&(i.style.display="none");const r=document.getElementById("map-area");r&&(r.style.display="none",r.style.visibility="hidden",r.style.opacity="0",r.classList.add("view-hidden"));const s=document.getElementById("map");s&&(s.style.display="none",s.style.visibility="hidden",s.style.opacity="0",s.classList.add("view-hidden"));const o=document.getElementById("map-tabs"),a=document.getElementById("map-toolbar");o&&(o.style.display="none",o.classList.add("view-hidden"));a&&(a.style.display="none",a.classList.add("view-hidden"));UH(),setTimeout(()=>{rj()},50),nj("Hersteller-Ansicht aktiviert","success")})(),setTimeout(()=>{zH()},100)}()}));const n=document.querySelectorAll(".manufacturer-tab");n.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();const t=e.target;n.forEach(e=>e.classList.remove("active")),t.classList.add("active");t.id;nj(`${t.textContent||"Tab"} wird geladen...`,"info")})}),setTimeout(()=>{zH()},500)},100)}function UH(){const e=document.querySelector(".manufacturer-sidebar");if(!e)return;const t=function(){const e=window.productDatabase||[];const t={vehicleMass:{},standard:{},foundation:{},operation:{},deployment:{},category:{},manufacturer:{}};return e.forEach(e=>{const n=e.technical_data;if(!n)return;const i=n.pr_mass_kg,r=n.pr_veh;if(i&&r){const e=`${i} [${r}]`;t.vehicleMass[e]=(t.vehicleMass[e]||0)+1}const s=n.standard;s&&(t.standard[s]=(t.standard[s]||0)+1);const o=n.foundation_depth;o&&(t.foundation[o]=(t.foundation[o]||0)+1);"A - Free standing (no ground fixings)"===n.foundation_depth&&(t.deployment.temporary=(t.deployment.temporary||0)+1),t.deployment.permanent=(t.deployment.permanent||0)+1;const a=e.product_type;a&&(t.category[a]=(t.category[a]||0)+1);const l=e.manufacturer;l&&(t.manufacturer[l]=(t.manufacturer[l]||0)+1)}),t}();e.innerHTML="";const n="de"===NH,i=n?"Anprallgeschwindigkeit (km/h)":"Impact Speed (Km/h)",r=n?"Anprallwinkel ()":"Impact Angle ()",s=n?"Eindringtiefe (m)":"Penetration Distance (m)",o="Standard",a=n?"Fundament":"Foundation",l=n?"Betrieb":"Operation",c=n?"Einsatz":"Deployment",u=n?"Kategorien / VSB-Art":"Categories / Style of VSB",h=n?"Hersteller":"Manufacturer",d=n?"bis":"to",f=n?"Zurcksetzen":"Reset",p=n?"Alle Hersteller":"All Manufacturers",g=`\n        <section class="sidebar-section">\n            <div class="filter-content">\n            \n        \x3c!-- Vehicle Mass Filter --\x3e\n        <div class="form-group collapsible-dropdown-group">\n            <div class="dropdown-header" onclick="toggleDropdown('vehicle-mass')">\n                <label>${n?"Fahrzeuggewicht (kg)":"Vehicle Mass (kg)"}</label>\n                <span class="dropdown-icon" id="vehicle-mass-icon"></span>\n            </div>\n            <div class="dropdown-content" id="vehicle-mass-content" style="display: none;">\n                <div class="checkbox-group">\n                    ${function(e){return[{mass:1500,category:"M1"},{mass:2500,category:"IT"},{mass:2500,category:"N1G"},{mass:3500,category:"N1"},{mass:7200,category:"N2A"},{mass:7200,category:"N2B"},{mass:7200,category:"N3C"},{mass:7500,category:"N2"},{mass:7500,category:"N3"},{mass:12e3,category:"N3D"},{mass:3e4,category:"N3F"}].map(t=>{const n=`${t.mass} [${t.category}]`,i=e[n]||0;return`<label><input type="checkbox" value="${t.mass} [${t.category}]" data-category="${t.category}"> ${t.mass} [${t.category}] (${i})</label>`}).join("")}(t.vehicleMass)}\n                </div>\n            </div>\n        </div>\n\n            \x3c!-- Impact Speed Filter --\x3e\n            <div class="form-group collapsible-range-group">\n                <div class="range-header" onclick="toggleRangeInput('impact-speed')">\n                    <label>${i}</label>\n                    <span class="dropdown-icon" id="impact-speed-icon"></span>\n                </div>\n                <div class="range-content" id="impact-speed-content" style="display: none;">\n                    <div style="display: flex; gap: 8px; align-items: center;">\n                        <input type="number" id="min-speed" value="16" min="0" max="200" class="form-control" style="flex: 1;">\n                        <span style="font-size: 12px; color: var(--secondary-text);">${d}</span>\n                        <input type="number" id="max-speed" value="112" min="0" max="200" class="form-control" style="flex: 1;">\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Impact Angle Filter --\x3e\n            <div class="form-group collapsible-range-group">\n                <div class="range-header" onclick="toggleRangeInput('impact-angle')">\n                    <label>${r}</label>\n                    <span class="dropdown-icon" id="impact-angle-icon"></span>\n                </div>\n                <div class="range-content" id="impact-angle-content" style="display: none;">\n                    <div style="display: flex; gap: 8px; align-items: center;">\n                        <input type="number" id="min-angle" value="15" min="0" max="180" class="form-control" style="flex: 1;">\n                        <span style="font-size: 12px; color: var(--secondary-text);">${d}</span>\n                        <input type="number" id="max-angle" value="90" min="0" max="180" class="form-control" style="flex: 1;">\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Penetration Distance Filter --\x3e\n            <div class="form-group collapsible-range-group">\n                <div class="range-header" onclick="toggleRangeInput('penetration-distance')">\n                    <label>${s}</label>\n                    <span class="dropdown-icon" id="penetration-distance-icon"></span>\n                </div>\n                <div class="range-content" id="penetration-distance-content" style="display: none;">\n                    <div style="display: flex; gap: 8px; align-items: center;">\n                        <input type="number" id="min-distance" value="0" min="0" max="100" step="0.1" class="form-control" style="flex: 1;">\n                        <span style="font-size: 12px; color: var(--secondary-text);">${d}</span>\n                        <input type="number" id="max-distance" value="60" min="0" max="100" step="0.1" class="form-control" style="flex: 1;">\n                    </div>\n                </div>\n            </div>\n\n        \x3c!-- Standards Filter --\x3e\n        <div class="form-group collapsible-dropdown-group">\n            <div class="dropdown-header" onclick="toggleDropdown('standards')">\n                <label>${o}</label>\n                <span class="dropdown-icon" id="standards-icon"></span>\n            </div>\n            <div class="dropdown-content" id="standards-content" style="display: none;">\n                <div class="checkbox-group">\n                    ${function(e){const t="de"===NH,n=[{value:"Development test meeting PAS 68:2005",label:t?"Virtuell getestet nach PAS 68:2005":"Development test meeting PAS 68:2005"},{value:"ISO 22343-1:2023",label:"ISO 22343-1:2023"},{value:"IWA 14-1:2013",label:"IWA 14-1:2013"},{value:"PAS 68:2005",label:"PAS 68:2005"},{value:"PAS 68:2007",label:"PAS 68:2007"},{value:"PAS 68:2010",label:"PAS 68:2010"},{value:"PAS 68:2013",label:"PAS 68:2013"}];return n.map(t=>{const n=e[t.value]||0;return`<label><input type="checkbox" value="${t.value}"> ${t.label} (${n})</label>`}).join("")}(t.standard)}\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Foundation Filter --\x3e\n        <div class="form-group collapsible-dropdown-group">\n            <div class="dropdown-header" onclick="toggleDropdown('foundation')">\n                <label>${a}</label>\n                <span class="dropdown-icon" id="foundation-icon"></span>\n            </div>\n            <div class="dropdown-content" id="foundation-content" style="display: none;">\n                <div class="checkbox-group">\n                    ${function(e){const t="de"===NH,n=[{value:"A - Free standing (no ground fixings)",label:t?"Freistehend (ohne Bodenbefestigung)":"Free standing (no ground fixings)"},{value:"Ap - Surface mounted (pinned or bolted to ground)",label:t?"Oberflchenmontiert (gedbbelt oder geschraubt)":"Surface mounted (pinned or bolted to ground)"},{value:"B - Depth <= 0.5m below ground level",label:t?"Tiefe <= 0,5m unter Gelndeoberkante":"Depth <= 0.5m below ground level"},{value:"C - Depth >0.5m below ground level",label:t?"Tiefe >0,5m unter Gelndeoberkante":"Depth >0.5m below ground level"}];return n.map(t=>{const n=e[t.value]||0;return`<label><input type="checkbox" value="${t.value}"> ${t.label} (${n})</label>`}).join("")}(t.foundation)}\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Operation Filter --\x3e\n        <div class="form-group collapsible-dropdown-group">\n            <div class="dropdown-header" onclick="toggleDropdown('operation')">\n                <label>${l}</label>\n                <span class="dropdown-icon" id="operation-icon"></span>\n            </div>\n            <div class="dropdown-content" id="operation-content" style="display: none;">\n                <div class="checkbox-group">\n                    ${function(e){const t="de"===NH,n=[{value:"active",label:t?"Aktiv":"active"},{value:"passive",label:t?"Passiv":"passive"}];return n.map(t=>{const n=e[t.value]||0;return`<label><input type="checkbox" value="${t.value}"> ${t.label} (${n})</label>`}).join("")}(t.operation)}\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Deployment Filter --\x3e\n        <div class="form-group collapsible-dropdown-group">\n            <div class="dropdown-header" onclick="toggleDropdown('deployment')">\n                <label>${c}</label>\n                <span class="dropdown-icon" id="deployment-icon"></span>\n            </div>\n            <div class="dropdown-content" id="deployment-content" style="display: none;">\n                <div class="checkbox-group">\n                    ${function(e){const t="de"===NH,n=[{value:"permanent",label:t?"Permanent":"permanent"},{value:"temporary",label:t?"Temporr":"temporary"}];return n.map(t=>{const n=e[t.value]||0;return`<label><input type="checkbox" value="${t.value}"> ${t.label} (${n})</label>`}).join("")}(t.deployment)}\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Categories Filter --\x3e\n        <div class="form-group collapsible-dropdown-group">\n            <div class="dropdown-header" onclick="toggleDropdown('categories')">\n                <label>${u}</label>\n                <span class="dropdown-icon" id="categories-icon"></span>\n            </div>\n            <div class="dropdown-content" id="categories-content" style="display: none;">\n                <div class="hierarchical-checkbox">\n                    ${function(e){const t="de"===NH,n={Poller:t?"Poller":"Bollards",Zaun:t?"Zaun":"Perimeter Barriers",Tor:t?"Tor":"Gates",Haltestelle:t?"Straenmbel":"Street Furniture",Durchfahrtsperre:t?"Sperrblocker":"Blockers",Unknown:t?"Sonstige":"Other"},i={};return Object.entries(n).forEach(([e,t])=>{i[t]||(i[t]=[]),i[t].push(e)}),Object.entries(i).map(([t,i])=>{const r=i.reduce((t,n)=>t+(e[n]||0),0),s=i.map(i=>{const r=e[i]||0,s=n[i]||i;return`<label><input type="checkbox" value="${i}" data-category="${t}"> ${s} (${r})</label>`}).join("");return`\n            <div class="category-item">\n                <div class="category-header">\n                    <label><input type="checkbox" value="${t}" data-category="${t}"> ${t} (${r})</label>\n                </div>\n                <div class="category-children">\n                    ${s}\n                </div>\n            </div>\n        `}).join("")}(t.category)}\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Manufacturer Filter --\x3e\n        <div class="form-group collapsible-dropdown-group">\n            <div class="dropdown-header" onclick="toggleDropdown('manufacturer')">\n                <label>${h}</label>\n                <span class="dropdown-icon" id="manufacturer-icon"></span>\n            </div>\n            <div class="dropdown-content" id="manufacturer-content" style="display: none;">\n                <select id="manufacturer-select" class="form-control">\n                    <option value="">${p}</option>\n                    ${function(e){return["ATGAccess","Avon-Barrier","Barkers Fencing","Blockaxess","Delta Scientific","Eagle Auto Gate","Frontier Pitts","Heald","Highway Care","Marshalls","Perimeter Protection","Reidsteel","Securiscape","Smith Ltd","Tiso Production","Urbaco","Zaun"].map(t=>`<option value="${t}">${t} (${e[t]||0})</option>`).join("")}(t.manufacturer)}\n                </select>\n            </div>\n        </div>\n            \n            \x3c!-- Reset Button immediately below menu items --\x3e\n            <button id="reset-all-filters" class="reset-button" style="\n                background: var(--accent-color);\n                color: white;\n                border: none;\n                padding: 8px 16px;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 12px;\n                margin-top: 16px;\n                width: 100%;\n            ">${f}</button>\n            </div>\n        </section>\n    `;e.innerHTML=g,function(){const e=document.getElementById("reset-all-filters");e&&e.addEventListener("click",()=>{!function(){[{id:"min-speed",value:"16"},{id:"max-speed",value:"112"},{id:"min-angle",value:"15"},{id:"max-angle",value:"90"},{id:"min-distance",value:"0"},{id:"max-distance",value:"60"}].forEach(({id:e,value:t})=>{const n=document.getElementById(e);n&&(n.value=t)});["vehicle-mass-content","standards-content","foundation-content","operation-content","deployment-content","categories-content"].forEach(e=>{const t=document.getElementById(e);if(t){t.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.checked=!1})}});const e=document.getElementById("manufacturer-select");e&&(e.value="")}(),FW()});document.querySelectorAll(".manufacturer-sidebar select").forEach(e=>{e.addEventListener("change",()=>{FW()})});document.querySelectorAll('.manufacturer-sidebar input[type="number"]').forEach(e=>{e.addEventListener("input",()=>{FW()})});document.querySelectorAll('.manufacturer-sidebar input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>{FW()})})}(),setTimeout(()=>{FW()},100)}function zH(){ZH(),async function(){const e=document.getElementById("products-loading");e&&(e.style.display="block");try{const t=await fetch("/Barricadix_MWP/product-database.json",{cache:"no-cache"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();window.productDatabase=n,function(e){const t=document.getElementById("manufacturer-filter");if(t){[...new Set(e.map(e=>e.manufacturer).filter(Boolean))].forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})}const n=document.getElementById("standard-filter");if(n){const t=[...new Set(e.map(e=>{var t;return null==(t=e.technical_data)?void 0:t.standard}).filter(Boolean))];t.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)})}const i=document.getElementById("vehicle-type-filter");if(i){const t=[...new Set(e.map(e=>{var t;return null==(t=e.technical_data)?void 0:t.material}).filter(Boolean))];t.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,i.appendChild(t)})}}(n),GH(n),e&&(e.style.display="none"),ZH(),setTimeout(()=>{document.getElementById("toggle-view-btn")&&XH("grid"),KH=!0},100)}catch(t){nj("Fehler beim Laden der Produktdatenbank","error");const e=document.getElementById("no-products");e&&(e.style.display="block",e.textContent="Fehler beim Laden der Produktdatenbank")}}(),function(){const e=document.getElementById("product-search"),t=document.getElementById("search-btn"),n=document.getElementById("manufacturer-filter"),i=document.getElementById("standard-filter"),r=document.getElementById("vehicle-type-filter");e&&e.addEventListener("input",JH);t&&t.addEventListener("click",JH);n&&n.addEventListener("change",JH);i&&i.addEventListener("change",JH);r&&r.addEventListener("change",JH);const s=document.getElementById("speed-filter");s&&s.addEventListener("change",JH);!function(){const e=document.getElementById("toggle-view-btn");if(!e)return;e.addEventListener("click",$H),XH("grid")}()}(),function(){const e=document.getElementById("close-modal"),t=document.getElementById("export-product"),n=document.getElementById("print-product");e&&e.addEventListener("click",()=>{const e=document.getElementById("product-modal");e&&(e.style.display="none",e.currentProductIndex=void 0)});t&&t.addEventListener("click",ej);n&&n.addEventListener("click",tj);const i=document.getElementById("product-modal");i&&i.addEventListener("click",e=>{e.target===i&&(i.style.display="none",i.currentProductIndex=void 0)})}()}function GH(e){!function(e){const t=document.getElementById("products-tbody");if(!t)return;if(t.innerHTML="",0===e.length){const e=document.getElementById("no-products");return void(e&&(e.style.display="block"))}const n=document.getElementById("no-products");n&&(n.style.display="none");const i=jH(e);i.forEach((e,n)=>{var i,r,s,o,a,l,c;const u=document.createElement("tr"),h=e.product_type_confidence||0,d=h>=.9?"":h>=.7?"":h>=.5?"":"";u.innerHTML=`\n            <td>${e.manufacturer||"N/A"}</td>\n            <td>${e.product_name||"N/A"}</td>\n            <td><span title="Produkttyp: ${e.product_type||"N/A"}">${e.product_type||"N/A"}</span></td>\n            <td><span title="Cluster: ${e.product_cluster||"N/A"}">${e.product_cluster||"N/A"}</span></td>\n            <td><span title="Vertrauen: ${(100*h).toFixed(0)}%">${d} ${(100*h).toFixed(0)}%</span></td>\n            <td>${(null==(i=e.technical_data)?void 0:i.standard)||"N/A"}</td>\n            <td>${(null==(r=e.technical_data)?void 0:r.pr_mass_kg)||"N/A"}</td>\n            <td>${(null==(s=e.technical_data)?void 0:s.pr_veh)||"N/A"}</td>\n            <td>${(null==(o=e.technical_data)?void 0:o.pr_speed_kph)||"N/A"}</td>\n            <td>${(null==(a=e.technical_data)?void 0:a.pr_angle_deg)||"N/A"}</td>\n            <td>${(null==(l=e.technical_data)?void 0:l.pr_pen_m)||"N/A"}</td>\n            <td>${(null==(c=e.technical_data)?void 0:c.pr_debris_m)||"N/A"}</td>\n            <td>\n                <button class="view-details-btn" data-product-index="${n}">\n                    ${ij("manufacturer.sidebar.productDatabase.viewDetails")}\n                </button>\n            </td>\n        `,t.appendChild(u)});t.querySelectorAll(".view-details-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target,n=parseInt(t.getAttribute("data-product-index")||"0"),r=i[n],s=(window.productDatabase||[]).findIndex(e=>e.manufacturer===r.manufacturer&&e.product_name===r.product_name);QH(s>=0?s:n)})})}(e),function(e){var t,n;const i=document.getElementById("products-grid");if(!i)return;VH&&clearTimeout(VH);const r=e.length+"_"+((null==(t=e[0])?void 0:t.product_name)||"")+"_"+((null==(n=e[e.length-1])?void 0:n.product_name)||"");if(r===HH&&i.children.length>0)return;VH=setTimeout(()=>{requestAnimationFrame(()=>{!function(e,t){if(t.innerHTML="",0===e.length){const e=document.getElementById("no-products-grid");return void(e&&(e.style.display="block"))}const n=document.getElementById("no-products-grid");n&&(n.style.display="none");const i="de"===NH,r={noImageAvailable:i?"Kein Bild verfgbar":"No image available",standard:"Standard",testSpeed:i?"Testgeschwindigkeit":"Test Speed",vehicleType:i?"Fahrzeugtyp":"Vehicle Type",impactAngle:i?"Anprallwinkel":"Impact Angle",penetrationDepth:i?"Eindringtiefe":"Penetration Depth",viewDetails:i?"Details anzeigen":"View Details"},s=jH(e),o=function(e){const t=e.map(e=>{const t=e.product_image_file&&null!==e.product_image_file&&""!==e.product_image_file.trim()&&"N/A"!==e.product_image_file;return{...e,hasRealImage:t,hasDatabaseFilename:t}});return t.sort((e,t)=>e.hasDatabaseFilename&&!t.hasDatabaseFilename?-1:!e.hasDatabaseFilename&&t.hasDatabaseFilename?1:0)}(s);o.filter(e=>e.hasRealImage),o.filter(e=>!e.hasRealImage);o.forEach((e,n)=>{var i,s,o,a,l;const c=document.createElement("div");c.className="product-card";const u=WH(e),h=e.hasRealImage;h&&n<20&&(c.className="product-card product-card-priority"),c.innerHTML=`\n            <div class="product-card-image ${h?"":"no-image"}">\n                <img src="${u}" alt="${e.product_name||"Produkt"}" \n                     loading="lazy" decoding="async"\n                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"\n                     class="product-image">\n                <div class="product-image-placeholder" style="display: none;">\n                    <i class="fas fa-image"></i>\n                    <span>${r.noImageAvailable}</span>\n                </div>\n            </div>\n            <div class="product-card-content">\n                <div class="product-card-header">\n                    <div class="product-card-title">${e.product_name||"N/A"}</div>\n                    <div class="product-card-manufacturer">${e.manufacturer||"N/A"}</div>\n                </div>\n                \x3c!-- Kategorisierung ausgeblendet / Classification hidden --\x3e\n                <div class="product-card-specs">\n                    <div class="product-card-spec">\n                        <div class="product-card-spec-label">${r.standard}</div>\n                        <div class="product-card-spec-value">${(null==(i=e.technical_data)?void 0:i.standard)||"N/A"}</div>\n                    </div>\n                    <div class="product-card-spec highlight-speed">\n                        <div class="product-card-spec-label">${r.testSpeed}</div>\n                        <div class="product-card-spec-value"><strong>${(null==(s=e.technical_data)?void 0:s.pr_speed_kph)||"N/A"} km/h</strong></div>\n                    </div>\n                    <div class="product-card-spec">\n                        <div class="product-card-spec-label">${r.vehicleType}</div>\n                        <div class="product-card-spec-value">${(null==(o=e.technical_data)?void 0:o.pr_veh)||"N/A"}</div>\n                    </div>\n                    <div class="product-card-spec">\n                        <div class="product-card-spec-label">${r.impactAngle}</div>\n                        <div class="product-card-spec-value">${(null==(a=e.technical_data)?void 0:a.pr_angle_deg)||"N/A"}</div>\n                    </div>\n                    <div class="product-card-spec">\n                        <div class="product-card-spec-label">${r.penetrationDepth}</div>\n                        <div class="product-card-spec-value">${(null==(l=e.technical_data)?void 0:l.pr_pen_m)||"N/A"} m</div>\n                    </div>\n                </div>\n                <div class="product-card-actions">\n                    <button class="product-card-btn secondary" data-product-index="${n}">\n                        ${r.viewDetails}\n                    </button>\n                </div>\n            </div>\n        `,t.appendChild(c)});const a=t.querySelectorAll(".product-card");a.forEach(e=>{e.addEventListener("click",e=>{const t=e.target;if(t.classList.contains("product-card-btn")){const e=parseInt(t.getAttribute("data-product-index")||"0"),n=o[e],i=(window.productDatabase||[]).findIndex(e=>e.manufacturer===n.manufacturer&&e.product_name===n.product_name);QH(i>=0?i:e)}})})}(e,i),HH=r})},50)}(e)}OH=DH,window.restoreMapState=function(){if(!window.savedMapState)return;return window.savedMapState};let VH=null,HH="";function jH(e){return e.filter(e=>{const t=e.product_name&&""!==e.product_name.trim(),n=e.manufacturer&&""!==e.manufacturer.trim();return t&&n}).filter((e,t,n)=>{const i=`${e.manufacturer.trim()}|${e.product_name.trim()}`;return!(n.findIndex(e=>`${e.manufacturer.trim()}|${e.product_name.trim()}`===i)!==t)})}function WH(e){if(e.product_image_file&&null!==e.product_image_file&&""!==e.product_image_file.trim()){let t;if(e.product_image_file.startsWith("/images/")){t=`${"/Barricadix_MWP/".endsWith("/")?"/Barricadix_MWP/":"/Barricadix_MWP//"}${e.product_image_file.slice(1)}`}else t=`/Barricadix_MWP/images/${e.product_image_file}`;const n=new Image;return n.onload=()=>{},n.onerror=()=>{},n.src=t,t}if(!e.product_name||""===e.product_name){return"/Barricadix_MWP/images/default_product_img01.jpg"}let t=e.product_name.replace(/[^a-zA-Z0-9\s\-_]/g,"").replace(/\s+/g,"_").replace(/[_-]+/g,"_").trim();return`/Barricadix_MWP/images/${[`${t}_img01.jpg`,`${t}_img02.jpg`,`${t}_img03.jpg`,`${t}.jpg`,`${t}_01.jpg`,`${t}_02.jpg`][0]}`}function $H(){const e=document.getElementById("toggle-view-btn");if(!e)return;XH("table"===e.getAttribute("data-view")?"grid":"table")}function XH(e){const t=document.getElementById("toggle-view-btn"),n=document.getElementById("products-table-container"),i=document.getElementById("products-grid-container");if(!t||!n||!i)return;t.setAttribute("data-view",e);const r=t.querySelector("span"),s=t.querySelector("i");if("grid"===e)n.style.display="none",i.style.display="block",r&&(r.textContent=ij("manufacturer.sidebar.productDatabase.toggleToTable")),s&&(s.className="fas fa-table");else{n.style.display="block",i.style.display="none";const e=document.getElementById("products-table");e&&(e.style.display="table"),r&&(r.textContent=ij("manufacturer.sidebar.productDatabase.toggleToGrid")),s&&(s.className="fas fa-th-large")}}let qH=null,KH=!1;function YH(e){return e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(//g,"o").replace(//g,"a").replace(//g,"u").replace(//g,"ss"):""}function JH(){KH&&(qH&&clearTimeout(qH),qH=setTimeout(()=>{FW()},150))}function ZH(){}function QH(e){var t,n,i,r,s,o,a,l,c,u,h,d,f,p;const g=(window.productDatabase||[])[e];if(!g)return;const m="de"===NH,y=m?"Produktname":"Product Name",v=m?"Standard getestet nach":"Standard Tested To",_=m?"Download Datum":"Download Date",b=m?"Produktklassifizierung":"Product Classification",E=m?"Produkttyp":"Product Type",w="Cluster",x=m?"Vertrauenswert":"Confidence Value",A=m?"Erkennungsquelle":"Detection Source",S=m?"Testparameter":"Test Parameters",T=m?"Fahrzeuggewicht":"Vehicle Weight",C=m?"Fahrzeugtyp":"Vehicle Type",I=m?"Testgeschwindigkeit":"Test Speed",k=m?"Anprallwinkel":"Impact Angle",R=m?"Eindringtiefe":"Penetration Depth",P=m?"Trmmerstreuweite":"Debris Spread",M=m?"Datenblatt URL":"Datasheet URL",L=m?"Produktbild":"Product Image",B=document.getElementById("modal-product-name");B&&(B.textContent=`${g.manufacturer} - ${g.product_name}`);const N=document.getElementById("modal-technical-specs");N&&(N.innerHTML=`\n            <p><strong>${ij("manufacturer.sidebar.productDatabase.manufacturer")}:</strong> ${g.manufacturer||"N/A"}</p>\n            <p><strong>${y}:</strong> ${g.product_name||"N/A"}</p>\n            <p><strong>${ij("manufacturer.sidebar.productDatabase.standard")}:</strong> ${(null==(t=g.technical_data)?void 0:t.standard)||"N/A"}</p>\n            <p><strong>${ij("manufacturer.sidebar.productDatabase.dimensions")}:</strong> ${(null==(n=g.technical_data)?void 0:n.dimensions)||"N/A"}</p>\n            <p><strong>${ij("manufacturer.sidebar.productDatabase.material")}:</strong> ${(null==(i=g.technical_data)?void 0:i.material)||"N/A"}</p>\n        `);const O=document.getElementById("modal-performance-data");O&&(O.innerHTML=`\n            <p><strong>${ij("manufacturer.sidebar.productDatabase.performance")}:</strong> ${(null==(r=g.technical_data)?void 0:r.performance_rating)||"N/A"}</p>\n            <p><strong>${ij("manufacturer.sidebar.productDatabase.foundation")}:</strong> ${(null==(s=g.technical_data)?void 0:s.foundation_depth)||"N/A"}</p>\n            <p><strong>${v}:</strong> ${(null==(o=g.technical_data)?void 0:o.standard_tested_to)||"N/A"}</p>\n            <p><strong>${_}:</strong> ${(null==(a=g.technical_data)?void 0:a.download_date)||"N/A"}</p>\n            <div style="margin-top: 20px; padding: 15px; background-color: rgba(30, 144, 255, 0.15); border-radius: 8px; border: 1px solid rgba(30, 144, 255, 0.3);">\n                <h4 style="margin-bottom: 12px; color: #1e90ff;"> ${b}</h4>\n                <p><strong>${E}:</strong> ${g.product_type||"N/A"}</p>\n                <p><strong>${w}:</strong> ${g.product_cluster||"N/A"}</p>\n                <p><strong>${x}:</strong> ${g.product_type_confidence?(100*g.product_type_confidence).toFixed(0)+"%":"N/A"}</p>\n                <p><strong>${A}:</strong> ${g.product_type_source||"N/A"}</p>\n            </div>\n            <div style="margin-top: 20px; padding: 15px; background-color: rgba(255, 193, 7, 0.15); border-radius: 8px; border: 1px solid rgba(255, 193, 7, 0.3);">\n                <h4 style="margin-bottom: 12px; color: #ffc107;"> ${S}</h4>\n                <p><strong>${T}:</strong> ${(null==(l=g.technical_data)?void 0:l.pr_mass_kg)||"N/A"} kg</p>\n                <p><strong>${C}:</strong> ${(null==(c=g.technical_data)?void 0:c.pr_veh)||"N/A"}</p>\n                <p><strong>${I}:</strong> ${(null==(u=g.technical_data)?void 0:u.pr_speed_kph)||"N/A"} km/h</p>\n                <p><strong>${k}:</strong> ${(null==(h=g.technical_data)?void 0:h.pr_angle_deg)||"N/A"}</p>\n                <p><strong>${R}:</strong> ${(null==(d=g.technical_data)?void 0:d.pr_pen_m)||"N/A"} m</p>\n                <p><strong>${P}:</strong> ${(null==(f=g.technical_data)?void 0:f.pr_debris_m)||"N/A"} m</p>\n            </div>\n        `);const D=document.getElementById("modal-certification");D&&(D.innerHTML=`\n            <p><strong>${ij("manufacturer.sidebar.productDatabase.standard")}:</strong> ${(null==(p=g.technical_data)?void 0:p.standard)||"N/A"}</p>\n            <p><strong>${M}:</strong> ${g.datasheet_url?`<a href="${g.datasheet_url}" target="_blank" style="color: #1e90ff;">${g.datasheet_url}</a>`:"N/A"}</p>\n            <p><strong>${L}:</strong> ${g.product_image_file||"N/A"}</p>\n        `);const F=document.getElementById("product-modal");if(F){F.style.display="flex",F.currentProductIndex=e;F.querySelectorAll("[data-translate-key]").forEach(e=>{const t=e.getAttribute("data-translate-key");if(t){const n=ij(t);n&&n!==t&&(e.textContent=n)}});const t=F.querySelector('[data-translate-key="manufacturer.sidebar.productDatabase.modal.exportData"]');t&&(t.textContent=ij("manufacturer.sidebar.productDatabase.modal.exportData"));const n=F.querySelector('[data-translate-key="manufacturer.sidebar.productDatabase.modal.printSpecs"]');n&&(n.textContent=ij("manufacturer.sidebar.productDatabase.modal.printSpecs"))}}function ej(){nj("Export-Funktionalitt wird implementiert...","info")}function tj(){nj("Druck-Funktionalitt wird implementiert...","info")}function nj(e,t="info"){document.querySelectorAll(".custom-notification").forEach(e=>e.remove());const n=document.createElement("div");n.className=`custom-notification custom-notification-${t}`,n.innerHTML=`\n        <div class="notification-content">\n            <span class="notification-message">${e}</span>\n            <button class="notification-close">&times;</button>\n        </div>\n    `,n.style.cssText=`\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: ${"info"===t?"#2563eb":"success"===t?"#22c55e":"warning"===t?"#f59e0b":"#ef4444"};\n        color: white;\n        padding: 16px 20px;\n        border-radius: 8px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        z-index: 10000;\n        max-width: 400px;\n        font-family: 'Open Sans', sans-serif;\n        font-size: 14px;\n        line-height: 1.4;\n    `,document.body.appendChild(n);const i=n.querySelector(".notification-close");i&&i.addEventListener("click",()=>n.remove()),setTimeout(()=>{n.parentNode&&n.remove()},5e3)}function ij(e,t){const n=DH[NH];if(!n)return e;let i=(r=n,e.split(".").reduce((e,t)=>e?e[t]:void 0,r));var r;if("string"!=typeof i)return e;if(t)for(const s in t)i=i.replace(new RegExp(`\\{${s}\\}`,"g"),String(t[s]));return i}async function rj(){if(!OH[NH]&&(await sj(),!OH[NH]))return;document.querySelectorAll("[data-translate-key]").forEach(e=>{try{const t=e.getAttribute("data-translate-key"),n=ij(t);if(n&&n!==t){if(e.hasAttribute("placeholder"))e.placeholder=n;else if("INPUT"===e.tagName&&"text"===e.type)e.value=n;else{const t=Array.from(e.childNodes).find(e=>{var t;return e.nodeType===Node.TEXT_NODE&&(null==(t=e.textContent)?void 0:t.trim())});t?t.textContent=n:e.textContent=n}0}else 0}catch(t){0}}),document.querySelectorAll("[data-translate-key-placeholder]").forEach(e=>{try{const t=e.getAttribute("data-translate-key-placeholder"),n=ij(t);n&&n!==t&&(e.placeholder=n)}catch(t){0}}),document.querySelectorAll("[data-translate-key-aria]").forEach(e=>{try{const t=e.getAttribute("data-translate-key-aria"),n=ij(t);n&&n!==t&&e.setAttribute("aria-label",n)}catch(t){0}}),document.querySelectorAll("[data-translate-key-tooltip]").forEach(e=>{try{const t=e.getAttribute("data-translate-key-tooltip"),n=ij(t);n&&n!==t&&(e.dataset.tooltip=n)}catch(t){0}});const e=document.getElementById("toggle-draw-mode");if(e){const t=e.querySelector("span");if(t){const e=ij(iH?"map.setWaypointsActive":"map.setWaypoints");e&&"map.setWaypointsActive"!==e&&"map.setWaypoints"!==e&&(t.textContent=e)}}!function(){const e=document.getElementById("products-grid");if(!e)return;e.querySelectorAll(".product-card").forEach(e=>{e.querySelectorAll(".product-card-spec-label, .tech-spec-item, .tech-spec-label, .spec-label").forEach(e=>{let t=e.textContent||"";t="en"===NH?t.replace(/Fahrzeuggewicht \(kg\)/gi,ij("manufacturer.sidebar.productDatabase.vehicleWeight")).replace(/Fahrzeugtyp/gi,ij("manufacturer.sidebar.productDatabase.vehicleType")).replace(/Geschwindigkeit \(km\/h\)/gi,ij("manufacturer.sidebar.productDatabase.speed")).replace(/Aufprallwinkel \(\)/gi,ij("manufacturer.sidebar.productDatabase.impactAngle")).replace(/Penetration \(m\)/gi,ij("manufacturer.sidebar.productDatabase.penetration")).replace(/Trmmerentfernung \(m\)/gi,ij("manufacturer.sidebar.productDatabase.debrisDistance")).replace(/Standard/gi,ij("manufacturer.sidebar.productDatabase.standard")).replace(/Hersteller/gi,ij("manufacturer.sidebar.productDatabase.manufacturer")).replace(/Typ/gi,ij("manufacturer.sidebar.productDatabase.type")).replace(/FAHRZEUGGEWICHT \(KG\)/gi,ij("manufacturer.sidebar.productDatabase.vehicleWeight").toUpperCase()).replace(/FAHRZEUGTYP/gi,ij("manufacturer.sidebar.productDatabase.vehicleType").toUpperCase()).replace(/GESCHWINDIGKEIT \(KM\/H\)/gi,ij("manufacturer.sidebar.productDatabase.speed").toUpperCase()).replace(/AUFPRALLWINKEL \(\)/gi,ij("manufacturer.sidebar.productDatabase.impactAngle").toUpperCase()).replace(/PENETRATION \(M\)/gi,ij("manufacturer.sidebar.productDatabase.penetration").toUpperCase()).replace(/STANDARD/gi,ij("manufacturer.sidebar.productDatabase.standard").toUpperCase()).replace(/HERSTELLER/gi,ij("manufacturer.sidebar.productDatabase.manufacturer").toUpperCase()).replace(/TYP/gi,ij("manufacturer.sidebar.productDatabase.type").toUpperCase()):t.replace(/Vehicle Weight \(kg\)/gi,"Fahrzeuggewicht (kg)").replace(/Vehicle Type/gi,"Fahrzeugtyp").replace(/Speed \(km\/h\)/gi,"Geschwindigkeit (km/h)").replace(/Impact Angle \(\)/gi,"Aufprallwinkel ()").replace(/Penetration \(m\)/gi,"Penetration (m)").replace(/Debris Distance \(m\)/gi,"Trmmerentfernung (m)").replace(/Standard/gi,"Standard").replace(/Manufacturer/gi,"Hersteller").replace(/Type/gi,"Typ").replace(/VEHICLE WEIGHT \(KG\)/gi,"FAHRZEUGGEWICHT (KG)").replace(/VEHICLE TYPE/gi,"FAHRZEUGTYP").replace(/SPEED \(KM\/H\)/gi,"GESCHWINDIGKEIT (KM/H)").replace(/IMPACT ANGLE \(\)/gi,"AUFPRALLWINKEL ()").replace(/PENETRATION \(M\)/gi,"PENETRATION (M)").replace(/STANDARD/gi,"STANDARD").replace(/MANUFACTURER/gi,"HERSTELLER").replace(/TYPE/gi,"TYP"),e.textContent=t});const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),n=[];let i;for(;i=t.nextNode();)i.nodeValue&&i.nodeValue.trim()&&n.push(i);n.forEach(e=>{let t=e.nodeValue||"";t="en"===NH?t.replace(/FAHRZEUGGEWICHT \(KG\)/gi,"VEHICLE WEIGHT (KG)").replace(/FAHRZEUGTYP/gi,"VEHICLE TYPE").replace(/GESCHWINDIGKEIT \(KM\/H\)/gi,"SPEED (KM/H)").replace(/AUFPRALLWINKEL \(\)/gi,"IMPACT ANGLE ()").replace(/PENETRATION \(M\)/gi,"PENETRATION (M)").replace(/STANDARD/gi,"STANDARD").replace(/HERSTELLER/gi,"MANUFACTURER").replace(/TYP/gi,"TYPE"):t.replace(/VEHICLE WEIGHT \(KG\)/gi,"FAHRZEUGGEWICHT (KG)").replace(/VEHICLE TYPE/gi,"FAHRZEUGTYP").replace(/SPEED \(KM\/H\)/gi,"GESCHWINDIGKEIT (KM/H)").replace(/IMPACT ANGLE \(\)/gi,"AUFPRALLWINKEL ()").replace(/PENETRATION \(M\)/gi,"PENETRATION (M)").replace(/STANDARD/gi,"STANDARD").replace(/MANUFACTURER/gi,"HERSTELLER").replace(/TYPE/gi,"TYP"),e.nodeValue=t})})}();const t=document.getElementById("manufacturer-view");if(t&&"none"!==t.style.display){const e=window.productDatabase;e&&e.length>0&&GH(e);const t=document.getElementById("product-modal");if(t&&"block"===t.style.display){const e=t.currentProductIndex;void 0!==e&&QH(e)}}setTimeout(()=>{document.querySelectorAll("[data-translate-key]").forEach(e=>{try{const t=e.getAttribute("data-translate-key"),n=ij(t);n&&n!==t&&e.textContent!==n&&(e.textContent=n)}catch(t){}})},200)}async function sj(){OH=DH}async function oj(e){var t;const n={center:eH?eH.getCenter():null,zoom:eH?eH.getZoom():null,drawnPolygon:lH?lH.getLatLngs():null,threatsMap:new Map(dH),waypoints:[...rH]};NH=e,localStorage.setItem("language",e),document.documentElement.lang=e,document.querySelectorAll(".lang-btn").forEach(t=>{t.classList.toggle("active",t.getAttribute("data-lang")===e)}),await rj();const i=document.getElementById("manufacturer-view");if(i&&"none"!==i.style.display&&(rj(),UH()),OW(),window.dispatchEvent(new Event("languageChanged")),eH&&n.center&&n.zoom){await new Promise(e=>setTimeout(e,500));try{if(eH.setView(n.center,n.zoom,{animate:!1}),n.drawnPolygon&&n.drawnPolygon.length>0){lH&&eH.removeLayer(lH),lH=L.polygon(n.drawnPolygon,{color:"yellow",fillColor:"#FFFF00",fillOpacity:.3,weight:2}).addTo(eH),mj(lH);const e=lH.getBounds().getCenter();cH=L.marker(e,{icon:L.divIcon({className:"polygon-label",html:`<div>${ij("map.securityAreaLabel")} 1</div>`,iconSize:[150,24]})}).addTo(eH),uH.push({polygon:lH,label:cH,id:`polygon-${Date.now()}`})}n.threatsMap.size>0&&(dH=n.threatsMap,dH.size>0&&Nj()),n.waypoints.length>0&&(rH=n.waypoints,rH.forEach((e,t)=>{const n=L.marker(e,{icon:L.divIcon({className:"waypoint-marker",html:`<div style="background: #ff7800; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">${t+1}</div>`,iconSize:[20,20],iconAnchor:[10,10]})}).addTo(eH);oH.push(n)}),rH.length>1&&(aH=L.polyline(rH,{color:"#ff7800",weight:3,opacity:.8,dashArray:"10, 10"}).addTo(eH))),eH.invalidateSize()}catch(r){}}dH.size>0&&Nj(),!1===(null==(t=document.querySelector(".product-recommendations-container"))?void 0:t.classList.contains("hidden"))&&await Vj()}async function aj(){var e;const t=document.getElementById("map");if(!t)return;t.style.display="block",t.style.visibility="visible",t.style.opacity="1",t.classList.remove("view-hidden");try{const{initializeProviderSystem:e}=await s(async()=>{const{initializeProviderSystem:e}=await import("./indexIntegration-BWW4NxPp.js");return{initializeProviderSystem:e}},__vite__mapDeps([0,1,2,3,4,5,6]));await e()}catch(i){}eH=L.map(t,{zoomControl:!1,preferCanvas:!0}).setView([51.5719,8.1061],16),L.control.zoom({position:"bottomright"}).addTo(eH);try{const{pickProvider:n,getCurrentMapBbox4326:r}=await s(async()=>{const{pickProvider:e,getCurrentMapBbox4326:t}=await import("./index-CcROzGNL.js");return{pickProvider:e,getCurrentMapBbox4326:t}},__vite__mapDeps([3,4,5,6])),o=r(eH),a=await n(o);let l=null;if(a.makeBasemapLayer)l=a.makeBasemapLayer();else{const{osmProvider:t}=await s(async()=>{const{osmProvider:e}=await import("./index-CcROzGNL.js");return{osmProvider:e}},__vite__mapDeps([3,4,5,6]));l=null==(e=t.makeBasemapLayer)?void 0:e.call(t)}l&&(l.addTo(eH),eH._currentBasemapLayer=l);const c=document.createElement("div");c.id="provider-attribution",c.style.cssText="\n            position: absolute;\n            bottom: 10px;\n            left: 10px;\n            background: rgba(255, 255, 255, 0.9);\n            padding: 4px 8px;\n            border-radius: 4px;\n            font-size: 11px;\n            color: #333;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.3);\n            z-index: 1000;\n            pointer-events: none;\n        ",c.textContent="nrw"===a.id?"Quelle: GEOBASIS.NRW":"Quelle: OSM",t.appendChild(c),window.currentProvider=a,function(e){let t=null;const n=async()=>{t&&clearTimeout(t),t=setTimeout(async()=>{try{const{pickProvider:t,getCurrentMapBbox4326:n}=await s(async()=>{const{pickProvider:e,getCurrentMapBbox4326:t}=await import("./index-CcROzGNL.js");return{pickProvider:e,getCurrentMapBbox4326:t}},__vite__mapDeps([3,4,5,6])),i=n(e),r=await t(i),o=window.currentProvider;if(!o||r.id!==o.id){const t=e._currentBasemapLayer;t&&e.removeLayer(t);let n=null;r.makeBasemapLayer&&(n=r.makeBasemapLayer(),n.addTo(e),e._currentBasemapLayer=n);const i=document.getElementById("provider-attribution");i&&(i.textContent="nrw"===r.id?"Quelle: GEOBASIS.NRW":"Quelle: OSM"),window.currentProvider=r,"nrw"===(null==o?void 0:o.id)&&r.id}}catch(i){}},1500)};e.on("moveend",n),e.on("zoomend",n)}(eH)}catch(i){L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(eH)}let n;window.map=eH,setTimeout(()=>{eH&&eH.invalidateSize()},100),setTimeout(()=>{eH&&eH.invalidateSize()},500),eH.on("move",()=>{n&&clearTimeout(n),n=window.setTimeout(()=>{requestAnimationFrame(()=>{dW(),vj()})},150)}),eH.on("zoom",()=>{dW(),vj()}),eH.on("zoomstart",()=>{}),eH.on("zoomend",()=>{dW();eH.getZoom()<14&&CH&&kj()}),eH.on("resize",()=>{dW()}),setTimeout(()=>{!function(){try{zV();window.handle3DToggle=lj}catch(i){}}(),function(){const e=document.getElementById("3d-toggle-btn");if(!e)return;e.addEventListener("click",async()=>{await lj()})}(),function(){const e=document.getElementById("map-settings-btn");if(!e)return;e.addEventListener("click",async()=>{if(eH)try{const{toggleBasemapProvider:e}=await s(async()=>{const{toggleBasemapProvider:e}=await import("./mapIntegration-Gh_eCX7z.js");return{toggleBasemapProvider:e}},[]);await e(eH)}catch(i){}})}()},100)}async function lj(){if(eH)try{const e=zV();VV.is3D?function(e,t){const n=t??document.getElementById("deckgl-mount"),i=e.getContainer();i.style.visibility="visible",i.style.pointerEvents="auto",n&&(n.style.display="none"),setTimeout(()=>window.dispatchEvent(new Event("resize")),0);const r=VV.current3D;r?e.setView([r.latitude,r.longitude],Math.round(r.zoom)):VV.last2D&&e.setView([VV.last2D.center[1],VV.last2D.center[0]],VV.last2D.zoom),VV.is3D=!1}(eH,e):await HV(eH,e),function(){const e=document.getElementById("3d-toggle-btn"),t=document.getElementById("3d-toggle-text");e&&t&&(VV.is3D?(t.textContent="2D",e.title="Zu 2D wechseln",e.classList.add("in-3d-mode")):(t.textContent="3D",e.title="Zu 3D wechseln",e.classList.remove("in-3d-mode")))}()}catch(dy){alert("3D konnte nicht geladen werden. Details in der Konsole.")}}const cj=()=>{if(!(0!==dH.size||window.entryDetectionManager&&window.entryDetectionManager.candidates&&0!==window.entryDetectionManager.candidates.length))return;if(dH.size>0){if(tH)try{tH.clearLayers(),eH.removeLayer(tH)}catch{}tH=L.layerGroup().addTo(eH),dH.forEach((e,t)=>{if(0===e.entryPoints.length)return;const n=document.getElementById("vehicle-select"),i=Tj((null==n?void 0:n.value)||"alle"),r=i?i[1]:3;let s,o,a;const l=Math.min(Math.round(10*r),10);l>=8?(s="#DC143C",o="#FF6347",a=6):l>=5?(s="#FF8C00",o="#FFA500",a=5):(s="#DAA520",o="#FFD700",a=4);const c=[];e.entryPoints.forEach(n=>{const i=`\n                    <b>${ij("threats.popupHeader")}</b><br>\n                    <b>Strae:</b> ${t}<br>\n                    <b>Straentyp:</b> ${e.roadType||"unbekannt"}<br>\n                    <b>Bedrohungslevel:</b> ${l}/10<br>\n                    <b>Max. Geschwindigkeit:</b> ${e.maxSpeed||"unbekannt"} km/h\n                `,r=L.circle([n.lat,n.lon],{radius:a,color:s,fillColor:o,fillOpacity:.8,weight:3}).bindPopup(i);tH.addLayer(r),c.push(r)}),hH.set(t,c)})}window.entryDetectionManager&&window.entryDetectionManager.candidates&&window.entryDetectionManager.candidates.length>0&&sW();const e=document.querySelector(".threat-list");e&&(e.innerHTML="",dH.size>0&&Nj(),window.entryDetectionManager&&window.entryDetectionManager.candidates&&window.entryDetectionManager.candidates.length>0&&NW(e),Oj(dH.size>0||window.entryDetectionManager&&window.entryDetectionManager.candidates&&window.entryDetectionManager.candidates.length>0));const t=document.getElementById("floating-threats");t&&(dH.size>0||window.entryDetectionManager&&window.entryDetectionManager.candidates&&window.entryDetectionManager.candidates.length>0)&&t.classList.remove("view-hidden")},uj=()=>{const e=document.querySelector(".threat-list");if(e){e.innerHTML="",dH.size>0&&Nj(),NW(e);const t=window.entryDetectionManager;Oj(dH.size>0||t&&t.candidates&&t.candidates.length>0)}},hj=()=>{const e=hH.get("entry-detection");e&&(e.forEach(e=>{tH&&tH.hasLayer(e)?tH.removeLayer(e):eH&&eH.hasLayer(e)&&eH.removeLayer(e)}),hH.set("entry-detection",[]))},dj=(e,t)=>{const n=[e.lng,e.lat];return{id:t,intersectionPoint:n,pathNodeIds:[],path:{type:"Feature",geometry:{type:"LineString",coordinates:[n]},properties:{}},distanceMeters:Math.max(100,120),straightness:1,continuity:1,confidence:.95,wayIds:[],manual:!0}},fj=e=>{const t=window.entryDetectionManager;if(!t)return;if(((e,t)=>!!(null==e?void 0:e.candidates)&&e.candidates.some(e=>!!e.manual&&L.latLng(e.intersectionPoint[1],e.intersectionPoint[0]).distanceTo(t)<2))(t,e))return void nj("In der Nhe existiert bereits eine manuelle Zufahrt.","warning");const n=`manual-${Date.now()}-${gH++}`,i=dj(e,n);t.addManualCandidate(i),hj(),sW(),uj(),nj("Manuelle Zufahrt hinzugefgt. Analyse aktualisieren, um Wege neu zu berechnen.","success")},pj=(e,t=!1)=>{e&&0===uH.length&&!lH&&(t||nj("Bitte zeichnen Sie zuerst einen Sicherheitsbereich.","warning"),e=!1),fH=e,pH&&(pH.classList.toggle("active",e),pH.setAttribute("aria-pressed",e?"true":"false")),t||nj(e?"Manueller Zufahrtsmodus aktiv. Rechtsklick auf die Auenkante setzt eine neue Zufahrt.":"Manueller Zufahrtsmodus beendet.","info")},gj=e=>{pH&&(pH.disabled=!e,pH.classList.toggle("disabled",!e),!e&&fH&&pj(!1,!0))},mj=e=>{e&&!e._manualEntryHandlerAttached&&(e.on("contextmenu",e=>{var t,n;"nav-threat-analysis"===sH&&(fH||pj(!0),null==(n=null==(t=e.originalEvent)?void 0:t.preventDefault)||n.call(t),fj(e.latlng))}),e._manualEntryHandlerAttached=!0)},yj=(e,t,n)=>{const i=document.getElementById("deletion-bubble");i&&i.remove();const r=e.getLatLng(),s=eH.latLngToContainerPoint(r),o=document.createElement("div");o.id="deletion-bubble",o.style.cssText=`\n        position: absolute;\n        left: ${s.x+15}px;\n        top: ${s.y-10}px;\n        background: rgba(12, 47, 77, 0.95);\n        backdrop-filter: blur(10px);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 12px;\n        padding: 12px 16px;\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n        z-index: 10000;\n        color: white;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-size: 14px;\n        min-width: 200px;\n        max-width: 250px;\n        pointer-events: auto;\n    `,o.innerHTML='\n        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">\n            <div style="font-weight: 600; color: #FFD700;">\n                 Zufahrtspunkt lschen\n            </div>\n            <button id="close-deletion-bubble" style="\n                background: none;\n                border: none;\n                color: #ccc;\n                font-size: 18px;\n                cursor: pointer;\n                padding: 0;\n                width: 20px;\n                height: 20px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            "></button>\n        </div>\n        <div style="display: flex; gap: 8px;">\n            <button id="confirm-deletion" style="\n                background: #dc3545;\n                color: white;\n                border: none;\n                padding: 8px 16px;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 13px;\n                font-weight: 500;\n                flex: 1;\n                transition: background-color 0.2s;\n            " onmouseover="this.style.background=\'#c82333\'" onmouseout="this.style.background=\'#dc3545\'">\n                Entfernen\n            </button>\n        </div>\n    ';const a=document.getElementById("map");a&&a.appendChild(o);const l=document.getElementById("close-deletion-bubble"),c=document.getElementById("confirm-deletion");l&&l.addEventListener("click",()=>{o.remove()}),c&&c.addEventListener("click",()=>{_j(e,t),o.remove()});const u=e=>{o.contains(e.target)||(o.remove(),document.removeEventListener("click",u))};return setTimeout(()=>{document.addEventListener("click",u)},100),o},vj=()=>{const e=document.getElementById("deletion-bubble");if(!e||!eH)return;const t=hH.get("entry-detection");t&&0!==t.length&&e.remove()},_j=(e,t)=>{if(t.fromThreatsMap&&t.streetName){const e=dH.get(t.streetName);if(e){const n=t.intersectionPoint[1],i=t.intersectionPoint[0];if(e.entryPoints=e.entryPoints.filter(e=>Math.sqrt(Math.pow(e.lat-n,2)+Math.pow(e.lon-i,2))>1e-4),0===e.entryPoints.length){dH.delete(t.streetName);const e=hH.get(t.streetName);e&&(e.forEach(e=>{tH&&tH.hasLayer(e)?tH.removeLayer(e):eH&&eH.hasLayer(e)&&eH.removeLayer(e)}),hH.delete(t.streetName))}else{const e=hH.get(t.streetName);e&&(e.forEach(e=>{tH&&tH.hasLayer(e)?tH.removeLayer(e):eH&&eH.hasLayer(e)&&eH.removeLayer(e)}),hH.delete(t.streetName))}return Nj(),sW(),void uj()}}t.manual&&function(e){const t=yH.get(e);t&&(t.forEach(e=>{e.pathLine&&eH.removeLayer(e.pathLine),e.waypointMarkers&&e.waypointMarkers.forEach(e=>eH.removeLayer(e))}),yH.delete(e))}(t.id);const n=e.getLatLng(),i=window.entryDetectionManager;i&&i.deleteCandidate(t.id);const r=[];eH.eachLayer(e=>{if(uH.some(t=>t.polygon===e)||e===lH)return;if(!(uH.some(t=>t.label===e)||e===cH||e===nH||oH.includes(e)))if(e instanceof L.Circle){const t=e.getLatLng();n.distanceTo(t)<2&&r.push(e)}else if(e instanceof L.Polyline){const t=e.getLatLngs();if(t&&t.length>0){let i=!1;for(const e of t){const t=Array.isArray(e)?L.latLng(e[0],e[1]):e;if(n.distanceTo(t)<10){i=!0;break}}i&&r.push(e)}}else if(e instanceof L.Marker){const t=e.getLatLng();n.distanceTo(t)<2&&r.push(e)}}),r.forEach((e,t)=>{try{tH&&tH.hasLayer(e)?tH.removeLayer(e):eH.removeLayer(e)}catch(n){}}),hH.forEach((t,i)=>{const r=t.length,s=t.filter(t=>{if(uH.some(e=>e.polygon===t)||t===lH)return!0;if(uH.some(e=>e.label===t)||t===cH)return!0;if(t===nH)return!0;if(oH.includes(t))return!0;if(t&&t.getLatLng){const e=t.getLatLng();return n.distanceTo(e)>=2}if(t&&t.getLatLngs){const e=t.getLatLngs();if(e&&e.length>0)for(const t of e){const e=Array.isArray(t)?L.latLng(t[0],t[1]):t;if(n.distanceTo(e)<10)return!1}return!0}return t!==e});s.length!==r&&hH.set(i,s)}),uj();eH.eachLayer(e=>{if(e instanceof L.Circle){e.getLatLng()}else if(e instanceof L.Marker){e.getLatLng()}else if(e instanceof L.Polyline){e.getLatLngs()}else L.Polygon}),setTimeout(()=>{const e=[];eH.eachLayer(t=>{if(uH.some(e=>e.polygon===t)||t===lH)return;if(!(uH.some(e=>e.label===t)||t===cH||t===nH||oH.includes(t)))if(t instanceof L.Circle){const i=t.getLatLng();n.distanceTo(i)<2&&e.push(t)}else if(t instanceof L.Polyline){const i=t.getLatLngs();if(i&&i.length>0){let r=!1;for(const e of i){const t=Array.isArray(e)?L.latLng(e[0],e[1]):e;if(n.distanceTo(t)<10){r=!0;break}}r&&e.push(t)}}else if(t instanceof L.Marker){const i=t.getLatLng();n.distanceTo(i)<2&&e.push(t)}}),e.length>0&&e.forEach(e=>{try{eH.removeLayer(e)}catch(t){}})},100)},bj=e=>{const t=(null==e?void 0:e.preserveManualEntries)??!1;if(kj(),kH){kH=!1;const e=document.getElementById("edit-threats-btn");e&&(e.classList.remove("active"),e.title="Zufahrten bearbeiten"),Mj()}if(RH.clear(),PH.clear(),tH){try{tH.clearLayers(),eH.removeLayer(tH)}catch(dy){}tH=null}hH.forEach(e=>{e.forEach(e=>eH.removeLayer(e))}),hH.clear(),window.entryDetectionManager&&window.entryDetectionManager.clearCandidates(t),t||pj(!1,!0),dH.clear();const n=document.querySelector(".threat-list");n&&(n.innerHTML="");const i=document.getElementById("floating-threats");i&&i.classList.add("view-hidden"),Oj(!1);const r=document.querySelector(".product-recommendations-container");r&&r.classList.add("hidden")};function Ej(e,t,n,i){const r=e.lon,s=e.lat,o=t.lon,a=t.lat,l=n.lon,c=n.lat,u=i.lon,h=i.lat,d=(r-o)*(c-h)-(s-a)*(l-u);if(0===d)return null;const f=((r-l)*(c-h)-(s-c)*(l-u))/d,p=-((r-o)*(s-c)-(s-a)*(r-l))/d;return f>0&&f<1&&p>0&&p<1?{lat:s+f*(a-s),lon:r+f*(o-r)}:null}function wj(e,t){const n=e.replace(/\(ID:\d+\)/g,"").replace(/(strae|weg|gasse|platz|allee)$/i,"").trim().toLowerCase(),i=t.replace(/\(ID:\d+\)/g,"").replace(/(strae|weg|gasse|platz|allee)$/i,"").trim().toLowerCase();if(n===i&&n.length>2)return!0;if(function(e,t){const n=Array(t.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let i=0;i<=e.length;i++)n[0][i]=i;for(let i=0;i<=t.length;i++)n[i][0]=i;for(let i=1;i<=t.length;i++)for(let r=1;r<=e.length;r++){const s=e[r-1]===t[i-1]?0:1;n[i][r]=Math.min(n[i][r-1]+1,n[i-1][r]+1,n[i-1][r-1]+s)}return n[t.length][e.length]}(n,i)<=1&&Math.min(n.length,i.length)>3)return!0;const r=n.replace(/^(haupt|neben|ober|unter|neu|alt)\s*/i,"");return r===i.replace(/^(haupt|neben|ober|unter|neu|alt)\s*/i,"")&&r.length>2}const xj=(e,t)=>{let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const s=t[i].lon,o=t[i].lat,a=t[r].lon,l=t[r].lat;o>e.lat!=l>e.lat&&e.lon<(a-s)*(e.lat-o)/(l-o)+s&&(n=!n)}return n};function Aj(e,t){const n=e.lat*Math.PI/180,i=t.lat*Math.PI/180,r=(t.lat-e.lat)*Math.PI/180,s=(t.lon-e.lon)*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(n)*Math.cos(i)*Math.sin(s/2)*Math.sin(s/2);return 6371e3*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}function Sj(e,t,n){const i=e.lon-t.lon,r=e.lat-t.lat,s=n.lon-t.lon,o=n.lat-t.lat,a=i*s+r*o,l=Math.sqrt(i*i+r*r),c=Math.sqrt(s*s+o*o);if(0===l||0===c)return 180;const u=a/(l*c),h=Math.max(-1,Math.min(1,u));return Math.acos(h)*(180/Math.PI)}function Tj(e){switch(e){case"500":return[4,6];case"3500":return[3,4];case"7500":return[1.5,2.5];case"12000":return[1,1.5];case"40000":return[.5,1];default:return null}}function Cj(e,t){if(t<=0)return 0;return 3.6*Math.sqrt(2*e*t)}function Ij(e,t,n,i=1e3){let r=0;if(t>0){const t=e[0];for(const[,e]of Object.entries(n)){const n=e;if(n.nodes&&n.nodes.length>1){const e=n.nodes,s=e[e.length-1],o=e[0];if(s===t.id||o===t.id){let t=0;for(let n=0;n<Math.min(e.length-1,10)&&(t+=50,!(t>=i));n++);r=Math.max(r,t);break}}}}return Math.min(r,i)}function kj(){if(!CH)return;const e=hH.get(CH),t=IH.get(CH);e&&t&&e.forEach((e,n)=>{const i=t[n];e.setStyle&&i&&e.setStyle({weight:i.weight,opacity:i.opacity})}),IH.delete(CH),CH=null}function Rj(){kH=!kH;const e=document.getElementById("edit-threats-btn");e&&(kH?(e.classList.add("active"),e.title="Edit-Modus beenden",eH&&(eH.getContainer().style.cursor="crosshair",eH.on("click",Lj)),Pj()):(e.classList.remove("active"),e.title="Zufahrten bearbeiten",Mj(),document.querySelectorAll(".delete-threat-btn").forEach(e=>e.remove())))}function Pj(){const e=document.querySelector(".threat-list");e&&e.querySelectorAll("li").forEach(e=>{var t,n;if(!e.querySelector(".delete-threat-btn")){const i=document.createElement("button");i.className="delete-threat-btn",i.innerHTML='<i class="fas fa-trash"></i>',i.title="Zufahrt entfernen",i.style.cssText="\n                float: right;\n                background: rgba(239, 68, 68, 0.2);\n                border: none;\n                color: #ef4444;\n                padding: 2px 6px;\n                border-radius: 3px;\n                cursor: pointer;\n                margin-left: 8px;\n                font-size: 12px;\n            ";const r=(null==(n=null==(t=e.textContent)?void 0:t.split(" (")[0])?void 0:n.replace(/^[]\s/,""))||"";i.addEventListener("click",t=>{t.stopPropagation(),function(e,t){RH.add(e),dH.has(e)&&dH.delete(e);const n=hH.get(e);n&&(n.forEach(e=>{tH&&tH.hasLayer(e)&&tH.removeLayer(e)}),hH.delete(e));t.remove(),Oj(dH.size>0)}(r,e)}),e.appendChild(i)}})}function Mj(){eH&&(eH.getContainer().style.cursor="",eH.off("click",Lj))}function Lj(e){const{lat:t,lng:n}=e.latlng,i=`Manueller Zufahrtspunkt ${Date.now()}`,r={lat:t,lon:n},s=function(e){const t=uH.length>0?uH[uH.length-1].polygon:lH;if(!t)return 100;const n=t.getLatLngs()[0].map(e=>({lat:e.lat,lon:e.lng}));let i=1/0;for(let r=0;r<n.length;r++){const t=Bj(e,n[r],n[(r+1)%n.length]);i=Math.min(i,t)}return Math.max(i,10)}(r),o={entryPoints:[{lat:t,lon:n,distance:s}],pathSegments:[[r]],totalLength:s,threatLevel:5,roadType:"manual",maxSpeed:50};dH.set(i,o),PH.set(i,o),function(e,t){if(!tH)return;const n=[];t.entryPoints.forEach(t=>{const i=L.circle([t.lat,t.lon],{radius:6,color:"red",fillColor:"#f03",fillOpacity:.8,weight:3}),r=`\n            <b>Manueller Zufahrtspunkt</b><br>\n            <b>Name:</b> ${e}<br>\n            <b>Beschleunigungsweg:</b> ${Math.round(t.distance)}m\n        `;i.bindPopup(r),tH.addLayer(i),n.push(i)}),hH.set(e,n)}(i,o),Nj()}function Bj(e,t,n){const i=Aj(e,t),r=Aj(e,n),s=Aj(e,{lat:(t.lat+n.lat)/2,lon:(t.lon+n.lon)/2});return Math.min(i,r,s)}function Nj(){const e=document.querySelector(".threat-list");if(!e)return;if(e.innerHTML="",0===dH.size)return void Oj();const t=Tj(document.getElementById("vehicle-select").value),n=Array.from(dH.entries()).map(([e,n])=>{if(0===n.entryPoints.length)return null;const i=Math.round(n.totalLength);let r=0;if(t&&i>0){const[,e]=t,s=n.entryPoints.length>0?[{lat:n.entryPoints[0].lat,lng:n.entryPoints[0].lon}]:void 0;r=Math.round(BW(e,i,s))}return{name:e,data:n,maxSpeed:r,lengthInMeters:i,threatLevel:n.threatLevel||5,roadType:n.roadType||"unbekannt",roadMaxSpeed:n.maxSpeed||50}}).filter(e=>null!==e);if(n.sort((e,t)=>e.threatLevel!==t.threatLevel?t.threatLevel-e.threatLevel:t.maxSpeed-e.maxSpeed),n.forEach(({name:t,maxSpeed:n,lengthInMeters:i,threatLevel:r,roadType:s})=>{const o=document.createElement("li");let a=`${r>=9?"":r>=7?"":r>=5?"":r>=3?"":""} ${t}`;a+=` (${s}, Level ${r})`,a+=` - ${i} m`,n>0&&(a+=` / ${n} km/h`),o.textContent=a,o.setAttribute("role","button"),o.setAttribute("tabindex","0"),o.addEventListener("click",()=>{e.querySelectorAll("li").forEach(e=>e.classList.remove("active")),o.classList.add("active");const n=hH.get(t);if(n&&n.length>0){const e=L.featureGroup(n);eH.fitBounds(e.getBounds().pad(.5)),function(e){kj();const t=hH.get(e);if(!t||0===t.length)return;CH=e;const n=[];t.forEach(e=>{const t={weight:e.options.weight||5,opacity:e.options.opacity||.9};n.push(t),e.setStyle&&e.setStyle({weight:2*(t.weight||5),opacity:Math.min((t.opacity||.9)+.2,1)})}),IH.set(e,n)}(t)}}),o.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||o.click()}),e.appendChild(o)}),0===e.children.length){const t=document.createElement("li");t.textContent=ij("threats.noCrossingWaysBoundary"),e.appendChild(t)}NW(e),Oj(!0),kH&&Pj()}function Oj(e=!1){const t=document.querySelector("#floating-threats h4");t&&(t.textContent=e?`${ij("threats.title")} (Strecke / Endgeschw.)`:ij("threats.title"))}const Dj=async()=>{var e,t,n,i,r;if(0===uH.length&&!lH)return void alert(ij("alerts.noPolygon"));const o=uH.length>0?uH:lH?[{polygon:lH,label:cH,id:"legacy"}]:[];if(0===o.length)return void alert(ij("alerts.noPolygon"));if(iH&&rH.length>0)return void alert("Bitte schlieen Sie zuerst alle Sicherheitsbereiche, bevor Sie die Gefahrenanalyse starten.");for(let s=0;s<o.length;s++){const{polygon:e}=o[s];if(!e.getLatLngs||"function"!=typeof e.getLatLngs)return void alert(`Sicherheitsbereich ${s+1} ist ungltig. Bitte zeichnen Sie ihn neu.`);const t=e.getLatLngs();if(!t||0===t.length||t[0]&&t[0].length<3)return void alert(`Sicherheitsbereich ${s+1} ist nicht geschlossen. Bitte schlieen Sie ihn zuerst.`)}const a=o[0].polygon,l=a.getLatLngs(),c=document.querySelector(".loading-indicator");if(c){bj({preserveManualEntries:!0}),c.classList.remove("hidden");try{let o=function(e){if(e.length<4)return!1;let t=0,n=0;for(let s=1;s<e.length-1;s++){const i=e[s-1],r=e[s],o=e[s+1],a=Math.atan2(r.lat-i.lat,r.lon-i.lon),l=Math.atan2(o.lat-r.lat,o.lon-r.lon);let c=Math.abs(l-a);c>Math.PI&&(c=2*Math.PI-c),n+=c,c>Math.PI/4&&t++}const i=n/(e.length-2),r=t/e.length>.3&&i>Math.PI/6;return r},d=function(e,t,n){for(const i of v.names)if(i.test(e))return!0;if(null==t?void 0:t.tags){for(const[e,n]of Object.entries(v.tags)){const i=t.tags[e];if(i&&n.includes(i)){if(("bicycle"===e||"foot"===e)&&t.tags.highway&&!["cycleway","footway","path"].includes(t.tags.highway))continue;return!0}}if(t.tags.leisure||t.tags.sport||t.tags.tourism)return!0;if("no"===t.tags.motor_vehicle||"no"===t.tags.motorcar||"no"===t.tags.vehicle)return!0;if("private"===t.tags.access||"no"===t.tags.access)return!0;if("designated"===t.tags.bicycle&&"cycleway"===t.tags.highway||"designated"===t.tags.foot&&"footway"===t.tags.highway)return!0}return!!o(n)};const f=a.getBounds();if(!f||!f.isValid())throw new Error("Invalid polygon bounds");const p=.005,g=f.getSouthWest(),m=f.getNorthEast(),y=`${g.lat-p},${g.lng-p},${m.lat+p},${m.lng+p}`,v={names:[/bikepark/i,/bike\s*park/i,/mountainbike/i,/mtb/i,/singletrail/i,/trail/i,/downhill/i,/freeride/i,/pumptrack/i,/pump\s*track/i,/bmx/i,/skatepark/i,/skate\s*park/i,/spielplatz/i,/playground/i,/golfplatz/i,/golf/i,/wanderweg/i,/hiking/i,/spazierweg/i,/serpentin/i,/kurve/i,/schleife/i],tags:{sport:["cycling","mtb","bmx","skateboard","golf","hiking"],leisure:["park","playground","sports_centre","track","golf_course"],tourism:["attraction","viewpoint"],mtb:["yes","designated"],motor_vehicle:["no","private"],access:["private","no","forestry","agricultural"]}};let _={elements:[]},b="unknown";try{const i=(l.flat?l.flat():l).map(e=>({lat:e.lat,lng:e.lng}));try{const{fetchRoadNetworkForPolygon:e}=await s(async()=>{const{fetchRoadNetworkForPolygon:e}=await import("./entryDetectionIntegration-CxuSJ9_A.js");return{fetchRoadNetworkForPolygon:e}},__vite__mapDeps([2,3,4,5,6])),{getCurrentProviderId:t}=await s(async()=>{const{getCurrentProviderId:e}=await import("./mapIntegration-Gh_eCX7z.js");return{getCurrentProviderId:e}},[]),n=await e(i),r=t();if(!(n&&n.nodes&&n.ways&&n.ways.length>0))throw new Error("Provider returned empty or invalid data");{b=r;const e=[];for(const t of n.nodes)e.push({type:"node",id:t.id,lat:t.lat,lon:t.lon});for(const t of n.ways){const n=t.tags||{};n.highway||n.railway||(n.highway="road"),e.push({type:"way",id:t.id,nodes:t.nodeIds,tags:n})}_={elements:e}}}catch(u){const{fetchOverpassWithFallback:e,createThreatAnalysisQuery:t}=await s(async()=>{const{fetchOverpassWithFallback:e,createThreatAnalysisQuery:t}=await import("./overpassHelper-D95OiS8Z.js");return{fetchOverpassWithFallback:e,createThreatAnalysisQuery:t}},[]),n=t(y,25);_=await e(n,{timeout:25,maxRetries:2,retryDelay:2e3}),b="osm-overpass"}null==(e=null==_?void 0:_.elements)||e.length;const r={};null==(t=null==_?void 0:_.elements)||t.forEach(e=>{var t;"way"===e.type&&(null==(t=e.tags)?void 0:t.highway)&&(r[e.tags.highway]=(r[e.tags.highway]||0)+1)});let o=0;null==(n=null==_?void 0:_.elements)||n.forEach(e=>{var t;if("way"===e.type&&(null==(t=e.tags)?void 0:t.highway)){let t=e.tags.name;t||(t="residential"===e.tags.highway?`Wohnstrae (ID:${e.id})`:"service"===e.tags.highway?`Erschlieungsstrae (ID:${e.id})`:`${e.tags.highway} (ID:${e.id})`),d(t,e,[])&&o++}})}catch(h){const e=h instanceof Error?h.message:String(h);return alert(`Fehler bei der Gefahrenanalyse: ${e}. Bitte versuchen Sie es spter erneut.`),void c.classList.add("hidden")}const E={},w={};let x=0,A=0,S=0;_.elements.forEach(e=>{if("node"===e.type)E[e.id]={lat:e.lat,lon:e.lon},x++;else if("way"===e.type&&e.tags&&(e.tags.highway||e.tags.railway)){let t=e.tags.name;t||(t="residential"===e.tags.highway?`Wohnstrae (ID:${e.id})`:"service"===e.tags.highway?`Erschlieungsstrae (ID:${e.id})`:"unclassified"===e.tags.highway?`Nebenstrae (ID:${e.id})`:"track"===e.tags.highway?`Wirtschaftsweg (ID:${e.id})`:e.tags.ref?e.tags.ref:`${e.tags.highway||"Strae"} (ID:${e.id})`),e.nodes&&Array.isArray(e.nodes)&&e.nodes.length>0?(w[e.id]={name:t,nodes:e.nodes,id:e.id},A++):S++}else"way"===e.type&&S++});const T=new Map;let C=[];try{if(C=Array.isArray(l[0])?Array.isArray(l[0][0])?l[0][0].map(e=>({lat:e.lat||e.lat,lon:e.lng||e.lon})):l[0].map(e=>({lat:e.lat||e.lat,lon:e.lng||e.lon})):l.map(e=>({lat:e.lat||e.lat,lon:e.lng||e.lon})),C.length<3)throw new Error("Invalid polygon: insufficient vertices");if(C=C.filter(e=>"number"==typeof e.lat&&"number"==typeof e.lon&&!isNaN(e.lat)&&!isNaN(e.lon)),C.length<3)throw new Error("Invalid polygon: insufficient valid coordinates")}catch(h){return alert(ij("alerts.polygonCoordinateError")),void c.classList.add("hidden")}let I=0,k=0;for(const e in w){if(!w.hasOwnProperty(e))continue;const t=w[e];if(!t||!t.nodes)continue;const n=t.nodes.map(e=>({id:e,...E[e]})).filter(e=>e.lat&&e.lon);if(n.length<2)continue;I++;const s=[],o=[];for(let e=0;e<n.length-1;e++){const t=n[e],i=n[e+1],r=xj(t,C),a=xj(i,C);if(r!==a){let r=null;for(let e=0;e<C.length;e++){const n=C[e],s=Ej(t,i,n,C[(e+1)%C.length]);if(s){r=s;break}}if(r){let l=0;for(let t=0;t<e;t++)l+=Aj(n[t],n[t+1]);l+=Aj(t,r);let c=0;if(a)for(let t=e+1;t<n.length-1;t++){const e=n[t],i=n[t+1],r=xj(e,C),s=xj(i,C);if(!r)break;if(c+=Aj(e,i),!s||c>1e3)break}else{const t=Math.min(.5*l,500),i=Ij(n,e,w,800);c=Math.max(t,i)}const u=l+c,h={lat:r.lat,lon:r.lon,distance:Math.max(u,10)};o.push(h);const d=[r];let f,p;a?(d.push({lat:t.lat,lon:t.lon}),f=e-1,p=-1):(d.push({lat:i.lat,lon:i.lon}),f=e+1,p=1);for(let e=f;e>=0&&e<n.length;e+=p){const t=n[e];if(d.length>=2){const e=d[d.length-2],n=d[d.length-1],i={lat:t.lat,lon:t.lon};if(Sj(e,n,i)<120)break}d.push({lat:t.lat,lon:t.lon})}s.push(d)}}}if(o.length>0){const e=_.elements.find(e=>e.id===t.id);if(!T.has(t.name)){const n=(null==(i=null==e?void 0:e.tags)?void 0:i.highway)||"unknown";let s=50;const o=_.elements.find(e=>e.id===t.id);if(null==(r=null==o?void 0:o.tags)?void 0:r.maxspeed){const e=o.tags.maxspeed.match(/\d+/);e&&(s=parseInt(e[0]))}const a=5;T.set(t.name,{entryPoints:[],pathSegments:[],totalLength:0,threatLevel:a,roadType:n,maxSpeed:s}),k++}const n=T.get(t.name);n.entryPoints.push(...o),n.pathSegments.push(...s);let a=0;s.forEach(e=>{for(let t=0;t<e.length-1;t++)a+=Aj(e[t],e[t+1])}),n.totalLength+=a}}const R=new Map;for(const[e,t]of T){let n=e,i=t;for(const[r,s]of R)if(wj(e,r)){n=r,i={entryPoints:[...s.entryPoints,...t.entryPoints],pathSegments:[...s.pathSegments,...t.pathSegments],totalLength:s.totalLength+t.totalLength,threatLevel:Math.max(s.threatLevel,t.threatLevel),roadType:s.threatLevel>=t.threatLevel?s.roadType:t.roadType,maxSpeed:Math.max(s.maxSpeed,t.maxSpeed)};break}R.set(n,i)}if(dH=R,dH.size>0){if(tH)try{tH.clearLayers(),eH.removeLayer(tH)}catch{}tH=L.layerGroup().addTo(eH);const e=document.getElementById("vehicle-select"),t=Tj((null==e?void 0:e.value)||"alle"),n=t?t[1]:3;dH.forEach((e,t)=>{if(0===e.entryPoints.length)return;const i=e.threatLevel||5;let r="red",s="#f03",o=5;i>=9?(r="#8B0000",s="#DC143C",o=10):i>=7?(r="#B22222",s="#FF6347",o=8):i>=5?(r="red",s="#f03",o=6):i>=3?(r="#FF8C00",s="#FFA500",o=5):(r="#DAA520",s="#FFD700",o=4);const a=[];e.entryPoints.forEach(n=>{const l=`\n                        <b>${ij("threats.popupHeader")}</b><br>\n                        <b>Strae:</b> ${t}<br>\n                        <b>Straentyp:</b> ${e.roadType||"unbekannt"}<br>\n                        <b>Bedrohungslevel:</b> ${i}/10<br>\n                        <b>Max. Geschwindigkeit:</b> ${e.maxSpeed||"unbekannt"} km/h\n                    `,c=L.circle([n.lat,n.lon],{radius:o,color:r,fillColor:s,fillOpacity:.8,weight:3}).bindPopup(l);tH.addLayer(c),a.push(c)}),e.pathSegments.forEach(e=>{if(e.length>1){const t=e.map(e=>[e.lat,e.lon]);let i=0;for(let n=0;n<e.length-1;n++)i+=Aj(e[n],e[n+1]);const r=Cj(n,i);let s="#e74c3c";r<=30?s="#39b54a":r<=50&&(s="#f1c40f");const o=L.polyline(t,{color:s,weight:5,opacity:.9});tH.addLayer(o),a.push(o)}}),a.length>0&&hH.set(t,a)}),Nj();const i=document.getElementById("floating-threats");i&&(i.classList.remove("view-hidden"),i.classList.remove("minimized"));const r=document.querySelector(".product-recommendations-container");r&&(r.classList.remove("hidden"),await Vj())}else{const e=document.querySelector(".threat-list"),t=document.createElement("li");t.textContent=ij("threats.noCrossingWaysArea"),e.appendChild(t);const n=document.getElementById("floating-threats");n&&(n.classList.remove("view-hidden"),n.classList.remove("minimized"))}}catch(h){alert(ij("alerts.analysisError"));const e=document.querySelector(".threat-list"),t=document.createElement("li");t.textContent=ij("threats.analysisFailed"),e.appendChild(t)}finally{c.classList.add("hidden"),window.entryDetectionManager&&_H&&(await window.entryDetectionManager.detectEntries(lH,_H),sW()),JH()}}};async function Fj(e){try{const t="undefined"!=typeof window&&window.location.hostname.endsWith("github.io"),n="AIzaSyAtkJFFEZFeFGj3fZe-VGWs5bK01kb9DK8";if(!n||t)return zj(e);const i=new ue(n),r=Array.from(dH.values()),s=r.length>0?r.reduce((e,t)=>e+(t.threatLevel||5),0)/r.length:5,o=function(){const e=window.planningState||{},t=e.schutzgter||e.schutzgueter||"",n=Array.from(dH.entries());let i="unbekannt";if(n.length>0){const e=n.map(([,e])=>e.roadType).filter(Boolean),r=n.some(([,e])=>(e.maxSpeed||0)>70),s=e.includes("residential"),o=e.includes("primary")||e.includes("motorway");i=r&&o?"industriell/verkehrsreich":s&&!o?"wohngebiet":t.toLowerCase().includes("innenstadt")||t.toLowerCase().includes("event")?"innenstadt/ffentlich":"gemischt"}return i}(),a=function(e){const{assetToProtect:t,securityLevel:n,protectionGrade:i,locationContext:r,threatLevel:s}=e,o=t.toLowerCase(),a=r.toLowerCase();let l=[];o.includes("atomkraftwerk")||o.includes("nuclear")||o.includes("kraftwerk")||o.includes("power plant")?l=["Tor","Schranke","Zaun","Poller"]:o.includes("industrie")||o.includes("industrial")||o.includes("fabrik")||o.includes("factory")||o.includes("werk")||o.includes("plant")?l=["Tor","Schranke","Zaun"]:o.includes("regierung")||o.includes("government")||o.includes("militr")||o.includes("military")||o.includes("ministerium")||o.includes("embassy")?l=["Tor","Zaun","Poller","Durchfahrtsperre"]:o.includes("krankenhaus")||o.includes("hospital")||o.includes("flughafen")||o.includes("airport")||o.includes("bahnhof")||o.includes("station")?l=["Poller","Durchfahrtsperre","Zaun"]:o.includes("bro")||o.includes("office")||o.includes("zentrum")||o.includes("center")||o.includes("gebude")||o.includes("building")||o.includes("event")||o.includes("veranstaltung")||o.includes("festival")||o.includes("markt")||o.includes("market")||o.includes("platz")||o.includes("square")||o.includes("innenstadt")?l=["Poller","Durchfahrtsperre"]:(o.includes("schule")||o.includes("school")||o.includes("universitt")||o.includes("university")||o.includes("campus"))&&(l=["Poller","Durchfahrtsperre","Zaun"]);(a.includes("innenstadt")||a.includes("city center")||a.includes("downtown")||a.includes("pedestrian"))&&(l=l.filter(e=>"Zaun"!==e&&"Tor"!==e));"high"===n||s>=8?(l.includes("Tor")||l.unshift("Tor"),l.includes("Zaun")||l.push("Zaun")):("low"===n||s<=4)&&(l=l.filter(e=>"Tor"!==e&&"Schranke"!==e));"permanent"===i?l.includes("Zaun")||l.push("Zaun"):"temporary"===i&&(l=l.filter(e=>"Zaun"!==e&&"Tor"!==e),l.includes("Poller")||l.unshift("Poller"));0===l.length&&(l=["Poller","Durchfahrtsperre"]);return[...new Set(l)]}({assetToProtect:e.assetToProtect||"",securityLevel:e.securityLevel||"medium",protectionGrade:e.protectionGrade||"permanent",locationContext:o,threatLevel:s}),l={...e,threatAnalysis:lW(),highestThreatRoads:cW(),threatLevelDistribution:uW(),locationContext:o,recommendedProductTypes:a.join(", "),averageThreatLevel:s.toFixed(1),productTypeJustification:aW(a,e.assetToProtect||"",o,s),hazardAssessment:wW(),vehicleDynamicsTable:bW(),energyClassification:EW()},c=ij("ai.reportPrompt",l)+`\n\n========== DETAILDATEN FR GUTACHTEN ==========\n\nENHANCED THREAT ANALYSIS:\n${l.threatAnalysis}\n\nHIGHEST THREAT ROADS:\n${l.highestThreatRoads}\n\nTHREAT LEVEL DISTRIBUTION:\n${l.threatLevelDistribution}\n\nHAZARD ANALYSIS (GEFHRDUNGSANALYSE ZUFAHRTSSCHUTZ):\n${l.hazardAssessment}\n\n========== FAHRDYNAMISCHE ANALYSE ==========\n\n${l.vehicleDynamicsTable}\n\n========== ENERGIEKLASSIFIZIERUNG ==========\n\n${l.energyClassification}\n\n========== EMPFEHLUNGEN ==========\n\nRECOMMENDED PRODUCT TYPES:\n${l.recommendedProductTypes}\n\nPRODUCT TYPE JUSTIFICATION:\n${l.productTypeJustification}\n\nLOCATION CONTEXT: ${l.locationContext}\nAVERAGE THREAT LEVEL: ${l.averageThreatLevel}/10\n\n========== AUSGABEANWEISUNGEN ==========\n\nWICHTIG: \n1. Erstelle den Bericht in ${"de"===NH?"deutscher":"englischer"} Sprache.\n2. Verwende Gutachtenstil / Verwaltungsdeutsch.\n3. Integriere die fahrdynamischen Berechnungen (Geschwindigkeiten, Energien, Energiestufen) in Kapitel 5 und 6.\n4. Leite Schutzklassen (SK1/SK2) und Schutzkategorien (A/B/C) nachvollziehbar aus den Energiestufen ab.\n5. Wende das ALARP-Prinzip in Kapitel 7 an.\n6. Formuliere produktoffen/produktneutral - keine Herstellernamen.\n7. Jedes der 11 Kapitel sollte 2-4 Abstze umfassen.\n8. Gesamtumfang: mindestens 2000 Wrter.`,u=i.getGenerativeModel({model:"gemini-2.5-flash"}),h=await u.generateContent(c),d=h.response.text().trim();let f;try{f=JSON.parse(d)}catch(dy){const t=d.split(/\n\s*\n/).map(e=>e.trim()).filter(Boolean);f=t.length>=11?{chapter1_auftrag:t[0],chapter2_normen:t[1],chapter3_bereich:t[2],chapter4_bedrohung:t[3],chapter5_methodik:t[4],chapter6_fahrdynamik:t[5],chapter7_risiko:t[6],chapter8_schutzziel:t[7],chapter9_konzept:t[8],chapter10_restgefahren:t[9],chapter11_empfehlung:t[10]}:t.length>=6?{chapter1_auftrag:t[0],chapter2_normen:"",chapter3_bereich:t[1],chapter4_bedrohung:t[2],chapter5_methodik:"",chapter6_fahrdynamik:"",chapter7_risiko:t[2],chapter8_schutzziel:t[3],chapter9_konzept:t[3],chapter10_restgefahren:t[4],chapter11_empfehlung:t[5]}:{chapter1_auftrag:t[0]||d.substring(0,500),chapter2_normen:t[1]||"",chapter3_bereich:t[2]||d.substring(500,1e3),chapter4_bedrohung:t[3]||d.substring(1e3,1500),chapter5_methodik:t[4]||"",chapter6_fahrdynamik:t[5]||"",chapter7_risiko:t[6]||d.substring(1500,2e3),chapter8_schutzziel:t[7]||"",chapter9_konzept:t[8]||d.substring(2e3,2500),chapter10_restgefahren:t[9]||"",chapter11_empfehlung:t[10]||d.substring(2500,3e3)}}return function(e){const t="de"===NH,n=e.purpose||e.threatAnalysis||"",i=["the","and","for","of","with","at","on","in","to","from","by","as","is","are"],r=["der","die","das","und","fr","von","mit","bei","auf","in","an","zu","zur","zum"].filter(e=>n.toLowerCase().includes(e)).length,s=i.filter(e=>n.toLowerCase().includes(e)).length,o=r>s;if(!(t&&!o||!t&&o))return e;const a={};for(const[l,c]of Object.entries(e))a[l]="string"==typeof c?Uj(c,t):c;return a}(f)}catch(t){return zj(e)}}function Uj(e,t){return t?e.replace(/\bThis report\b/gi,"Dieser Bericht").replace(/\baims to\b/gi,"zielt darauf ab").replace(/\bidentify\b/gi,"zu identifizieren").replace(/\bassess\b/gi,"zu bewerten").replace(/\bmitigate\b/gi,"zu mindern").replace(/\bpotential\b/gi,"potenzielle").replace(/\brisks\b/gi,"Risiken").replace(/\bassets\b/gi,"Schutzgter").replace(/\bensuring\b/gi,"um sicherzustellen").replace(/\bbusiness continuity\b/gi,"Geschftskontinuitt").replace(/\bstrategic\b/gi,"strategische").replace(/\bsecurity\b/gi,"Sicherheits").replace(/\binvestments\b/gi,"Investitionen").replace(/\bThe primary threat\b/gi,"Die primre Bedrohung").replace(/\bis\b/gi,"ist").replace(/\buse of vehicles\b/gi,"die Nutzung von Fahrzeugen").replace(/\bvehicle as weapon\b/gi,"Fahrzeug als Waffe").replace(/\bram attack\b/gi,"Rammangriff").replace(/\bvehicle impact\b/gi,"Fahrzeuganprall").replace(/\bcrash barrier\b/gi,"Anprallbarriere").replace(/\bsecurity barrier\b/gi,"Sicherheitsbarriere").replace(/\bpenetration depth\b/gi,"Eindringtiefe").replace(/\bdebris scatter\b/gi,"Trmmerstreuung").replace(/\bas\b/gi,"als").replace(/\bweapon\b/gi,"Waffe").replace(/\bPotential\b/gi,"Potenzielle").replace(/\badversaries\b/gi,"Gegner").replace(/\binclude\b/gi,"umfassen").replace(/\bstate-sponsored\b/gi,"staatsgesttzte").replace(/\bterrorist\b/gi,"terroristische").replace(/\bvehicle threats\b/gi,"Fahrzeugbedrohungen").replace(/\bvehicle attacks\b/gi,"Fahrzeugangriffe").replace(/\bram attacks\b/gi,"Rammangriffe").replace(/\battacks\b/gi,"Angriffe").replace(/\bGiven\b/gi,"Angesichts").replace(/\bglobal\b/gi,"globaler").replace(/\btrends\b/gi,"Trends").replace(/\band\b/gi,"und").replace(/\bthe\b/gi,"der").replace(/\bof\b/gi,"von").replace(/\bto\b/gi,"zu").replace(/\bin\b/gi,"in").replace(/\bon\b/gi,"auf").replace(/\bat\b/gi,"bei").replace(/\bwith\b/gi,"mit").replace(/\bfor\b/gi,"fr").replace(/\bfrom\b/gi,"von").replace(/\bby\b/gi,"durch").replace(/\bas\b/gi,"als").replace(/\bis\b/gi,"ist").replace(/\bare\b/gi,"sind").replace(/\bwas\b/gi,"war").replace(/\bwere\b/gi,"waren").replace(/\bwill\b/gi,"wird").replace(/\bwould\b/gi,"wrde").replace(/\bcould\b/gi,"knnte").replace(/\bshould\b/gi,"sollte").replace(/\bmay\b/gi,"kann").replace(/\bmight\b/gi,"knnte").replace(/\bcan\b/gi,"kann"):e.replace(/\bDieser Bericht\b/gi,"This report").replace(/\bzielt darauf ab\b/gi,"aims to").replace(/\bzu identifizieren\b/gi,"identify").replace(/\bzu bewerten\b/gi,"assess").replace(/\bzu mindern\b/gi,"mitigate").replace(/\bpotenzielle\b/gi,"potential").replace(/\bRisiken\b/gi,"risks").replace(/\bSchutzgter\b/gi,"assets").replace(/\bum sicherzustellen\b/gi,"ensuring").replace(/\bGeschftskontinuitt\b/gi,"business continuity").replace(/\bstrategische\b/gi,"strategic").replace(/\bSicherheits\b/gi,"security").replace(/\bInvestitionen\b/gi,"investments").replace(/\bDie primre Bedrohung\b/gi,"The primary threat").replace(/\bist\b/gi,"is").replace(/\bdie Nutzung von Fahrzeugen\b/gi,"use of vehicles").replace(/\bals\b/gi,"as").replace(/\bWaffe\b/gi,"weapon").replace(/\bPotenzielle\b/gi,"Potential").replace(/\bGegner\b/gi,"adversaries").replace(/\bumfassen\b/gi,"include").replace(/\bstaatsgesttzte\b/gi,"state-sponsored").replace(/\bterroristische\b/gi,"terrorist").replace(/\bFahrzeugbedrohungen\b/gi,"vehicle threats").replace(/\bFahrzeugangriffe\b/gi,"vehicle attacks").replace(/\bRammangriffe\b/gi,"ram attacks").replace(/\bAngriffe\b/gi,"attacks").replace(/\bAngesichts\b/gi,"Given").replace(/\bglobaler\b/gi,"global").replace(/\bTrends\b/gi,"trends").replace(/\bund\b/gi,"and").replace(/\bder\b/gi,"the").replace(/\bvon\b/gi,"of").replace(/\bzu\b/gi,"to").replace(/\bin\b/gi,"in").replace(/\bauf\b/gi,"on").replace(/\bbei\b/gi,"at").replace(/\bmit\b/gi,"with").replace(/\bfr\b/gi,"for").replace(/\bdurch\b/gi,"by").replace(/\bist\b/gi,"is").replace(/\bsind\b/gi,"are").replace(/\bwar\b/gi,"was").replace(/\bwaren\b/gi,"were").replace(/\bwird\b/gi,"will").replace(/\bwrde\b/gi,"would").replace(/\bknnte\b/gi,"could").replace(/\bsollte\b/gi,"should").replace(/\bkann\b/gi,"may")}function zj(e){var t,n,i,r,s,o,a,l;try{const c=window.planningState||{},u=ij("report.undefinedValue"),h=c.schutzgter??c.schutzgueter,d=Array.isArray(h)?h.filter(Boolean):h?[h]:[],f=d.length>0?d.join(", "):e.assetToProtect&&e.assetToProtect!==ij("report.undefinedAsset")?e.assetToProtect:ij("report.undefinedAsset"),p=e.locationName||ij("report.undefinedLocation"),g=e.securityLevel||u,m=e.protectionGrade||u,y=e.protectionPeriod||u,v=e.productType||u,_=e.penetration||u,b=e.debrisDistance||u,E=(null==(n=null==(t=c.risiko)?void 0:t.site)?void 0:n.untergrund)||u,w=(null==(i=c.restrisiko)?void 0:i.klasse)||m,x=pW(),A=(null==x?void 0:x.city)||"",S=(null==x?void 0:x.area)||"",T=(null==x?void 0:x.expectedDamageLabel)||"",C=(null==x?void 0:x.averageScore)||0,I=(null==x?void 0:x.totalScore)||0,k=(null==x?void 0:x.maxPossibleScore)||0;let R="";C>0&&(R=C<=1.5?"de"===NH?"NIEDRIG":"LOW":C<=2?"de"===NH?"MITTEL":"MEDIUM":C<=2.5?"de"===NH?"ERHHT":"ELEVATED":"de"===NH?"HOCH":"HIGH");const P=(null==(r=null==x?void 0:x.factors)?void 0:r.filter(e=>null!==e.value))||[],M=P.filter(e=>"Anlassbezogene Belange"===e.category),L=P.filter(e=>"Rumliche Belange"===e.category),B=P.filter(e=>"Weitere Sicherheitsbelange"===e.category),N=P.filter(e=>"Tatbeeinflussende Belange"===e.category),O=Array.isArray(null==(o=null==(s=c.risiko)?void 0:s.site)?void 0:o.anfahrkorridore)?c.risiko.site.anfahrkorridore.map(e=>(null==e?void 0:e.name)||(null==e?void 0:e.bezeichnung)||(null==e?void 0:e.label)||(null==e?void 0:e.strasse)||(null==e?void 0:e.strae)).filter(Boolean):[],D=Array.from(dH.keys()),F=Array.from(new Set([...O,...D])),U=F.length,z=F.length>0?"de"===NH?`${F.length} Zufahrten (${F.join(", ")})`:`${F.length} access routes (${F.join(", ")})`:"de"===NH?"keine detaillierten Zufahrten dokumentiert":"no detailed access routes documented",G=Array.from(dH.entries()),V=G.length>0?G.reduce((e,[,t])=>e+(t.threatLevel||5),0)/G.length:null,H=V?`${V.toFixed(1)}/10`:"de"===NH?"keine belastbaren Daten":"no reliable data",j=G.reduce((e,[t,n])=>{const i=Math.round(n.totalLength||0);return i>e.length?{name:t,length:i,maxSpeed:n.maxSpeed||0}:e},{name:"",length:0,maxSpeed:0}),W=j.name?"de"===NH?`${j.name} mit ca. ${j.length} m Beschleunigungsstrecke`:`${j.name} with roughly ${j.length} m of approach distance`:"de"===NH?"die lngeren, nahezu hindernisfreien Achsen":"the longer, unobstructed approaches",$=G.map(([e,t])=>{const n=Math.round(t.totalLength||0),i=Math.round(t.minSpeed||0),r=Math.round(t.maxSpeed||0);return`${e} (${n} m, ${i}${r} km/h)`}).join("; "),X=(e=>{if("number"==typeof e&&!isNaN(e))return e;if("string"==typeof e){const t=parseFloat(e.replace(",","."));return isNaN(t)?null:t}return null})(null==(l=null==(a=c.risiko)?void 0:a.dynamik)?void 0:l.v_kmh),q=G.length>0?Math.max(...G.map(([,e])=>e.maxSpeed||0)):null,K=X??(null!==q&&isFinite(q)?q:null),Y=K?"de"===NH?`Die erwarteten Annherungsgeschwindigkeiten liegen bei rund ${Math.round(K)} km/h`:`Expected approach speeds are roughly ${Math.round(K)} km/h`:"de"===NH?"Mangels Messwerten wird mit konservativen Annherungsgeschwindigkeiten gerechnet":"In absence of measurements, conservative approach speeds are assumed",J=C>0?"de"===NH?`Die Gefhrdungsanalyse im Eingabedialog ergab eine durchschnittliche Bewertung von ${C.toFixed(1)} (Gesamtpunktzahl: ${I}/${k}), was einer Gefhrdungseinstufung "${R}" entspricht.${T?` Das erwartete Schadensausma wurde als "${T}" eingeschtzt.`:""}`:`The hazard analysis input yielded an average rating of ${C.toFixed(1)} (total score: ${I}/${k}), corresponding to a "${R}" risk classification.${T?` Expected damage level was assessed as "${T}".`:""}`:"",Z=(e,t)=>{if(0===e.length)return"";const n=e.map(e=>{const t=1===e.value?"gering":2===e.value?"mittel":3===e.value?"hoch":"";return`${e.label} (${t})`});return`${t}: ${n.join(", ")}`},Q=(e,t)=>{if(0===e.length)return"";const n=e.map(e=>{const t=1===e.value?"low":2===e.value?"medium":3===e.value?"high":"";return`${e.label} (${t})`});return`${t}: ${n.join(", ")}`};let ee="";if(P.length>0)if("de"===NH){const e=[];e.push(`Im Rahmen der Gefhrdungsanalyse wurden ${P.length} Bewertungsfaktoren erfasst:`),M.length>0&&e.push(Z(M,"Anlassbezogene Belange")),L.length>0&&e.push(Z(L,"Rumliche Belange")),B.length>0&&e.push(Z(B,"Sicherheitsbelange")),N.length>0&&e.push(Z(N,"Tatbeeinflussende Belange")),ee=e.join(" ")}else{const e=[];e.push(`The hazard analysis recorded ${P.length} assessment factors:`),M.length>0&&e.push(Q(M,"Event-related factors")),L.length>0&&e.push(Q(L,"Spatial factors")),B.length>0&&e.push(Q(B,"Security factors")),N.length>0&&e.push(Q(N,"Attack-influencing factors")),ee=e.join(" ")}return"de"===NH?{purpose:`Diese Betriebsanforderung nach DIN SPEC 91414-2 Anhang E dokumentiert das Zufahrtsschutzkonzept fr ${f} am Standort ${p}${A?` (${A}${S?", "+S:""})`:""}. Das Konzept dient der nachvollziehbaren Planung des Zufahrtsschutzes gegen vorstzliche berfahrtaten und orientiert sich an DIN SPEC 91414-2, DIN ISO 22343-2 sowie der polizeilichen Weicht-Handreichung zu berfahrtaten.\n\nDas angestrebte Sicherheitsniveau wurde als "${g}" definiert, woraus sich der Sicherungsgrad "${m}" ableitet. Der Schutzzeitraum ist als "${y}" festgelegt. Die Betriebsanforderung beschreibt, was der Betreiber vom Zufahrtsschutzkonzept erwarten kann  von der Planung ber die Umsetzung bis zum laufenden Betrieb.\n\nAls normative Grundlagen dienen DIN SPEC 91414-1/-2 (Zufahrtsschutzkonzepte und Risikobeurteilung), DIN ISO 22343-1/-2 (Fahrzeugsicherheitsbarrieren  Leistungsanforderungen und Anwendung), die Technische Richtlinie Mobile Fahrzeugsperren" sowie einschlgige polizeiliche Handreichungen. Der Bericht ersetzt keine hoheitliche Gefhrdungsbewertung der zustndigen Sicherheitsbehrden.`,threatAnalysis:`${Y}. Die Bedrohungsszenarien folgen dem polizeilichen Vehicle-as-a-Weapon-Bild und bercksichtigen unterschiedliche Fahrzeugmassen von PKW bis hin zu schweren Nutzfahrzeugen. Die GIS-Analyse identifizierte ${z} mit einem durchschnittlichen Bedrohungsniveau von ${H}.\n\n${J} ${ee}\n\nDie Risikobewertung erfolgt qualitativ nach einer Matrix aus Eintrittswahrscheinlichkeit und Schadensausma gem DIN SPEC 91414-2. Hieraus leitet sich der Sicherungsgrad ${m} ab, der die Anforderungen an die einzusetzenden Fahrzeugsicherheitsbarrieren definiert. Die Sicherungsgrade SG0 bis SG4 korrespondieren mit steigenden Schutzanforderungen, wobei SG0 keinen besonderen Schutz und SG4 den hchsten Schutz gegen schwere Fahrzeuge bei hohen Geschwindigkeiten darstellt.\n\nEs wird ausdrcklich darauf hingewiesen, dass die konkrete Gefhrdungsbewertung originr bei den zustndigen Sicherheitsbehrden liegt. Der vorliegende Bericht stellt eine technische Planungsgrundlage dar, ersetzt jedoch keine polizeiliche Gefhrdungseinschtzung.`,vulnerabilities:`Die Schwachstellenanalyse nach DIN SPEC 91414-2 untersucht systematisch die bergnge von Zone 0 (ffentlicher Verkehrsraum) ber die bergangszone hin zur Schutzzone und identifiziert lange, hindernisarme Achsen als besonders kritisch. Die Analyse bercksichtigt Topografie, bauliche Gegebenheiten und vorhandene Infrastruktur.\n\nInsgesamt wurden ${U} Zufahrtsmglichkeiten identifiziert: ${$||z}. Besonders kritisch erscheint ${W}, da hier weite Beschleunigungsrume ohne natrliche Hindernisse vorliegen. Die vorhandenen Boden- und Umfeldbedingungen (${E}) bieten nur begrenzten natrlichen Verzgerungsraum.\n\nJede Zufahrt erhlt ein eigenes Schwachstellenprofil, das Annherungsrichtung, Beschleunigungsstrecke, erreichbare Geschwindigkeit, vorhandene oder fehlende Hindernisse sowie die Nutzungsart (z. B. Lieferverkehr, Fugngerzone) bercksichtigt. Zufahrtsberechtigungen und Nutzungszeiten (Lieferverkehr, Anwohner, PNV) sowie die Anforderungen von BOS (Feuerwehr, Rettungsdienst, Polizei) flieen in die Bewertung ein.`,hvmMeasures:`Aus der Schwachstellenanalyse ergeben sich konkrete Schutzziele: Durchbruch verhindern, Geschwindigkeit vor Aufprall reduzieren und angrenzende Fugngerbereiche schtzen. Der abgeleitete Sicherungsgrad ${m} definiert die Leistungsanforderungen an die einzusetzenden Fahrzeugsicherheitsbarrieren.\n\nEmpfohlen werden zertifizierte HVM-Komponenten der Kategorie "${v}" fr den Schutzzeitraum "${y}". Die Systeme sollten Eindringtiefen von etwa ${_} m und Trmmerstrecken von ${b} m einhalten. Alle eingesetzten Barrieren mssen nach anerkannten Prfstandards (IWA 14-1/-2, DIN ISO 22343-1/-2, PAS 68/69) zertifiziert sein.\n\nDie Zuordnung der Zufahrten zu Schutzmanahmen erfolgt auf Basis der energetischen Einstufung: Zufahrten mit hoher kinetischer Energie (lange Beschleunigungsstrecken, hohe Geschwindigkeiten) erfordern entsprechend leistungsfhigere Barrieren. Die finale Produktauswahl ist mit Polizei und Fachplanern abzustimmen. Bei Abweichungen von den allgemein anerkannten Regeln der Technik sind diese zu benennen, zu begrnden und auf verbleibende Risiken hinzuweisen.`,siteConsiderations:`Die Integration der HVM-Manahmen folgt den Prinzipien von Security by Design": Schutzmanahmen werden mglichst unauffllig in den stdtebaulichen Kontext eingebettet, ohne die Nutzung des ffentlichen Raums unntig einzuschrnken. Die vorhandenen Untergrnde (${E}) und Nutzungsmuster werden bercksichtigt.\n\nFlucht- und Rettungswege sowie Feuerwehrzufahrten mssen jederzeit gewhrleistet bleiben. Dies erfordert ggf. durchfahrbare oder entnehmbare Sperrelemente mit definierten ffnungszeiten und -verfahren. Die Barrierefreiheit des ffentlichen Raums ist zu erhalten; Durchgangsbreiten mssen den Anforderungen entsprechen.\n\nDie Abstimmung mit allen Beteiligten (Betreiber, Anwohner, Gewerbe, Behrden) ist dokumentiert zu fhren. Auswirkungen auf Lieferverkehr, Logistik und allgemeine Erreichbarkeit sind zu minimieren und in das Betriebskonzept zu integrieren.`,operationalImpact:`Fr den Betrieb des Zufahrtsschutzkonzepts sind klare Verantwortlichkeiten festzulegen. Der Betreiber/Risikoverantwortliche trgt die Gesamtverantwortung fr Auf- und Abbau, regelmige Kontrollen, Winterdienst und das Freihalten der Schlsselflchen. Mobile Elemente sind zu dokumentieren und deren Standorte zu protokollieren.\n\nDie Betriebszustnde (offen/geschlossen, auf-/abgebaut) sind klar zu definieren. Personal muss geschult und eingewiesen werden; Bedienungsanweisungen sind vorzuhalten. Wartung, Instandhaltung und regelmige Inspektionen erfolgen gem DIN ISO 22343-2 Kapitel 15/16. Prfzeugnisse, Zertifikate und Wartungsprotokolle sind zu dokumentieren und aufzubewahren.\n\nBei wesentlichen nderungen bestehen Meldepflichten gegenber Betreiber und Polizei. Trotz technischer und organisatorischer Manahmen verbleibt ein Restrisiko (aktuelles Niveau: ${w}), das nur durch kontinuierliche Lagebewertung und regelmige berprfung des Konzepts adressiert werden kann. Dieser Bericht stellt eine technische Betriebsanforderung nach DIN SPEC 91414-2 / DIN ISO 22343-2 dar und ersetzt keine hoheitliche Gefhrdungsbewertung der zustndigen Sicherheitsbehrden.`}:{purpose:`This operational requirement according to DIN SPEC 91414-2 Annex E documents the access protection concept for ${f} at ${p}${A?` (${A}${S?", "+S:""})`:""}. The concept serves to plan access protection against deliberate hostile vehicle attacks in a traceable manner and is based on DIN SPEC 91414-2, DIN ISO 22343-2 and police guidance on vehicle attacks.\n\nThe target security level was defined as "${g}", resulting in protection grade "${m}". The protection period is set as "${y}". This operational requirement describes what the operator can expect from the access protection concept  from planning through implementation to ongoing operation.\n\nNormative foundations include DIN SPEC 91414-1/-2 (access protection concepts and risk assessment), DIN ISO 22343-1/-2 (vehicle security barriers  performance requirements and application), the Technical Guideline "Mobile Vehicle Barriers" and relevant police guidance. This report does not replace a sovereign threat assessment by the competent security authorities.`,threatAnalysis:`${Y}. Threat scenarios follow police experience with vehicle-as-a-weapon incidents involving different vehicle masses from cars to heavy commercial vehicles. The GIS analysis identified ${z} with an average threat level of ${H}.\n\n${J} ${ee}\n\nRisk assessment is performed qualitatively using a matrix of likelihood and impact according to DIN SPEC 91414-2. This derives protection grade ${m}, which defines requirements for vehicle security barriers. Protection grades SG0 to SG4 correspond to increasing protection requirements, with SG0 representing no special protection and SG4 the highest protection against heavy vehicles at high speeds.\n\nIt is expressly noted that the specific threat assessment is the responsibility of the competent security authorities. This report provides a technical planning basis but does not replace a police threat assessment.`,vulnerabilities:`The vulnerability analysis according to DIN SPEC 91414-2 systematically examines transitions from Zone 0 (public traffic area) through the transition zone to the protection zone and identifies long, unobstructed alignments as particularly critical. The analysis considers topography, structural conditions and existing infrastructure.\n\nA total of ${U} access possibilities were identified: ${$||z}. Particularly critical appears ${W}, as wide acceleration spaces without natural obstacles exist here. Existing ground and environmental conditions (${E}) offer only limited natural deceleration space.\n\nEach access point receives its own vulnerability profile considering approach direction, acceleration distance, achievable speed, existing or missing obstacles and usage type (e.g. delivery traffic, pedestrian zone). Access authorizations and usage times (delivery traffic, residents, public transport) as well as BOS requirements (fire brigade, rescue service, police) are incorporated into the assessment.`,hvmMeasures:`The vulnerability analysis yields specific protection goals: prevent breakthrough, reduce speed before impact and protect adjacent pedestrian areas. The derived protection grade ${m} defines performance requirements for vehicle security barriers to be deployed.\n\nCertified HVM components of category "${v}" are recommended for protection period "${y}". Systems should maintain penetration depths of approximately ${_} m and debris throw distances of ${b} m. All deployed barriers must be certified according to recognized test standards (IWA 14-1/-2, DIN ISO 22343-1/-2, PAS 68/69).\n\nAssignment of access points to protective measures is based on energetic classification: access points with high kinetic energy (long acceleration distances, high speeds) require correspondingly more capable barriers. Final product selection must be coordinated with police and specialist planners. Any deviations from generally accepted technical rules must be identified, justified and residual risks noted.`,siteConsiderations:`Integration of HVM measures follows "Security by Design" principles: protective measures are embedded as unobtrusively as possible into the urban context without unnecessarily restricting use of public space. Existing ground conditions (${E}) and usage patterns are considered.\n\nEscape and rescue routes as well as fire brigade access must be guaranteed at all times. This may require passable or removable barrier elements with defined opening times and procedures. Accessibility of public space must be maintained; passage widths must meet requirements.\n\nCoordination with all stakeholders (operator, residents, businesses, authorities) must be documented. Impacts on delivery traffic, logistics and general accessibility are to be minimized and integrated into the operating concept.`,operationalImpact:`Clear responsibilities must be established for operation of the access protection concept. The operator/risk owner bears overall responsibility for setup and dismantling, regular inspections, winter maintenance and keeping key areas clear. Mobile elements must be documented and their locations logged.\n\nOperating states (open/closed, set up/dismantled) must be clearly defined. Personnel must be trained and briefed; operating instructions must be available. Maintenance, upkeep and regular inspections follow DIN ISO 22343-2 Chapters 15/16. Test certificates, certifications and maintenance logs must be documented and retained.\n\nReporting obligations to operator and police exist for significant changes. Despite technical and organizational measures, residual risk remains (current level: ${w}), which can only be addressed through continuous situational assessment and regular review of the concept. This report constitutes a technical operational requirement according to DIN SPEC 91414-2 / DIN ISO 22343-2 and does not replace a sovereign threat assessment by the competent security authorities.`}}catch{return"de"===NH?{purpose:`Schutzziel und Rahmenbedingungen fr ${e.locationName}.`,threatAnalysis:"Zusammenfassung der Gefahren basierend auf Karten-/Chat-Eingaben.",vulnerabilities:"Allgemeine Schwachstellen am Standort.",hvmMeasures:"Empfohlene HVMManahmen gem Annahmen.",siteConsiderations:"Standortspezifische Hinweise.",operationalImpact:"Betriebliche Auswirkungen und Gestaltung."}:{purpose:`Protection objective and framework conditions for ${e.locationName}.`,threatAnalysis:"Summary of hazards based on map/chat inputs.",vulnerabilities:"General vulnerabilities at the site.",hvmMeasures:"Recommended HVM measures according to assumptions.",siteConsiderations:"Site-specific notes.",operationalImpact:"Operational impacts and design."}}}async function Gj(e){const t=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e.lat}&lon=${e.lng}&zoom=18&addressdetails=1`;try{const e=await fetch(t,{headers:{"Accept-Language":NH}});if(!e.ok)return"Unknown Location";return(await e.json()).display_name||"Unknown Location"}catch(n){return"Could not determine location"}}async function Vj(){let e=window.productDatabase||[];if(0===e.length)try{const t=await fetch("/Barricadix_MWP/product-database.json");if(!t.ok)throw new Error("Product database fetch failed");e=await t.json(),window.productDatabase=e}catch(t){return}await async function(){const e=document.getElementById("map");if(!e||!eH)return;e.classList.remove("view-hidden"),setTimeout(()=>{eH&&eH.invalidateSize()},100);const t=dH.size>0,n=window.entryDetectionManager&&window.entryDetectionManager.candidates&&window.entryDetectionManager.candidates.length>0;(t||n)&&await async function(){hW(),hH.forEach((e,t)=>{if("entry-detection"===t)return;const n=dH.get(t);n&&e&&e.forEach((e,i)=>{const r=function(e,t){if(!e.entryPoints||0===e.entryPoints.length||t>=e.entryPoints.length)return 0;const n=document.getElementById("vehicle-select"),i=Tj(n.value);if(!i)return 0;const r=e.entryPoints[t],s=r.distance||e.totalLength;const o=Cj(i[0]+.75*(i[1]-i[0]),s);return Math.round(o)}(n,i),s=jj(r);if(s.length>0){const n=Hj(s,r,t,i);oW(e,t,r,n,i)}else Wj(e,t,r)})});const e=hH.get("entry-detection"),t=window.entryDetectionManager;e&&t&&t.candidates&&t.candidates.length>0&&e.forEach((e,n)=>{if(n>=t.candidates.length)return;const i=t.candidates[n],r=Tj(document.getElementById("vehicle-select").value);if(!r)return;const s=function(e,t,n,i){const r=function(e,t,n){const i={hasConstraints:!1};if(!t)return i;const r=[];for(const o of e.wayIds){const e=t.ways.find(e=>e.id===o);if(null==e?void 0:e.tags.maxspeed){const t=rc(e.tags.maxspeed);void 0!==t&&r.push(t)}}r.length>0&&(i.maxspeedLimit=Math.min(...r),i.hasConstraints=!0);if(n&&e.path.geometry.coordinates.length>0){const t=e.path.geometry.coordinates,r=Math.min(10,t.length),s=Math.max(1,Math.floor(t.length/r));let o;for(let e=0;e<t.length;e+=s){const[i,r]=t[e],s=n.getConstraintsAt({lat:r,lng:i});if(s.trafficCalming){const e="bump"===s.trafficCalming.type?20:"hump"===s.trafficCalming.type?30:"table"===s.trafficCalming.type?20:"chicane"===s.trafficCalming.type||"choker"===s.trafficCalming.type?30:25;(void 0===o||e<o)&&(o=e)}}void 0!==o&&(i.trafficCalmingLimit=o,i.hasConstraints=!0)}const s=[];for(const o of e.wayIds){const e=t.ways.find(e=>e.id===o);(null==e?void 0:e.tags.highway)&&s.push(e.tags.highway)}if(s.length>0){const e=function(e){const t={living_street:10,residential:30,service:20,track:15,path:10,footway:10,pedestrian:10,unclassified:50,tertiary:50,tertiary_link:40,secondary:50,secondary_link:40,primary:50,primary_link:40,trunk:80,trunk_link:60,motorway:100,motorway_link:60,busway:40,bus_guideway:40,road:50};if(!e||0===e.length)return;const n=[];for(const i of e){const e=t[i];void 0!==e&&n.push(e)}if(n.length>0)return Math.min(...n);return}(s);void 0!==e&&(i.highwayTypeLimit=e,i.hasConstraints=!0)}return i}(e,n,i),s=t[0]+.75*(t[1]-t[0]),o=Math.max(e.distanceMeters,100),a=Cj(s,o);let l=a,c=`Physical limit: ${Math.round(a)} km/h (75% acceleration over ${Math.round(e.distanceMeters)}m)`;if(void 0!==r.maxspeedLimit)l=Math.min(l,r.maxspeedLimit),c=`OSM maxspeed: ${r.maxspeedLimit} km/h`;else if(void 0!==r.trafficCalmingLimit)l=Math.min(l,r.trafficCalmingLimit),c=`Traffic calming: ${r.trafficCalmingLimit} km/h`;else if(void 0!==r.highwayTypeLimit)l=Math.min(l,r.highwayTypeLimit),c=`Highway type: ${r.highwayTypeLimit} km/h`;else if(!r.hasConstraints){const t=(u=e.distanceMeters)<30?25:u<50?30:u<100?40:u<200?50:60;l=Math.min(l,t),c=`Distance-based: ${t} km/h (no OSM data)`}var u;if(e.distanceMeters<100){const e=.85,t=Math.round(l*e);t>=20?(l=t,c+=`  ${l} km/h (15% safety margin for short distance)`):l=Math.round(l)}else l=Math.round(l);return l=Math.max(l,20),{speed:l,reasoning:c}}(i,r,_H,vH),o=s.speed,a=jj(o);if(a.length>0){oW(e,`Zufahrt ${n+1}`,o,Hj(a,o,`Zufahrt ${n+1}`,n),n)}else Wj(e,`Zufahrt ${n+1}`,o)})}()}()}function Hj(e,t,n,i){if(1===e.length)return e[0];function r(e){var t,n;if(null==(t=e.technical_data)?void 0:t.pr_speed_kph)return parseFloat(e.technical_data.pr_speed_kph);if(e.speed)return parseFloat(e.speed);if(null==(n=e.technical_data)?void 0:n.performance_rating){const t=e.technical_data.performance_rating.split("/");if(t.length>=3)return parseFloat(t[2])||0}return 0}let s=e[0],o=1/0;for(const a of e){const e=r(a)-t;e>=0&&e<o&&(o=e,s=a)}if(o<20){const a=e.filter(e=>{const n=r(e)-t;return n>=0&&n<=o+15});if(a.length>1){const e=n.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0)+1e3*(i||0);s=a[Math.abs(e)%a.length]}}return s}function jj(e){var t,n;const i=window.productDatabase||[];i.map(e=>{var t;let n=0;return(null==(t=e.technical_data)?void 0:t.pr_speed_kph)?n=e.technical_data.pr_speed_kph:e.speed&&(n=parseFloat(e.speed)),{name:e.product_name,speed:n}}).filter(e=>e.speed>0).sort((e,t)=>e.speed-t.speed);if(!i||0===i.length)return[];function r(e){if(!e||"string"!=typeof e)return 0;const t=e.split("/");if(t.length>=3){const e=t[2],n=parseFloat(e);if(!isNaN(n))return n}return 0}const s=i.filter(t=>{let n=0;t.technical_data&&t.technical_data.pr_speed_kph?n=parseFloat(t.technical_data.pr_speed_kph):t.speed?n=parseFloat(t.speed):t.technical_data&&t.technical_data.performance_rating?n=r(t.technical_data.performance_rating):t.performance_rating&&(n=r(t.performance_rating));const i=!isNaN(n)&&n>0&&n>=e;return i});i.filter(t=>{var n;let i=0;return(null==(n=t.technical_data)?void 0:n.pr_speed_kph)?i=t.technical_data.pr_speed_kph:t.speed&&(i=parseFloat(t.speed)),i>0&&i<e}).length;const o=s.sort((e,t)=>{function n(e){var t,n;return(null==(t=e.technical_data)?void 0:t.pr_speed_kph)?parseFloat(e.technical_data.pr_speed_kph):e.speed?parseFloat(e.speed):r((null==(n=e.technical_data)?void 0:n.performance_rating)||e.performance_rating||"0")}const i=n(e);return n(t)-i});if(o.length>0){const e=o[0];let i=0;i=(null==(t=e.technical_data)?void 0:t.pr_speed_kph)?parseFloat(e.technical_data.pr_speed_kph):e.speed?parseFloat(e.speed):r((null==(n=e.technical_data)?void 0:n.performance_rating)||e.performance_rating||"0")}return o}function Wj(e,t,n){var i;let r=null,s=!1;const o=null==(i=e.getElement)?void 0:i.call(e);o&&o.classList.add("has-tooltip","no-product-marker"),e.on("click",i=>{if(i.originalEvent.stopPropagation(),s)s=!1,r&&(eH.closePopup(r),r=null);else{s=!0;const i=`\n            <div class="product-tooltip">\n                <div class="tooltip-header">\n                    <h4>${t}</h4>\n                    <span class="tooltip-close"></span>\n                </div>\n                <div class="tooltip-content">\n                    <div class="no-product-info">\n                        <div class="warning-icon">\n                            <i class="fas fa-exclamation-triangle" style="color: #ff9900; font-size: 2rem; margin-bottom: 12px;"></i>\n                        </div>\n                        <h5>${ij("products.contactAdvice")}</h5>\n                        <p><strong>${ij("products.requiredSpeed")}:</strong> ${n} km/h</p>\n                        <div class="contact-message">\n                            <p style="text-align: center; font-weight: 500; line-height: 1.5; margin: 16px 0;">\n                                ${ij("products.noSuitableProduct")}\n                            </p>\n                        </div>\n                    </div>\n                </div>\n                <div class="tooltip-pin-indicator">\n                    <i class="fas fa-info-circle"></i> ${s?ij("products.pinned")||"Angepinnt":ij("products.clickToPin")||"Klicken zum Anpinnen"}\n                </div>\n            </div>\n        `,a=e.getLatLng?e.getLatLng():e._latlng||e.latlng||{lat:0,lng:0};if(!a||"number"!=typeof a.lat||"number"!=typeof a.lng)return;try{const e=eH.getCenter(),t=eH.getZoom();r=L.popup({closeButton:!0,autoClose:!1,closeOnClick:!1,className:"product-popup no-product-popup",offset:[10,-10]}).setLatLng(a).setContent(i),r.addTo(eH),setTimeout(()=>{eH&&e&&"number"==typeof t&&eH.setView(e,t,{animate:!1})},10);const n=r._animateZoom;r._animateZoom=function(e){try{if(this._latlng&&this._latlng.lat&&this._latlng.lng)return n.call(this,e)}catch(t){}}}catch(o){return}r.on("remove",()=>{s=!1,r=null})}})}function $j(e){if(!e||!e.tags)return!1;const t=e.tags,n=["access=private","access=permissive","access=delivery","access=emergency","access=customers","access=residents","service=driveway","service=parking_aisle","service=alley"];if(t.highway&&["residential","service","unclassified","track","path","footway","cycleway","pedestrian"].includes(t.highway))return!0;for(const i of n){const[e,n]=i.split("=");if(t[e]===n)return!0}return"residential"===t.landuse||"commercial"===t.landuse}function Xj(e){var t;const n=window.entryDetectionManager;if(!n)return void nj("Entry Detection Manager nicht verfgbar.","error");const i=null==(t=n.candidates)?void 0:t.find(t=>t.id===e);if(!i)return void nj("Zufahrtspunkt nicht gefunden.","error");mH=e,yH.has(e)||yH.set(e,[]);const r=yH.get(e);if(r.find(e=>e.pathLine&&eH.hasLayer(e.pathLine)))return void nj("Pfadzeichnen fortgesetzt. Klicke auf die Karte um weitere Punkte zu setzen.","info");const s=L.latLng(i.intersectionPoint[1],i.intersectionPoint[0]),o={pathLine:null,waypointMarkers:[],waypoints:[s]};r.push(o);const a=Yj(s,i,r.length-1,0);o.waypointMarkers.push(a);const l=document.getElementById("manual-path-drawing-toggle");l&&(l.classList.add("active"),l.setAttribute("aria-pressed","true")),nj("Pfadzeichnen gestartet. Klicke auf die Karte um Punkte zu setzen. Rechtsklick auf letzten Punkt zum Beenden.","info")}function qj(e,t){const n=t.getLatLng(),i=window.entryDetectionManager;if(!i)return;const r=`manual-${Date.now()}-${gH++}`,s=dj(n,r);i.addManualCandidate(s),mH=r,yH.has(r)||yH.set(r,[]);const o={pathLine:null,waypointMarkers:[],waypoints:[n]};yH.get(r).push(o);const a=Yj(n,s,0,0);o.waypointMarkers.push(a),nj("Abzweigung gestartet. Klicke auf die Karte um Punkte zu setzen. Rechtsklick auf letzten Punkt zum Beenden.","info"),sW()}function Kj(){if(!mH)return;const e=mH;mH=null;const t=yH.get(e);if(!t||0===t.length)return;t.forEach((e,t)=>{if(e.waypoints.length<2)return;let n;e.waypointMarkers.forEach((e,t)=>{var n;if(e)try{eH.hasLayer(e)&&eH.removeLayer(e);const t=null==(n=e.getElement)?void 0:n.call(e);t&&(t.style.opacity="0",t.style.display="none",t.style.visibility="hidden"),e._isHidden=!0}catch(i){}});try{n=function(e){if(e.length<2)return e;if(2===e.length)return e;const t=[],n=.3;t.push(e[0]);try{for(let s=0;s<e.length-1;s++){const i=e[Math.max(0,s-1)],r=e[s],o=e[s+1],a=e[Math.min(e.length-1,s+2)];if(0===s){const e=Zj(r,o),i=r.distanceTo(o),s=Qj(r,e,Math.min(i*n,15)),a=tW(r,s,o,Math.max(5,Math.min(15,Math.floor(i/5))));t.push(...a.slice(1))}else if(s===e.length-2){const e=Zj(r,o),i=r.distanceTo(o),s=Math.min(i*n,15),a=Qj(o,e+Math.PI,s),l=tW(r,a,o,Math.max(5,Math.min(15,Math.floor(i/5))));t.push(...l.slice(1))}else{const e=Zj(i,r),s=Zj(r,o),l=Zj(o,a),c=eW(e,s),u=r.distanceTo(o),h=Math.min(u*n*.5,10),d=eW(s,l),f=Math.min(u*n*.5,10),p=Qj(r,c,h),g=Qj(o,d+Math.PI,f),m=nW(r,p,g,o,Math.max(8,Math.min(20,Math.floor(u/3))));t.push(...m.slice(1))}}const i=e[e.length-1],r=t[t.length-1];return r&&r.lat===i.lat&&r.lng===i.lng||t.push(i),t}catch(i){return e}}(e.waypoints),0===n.length&&(n=e.waypoints)}catch(i){n=e.waypoints}e.pathLine&&(eH.removeLayer(e.pathLine),e.pathLine=null);try{e.pathLine=L.polyline(n,{color:"#0ea5e9",weight:3,smoothFactor:1}).addTo(eH)}catch(i){e.pathLine=L.polyline(e.waypoints,{color:"#0ea5e9",weight:3}).addTo(eH)}e.smoothedWaypoints=n,e.isSmoothed=!0});const n=document.getElementById("manual-path-drawing-toggle");n&&(n.classList.remove("active"),n.setAttribute("aria-pressed","false")),rW(),nj("Pfadzeichnen beendet. Pfad wurde geglttet.","success"),sW()}function Yj(e,t,n,i){const r=L.circleMarker(e,{radius:4,color:"#0ea5e9",fillColor:"#0ea5e9",fillOpacity:1}).addTo(eH);return r.on("contextmenu",e=>{L.DomEvent.stopPropagation(e),e.originalEvent.preventDefault();const s=document.createElement("div");s.className="waypoint-context-menu",s.style.cssText=`\n            position: absolute;\n            left: ${e.originalEvent.clientX}px;\n            top: ${e.originalEvent.clientY}px;\n            background: white;\n            border: 1px solid #ccc;\n            padding: 5px;\n            border-radius: 4px;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n            z-index: 10000;\n            min-width: 120px;\n        `;const o=(e,t,n)=>{const i=document.createElement("div");return i.textContent=e,i.style.cssText=`padding: 8px 12px; cursor: pointer; color: ${t}; font-family: sans-serif; font-size: 13px;`,i.onmouseover=()=>i.style.background="#f3f4f6",i.onmouseout=()=>i.style.background="transparent",i.onclick=n,i};s.appendChild(o("Marker lschen","#dc2626",()=>{!function(e,t,n){const i=yH.get(e);if(!i||!i[t])return;const r=i[t];r.isSmoothed&&(r.pathLine&&(eH.removeLayer(r.pathLine),r.pathLine=null),r.waypointMarkers.forEach((e,t)=>{var n;if(e)try{if(e._isHidden||!eH.hasLayer(e)){e.addTo(eH),e._isHidden=!1;const t=null==(n=e.getElement)?void 0:n.call(e);t&&(t.style.opacity="1",t.style.display="",t.style.visibility="visible"),e.setStyle&&e.setStyle({opacity:1,fillOpacity:1,color:"#0ea5e9",fillColor:"#0ea5e9"})}}catch(i){}}),r.smoothedWaypoints=null,r.isSmoothed=!1,r.waypoints.length>1&&(r.pathLine=L.polyline(r.waypoints,{color:"#0ea5e9",weight:3}).addTo(eH)));for(let s=n;s<r.waypointMarkers.length;s++)eH.removeLayer(r.waypointMarkers[s]);r.waypoints.splice(n),r.waypointMarkers.splice(n),0===r.waypoints.length?(r.pathLine&&eH.removeLayer(r.pathLine),i.splice(t,1)):r.pathLine&&r.pathLine.setLatLngs(r.waypoints);Jj(e),rW()}(t.id,n,i),document.body.removeChild(s)})),s.appendChild(o("Abzweigung","#0ea5e9",()=>{qj(0,r),document.body.removeChild(s)}));const a=yH.get(t.id);a&&a[n]&&i===a[n].waypoints.length-1&&(s.appendChild(o("Zeichnen fortsetzen","#10b981",()=>{mH=t.id,nj("Pfadzeichnen fortgesetzt.","info"),document.body.removeChild(s)})),s.appendChild(o("Zeichnen beenden","#6b7280",()=>{Kj(),document.body.removeChild(s)}))),document.body.appendChild(s);const l=e=>{s.contains(e.target)||(document.body.contains(s)&&document.body.removeChild(s),document.removeEventListener("click",l))};setTimeout(()=>document.addEventListener("click",l),0)}),r.on("click",e=>{if(mH===t.id)L.DomEvent.stopPropagation(e);else{const r=yH.get(t.id);r&&r[n]&&i===r[n].waypoints.length-1&&(mH=t.id,nj("Pfadzeichnen fortgesetzt.","info"),L.DomEvent.stopPropagation(e))}}),r}function Jj(e){const t=window.entryDetectionManager,n=null==t?void 0:t.candidates.find(t=>t.id===e);if(!n)return;const i=yH.get(e);if(!i||0===i.length)return;const r=i[0],s=r.smoothedWaypoints||r.waypoints,o=s.map(e=>[e.lng,e.lat]);n.path={type:"Feature",geometry:{type:"LineString",coordinates:o},properties:{}};let a=0;for(let l=0;l<s.length-1;l++)a+=s[l].distanceTo(s[l+1]);n.distanceMeters=a}function Zj(e,t){const n=e.lat*Math.PI/180,i=t.lat*Math.PI/180,r=(t.lng-e.lng)*Math.PI/180,s=Math.sin(r)*Math.cos(i),o=Math.cos(n)*Math.sin(i)-Math.sin(n)*Math.cos(i)*Math.cos(r);return Math.atan2(s,o)}function Qj(e,t,n){const i=e.lat*Math.PI/180,r=e.lng*Math.PI/180,s=n/6371e3,o=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(t)),a=r+Math.atan2(Math.sin(t)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(o));return L.latLng(180*o/Math.PI,180*a/Math.PI)}function eW(e,t){const n=(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI);let i=(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI)-n;return i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI),n+i/2}function tW(e,t,n,i){const r=[];for(let s=0;s<=i;s++){const o=s/i,a=(1-o)*(1-o)*e.lat+2*(1-o)*o*t.lat+o*o*n.lat,l=(1-o)*(1-o)*e.lng+2*(1-o)*o*t.lng+o*o*n.lng;r.push(L.latLng(a,l))}return r}function nW(e,t,n,i,r){const s=[];for(let o=0;o<=r;o++){const a=o/r,l=1-a,c=l*l,u=c*l,h=a*a,d=h*a,f=u*e.lat+3*c*a*t.lat+3*l*h*n.lat+d*i.lat,p=u*e.lng+3*c*a*t.lng+3*l*h*n.lng+d*i.lng;s.push(L.latLng(f,p))}return s}function iW(e,t,n){const i=e.lat-t.lat,r=e.lng-t.lng,s=n.lat-t.lat,o=n.lng-t.lng,a=s*s+o*o;let l,c,u=-1;return 0!==a&&(u=(i*s+r*o)/a),u<0?(l=t.lat,c=t.lng):u>1?(l=n.lat,c=n.lng):(l=t.lat+u*s,c=t.lng+u*o),L.latLng(l,c)}function rW(){const e=window.entryDetectionManager;e&&e.candidates&&(e.candidates.forEach(e=>{if(!e.manual)return;const t=yH.get(e.id);if(!t||0===t.length)return;const n=t[0],i=n.waypoints.map((e,t)=>{let i=0;for(let r=0;r<t;r++)i+=n.waypoints[r].distanceTo(n.waypoints[r+1]);return{lat:e.lat,lng:e.lng,distance:i}});if(vH&&i.length>1)try{const t=document.getElementById("vehicle-select"),n=Tj((null==t?void 0:t.value)||"3500"),r=n?n[1]:3,s=i[i.length-1].distance,o=BW(r,s,i.map(e=>({lat:e.lat,lng:e.lng})));e.calculatedSpeed=o,e.hasCalculatedSpeed=!0}catch(r){}}),sW())}function sW(){const e=window.entryDetectionManager;if(!e||!e.candidates||0===e.candidates.length)return void(dH.size>0&&function(){if(0===dH.size)return;hj(),tH||(tH=L.layerGroup().addTo(eH));const e=[];if(dH.forEach((t,n)=>{t.entryPoints.forEach(i=>{e.push({point:i,streetName:n,threatData:t})})}),0===e.length)return;let t=90,n=-90,i=180,r=-180;e.forEach(({point:e})=>{t=Math.min(t,e.lat),n=Math.max(n,e.lat),i=Math.min(i,e.lon),r=Math.max(r,e.lon)});const s=(t+n)/2,o=(i+r)/2,a=[...e].sort((e,t)=>{const n=e.point.lat,i=e.point.lon,r=t.point.lat,a=t.point.lon;return((90-180*Math.atan2(n-s,i-o)/Math.PI+360)%360-315+360)%360-((90-180*Math.atan2(r-s,a-o)/Math.PI+360)%360-315+360)%360});a.forEach((e,t)=>{var n;const i=t+1,r=`<div style="\n            background-color: ${"#DC143C"};\n            color: white;\n            border-radius: 50%;\n            width: 32px;\n            height: 32px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: bold;\n            font-size: 18px;\n            border: 2px solid white;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        ">${i}</div>`,s=L.marker([e.point.lat,e.point.lon],{icon:L.divIcon({className:"entry-point-marker",html:r,iconSize:[32,32],iconAnchor:[16,16]})});s.on("contextmenu",t=>{if(t.originalEvent.preventDefault(),"nav-threat-analysis"===sH){const t={id:`threat-${e.streetName}-${e.point.lat}-${e.point.lon}`,intersectionPoint:[e.point.lon,e.point.lat],manual:!1,fromThreatsMap:!0};yj(s,t)}});const o=`\n            <div style="min-width: 200px;">\n                <b> Zufahrtspunkt ${i}</b><br>\n                <b>Strae:</b> ${e.streetName}<br>\n                <b>Distanz:</b> ${Math.round(e.point.distance||e.threatData.totalLength)}m<br>\n                <b>Geschwindigkeit:</b> ${e.threatData.maxSpeed||"unbekannt"} km/h\n            </div>\n        `;s.bindPopup(o),null==tH||tH.addLayer(s),hH.has("entry-detection")||hH.set("entry-detection",[]),null==(n=hH.get("entry-detection"))||n.push(s)})}());hj(),tH||(tH=L.layerGroup().addTo(eH));const t=window.currentOsmData,n=new Map;t&&t.ways&&t.ways.forEach(e=>{n.set(e.id,e)});const i=[...e.candidates];if(dH.size>0){const t=new Set(e.candidates.map(e=>{const[t,n]=e.intersectionPoint;return`${n.toFixed(6)},${t.toFixed(6)}`}));dH.forEach((e,n)=>{e.entryPoints.forEach(r=>{const s=`${r.lat.toFixed(6)},${r.lon.toFixed(6)}`;if(!t.has(s)){const o={id:`threat-${n}-${r.lat}-${r.lon}`,intersectionPoint:[r.lon,r.lat],pathNodeIds:[],path:null,distanceMeters:r.distance||e.totalLength,straightness:1,continuity:1,confidence:.8,wayIds:[],manual:!1,fromThreatsMap:!0,streetName:n,threatData:e};i.push(o),t.add(s)}})})}let r=90,s=-90,o=180,a=-180;i.forEach(e=>{const[t,n]=e.intersectionPoint;r=Math.min(r,n),s=Math.max(s,n),o=Math.min(o,t),a=Math.max(a,t)});const l=(r+s)/2,c=(o+a)/2;[...i].sort((e,t)=>{const[n,i]=e.intersectionPoint,[r,s]=t.intersectionPoint;return((90-180*Math.atan2(i-l,n-c)/Math.PI+360)%360-315+360)%360-((90-180*Math.atan2(s-l,r-c)/Math.PI+360)%360-315+360)%360}).forEach((e,t)=>{var i;let r=!1;if(e.wayIds&&e.wayIds.length>0)for(const u of e.wayIds){const e=n.get(u);if(e&&$j(e)){r=!0;break}}const s=!!e.manual,o=t+1,a=`<div style="\n            background-color: ${s||!r||e.hasCalculatedSpeed?"#DC143C":"#FFD700"};\n            color: white;\n            border-radius: 50%;\n            width: 32px;\n            height: 32px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: bold;\n            font-size: 18px; /* Doubled size from 12px -> 24px requested, 18px fits well in 32px */\n            border: 2px solid white;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        ">${o}</div>`,l=L.marker([e.intersectionPoint[1],e.intersectionPoint[0]],{icon:L.divIcon({className:"entry-point-marker",html:a,iconSize:[32,32],iconAnchor:[16,16]})});l.on("contextmenu",t=>{if(t.originalEvent.preventDefault(),"nav-threat-analysis"===sH&&(fH||s)){const n=document.createElement("div");n.className="waypoint-context-menu",n.style.cssText=`\n                    position: absolute;\n                    left: ${t.originalEvent.clientX}px;\n                    top: ${t.originalEvent.clientY}px;\n                    background: white;\n                    border: 1px solid #ccc;\n                    padding: 5px;\n                    border-radius: 4px;\n                    box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n                    z-index: 10000;\n                    min-width: 150px;\n                `;const i=(e,t,n)=>{const i=document.createElement("div");return i.textContent=e,i.style.cssText=`padding: 8px 12px; cursor: pointer; color: ${t}; font-family: sans-serif; font-size: 13px; border-bottom: 1px solid #eee;`,i.onmouseover=()=>i.style.background="#f3f4f6",i.onmouseout=()=>i.style.background="transparent",i.onclick=n,i};n.appendChild(i("Lschen","#dc2626",()=>{_j(l,e),document.body.removeChild(n)})),n.appendChild(i("Abzweigung","#0ea5e9",()=>{qj(0,l),document.body.removeChild(n)})),s&&n.appendChild(i("Pfad zeichnen","#10b981",()=>{Xj(e.id),document.body.removeChild(n)})),document.body.appendChild(n);const r=e=>{n.contains(e.target)||(document.body.contains(n)&&document.body.removeChild(n),document.removeEventListener("click",r))};return void setTimeout(()=>document.addEventListener("click",r),0)}"nav-threat-analysis"===sH&&yj(l,e)});const c=`\n            <div style="min-width: 200px;">\n                <b> Zufahrtspunkt ${o}</b><br>\n                <b>Typ:</b> ${s?"Manuell":r?"Erschlieungsstrae":"Hauptzufahrt"}<br>\n                <b>Confidence:</b> ${Math.round(100*e.confidence)}%<br>\n                <b>Distanz:</b> ${Math.round(e.distanceMeters)}m<br>\n                <b>Geradheit:</b> ${Math.round(100*e.straightness)}%<br>\n                <b>Ways:</b> ${e.wayIds.length}\n            </div>\n        `;l.bindPopup(c),null==tH||tH.addLayer(l),hH.has("entry-detection")||hH.set("entry-detection",[]),null==(i=hH.get("entry-detection"))||i.push(l)})}function oW(e,t,n,i,r){var o;let a=null,l=!1,c=null;const u=null==(o=e.getElement)?void 0:o.call(e);u&&u.classList.add("has-tooltip");const h=()=>{var e;const r=WH(i);return`\n            <div class="product-tooltip">\n                <div class="tooltip-header">\n                    <h4>${t}</h4>\n                    <span class="tooltip-close"></span>\n                </div>\n                <div class="tooltip-content">\n                    <div class="product-image">\n                        <img src="${r}" alt="${i.product_name||i.type||"Produkt"}" \n                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">\n                        <div class="product-image-placeholder" style="display: none;">\n                            <i class="fas fa-image"></i>\n                        </div>\n                    </div>\n                    <div class="product-info">\n                        <h5>${i.product_name||i.type||"Unbekanntes Produkt"}</h5>\n                        <p><strong>Hersteller:</strong> ${i.manufacturer}</p>\n                        <p><strong>Getestete Geschw.:</strong> ${i.speed||i.pr_speed_kph||(null==(e=i.technical_data)?void 0:e.pr_speed_kph)||"N/A"} km/h</p>\n                        <p><strong>Erforderlich:</strong> ${n} km/h</p>\n                        <p><strong>Fahrzeugtyp:</strong> ${i.pr_veh||"N/A"}</p>\n                        <p><strong>Standard:</strong> ${i.standard}</p>\n                    </div>\n                </div>\n                <div class="tooltip-pin-indicator ${l?"pinned":""}">\n                    <i class="fas fa-thumbtack"></i> ${l?"Angepinnt":"Klicken zum Anpinnen"}\n                </div>\n            </div>\n        `};e.on("mouseover",e=>{if(l)return;a=document.createElement("div"),a.className="leaflet-tooltip-pane",a.innerHTML=h(),document.body.appendChild(a);const t=e=>{a&&(a.style.left=`${e.clientX+10}px`,a.style.top=e.clientY-10+"px")};t(e.originalEvent),document.addEventListener("mousemove",t),a.cleanup=()=>{document.removeEventListener("mousemove",t)}}),e.on("mouseout",()=>{l||a&&(a.cleanup&&a.cleanup(),document.body.removeChild(a),a=null)}),e.on("click",async o=>{var u;if(o.originalEvent.stopPropagation(),l){if(l=!1,c&&(eH.closePopup(c),c=null),a){const n=LH.findIndex(e=>e.element===a);-1!==n&&LH.splice(n,1);const i=BH.findIndex(t=>t.marker===e);-1!==i&&BH.splice(i,1);try{const{useTenderSelection:e}=await s(async()=>{const{useTenderSelection:e}=await import("./useTenderSelection-CexbjLyv.js");return{useTenderSelection:e}},[]),n=e.getState().list().find(e=>e.entryLabel===t);n&&e.getState().remove(`${n.entryId}:${n.id}`)}catch(d){}a.cleanup&&a.cleanup(),document.body.removeChild(a),a=null}}else{l=!0,a&&!a.classList.contains("pinned-tooltip")&&(a.cleanup&&a.cleanup(),document.body.removeChild(a),a=null);const o=h(),p=e.getLatLng?e.getLatLng():e._latlng||e.latlng||{lat:0,lng:0};if(!p||"number"!=typeof p.lat||"number"!=typeof p.lng)return;try{const e=eH.getCenter(),t=eH.getZoom();c=L.popup({closeButton:!0,autoClose:!1,closeOnClick:!1,className:"product-popup",offset:[10,-10]}).setLatLng(p).setContent(o),c.addTo(eH),setTimeout(()=>{eH&&e&&"number"==typeof t&&eH.setView(e,t,{animate:!1})},10);const n=c._animateZoom;c._animateZoom=function(e){try{if(this._latlng&&this._latlng.lat&&this._latlng.lng)return n.call(this,e)}catch(t){}}}catch(f){return}BH.push({streetName:t,maxSpeed:n,product:i,marker:e});try{const{useTenderSelection:e}=await s(async()=>{const{useTenderSelection:e}=await import("./useTenderSelection-CexbjLyv.js");return{useTenderSelection:e}},[]),o=void 0!==r?`${t}-${r}`:`${t}-${Date.now()}`,a=i.id||i.product_name||String(Date.now()),l=`${o}:${a}`;e.getState().items[l]||e.getState().add({id:a,name:i.product_name||"Unbekannt",entryId:o,entryLabel:t,requiredSpeedKmh:n,standards:Array.isArray(i.standard)?i.standard:(null==(u=i.technical_data)?void 0:u.standard)?[i.technical_data.standard]:[],image:i.product_image_file||void 0,raw:i})}catch(d){}c.on("remove",async()=>{l=!1,c=null;const n=BH.findIndex(t=>t.marker===e);-1!==n&&BH.splice(n,1);try{const{useTenderSelection:e}=await s(async()=>{const{useTenderSelection:e}=await import("./useTenderSelection-CexbjLyv.js");return{useTenderSelection:e}},[]),n=e.getState().list().find(e=>e.entryLabel===t);n&&e.getState().remove(`${n.entryId}:${n.id}`)}catch(d){}})}})}function aW(e,t,n,i){let r=`Basierend auf dem zu schtzenden Objekt "${t}", dem Standortkontext "${n}" und dem durchschnittlichen Bedrohungslevel von ${i.toFixed(1)}/10 werden folgende Produkttypen empfohlen:\n\n`;return e.forEach(e=>{switch(e){case"Tor":r+=" Tor: Geeignet fr kontrollierte Zufahrten mit hohem Sicherheitsbedarf. Ermglicht selektiven Zugang fr autorisierte Fahrzeuge.\n";break;case"Schranke":r+=" Schranke: Ideal fr industrielle Bereiche mit hufigem, aber kontrolliertem Fahrzeugverkehr. Bietet schnelle Durchfahrtskontrolle.\n";break;case"Zaun":r+=" Zaun: Permanente Perimetersicherung fr Bereiche mit erhhtem Sicherheitsbedarf. Verhindert unbefugtes Eindringen.\n";break;case"Poller":r+=" Poller: Diskrete Lsung fr ffentliche Bereiche. Ermglicht Fugngerverkehr bei gleichzeitigem Fahrzeugschutz.\n";break;case"Durchfahrtsperre":r+=" Durchfahrtsperre: Flexible temporre Lsung fr Events oder vernderliche Sicherheitsanforderungen.\n"}}),r}function lW(){const e=Array.from(dH.entries());if(0===e.length)return"Keine Bedrohungen erkannt.";const t=e.filter(([,e])=>(e.threatLevel||5)>=9),n=e.filter(([,e])=>(e.threatLevel||5)>=7&&(e.threatLevel||5)<9),i=e.filter(([,e])=>(e.threatLevel||5)>=5&&(e.threatLevel||5)<7),r=e.filter(([,e])=>(e.threatLevel||5)<5);let s=`Gesamtanzahl identifizierter Zufahrten: ${e.length}\n`;return s+=`Kritische Bedrohungen (Level 9-10): ${t.length}\n`,s+=`Hohe Bedrohungen (Level 7-8): ${n.length}\n`,s+=`Mittlere Bedrohungen (Level 5-6): ${i.length}\n`,s+=`Niedrige Bedrohungen (Level 1-4): ${r.length}\n`,s}function cW(){const e=Array.from(dH.entries()).filter(([,e])=>e.threatLevel&&e.threatLevel>=7).sort((e,t)=>(t[1].threatLevel||0)-(e[1].threatLevel||0)).slice(0,5);return 0===e.length?"Keine Hochrisiko-Zufahrten identifiziert.":e.map(([e,t])=>`${e}: Level ${t.threatLevel}/10 (${t.roadType}, ${t.maxSpeed} km/h, ${Math.round(t.totalLength)}m Beschleunigungsstrecke)`).join("\n")}function uW(){const e=Array.from(dH.values());if(0===e.length)return"Keine Daten verfgbar.";const t={},n={unter_30:0,"30_50":0,"50_80":0,"ber_80":0};e.forEach(e=>{const i=e.roadType||"unbekannt";t[i]=(t[i]||0)+1;const r=e.maxSpeed||50;r<30?n.unter_30++:r<=50?n["30_50"]++:r<=80?n["50_80"]++:n.ber_80++});let i="Straentyp-Verteilung:\n";return Object.entries(t).forEach(([e,t])=>{i+=`- ${e}: ${t}\n`}),i+="\nGeschwindigkeits-Verteilung:\n",i+=`- Unter 30 km/h: ${n.unter_30}\n`,i+=`- 30-50 km/h: ${n["30_50"]}\n`,i+=`- 50-80 km/h: ${n["50_80"]}\n`,i+=`- ber 80 km/h: ${n.ber_80}\n`,i}function hW(){eH&&eH.eachLayer(e=>{e instanceof L.Popup&&("product-popup"===e.options.className||"product-popup no-product-popup"===e.options.className)&&eH.closePopup(e)});document.querySelectorAll(".pinned-tooltip").forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)});document.querySelectorAll(".leaflet-tooltip-pane:not(.pinned-tooltip)").forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),LH=[],BH=[]}function dW(){eH&&eH.latLngToContainerPoint&&LH.forEach((e,t)=>{try{const{element:t,marker:n,latLng:i}=e;if(!i||"number"!=typeof i.lat||"number"!=typeof i.lng)return;const r=eH.latLngToContainerPoint(i),s=eH.getContainer().getBoundingClientRect(),o=`${s.left+r.x+10}px`,a=s.top+r.y-10+"px";t.style.left=o,t.style.top=a}catch(n){}})}function fW(e){return ij(e<33?"sidebar.low":e<66?"products.resistanceMedium":"sidebar.high")}function pW(){var e,t;const n=document.getElementById("hazard-city"),i=document.getElementById("hazard-area"),r=document.getElementById("hazard-expected-damage");if(!n&&!i&&!r)return null;const s=(null==(e=null==n?void 0:n.value)?void 0:e.trim())||"",o=(null==(t=null==i?void 0:i.value)?void 0:t.trim())||"",a=(null==r?void 0:r.value)||"",l={sachschaden:"gering (Sachschden)",leicht:"leichte Personenschden",schwer:"schwere Personenschden",massenopfer:"viele Tote / Massenopfer"}[a]||a,c=[{id:"hazard-anlass-allgemeingebrauch",category:"Anlassbezogene Belange",label:"Stadtrumlicher Allgemeingebrauch",question:"Wie stark wird der Raum im Alltag von der Allgemeinheit genutzt?"},{id:"hazard-anlass-sondernutzung",category:"Anlassbezogene Belange",label:"Stadtrumliche Sondernutzung",question:"Finden im Raum regelmig Sondernutzungen statt (z. B. Veranstaltungen, Mrkte)?"},{id:"hazard-anlass-haeufigkeit",category:"Anlassbezogene Belange",label:"Hufigkeit der Sondernutzung",question:"Wie hufig finden Sondernutzungen im betrachteten Raum statt?"},{id:"hazard-anlass-zusammensetzung",category:"Anlassbezogene Belange",label:"Zusammensetzung der Nutzer",question:"Welche Nutzergruppen halten sich berwiegend im Raum auf?"},{id:"hazard-anlass-anzahl",category:"Anlassbezogene Belange",label:"Anzahl der Nutzer",question:"Wie viele Personen nutzen den Raum typischerweise gleichzeitig?"},{id:"hazard-raum-struktur",category:"Rumliche Belange",label:"Bauliche Struktur des Raumes",question:"Erleichtert die bauliche Struktur des Raumes eine Annherung von Fahrzeugen?"},{id:"hazard-raum-gebaeude",category:"Rumliche Belange",label:"Besondere Gebude",question:"Gibt es besonders schutzwrdige Gebude im unmittelbaren Umfeld?"},{id:"hazard-raum-flucht-nutzer",category:"Rumliche Belange",label:"Fluchtoptionen fr Nutzer",question:"Sind ausreichende Fluchtwege fr die anwesenden Personen vorhanden?"},{id:"hazard-raum-flaeche",category:"Rumliche Belange",label:"Flchengre",question:"Wie gro ist die Flche des betrachteten Raumes?"},{id:"hazard-raum-dichte",category:"Rumliche Belange",label:"Besucherdichte",question:"Wie hoch ist die typische Besucherdichte im Raum?"},{id:"hazard-security-bedeutung-raum",category:"Weitere Sicherheitsbelange",label:"Bedeutung des ffentlichen Raumes",question:"Welche symbolische oder gesellschaftliche Bedeutung hat der Raum?"},{id:"hazard-security-massnahmen-baulich",category:"Weitere Sicherheitsbelange",label:"Erkennbare Sicherheitsmanahmen",question:"Sind bereits bauliche oder technische Sicherheitsmanahmen erkennbar vorhanden?"},{id:"hazard-security-massnahmen-personell",category:"Weitere Sicherheitsbelange",label:"Erkennbare personelle Sicherheitsmanahmen",question:"Gibt es regelmig sichtbare Prsenz von Sicherheitskrften?"},{id:"hazard-tat-anfahrtsoptionen",category:"Tatbeeinflussende Belange",label:"Anfahrtsoptionen fr potentielle Tter",question:"Wie gut knnen Tter den Bereich mit einem Fahrzeug anfahren?"},{id:"hazard-tat-fluchtmoeglichkeiten",category:"Tatbeeinflussende Belange",label:"Fluchtmglichkeiten fr potentielle Tter",question:"Welche Fluchtmglichkeiten bestnden fr Tter nach einer Tat?"},{id:"hazard-tat-auswirkung",category:"Tatbeeinflussende Belange",label:"Auswirkung",question:"Wie gravierend wren die Wirkungen eines Fahrzeugangriffs im Raum?"},{id:"hazard-tat-ziele",category:"Tatbeeinflussende Belange",label:"Zustzliche Tatziele",question:"Gibt es in unmittelbarer Nhe weitere potenzielle Tatziele?"},{id:"hazard-tat-varianten",category:"Tatbeeinflussende Belange",label:"Zustzliche Tatvarianten",question:"Sind besondere Tatvarianten denkbar (z. B. alternative Routen, zeitliche Besonderheiten)?"}].map(e=>{const t=document.getElementById(e.id),n=(null==t?void 0:t.value)||"",i=n?parseInt(n,10):NaN;return{...e,value:Number.isFinite(i)?i:null}}),u=c.filter(e=>null!==e.value),h=u.reduce((e,t)=>e+(t.value||0),0);return{city:s,area:o,expectedDamage:a,expectedDamageLabel:l,factors:c,totalScore:h,maxPossibleScore:3*c.length,averageScore:u.length>0?h/u.length:0}}window.getHazardAnalysisFormData=pW;const gW=[{id:"kleinwagen",name:"Kleinwagen",mass:1200,acceleration:2.75},{id:"mittelklasse",name:"Mittelklasse-Pkw",mass:1500,acceleration:3.2},{id:"fullsize",name:"Full-Size-Pkw/Van",mass:1800,acceleration:3.7},{id:"sportwagen",name:"Performance-/Sportwagen",mass:1600,acceleration:5},{id:"pickup",name:"Pick-up",mass:2500,acceleration:2.5},{id:"transporter",name:"Transporter/Flatbed",mass:3500,acceleration:1.9},{id:"lkw_7t",name:"Lkw 7,5t",mass:7200,acceleration:2},{id:"lkw_12t",name:"Lkw 12t",mass:12e3,acceleration:1.25},{id:"lkw_30t",name:"Lkw 30t",mass:3e4,acceleration:.75}],mW={E1:{max:250,label:"E1 (niedrig)",protection:"einfache Sperren"},E2:{max:800,label:"E2 (mittel, SK1)",protection:"SK1-Barrieren"},E3:{max:1950,label:"E3 (hoch, SK2)",protection:"SK2-Barrieren"},E4:{label:"E4 (sehr hoch)",protection:"Hochsicherheitsbarrieren"}};function yW(e,t,n){return e*t*n/1e3}function vW(e){return e<mW.E1.max?{level:"E1",label:mW.E1.label,protection:mW.E1.protection}:e<mW.E2.max?{level:"E2",label:mW.E2.label,protection:mW.E2.protection}:e<mW.E3.max?{level:"E3",label:mW.E3.label,protection:mW.E3.protection}:{level:"E4",label:mW.E4.label,protection:mW.E4.protection}}function _W(e){switch(e){case"E4":case"E3":return{category:"A",description:"hochkritisch",requirement:"SK2-Hochsicherheitsbarrieren"};case"E2":return{category:"B",description:"mittlerer Schutzbedarf",requirement:"SK1-Barrieren"};default:return{category:"C",description:"energetisch gering",requirement:"einfache Sperren"}}}function bW(){const e=Array.from(dH.entries());if(0===e.length)return"Keine Zufahrten fr fahrdynamische Analyse verfgbar.";const t=[];return t.push("FAHRDYNAMISCHE ANALYSE JE ZUFAHRT UND FAHRZEUGKLASSE:"),t.push(""),e.forEach(([e,n])=>{const i=n.totalLength||50;t.push("Zufahrt: "+e+" (Anfahrtsstrecke: "+Math.round(i)+" m)");let r=0,s="";gW.forEach(e=>{const n=Cj(e.acceleration,i),o=yW(e.mass,e.acceleration,i),a=vW(o);t.push("  - "+e.name+": v="+n.toFixed(0)+" km/h, E="+o.toFixed(0)+" kJ ("+a.label+")"),o>r&&(r=o,s=e.name)});const o=vW(r),a=_W(o.level);t.push("   Worst Case: "+s+" mit E_max="+r.toFixed(0)+" kJ"),t.push("   Energiestufe: "+o.label+", Schutzkategorie: "+a.category+" ("+a.description+")"),t.push("")}),t.join("\n")}function EW(){const e=Array.from(dH.entries());if(0===e.length)return"Keine Zufahrten fr Energieklassifizierung verfgbar.";const t={A:[],B:[],C:[]},n=[];n.push("WORST-CASE-TABELLE (Maximalenergien je Zufahrt):"),n.push("Zufahrt | Strecke [m] | E_max [kJ] | Energiestufe | Kategorie | Schutzklasse"),n.push("--------|-------------|------------|--------------|-----------|-------------"),e.forEach(([e,i])=>{const r=i.totalLength||50;let s=0;gW.forEach(e=>{const t=yW(e.mass,e.acceleration,r);t>s&&(s=t)});const o=vW(s),a=_W(o.level);t[a.category].push(e),n.push(e.substring(0,20).padEnd(20)+" | "+Math.round(r).toString().padStart(5)+" | "+s.toFixed(0).padStart(10)+" | "+o.level.padEnd(12)+" | "+a.category.padEnd(9)+" | "+a.requirement)});const i=[];return i.push(n.join("\n")),i.push(""),i.push("KATEGORISIERUNG NACH SCHUTZBEDARF:"),i.push("Kategorie A (hochkritisch, SK2): "+(t.A.length>0?t.A.join(", "):"keine")),i.push("Kategorie B (mittel, SK1): "+(t.B.length>0?t.B.join(", "):"keine")),i.push("Kategorie C (gering, einfache Sperren): "+(t.C.length>0?t.C.join(", "):"keine")),i.join("\n")}function wW(){const e=pW();if(!e)return"Es wurden keine expliziten Daten zur Gefhrdungsanalyse in der Eingabemaske erfasst.";const t=[];if(e.city||e.area){const n=[e.city,e.area].filter(Boolean).join("  ");t.push(`Betrachteter Raum: ${n}`)}e.expectedDamageLabel&&t.push(`Erwartetes Schadensausma: ${e.expectedDamageLabel}`);const n=e.factors.filter(e=>null!==e.value);if(n.length>0){t.push(""),t.push("Bewertete Belange (Skala: 1 = geringe Ausprgung, 2 = mittlere Ausprgung, 3 = starke Ausprgung):");const i=[...new Set(n.map(e=>e.category))];i.forEach(e=>{const i=n.filter(t=>t.category===e);i.length>0&&(t.push(`\n${e}:`),i.forEach(e=>{t.push(`  - ${e.label}: Bewertung ${e.value}`)}))}),t.push(""),t.push(`Gesamtpunktzahl: ${e.totalScore} von maximal ${e.maxPossibleScore} Punkten`),t.push(`Durchschnittliche Bewertung: ${e.averageScore.toFixed(1)}`);let r="";r=e.averageScore<=1.5?"NIEDRIG":e.averageScore<=2?"MITTEL":e.averageScore<=2.5?"ERHHT":"HOCH",t.push(`Gefhrdungseinstufung basierend auf Bewertungsmatrix: ${r}`)}else t.push("Keine Bewertungsfaktoren wurden ausgefllt.");return t.join("\n")}async function xW(){var e,t;const n=document.getElementById("report-iframe"),i=document.querySelector(".report-loading-overlay"),r=document.getElementById("download-report-btn"),o=document.getElementById("map"),a=document.getElementById("report-preview-area");i.classList.remove("view-hidden"),r.disabled=!0;let l=null;const c=new Date;try{if(lH){if(!lH.getLatLngs||"function"!=typeof lH.getLatLngs)throw new Error("Invalid polygon data for map capture");const e=lH.getLatLngs();if(!e||0===e.length)throw new Error("Polygon has no valid coordinates");a.classList.add("view-hidden"),o.classList.remove("view-hidden"),await new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("Map rendering timeout"))},1e4),i=()=>{clearTimeout(n);const t="de"===NH?1e3:500;requestAnimationFrame(()=>setTimeout(e,t))};let r;eH.invalidateSize(),eH.once("moveend",()=>{r=window.setTimeout(i,1500)}),setTimeout(()=>{i()},3e3);try{const e=lH.getBounds();e&&e.isValid()?eH.fitBounds(e,{animate:!1,padding:[20,20]}):eH.setView(eH.getCenter(),eH.getZoom())}catch(s){}}),await new Promise(e=>setTimeout(e,500)),l=await html2canvas(o,{useCORS:!0,logging:!0,allowTaint:!0,backgroundColor:"#ffffff",scale:2,width:o.offsetWidth,height:o.offsetHeight,onclone:e=>{e.querySelectorAll(".leaflet-popup-pane > *").forEach(e=>{e.style.display="none"});const t=e.getElementById("map");t&&(t.style.visibility="visible",t.style.opacity="1",t.style.display="block");const n=e.querySelector(".leaflet-container");n&&(n.style.visibility="visible",n.style.opacity="1")}})}l&&l.width>0&&l.height>0||(l=null);const i=lH?await Gj(lH.getBounds().getCenter()):ij("report.undefinedLocation"),h=window.planningState||{},d=h.schutzgter||h.schutzgueter||ij("report.undefinedAsset");let f="OpenStreetMap";try{const{getCurrentProviderId:e}=await s(async()=>{const{getCurrentProviderId:e}=await import("./mapIntegration-Gh_eCX7z.js");return{getCurrentProviderId:e}},[]);f="nrw"===e()?"GEOBASIS.NRW":"OpenStreetMap"}catch(u){}const p=c.toLocaleDateString("de"===NH?"de-DE":"en-US");let g=ij("report.noThreatAnalysis");if(dH.size>0){const e=document.getElementById("vehicle-select"),t=Tj(e.value),n=Array.from(dH.entries()).map(([e,n])=>{const i=Math.round(n.totalLength);let r=0;if(t&&i>0){const[,e]=t;r=Math.round(BW(e,i))}return{name:e,lengthInMeters:i,maxSpeed:r}});n.sort((e,t)=>t.maxSpeed-e.maxSpeed),g=n.map(e=>{const t=e.maxSpeed>0?` | ${ij("threats.speed")}: ${e.maxSpeed} km/h`:"";return`- ${e.name}: ${e.lengthInMeters} m${t}`}).join("\n")}const m=document.getElementById("security-risk-slider"),y=document.getElementById("product-class-slider"),v=document.getElementById("protection-period-select"),_=document.getElementById("protection-product-select"),b=function(){const e=document.getElementById("vehicle-select"),t=parseInt(e.value,10);if(isNaN(t))return null;let n=null,i=1/0;for(const r of MH){const e=parseInt(r.vehicleWeight,10),s=parseFloat(r.penetration);!isNaN(e)&&!isNaN(s)&&e>=t&&s<i&&(i=s,n=r)}return n}(),E={locationName:i,assetToProtect:d,securityLevel:fW(parseInt(m.value)),protectionGrade:fW(parseInt(y.value)),threatList:g,protectionPeriod:v.options[v.selectedIndex].text,productType:_.options[_.selectedIndex].text,penetration:b?b.penetration:ij("report.undefinedValue"),debrisDistance:b&&b.debrisDistance||ij("report.undefinedValue")},w=await Fj(E);if(!w)throw new Error("AI did not return report sections.");const{jsPDF:x}=window.jspdf,A=new x({orientation:"p",unit:"mm",format:"a4"}),S=()=>{const e=A.internal.pageSize.getWidth(),t=A.internal.pageSize.getHeight();if(A.saveGraphicsState(),A.setFont("helvetica","bold"),A.setFontSize(120),A.setTextColor(200,200,200),x.GState){const e=new x.GState({opacity:.2});A.setGState(e)}A.text(ij("report.watermark"),e/2+50,t/2+50,{align:"center",angle:45}),A.restoreGraphicsState()},T=20,C=A.internal.pageSize.getWidth(),I=C-2*T;let k=25;const R=(e,t)=>{k>250&&(A.addPage(),S(),k=25),A.setFont("helvetica","bold").setFontSize(14).text(ij(e),T,k),k+=7;const n=jV(t,!1),i=A.setFont("helvetica","normal").setFontSize(11).splitTextToSize(n,I);k+5*i.length>280&&(A.addPage(),S(),k=25),A.text(i,T,k),k+=5*i.length+10};S();const P=pW(),M=(null==P?void 0:P.area)||d,L=i.split(",")[0].trim();A.setFont("helvetica","bold").setFontSize(14),A.text(L,C/2,k,{align:"center"}),k+=20,A.setFont("helvetica","bold").setFontSize(20);const B="de"===NH?"Risikobewertung Zufahrtsschutz":"Risk Assessment Access Protection";A.text(B,C/2,k,{align:"center"}),k+=10,A.setFont("helvetica","bold").setFontSize(16);const N=`${M} ${(new Date).getFullYear()}`;A.text(N,C/2,k,{align:"center"}),k+=15,A.setFont("helvetica","italic").setFontSize(11);const O="de"===NH?"Gutachten zur fahrdynamischen Gefhrdungsanalyse, Schutzzieldefinition und Planung von Fahrzeugsicherheitsbarrieren":"Expert Report on Vehicle Dynamics Hazard Analysis, Protection Goal Definition and Planning of Vehicle Security Barriers";A.splitTextToSize(O,I-20).forEach(e=>{A.text(e,C/2,k,{align:"center"}),k+=6}),k+=20,A.setDrawColor(30,144,255).setLineWidth(1).line(T+20,k,C-T-20,k),k+=25,A.setFont("helvetica","normal").setFontSize(10);("de"===NH?["Erstellt durch: BarricadiX GmbH","Bearbeiter: Automatisierte Analyse","Auftraggeber: [Kommune / Veranstalter]",`Aktenzeichen: BX-${(new Date).getFullYear()}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`,`Datum: ${p}`,"Version: 1.0 (Entwurf)"]:["Created by: BarricadiX GmbH","Analyst: Automated Analysis","Client: [Municipality / Organizer]",`Reference: BX-${(new Date).getFullYear()}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`,`Date: ${p}`,"Version: 1.0 (Draft)"]).forEach(e=>{A.text(e,C/2,k,{align:"center"}),k+=6}),k+=30,A.setFont("helvetica","italic").setFontSize(9);const D="de"===NH?"Dieses Gutachten ersetzt keine hoheitliche Gefhrdungsbewertung der zustndigen Sicherheitsbehrden.":"This report does not replace a sovereign threat assessment by the competent security authorities.";A.splitTextToSize(D,I-40).forEach(e=>{A.text(e,C/2,k,{align:"center"}),k+=5}),A.addPage(),S(),k=25,A.setFont("helvetica","bold").setFontSize(14);const F="de"===NH?"Kurzfassung fr Entscheidungstrger":"Executive Summary";A.text(F,T,k),k+=10,A.setDrawColor(30,144,255).setLineWidth(.5).line(T,k,C-T,k),k+=10;const U=Array.from(dH.entries()),z=U.length>0?U.reduce((e,[,t])=>e+(t.threatLevel||5),0)/U.length:5;let G=0,V=0,H=0;U.forEach(([,e])=>{const t=22500*(e.totalLength||50)/1e3;t>=800?G++:t>=250?V++:H++}),A.setFont("helvetica","normal").setFontSize(10);("de"===NH?[`Gegenstand: Risikobewertung Zufahrtsschutz fr ${M} in ${L}`,"","Ergebnis der Analyse:",` ${U.length} Zufahrten wurden identifiziert und fahrdynamisch bewertet`,` Durchschnittliches Bedrohungsniveau: ${z.toFixed(1)}/10`,` Abgeleiteter Sicherungsgrad: ${E.protectionGrade}`,"","Kategorisierung nach Schutzbedarf:",` Kategorie A (hochkritisch, SK2 erforderlich): ${G} Zufahrten`,` Kategorie B (mittel, SK1 ausreichend): ${V} Zufahrten`,` Kategorie C (gering, einfache Sperren): ${H} Zufahrten`,"","Empfehlung:","Mit der Umsetzung der empfohlenen SK1-/SK2-Manahmen und eines abgestimmten","Betriebskonzepts kann das Risiko auf ein ALARP-konformes Niveau reduziert werden.","Die Detailplanung und Produktauswahl sollte in Abstimmung mit den zustndigen","Sicherheitsbehrden erfolgen."]:[`Subject: Risk Assessment Access Protection for ${M} in ${L}`,"","Analysis Results:",` ${U.length} access routes were identified and assessed for vehicle dynamics`,` Average threat level: ${z.toFixed(1)}/10`,` Derived protection grade: ${E.protectionGrade}`,"","Categorization by Protection Requirement:",` Category A (highly critical, SK2 required): ${G} access routes`,` Category B (medium, SK1 sufficient): ${V} access routes`,` Category C (low, simple barriers): ${H} access routes`,"","Recommendation:","With the implementation of the recommended SK1/SK2 measures and a coordinated","operational concept, the risk can be reduced to an ALARP-compliant level.","Detailed planning and product selection should be coordinated with the","competent security authorities."]).forEach(e=>{k>270&&(A.addPage(),S(),k=25),A.text(e,T,k),k+=6}),k+=10,A.setFont("helvetica","bold").setFontSize(10);const j="de"===NH?"Risiko-Ampel:":"Risk Traffic Light:";A.text(j,T,k),k+=8;const W=50,$=15,X=10;let q=T;A.setFillColor(220,53,69),A.rect(q,k,W,$,"F"),A.setTextColor(255,255,255),A.setFont("helvetica","bold").setFontSize(9),A.text(`A: ${G}`,q+W/2,k+$/2+3,{align:"center"}),q+=W+X,A.setFillColor(255,193,7),A.rect(q,k,W,$,"F"),A.setTextColor(0,0,0),A.text(`B: ${V}`,q+W/2,k+$/2+3,{align:"center"}),q+=W+X,A.setFillColor(40,167,69),A.rect(q,k,W,$,"F"),A.setTextColor(255,255,255),A.text(`C: ${H}`,q+W/2,k+$/2+3,{align:"center"}),A.setTextColor(0,0,0),k+=$+20,A.addPage(),S(),k=25;const K=w.chapter1_auftrag||w.purpose||"";K&&R("report.sections.chapter1.title",K);const Y=w.chapter2_normen||"";Y&&R("report.sections.chapter2.title",Y);const J=w.chapter3_bereich||"";J&&R("report.sections.chapter3.title",J);const Z=w.chapter4_bedrohung||w.threatAnalysis||"";if(Z&&R("report.sections.chapter4.title",Z),dH.size>0){k-=5;const e=jV(ij("report.threatListIntro"),!1),t=A.setFont("helvetica","italic").setFontSize(10).splitTextToSize(e,I),n=5*t.length;k+n>280&&(A.addPage(),S(),k=25),A.text(t,T,k),k+=n+4,A.setFont("helvetica","normal").setFontSize(11);const i=document.getElementById("vehicle-select"),r=Tj(i.value),s=5.2,o=4;dH.forEach((e,t)=>{let n=` ${t} (${Math.round(e.totalLength)} m)`;if(r&&e.totalLength>0){const[t,i]=r,s=Math.round(BW(t,e.totalLength)),o=Math.round(BW(i,e.totalLength));n+=` | ${ij("threats.speed")}: ${s}-${o} km/h`}const i=jV(n,!1),a=A.splitTextToSize(i,I-10),l=a.length*s;k+l>280&&(A.addPage(),S(),k=25),A.text(a,T+5,k),k+=l+o}),k+=6}const Q=w.chapter5_methodik||"";Q&&R("report.sections.chapter5.title",Q);const ee=w.chapter6_fahrdynamik||"";ee&&R("report.sections.chapter6.title",ee);const te=w.chapter7_risiko||w.vulnerabilities||"";te&&R("report.sections.chapter7.title",te);const ne=w.chapter8_schutzziel||"";ne&&R("report.sections.chapter8.title",ne);const ie=w.chapter9_konzept||w.hvmMeasures||"";if(ie&&R("report.sections.chapter9.title",ie),l){const e=l.height/l.width,t=I*e;k+t>280&&(A.addPage(),S(),k=25),A.addImage(l,"PNG",T,k,I,t),k+=t+10}else{const e=ij("report.noMapAvailable"),t=A.setFont("helvetica","italic").setFontSize(10).splitTextToSize(e,I);k+5*t.length>280&&(A.addPage(),S(),k=25),A.text(t,T,k),k+=5*t.length+10}const re=w.chapter10_restgefahren||w.siteConsiderations||"";re&&R("report.sections.chapter10.title",re);const se=w.chapter11_empfehlung||w.operationalImpact||"";if(se&&R("report.sections.chapter11.title",se),dH.size>0){A.addPage(),S(),k=25,A.setFont("helvetica","bold").setFontSize(14);const e="de"===NH?"Anhang A: Fahrdynamische Detailtabellen":"Appendix A: Vehicle Dynamics Detail Tables";A.text(e,T,k),k+=8,A.setDrawColor(30,144,255).setLineWidth(.5).line(T,k,C-T,k),k+=10,A.setFont("helvetica","normal").setFontSize(9);const t="de"===NH?"Die folgenden Tabellen zeigen die fahrdynamischen Berechnungen fr jede identifizierte Zufahrt und alle betrachteten Fahrzeugklassen. Berechnung: v = (2as) [km/h], E = mas [kJ]":"The following tables show the vehicle dynamics calculations for each identified access route and all considered vehicle classes. Calculation: v = (2as) [km/h], E = mas [kJ]",n=A.splitTextToSize(t,I);A.text(n,T,k),k+=4*n.length+8;Array.from(dH.entries()).forEach(([e,t],n)=>{const i=t.totalLength||50;k>200&&(A.addPage(),S(),k=25),A.setFont("helvetica","bold").setFontSize(10);const r="de"===NH?"A."+(n+1)+" Zufahrt: "+e+" (s = "+Math.round(i)+" m)":"A."+(n+1)+" Access: "+e+" (s = "+Math.round(i)+" m)";A.text(r,T,k),k+=6,A.setFont("helvetica","bold").setFontSize(8);const s=[45,25,25,25,25,35];let o=T;("de"===NH?["Fahrzeugklasse","m [kg]","a [m/s]","v [km/h]","E [kJ]","Energiestufe"]:["Vehicle Class","m [kg]","a [m/s]","v [km/h]","E [kJ]","Energy Level"]).forEach((e,t)=>{A.text(e,o,k),o+=s[t]}),k+=4,A.setDrawColor(100,100,100).setLineWidth(.2),A.line(T,k,T+s.reduce((e,t)=>e+t,0),k),k+=3,A.setFont("helvetica","normal").setFontSize(8);let a=0,l="";[{name:"Kleinwagen",mass:1200,acc:2.75},{name:"Mittelklasse",mass:1500,acc:3.2},{name:"Full-Size/Van",mass:1800,acc:3.7},{name:"Sportwagen",mass:1600,acc:5},{name:"Pick-up",mass:2500,acc:2.5},{name:"Transporter",mass:3500,acc:1.9},{name:"Lkw 7,5t",mass:7200,acc:2},{name:"Lkw 12t",mass:12e3,acc:1.25},{name:"Lkw 30t",mass:3e4,acc:.75}].forEach(e=>{const t=3.6*Math.sqrt(2*e.acc*i),n=e.mass*e.acc*i/1e3;let r="E1";n>=1950?r="E4":n>=800?r="E3":n>=250&&(r="E2"),n>a&&(a=n,l=e.name),o=T;[e.name,e.mass.toString(),e.acc.toFixed(2),t.toFixed(0),n.toFixed(0),r].forEach((e,t)=>{A.text(e,o,k),o+=s[t]}),k+=4}),k+=2,A.setFont("helvetica","bold").setFontSize(8);let c="E1";a>=1950?c="E4":a>=800?c="E3":a>=250&&(c="E2");const u=" Worst Case: "+l+", E_max = "+a.toFixed(0)+" kJ ("+c+")";A.text(u,T,k),k+=12}),k>240&&(A.addPage(),S(),k=25),A.setFont("helvetica","bold").setFontSize(9);const i="de"===NH?"Legende Energiestufen:":"Energy Level Legend:";A.text(i,T,k),k+=5,A.setFont("helvetica","normal").setFontSize(8);("de"===NH?["E1 (< 250 kJ): Niedriges Energieniveau  einfache Sperren ausreichend","E2 (250800 kJ): Mittleres Energieniveau  SK1-Barrieren empfohlen","E3 (8001.950 kJ): Hohes Energieniveau  SK2-Barrieren erforderlich","E4 ( 1.950 kJ): Sehr hohes Energieniveau  Hochsicherheitsbarrieren erforderlich"]:["E1 (< 250 kJ): Low energy level  simple barriers sufficient","E2 (250800 kJ): Medium energy level  SK1 barriers recommended","E3 (8001,950 kJ): High energy level  SK2 barriers required","E4 ( 1,950 kJ): Very high energy level  high security barriers required"]).forEach(e=>{A.text(e,T,k),k+=4})}try{const t=A.getNumberOfPages||(null==(e=A.internal)?void 0:e.getNumberOfPages),n="function"==typeof t?t.call(A):1;for(let e=1;e<=n;e++)A.setPage(e),S()}catch(dy){S()}a.classList.remove("view-hidden"),o.classList.add("view-hidden"),await new Promise(requestAnimationFrame);try{const e=A.output("blob");xH&&URL.revokeObjectURL(xH),xH=URL.createObjectURL(e),n.src=xH}catch(dy){n.src=A.output("datauristring")}wH=A;const oe=i.split(",")[0].trim().replace(/[<>:"/\\|?*]/g,""),ae=(null==(t=null==P?void 0:P.area)?void 0:t.trim().replace(/[<>:"/\\|?*]/g,""))||"",le=c.toLocaleDateString("de-DE").replace(/\./g,"-"),ce=["Risikobericht",oe];ae&&ae.length>0&&ce.push(ae),ce.push(le),AH=ce.join("_").replace(/\s+/g,"-")+".pdf",r.disabled=!1}catch(u){alert(ij("alerts.reportCreationError")),o.classList.add("view-hidden"),a.classList.remove("view-hidden")}finally{i.classList.add("view-hidden")}}function AW(){if(wH){const e=AH||ij("report.reportFilename");wH.save(e)}else alert(ij("alerts.noReportToDownload"))}async function SW(){if(SH){const e=lH?await Gj(lH.getBounds().getCenter()):"Standort";let t=e.split(",")[0].trim();if(t=t.replace(/^\d{5}\s+/,""),!t||/^\d+$/.test(t)){const n=e.split(",");t=n[1]?n[1].trim():"Standort"}(!t||t.length<2)&&(t="Standort");const n=(new Date).toISOString().split("T")[0];SH.save(`Ausschreibung_Zufahrtschutz_${t}_${n}.pdf`)}else alert("Es wurde noch keine Ausschreibung erstellt, die heruntergeladen werden knnte.")}async function TW(){const e=document.getElementById("tender-iframe"),t=document.querySelector(".report-loading-overlay"),n=document.getElementById("map"),i=document.getElementById("tender-preview-area"),r=document.getElementById("download-tender-btn");r&&(r.disabled=!0),t&&t.classList.remove("view-hidden");try{const{useTenderSelection:o}=await s(async()=>{const{useTenderSelection:e}=await import("./useTenderSelection-CexbjLyv.js");return{useTenderSelection:e}},[]),a=o.getState().list();if(0===a.length)return alert("Bitte pinnen Sie zuerst Produkte in der Produktauswahl an."),void(t&&t.classList.add("view-hidden"));const l=lH?await Gj(lH.getBounds().getCenter()):"Standort";let c=l.split(",")[0].trim();if(c=c.replace(/^\d{5}\s+/,""),!c||/^\d+$/.test(c)){const e=l.split(",");c=e[1]?e[1].trim():"Standort"}(!c||c.length<2)&&(c="Standort");(new Date).toISOString().split("T")[0];const u={KOMMUNE:c,AMT:"Amt fr ffentliche Sicherheit",STRASSEN_PLANGEBIET:l,VERFAHRENSNR:`V-${(new Date).getFullYear()}-${String(Math.floor(1e3*Math.random())).padStart(3,"0")}`,VERGABEART:"UVgO Liefer-/Dienstleistung",LOS_NR:["1"],KOSTENSTELLE:"KST-001",ANSPRECHPARTNER:"Mustermann, Max",KONTAKT:"max.mustermann@kommune.de, Tel: 0231/123-456",DATUM_STAND:(new Date).toLocaleDateString("de-DE")},h=window.planningState||{},d={veranstaltung:h.schutzgter||"ffentliche Veranstaltung",zeitraum:"Nach Vereinbarung",aufbau_ab:(new Date).toLocaleDateString("de-DE"),abbau_bis:new Date(Date.now()+2592e6).toLocaleDateString("de-DE"),erwartete_besucher:h.erwarteteBesucher||"variabel",rettungswege:"gem DIN 18040"},f=new Map;a.forEach(e=>{if(!f.has(e.entryId)){const t=dH.get(e.entryLabel);f.set(e.entryId,{id:e.entryId,strasse_platz:e.entryLabel,nutzungsprofil:"residential"===(null==t?void 0:t.roadType)?"Anlieferung/Anwohner":"Hauptzufahrt",freihaltebreite:4.5,radien:6,"lngsgeflle":2,untergrund:"Asphalt/Beton",medien_leitungslage:"keine bekannt",fluchtwegbezug:"ja",rettungsdienst:!0,"rumfahrzeugbedarf":!0})}});const p=Array.from(f.values()),g=new Map;let m;if(a.forEach(e=>{var t,n;const i=e.raw||{},r=i.technical_data||{},s="K12"===i.pr_veh?6800:"N2"===i.pr_veh?3500:2e3,o=e.requiredSpeedKmh/3.6,a=.5*s*o*o/1e3;g.set(e.entryId,{fahrzeugklasse:i.pr_veh||r.vehicle_type||"K12",anprallgeschwindigkeit:e.requiredSpeedKmh,anprallenergie:Math.round(a),penetration:r.penetration||i.penetration||.5,restfahrzeuggeschwindigkeit:Math.round(.3*e.requiredSpeedKmh),"ffnungsart":(null==(t=i.type)?void 0:t.includes("motor"))||(null==(n=i.type)?void 0:n.includes("automatic"))?"motorisch":"manuell",durchfahrtsbreite:r.clear_width||4,notentriegelung:!0,schliesssystem:"Profilzylinder",wartung:"jhrlich"})}),n&&lH)try{eH&&eH.closePopup();const e=document.querySelectorAll(".leaflet-popup-pane, .leaflet-tooltip-pane"),t=[];e.forEach(e=>{t.push(e.style.display),e.style.display="none"}),n.classList.remove("view-hidden"),await new Promise(e=>setTimeout(e,500));m=(await html2canvas(n,{useCORS:!0,backgroundColor:"#ffffff",scale:1,width:n.offsetWidth,height:n.offsetHeight})).toDataURL("image/png"),n.classList.add("view-hidden"),e.forEach((e,n)=>{e.style.display=t[n]||""})}catch(dy){}const{createTenderPdf:y}=await s(async()=>{const{createTenderPdf:e}=await Promise.resolve().then(()=>XV);return{createTenderPdf:e}},void 0),v=await y(u,d,p,g,a,m);n.classList.add("view-hidden"),i&&i.classList.remove("view-hidden");const _=v.output("blob");TH&&URL.revokeObjectURL(TH),TH=URL.createObjectURL(_),e&&(e.src=TH),SH=v,r&&(r.disabled=!1)}catch(o){alert("Fehler bei der Erstellung der Ausschreibung")}finally{t&&t.classList.add("view-hidden")}}function CW(){var e;const t=document.getElementById("toggle-parameter-bubble"),n=document.getElementById("parameter-bubble"),i=document.getElementById("parameter-strip"),r=document.getElementById("nav-param-input"),s=document.getElementById("tab-param-input");if(!n||!i)return void setTimeout(()=>CW(),1e3);let o=null;t&&(o=t.cloneNode(!0),null==(e=t.parentNode)||e.replaceChild(o,t));const a=e=>{const t=null==o?void 0:o.querySelector("i");t&&(t.className=e?"fas fa-chevron-left":"fas fa-chevron-right");const n=i.querySelector("i.fa-chevron-right, i.fa-chevron-left");n&&(n.className=e?"fas fa-chevron-left":"fas fa-chevron-right")},l=()=>{n.style.transform="translateX(-100%)",n.style.opacity="0",setTimeout(()=>{n.style.visibility="hidden"},300),i.style.display="block",i.style.visibility="visible",i.style.opacity="1",a(!1)},c=()=>{n.style.visibility="visible";const e=document.getElementById("hazard-analysis-bubble"),t=document.getElementById("hazard-analysis-strip");e&&t&&(e.style.transform="translateX(-100%)",e.style.opacity="0",setTimeout(()=>{e.style.visibility="hidden"},300),t.style.display="block",t.style.visibility="visible",t.style.opacity="1"),n.style.transform="translateX(0)",n.style.opacity="1",i.style.display="block",i.style.visibility="visible",i.style.opacity="1",a(!0)};o&&o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t="block"===i.style.display||"none"!==window.getComputedStyle(i).display,r="1"===n.style.opacity||"1"===window.getComputedStyle(n).opacity;t&&!r?c():l()}),i.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t="block"===i.style.display||"none"!==window.getComputedStyle(i).display,r="1"===n.style.opacity||"1"===window.getComputedStyle(n).opacity;t&&!r?c():l()});const u=e=>{e.preventDefault(),c()};r&&r.addEventListener("click",u),s&&s.addEventListener("click",u),l(),a(!1);const h=()=>{n.style.setProperty("transform","translateX(0px)","important"),n.style.setProperty("opacity","1","important"),n.style.setProperty("visibility","visible","important"),i.style.display="none",n.classList.add("parameter-expanded"),n.classList.remove("parameter-collapsed")};window.expandParameterMenu=h,window.debugParameterMenu=()=>{h()},function(e){const t=e.querySelector('div[style*="cursor: move"]');if(!t)return;let n,i,r,s,o=!1,a=0,l=0;function c(e){r=e.clientX-a,s=e.clientY-l,(e.target===t||t.contains(e.target))&&(o=!0,t.style.cursor="grabbing")}function u(t){if(o){t.preventDefault(),n=t.clientX-r,i=t.clientY-s,a=n,l=i;const o=e.getBoundingClientRect(),c=window.innerWidth-o.width,u=window.innerHeight-o.height;a=Math.max(0,Math.min(c,a)),l=Math.max(0,Math.min(u,l)),e.style.transform=`translate(${a}px, ${l}px)`}}function h(){r=n,s=i,o=!1,t.style.cursor="move"}t.addEventListener("mousedown",c),document.addEventListener("mousemove",u),document.addEventListener("mouseup",h)}(n)}function IW(){var e;const t=document.getElementById("toggle-hazard-analysis-bubble"),n=document.getElementById("hazard-analysis-bubble"),i=document.getElementById("hazard-analysis-strip"),r=document.getElementById("nav-hazard-analysis"),s=document.getElementById("tab-hazard-analysis");if(!n||!i)return void setTimeout(()=>IW(),1e3);let o=null;t&&(o=t.cloneNode(!0),null==(e=t.parentNode)||e.replaceChild(o,t));const a=e=>{const t=null==o?void 0:o.querySelector("i");t&&(t.className=e?"fas fa-chevron-left":"fas fa-chevron-right");const n=i.querySelector("i.fa-chevron-right, i.fa-chevron-left");n&&(n.className=e?"fas fa-chevron-left":"fas fa-chevron-right")},l=()=>{n.style.transform="translateX(-100%)",n.style.opacity="0",setTimeout(()=>{n.style.visibility="hidden"},300),i.style.display="block",i.style.visibility="visible",i.style.opacity="1",a(!1)},c=()=>{n.style.visibility="visible";const e=document.getElementById("parameter-bubble"),t=document.getElementById("parameter-strip");e&&t&&(e.style.transform="translateX(-100%)",e.style.opacity="0",setTimeout(()=>{e.style.visibility="hidden"},300),t.style.display="block",t.style.visibility="visible",t.style.opacity="1"),n.style.transform="translateX(0)",n.style.opacity="1",i.style.display="block",i.style.visibility="visible",i.style.opacity="1",a(!0)};o&&o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t="block"===i.style.display||"none"!==window.getComputedStyle(i).display,r="1"===n.style.opacity||"1"===window.getComputedStyle(n).opacity;t&&!r?c():l()}),i.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t="block"===i.style.display||"none"!==window.getComputedStyle(i).display,r="1"===n.style.opacity||"1"===window.getComputedStyle(n).opacity;t&&!r?c():l()});const u=e=>{e.preventDefault(),c()};r&&r.addEventListener("click",u),s&&s.addEventListener("click",u),l()}function kW(){const e=document.getElementById("parameter-bubble"),t=document.getElementById("parameter-strip"),n=document.getElementById("nav-param-input"),i=document.getElementById("tab-param-input");if(!(e&&t&&n&&i))return void setTimeout(()=>kW(),2e3);const r=()=>{e.style.setProperty("transform","translateX(0px)","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("visibility","visible","important"),t.style.display="none"},s=()=>{e.style.setProperty("transform","translateX(-100%)","important"),e.style.setProperty("opacity","0","important"),t.style.display="block"},o=n.cloneNode(!0),a=i.cloneNode(!0),l=t.cloneNode(!0);n.parentNode&&n.parentNode.replaceChild(o,n),i.parentNode&&i.parentNode.replaceChild(a,i),t.parentNode&&t.parentNode.replaceChild(l,t),o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),r()}),a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),r()}),l.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),r()}),window.emergencyExpandMenu=r,window.emergencyCollapseMenu=s,window.emergencyParameterMenuActive=!0,s()}function RW(){if(!vH)return;const e=document.getElementById("osm-maxspeed"),t=document.getElementById("osm-traffic-calming"),n=document.getElementById("osm-surface"),i=document.getElementById("weather-select"),r={useMaxspeed:(null==e?void 0:e.checked)??!0,useTrafficCalming:(null==t?void 0:t.checked)??!0,useSurface:(null==n?void 0:n.checked)??!1,weather:(null==i?void 0:i.value)??"dry"};vH.updateConfig(r)}function PW(){const e=document.getElementById("osm-maxspeed"),t=document.getElementById("osm-traffic-calming"),n=document.getElementById("osm-surface");return(null==e?void 0:e.checked)||(null==t?void 0:t.checked)||(null==n?void 0:n.checked)}function MW(){EH&&clearTimeout(EH),EH=window.setTimeout(()=>{!async function(){var e,t,n;if(!lH||!vH||!PW())return;try{const o=lH.getLatLngs()[0].map(e=>({lat:e.lat,lng:e.lng}));if(o.length<3)return void LW("error","Polygon zu klein");const a=`${(null==(e=document.getElementById("osm-maxspeed"))?void 0:e.checked)?"M":""}${(null==(t=document.getElementById("osm-traffic-calming"))?void 0:t.checked)?"C":""}${(null==(n=document.getElementById("osm-surface"))?void 0:n.checked)?"S":""}`,l=nc.getKey(o,a),c=nc.get(l);if(c)return _H=c,vH.setOsmData(c),void LW("success",`${c.ways.length} Straen, ${c.calming.length} Verkehrsberuhiger`);LW("loading","Lade OSM-Daten..."),bH&&bH.abort(),bH=new AbortController;try{let e;try{const{fetchOsmDataWithProvider:t}=await s(async()=>{const{fetchOsmDataWithProvider:e}=await import("./indexIntegration-BWW4NxPp.js");return{fetchOsmDataWithProvider:e}},__vite__mapDeps([0,1,2,3,4,5,6]));e=await t(o,bH.signal);const{getCurrentProviderId:n}=await s(async()=>{const{getCurrentProviderId:e}=await import("./mapIntegration-Gh_eCX7z.js");return{getCurrentProviderId:e}},[]);n()}catch(i){e=await tc(o,bH.signal)}nc.set(l,e),_H=e,vH.setOsmData(e)}catch(r){return void LW("error",r instanceof Error?r.message:"Fehler beim Laden der OSM-Daten")}_H.ways.filter(e=>e.tags.maxspeed).length;LW("success",`${_H.ways.length} Straen, ${_H.calming.length} Verkehrsberuhiger`)}catch(r){if("AbortError"===r.name)return;LW("error","OSM-Daten nicht verfgbar")}}()},300)}function LW(e,t){const n=document.getElementById("osm-status"),i=null==n?void 0:n.querySelector(".status-text");n&&i&&(n.className=`osm-status ${e}`,n.style.display="flex",i.textContent=t,"loading"!==e&&setTimeout(()=>{n.classList.contains(e)&&(n.style.display="none")},5e3))}function BW(e,t,n){const i=Cj(e,t);if(vH&&_H&&n&&n.length>0){let e=i;const t=Math.min(10,n.length),r=Math.max(1,Math.floor(n.length/t));for(let s=0;s<n.length;s+=r){const t=n[s],r=vH.getConstraintsAt(t);let o;if(s>0&&s<n.length-1){const e=n[s-1],i=n[s+1],r=Math.atan2(t.lat-e.lat,t.lng-e.lng),a=Math.atan2(i.lat-t.lat,i.lng-t.lng),l=Math.abs(a-r);l>.01&&(o=1/l*1e3)}const a=vH.applyConstraints(i,r,o);e=Math.min(e,a)}return e}return i}function NW(e){const t=window.entryDetectionManager;if(!t||!t.candidates||0===t.candidates.length)return;const n=document.createElement("li");n.className="entry-detection-header",n.style.cssText="\n        background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(74, 222, 128, 0.05));\n        border-left: 4px solid #4ade80;\n        font-weight: 600;\n        color: #4ade80;\n        margin-top: 16px;\n        padding: 12px 16px;\n        border-radius: 8px;\n        cursor: default;\n    ",n.innerHTML=`\n        <i class="fas fa-door-open" style="margin-right: 8px;"></i>\n        Zufahrtserkennung (${t.candidates.length} gefunden)\n    `,e.appendChild(n);const i=window.currentOsmData,r=new Map;i&&i.ways&&i.ways.forEach(e=>{r.set(e.id,e)}),t.candidates.forEach((t,n)=>{let i=!1;if(t.wayIds&&t.wayIds.length>0)for(const e of t.wayIds){const t=r.get(e);if(t&&$j(t)){i=!0;break}}const s=document.createElement("li");s.className="entry-candidate-item";const o=t.confidence>=.7?"#4ade80":t.confidence>=.4?"#fbbf24":"#f87171",a=i?"#FFD700":o;s.style.cssText=`\n            background: rgba(255, 255, 255, 0.05);\n            border-left: 3px solid ${a};\n            margin: 4px 0;\n            padding: 12px 16px;\n            border-radius: 6px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        `,s.innerHTML=`\n            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">\n                <span style="font-weight: 600; color: white;">\n                    ${i?"":""} Zufahrt ${n+1} ${i?"(Erschlieung)":""}\n                </span>\n                <span style="background: rgba(255, 255, 255, 0.2); padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; color: ${o};">\n                    ${Math.round(100*t.confidence)}% Confidence\n                </span>\n            </div>\n            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; font-size: 11px; color: #ccc;">\n                <div>\n                    <div style="color: #aaa; font-size: 10px; margin-bottom: 2px;">Distanz:</div>\n                    <div style="font-weight: 600; color: white;">${Math.round(t.distanceMeters)}m</div>\n                </div>\n                <div>\n                    <div style="color: #aaa; font-size: 10px; margin-bottom: 2px;">Geradheit:</div>\n                    <div style="font-weight: 600; color: white;">${Math.round(100*t.straightness)}%</div>\n                </div>\n                <div>\n                    <div style="color: #aaa; font-size: 10px; margin-bottom: 2px;">Kontinuitt:</div>\n                    <div style="font-weight: 600; color: white;">${Math.round(100*t.continuity)}%</div>\n                </div>\n            </div>\n        `,s.addEventListener("mouseenter",()=>{s.style.background="rgba(255, 255, 255, 0.1)",s.style.transform="translateX(4px)"}),s.addEventListener("mouseleave",()=>{s.style.background="rgba(255, 255, 255, 0.05)",s.style.transform="translateX(0)"}),s.addEventListener("click",()=>{}),e.appendChild(s)})}function OW(){const e=document.querySelector("#chatbot-react-root h2");e&&(e.textContent=ij("ai.chatbot.title"));const t=document.querySelector("#chatbot-react-root .message:first-child .message-content");t&&(t.textContent=ij("ai.chatbot.welcome"));const n=document.querySelector("#chatbot-react-root .message:nth-child(2) .message-content");n&&(n.textContent=ij("ai.chatbot.assetQuestion"));const i=document.querySelector('#chatbot-react-root input[type="text"]');i&&(i.placeholder=ij("ai.chatbot.inputPlaceholder"));const r=document.querySelector('#chatbot-react-root button[type="submit"]');r&&(r.textContent=ij("ai.chatbot.sendButton"))}function DW(e){const t=document.getElementById(e);if(!t)return[];const n=t.querySelectorAll('input[type="checkbox"]:checked');return Array.from(n).map(e=>e.value)}function FW(){var e;if(!KH)return;const t=function(){const e=DW("vehicle-mass-content"),t=DW("standards-content"),n=DW("foundation-content"),i=DW("operation-content"),r=DW("deployment-content"),s=DW("categories-content"),o=document.getElementById("min-speed"),a=document.getElementById("max-speed"),l=document.getElementById("min-angle"),c=document.getElementById("max-angle"),u=document.getElementById("min-distance"),h=document.getElementById("max-distance"),d=document.getElementById("manufacturer-select");return{vehicleMass:e,impactSpeed:{min:o&&parseInt(o.value)||16,max:a&&parseInt(a.value)||112},impactAngle:{min:l&&parseInt(l.value)||15,max:c&&parseInt(c.value)||90},penetrationDistance:{min:u&&parseFloat(u.value)||0,max:h&&parseFloat(h.value)||60},standard:t,foundation:n,operation:i,deployment:r,category:s,manufacturer:(null==d?void 0:d.value)||""}}(),n=window.productDatabase||[];if(!n||0===n.length)return;const i=(null==(e=document.getElementById("product-search"))?void 0:e.value.toLowerCase().trim())||"";let r=function(e,t){const n=t.vehicleMass&&t.vehicleMass.length>0,i=t.standard&&t.standard.length>0,r=t.foundation&&t.foundation.length>0,s=t.deployment&&t.deployment.length>0,o=t.category&&t.category.length>0,a=t.manufacturer&&""!==t.manufacturer,l=t.impactSpeed&&(t.impactSpeed.min>16||t.impactSpeed.max<112),c=t.impactAngle&&(t.impactAngle.min>15||t.impactAngle.max<90),u=t.penetrationDistance&&(t.penetrationDistance.min>0||t.penetrationDistance.max<60);if(!(n||i||r||s||o||a||l||c||u))return e;return e.filter(e=>{const h=e.technical_data||{};if(n){const e=h.pr_mass_kg,n=h.pr_veh;if(e&&n){if(!t.vehicleMass.some(t=>{const[i,r]=t.split(" "),s=parseInt(i);return e===s&&n===r.replace(/[\[\]]/g,"")}))return!1}}if(l){const e=h.pr_speed_kph;if(e&&(e<t.impactSpeed.min||e>t.impactSpeed.max))return!1}if(c){const e=h.pr_angle_deg;if(e&&(e<t.impactAngle.min||e>t.impactAngle.max))return!1}if(u){const e=h.pr_pen_m;if(e&&(e<t.penetrationDistance.min||e>t.penetrationDistance.max))return!1}if(i){const e=h.standard;if(e&&!t.standard.some(t=>e.includes(t)||t.includes(e)))return!1}if(r){const e=h.foundation_depth;if(e&&!t.foundation.includes(e))return!1}if(o){const n=e.product_type;if(n&&!t.category.includes(n))return!1}if(s){const e=t.deployment.includes("temporary"),n=t.deployment.includes("permanent"),i="A - Free standing (no ground fixings)"===h.foundation_depth;if(e&&n);else if(e&&!n&&!i)return!1}return!a||e.manufacturer===t.manufacturer})}(n,t);if(i){const e=YH(i);r.length;r=r.filter(t=>{var n,r;const s=YH(t.product_name||""),o=YH(t.manufacturer||""),a=YH((null==(n=t.technical_data)?void 0:n.standard)||""),l=YH(t.product_type||""),c=YH(t.product_cluster||""),u=(t.product_name||"").toLowerCase(),h=(t.manufacturer||"").toLowerCase(),d=((null==(r=t.technical_data)?void 0:r.standard)||"").toLowerCase();return s.includes(e)||o.includes(e)||a.includes(e)||l.includes(e)||c.includes(e)||u.includes(i)||h.includes(i)||d.includes(i)})}GH(r)}window.calculateVehicleDynamicsTable=bW,window.getEnergyClassificationSummary=EW,window.buildHazardAssessmentSummary=wW,window.toggleRangeInput=function(e){const t=document.getElementById(`${e}-content`),n=document.getElementById(`${e}-icon`);if(t&&n){"none"!==t.style.display?(t.style.display="none",n.classList.remove("expanded")):(t.style.display="block",n.classList.add("expanded"))}},window.toggleDropdown=function(e){const t=document.getElementById(`${e}-content`),n=document.getElementById(`${e}-icon`);if(t&&n){"none"!==t.style.display?(t.style.display="none",n.classList.remove("expanded")):(t.style.display="block",n.classList.add("expanded"))}},document.addEventListener("DOMContentLoaded",()=>{KV(),JV(),document.querySelectorAll(".logo-img, .welcome-logo").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),QV()}),e.style.cursor="pointer"}),function(){const e=document.getElementById("edit-threats-btn"),t=document.getElementById("minimize-threats-btn"),n=document.getElementById("close-threats-btn"),i=document.getElementById("floating-threats");e&&e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),Rj()}),t&&i&&t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),i.classList.toggle("minimized");const n=i.classList.contains("minimized"),r=i.querySelector(".threat-panel-content");r&&(n?(r.style.maxHeight="0",r.style.opacity="0",r.style.padding="0",r.style.margin="0",r.style.overflow="hidden"):(r.style.maxHeight="",r.style.opacity="",r.style.padding="",r.style.margin="",r.style.overflow="")),t.title=ij(n?"threats.maximize":"threats.minimize");const s=t.querySelector("i");s&&(s.className=n?"fas fa-plus":"fas fa-minus")}),n&&i&&n.addEventListener("click",()=>{i.classList.add("view-hidden"),bj()})}()});export{_e as R,s as _,ic as o};
