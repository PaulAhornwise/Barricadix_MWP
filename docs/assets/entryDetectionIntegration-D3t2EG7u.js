const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/osmProvider-DAm3X9iX.js","assets/main-DVnnv9of.js","assets/main-ez1ojIn0.css"])))=>i.map(i=>d[i]);
import{_ as r}from"./main-DVnnv9of.js";import{getCurrentMapBbox4326 as t,pickProvider as o}from"./index-Cv7S1VUF.js";import{simplePolygonHash as e,cacheKey as n,geoCache as a}from"./provider-DtzApHY_.js";import"./nrwProvider-DIf7VFJk.js";import"./osmProvider-DAm3X9iX.js";async function i(i){var s;try{const w=function(r){const t=r.map(r=>[r.lng,r.lat]);if(t.length>0){const r=t[0],o=t[t.length-1];r[0]===o[0]&&r[1]===o[1]||t.push([r[0],r[1]])}return{type:"Feature",geometry:{type:"Polygon",coordinates:[t]},properties:{}}}(i),m=e(w),f=window.map;if(!f)throw new Error("Map instance not available for provider selection");const l=t(f);let h=await o(l);if("nrw"===h.id){if(!(await async function(){try{const r=new AbortController,t=setTimeout(()=>r.abort(),3e3),o=await fetch("http://localhost:3001/health",{method:"GET",signal:r.signal});return clearTimeout(t),o.ok}catch{return!1}}())){const{osmProvider:t}=await r(async()=>{const{osmProvider:r}=await import("./osmProvider-DAm3X9iX.js");return{osmProvider:r}},__vite__mapDeps([0,1,2]));h=t}}const p=n(h.id,m),u=a.get(p);if(u)return u;let v,y=!1;try{if(v=await h.fetchRoadNetwork(w),!v||!Array.isArray(v.nodes)||!Array.isArray(v.ways))throw new Error(`Invalid bundle structure from ${h.id} provider`);if("nrw"===h.id&&0===v.ways.length)throw new Error("NRW returned no features");if(v.ways.length>0){const r=new Map;for(const t of v.ways){const o=(null==(s=t.tags)?void 0:s.highway)||"unknown";r.set(o,(r.get(o)||0)+1)}}}catch(c){if("osm"===h.id)throw c;{const{osmProvider:t}=await r(async()=>{const{osmProvider:r}=await import("./osmProvider-DAm3X9iX.js");return{osmProvider:r}},__vite__mapDeps([0,1,2]));try{v=await t.fetchRoadNetwork(w),y=!0;const r=n("osm",m);a.set(r,v)}catch(d){throw new Error(`Both ${h.id} and OSM providers failed. Last error: ${d instanceof Error?d.message:"Unknown error"}`)}}}return y||a.set(p,v),y&&function(r,t){const o=document.querySelector(".toast-container");if(o){const e=document.createElement("div");e.className="toast toast-warning",e.textContent=`${r.toUpperCase()} Daten nicht verfügbar – ${t.toUpperCase()} verwendet.`,o.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},5e3)}}(h.id,"osm"),v}catch(c){throw new Error(`Road network fetch failed: ${c instanceof Error?c.message:"Unknown error"}`)}}export{i as fetchRoadNetworkForPolygon};
